"use strict";function getLogger(n,t){var i=new bUlsCache(n,t);return{ULS:{trace:function(n,t,r){return traceTagImpl(i,0,n,t,r)},traceTag:function(n,t,r,u){return traceTagImpl(i,n,t,r,u)},flush:i.flush,flushOnClose:i.flushOnClose}}}function traceTagImpl(n,t,i,r,u){if(!(r>currentLevel)){var f={timestamp:Date.now(),category:i,tag:t,level:r,type:logType.Trace,message:u};n.handleTrace(f)}}function formatForUpload(n,t,i,r){var u=n.map(function(n){return getLogEntryInWireFormat(n,r)}),f=getLogBatchInWireFormat(r,u,t,i);return JSON.stringify(f)}function getLogEntryInWireFormat(n,t){var i={},r;return i.G=n.tag,i.T=n.timestamp-t,i.M=n.message,i.C=n.category,r=n.type*shiftFactory+n.level,i.D=r,i}function getLogBatchInWireFormat(n,t,i,r){var u={};return u.T=n,u.L=t,u.S=i,u.I=r,u.V=1,u}function uploadLogs(n,t,i){if(t!==""){var r=new XMLHttpRequest;(r.readyState===XMLHttpRequest.UNSENT||r.readyState===XMLHttpRequest.DONE)&&(r.open("POST",t,i),r.send(n))}}var logLevel,ULS,currentLevel,bUlsCache,shiftFactory,logCategory,logType,PowerPointOnline;(function(n){n[n.Spam=200]="Spam";n[n.Verbose=100]="Verbose";n[n.Info=50]="Info";n[n.Warning=15]="Warning";n[n.Error=10]="Error"})(logLevel||(logLevel={}));ULS={getLogger:getLogger};currentLevel=logLevel.Info;bUlsCache=function(){function n(t,i){var r=this;this.uploadId=0;this.logCache=[];this.timestampBase=Date.now();this.userSessionId="00000000-0000-0000-0000-000000000000";this.flushOnClose=function(){r.triggerUpload(!1,!1)};this.flush=function(){r.triggerUploadAsync()};this.triggerUploadAsync=function(){window.setTimeout(function(){return r.triggerUpload(!0,!0)},0)};this.triggerUpload=function(t,i){if(window.clearTimeout(r.timeoutId),r.logCache.length>0){r.uploadId+=1;var u=formatForUpload(r.logCache,r.userSessionId,r.uploadId,r.timestampBase);uploadLogs(u,r.remoteUrlEndpoint,i);r.logCache=[];r.timestampBase=Date.now()}t&&(r.timeoutId=window.setTimeout(r.triggerUploadAsync,n.uploadCadenceInMsSec))};this.userSessionId=t;this.remoteUrlEndpoint=i+"?usid="+t;window.setTimeout(function(){return r.triggerUpload(!0,!0)},0)}return n.prototype.handleTrace=function(t){t.message.length>n.messageMaxChars&&(t.message=t.message.substr(0,n.messageMaxChars-n.trimedMessage.length)+n.trimedMessage);this.logCache.push(t);(this.logCache.length>n.uploadTriggerSize||t.level===logLevel.Error)&&this.triggerUploadAsync()},n.messageMaxChars=3072,n.uploadCadenceInMsSec=3e4,n.uploadTriggerSize=30,n.trimedMessage="... [Trimmed]",n}();shiftFactory=1e3,function(n){n[n.WordViewer=301]="WordViewer";n[n.WopiPendingApplication=379]="WopiPendingApplication";n[n.VisioApp=700]="VisioApp";n[n.PptNavigation=810]="PptNavigation";n[n.PptSession=817]="PptSession";n[n.PptVersionHistory=832]="PptVersionHistory";n[n.PptLive=833]="PptLive"}(logCategory||(logCategory={})),function(n){n[n.Trace=0]="Trace";n[n.Assert=1]="Assert"}(logType||(logType={})),function(n){var t;(function(n){var r=function(){function n(){}return n.prototype.trace=function(n,t,i){this.traceTag(0,n,t,i)},n.prototype.traceTag=function(n,t,i,r){var u=null;switch(i){case logLevel.Verbose:u=console.debug;break;case logLevel.Info:u=console.log;break;case logLevel.Warning:case logLevel.Error:u=console.error;break;default:u=console.error}u(r)},n}(),t,i;n.ConsoleSessionLogger=r;t=function(){function n(n,t){try{this.logger=ULS.getLogger(n,t+"RemoteUls.ashx")}catch(i){}}return n.prototype.trace=function(n,t,i){this.logger!=null&&this.logger.ULS.trace(n,t,i)},n.prototype.traceTag=function(n,t,i,r){this.logger!=null&&this.logger.ULS.traceTag(n,t,i,r)},n.prototype.flush=function(){this.logger!=null&&this.logger.ULS.flush()},n.prototype.flushOnClose=function(){this.logger!=null&&this.logger.ULS.flushOnClose()},n}();n.UlsSessionLogger=t;i=function(){function n(){}return n.init=function(n){this.logger=n},n.trace=function(n,t,i){this.logger!=null&&this.logger.trace(n,t,i)},n.traceTag=function(n,t,i,r){this.logger!=null&&this.logger.traceTag(n,t,i,r)},n}();n.SessionLogger=i})(t=n.Telemetry||(n.Telemetry={}))}(PowerPointOnline||(PowerPointOnline={}));"use strict";function createFeatureManager(n,t){return{isFeatureEnabled:function(i){return isFeatureEnabledInternal(i,n,t)}}}function isFeatureEnabledInternal(n,t,i){if(!t)return undefined;try{return t(n)}catch(r){i&&i.ULS.traceTag(591923268,logCategory.WopiPendingApplication,logLevel.Error,"Host encountered error in featuremanager callback: "+r)}return undefined}var __assign=this&&this.__assign||function(){return __assign=Object.assign||function(n){for(var t,r,i=1,u=arguments.length;i<u;i++){t=arguments[i];for(r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},__assign.apply(this,arguments)},__extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),Configuration=function(){function n(){}return n.HostCallbackTimeout=6e4,n}(),BuildVersionConfig=function(){function n(){}return Object.defineProperty(n,"BUILD_NUMBER",{get:function(){return"16.0.13309.36626"},enumerable:!0,configurable:!0}),Object.defineProperty(n,"BUILD_NUMBER_MINOR",{get:function(){return 1330936626},enumerable:!0,configurable:!0}),Object.defineProperty(n,"BUILD_CDN_NUMBER",{get:function(){return"161330936626"},enumerable:!0,configurable:!0}),n}(),BrowserUtils=function(){function n(){}return n.IsIPad=function(){return window.navigator.userAgent.indexOf("iPad")>=0},n.IsIPhone=function(){return window.navigator.userAgent.indexOf("iPhone")>=0},n.IsAndroid=function(){return window.navigator.userAgent.indexOf("Android")>=0},n.IsAndroidMobilePhone=function(){if(!n.IsAndroid())return!1;var t=window.navigator.userAgent.toLowerCase(),i=new RegExp("android.+mobile");return i.test(t)},n.IsMobile=function(){return n.IsIPad()||n.IsAndroid()},n.SupportsNewMobileWebExp=function(){return n.IsIPhone()||n.IsAndroidMobilePhone()},n.MaxTouchPoints=function(){var n=window.navigator.maxTouchPoints||window.navigator.msMaxTouchPoints;return n&&!isNaN(n)?n:0},n.SupportPreloadLink=function(){return n.GetChromeVersion()>=50},n.GetChromeVersion=function(){var n=window.navigator.userAgent.toLowerCase(),t;if(n.indexOf("chrome/")>=0&&(t=n.indexOf("chrome/"),t>=0)){var i=t+7,r=n.indexOf(".",i),u=n.substring(i,r);return+u}return 0},n.SupportsTouch=function(){return n.IsMobile()||n.MaxTouchPoints()>0},n.DevicePixelRatio=function(){return window.devicePixelRatio||(window.screen?window.screen.deviceXDPI/window.screen.logicalXDPI:1)||1},n.IsRibbonMinimized=function(){var t=""+document.cookie;return t.indexOf(n.EditRibbonMinimizedCookieName+"=true")>=0},n.BrowserSupportsRenderingSVGInWebGL=function(){var u=!1,t,i,r;if(!n.iOS9OrOlderDetected()&&!n.IsSafariAtLeast(1))try{t=document.createElement("canvas");(t.getContext("webgl")||document.createElement("canvas").getContext("experimental-webgl"))&&(i=document.createElement("canvas").getContext("2d"),i&&(r=document.createElement("img"),r.src="data:image/svg+xml;charset=utf8,%3Csvg xmlns='http://www.w3.org/2000/svg'%3E%3C/svg%3E",i.drawImage(r,0,0,10,10),t.toDataURL("image/png"),u=!0))}catch(f){}return u},n.IsSafariAtLeast=function(n){var t=window.navigator.userAgent.toLowerCase(),i,r,u;return t.indexOf(" applewebkit/")>-1&&t.indexOf("edge/")<0&&(i=t.indexOf("version/"),i>=0)?(r=i+8,u=t.length,parseInt(t.substring(r,u))>=n):!1},n.iOS9OrOlderDetected=function(){var n=window.navigator.userAgent.toLowerCase(),r,t,i;return(n.indexOf("iphone")!=-1||n.indexOf("ipad")!=-1||n.indexOf("ipod")!=-1)&&(r=new RegExp("os (\\d+)_"),t=r.exec(n),t&&t.length>=2)?(i=parseInt(t[1]),!isNaN(i)&&i<=9):!1},n.EditRibbonMinimizedCookieName="WACRibbonMinimizedPPT",n}(),HTMLHelper=function(){function n(){}return n.toPx=function(n){return isNaN(n)?"":n.toString()+"px"},n.floatToPercent=function(n){return(n*100).toString()+"%"},n}(),PPTApplication=function(){function n(n,t,i,r,u,f){this.eventHandlers={};this.m_disposeTelemetry={};this.c_wacFrameUnloadTimeoutInMs=1e3;this.m_unloading=!1;this.m_disposed=!1;this.m_sessionId=n;this.m_disposeCallback=t;this.m_frame=i;this.m_logger=r;this.m_postMessenger=f;this.m_postMessenger.RegisterMessagePayloadHandler("App_Unloaded",this.handleAppUnloaded.bind(this));this.m_postMessenger.RegisterMessagePayloadHandler("App_DocReboot",this.handleAppDocReboot.bind(this));this.m_postMessenger.RegisterMessagePayloadHandler("App_CreateNewDocument",this.handleAppCreateNewDocument.bind(this));u&&this.m_postMessenger.RegisterMessagePayloadHandler("App_AccessibilityLoopComplete",this.handleAccessibilityLoopComplete.bind(this))}return n.prototype.GetApplicationType=function(){return"PowerPoint"},n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.prototype.GetSessionId=function(){return this.m_sessionId},n.prototype.RegisterEventHandler=function(n,t){if(n!==undefined){if(this.eventHandlers[n])throw new Error("Duplicate registration");this.eventHandlers[n]=t}},n.prototype.RemoveEventHandler=function(n,t){this.eventHandlers[n]!==t&&delete this.eventHandlers[n]},n.prototype.RegisterErrorHandler=function(n){n!==undefined&&(this.errorHandler=n);throw Error("Not Implemented");},n.prototype.RemoveErrorHandler=function(n){n!==undefined&&delete this.errorHandler;throw Error("Not Implemented");},n.prototype.TriggerDocReboot=function(n){this.raiseEvent("DocReboot",n)},n.prototype.Dispose=function(n){if(!this.m_disposed&&(!this.m_unloading||!n))if(this.m_disposeTelemetry.DisposeStart=Date.now(),n){if(this.m_unloading=!0,this.m_disposeTelemetry.HostUnloadSent=Date.now(),!this.m_frame||!this.m_frame.contentWindow)throw Error("null frame or window");this.m_postMessenger.SendPostMessage(this.m_frame.contentWindow,"Host_Unload",{});window.setTimeout(this.handleApplicationUnloadTimeout.bind(this),this.c_wacFrameUnloadTimeoutInMs);this.m_postMessenger&&this.m_postMessenger.Dispose()}else this.disposeInternal()},n.prototype.disposeInternal=function(){this.m_disposed||(this.m_disposed=!0,this.m_unloading=!1,this.m_disposeCallback&&this.m_disposeCallback(this.m_sessionId),this.raiseEvent("Unloaded",{}),this.m_disposeTelemetry.DisposeDone=Date.now(),this.m_disposeTelemetry.SessionId=this.m_sessionId,this.m_logger.ULS.traceTag(41710159,logCategory.WopiPendingApplication,logLevel.Info,JSON.stringify(this.m_disposeTelemetry)),delete this.eventHandlers,delete this.errorHandler)},n.prototype.handleAppUnloaded=function(n){this.m_disposeTelemetry.AppUnloadedReceived=Date.now();n&&(this.m_disposeTelemetry.WacDisposeTelemetry=n);this.disposeInternal()},n.prototype.handleApplicationUnloadTimeout=function(){(this.m_unloading||!this.m_disposed)&&(this.m_logger.ULS.traceTag(41710160,logCategory.WopiPendingApplication,logLevel.Warning,"Unload timed out"),this.m_disposeTelemetry.AppUnloadTimedout=Date.now());this.disposeInternal()},n.prototype.handleAccessibilityLoopComplete=function(n){window.parent!==window&&this.m_postMessenger.SendPostMessage(window.parent,"App_AccessibilityLoopComplete",n);this.raiseEvent("App_AccessibilityLoopComplete",n)},n.prototype.handleAppDocReboot=function(n){this.TriggerDocReboot(n)},n.prototype.handleAppCreateNewDocument=function(n){this.raiseEvent("App_CreateNewDocument",n)},n.prototype.raiseEvent=function(n,t){var i=this.eventHandlers[n];i&&i(t||{})},n}(),Dimensions=function(){function n(n,t){this.Width=n;this.Height=t}return n}(),SlideDimensionsHelper=function(){function n(){}return n.AdjustDimensionsForScrollbars=function(n,t,i,r){var u=new Dimensions(n.Width,n.Height),f=u.Width<t,e;return f&&(u.Height-=r),e=u.Height<i,e&&(u.Width-=r),!f&&u.Width<t&&(f=!0,u.Height-=r),u.Width=Math.max(u.Width,t),u.Height=Math.max(u.Height,i),u},n.GetAdjustedSlideDimensions=function(t,i){var r=i.Width,u=i.Height;return u-=n.EditNotesHeightPeek+1,r-=n.AreaWidth+1+n.DefaultScrollbarSize,n.CalculateAvailableSlideDimensions(new Dimensions(r,u),t)},n.CalculateAvailableSlideDimensions=function(t,i){var r=new Dimensions(t.Width-2*n.SlidePadding,t.Height-2*n.SlidePadding),u=new Dimensions(i.Width/2,i.Height/2),f=new Dimensions(i.Width*2,i.Height*2);return r.Width<u.Width?r.Width=u.Width:r.Width>f.Width&&(r.Width=f.Width),r.Height<u.Height?r.Height=u.Height:r.Height>f.Height&&(r.Height=f.Height),r},n.CalculateEditingAreaDimensions=function(){var t=n.AdjustDimensionsForScrollbars(new Dimensions(window.document.documentElement.clientWidth,window.document.documentElement.clientHeight-n.UnifiedHeaderHeight),n.EditAreaMinimumWidth,n.EditAreaMinimumHeight,n.DefaultScrollbarSize);return BrowserUtils.IsRibbonMinimized()||(t.Height-=BrowserUtils.SupportsTouch()?n.EditLowerRibbonHeightTouchPx:n.EditLowerRibbonHeightMousePx),t.Height-=n.EditDefaultRibbonHeight,t.Height-=n.StatusBarHeight,t},n.UnifiedHeaderHeight=50,n.EditAreaMinimumWidth=320,n.EditAreaMinimumHeight=256,n.DefaultScrollbarSize=17,n.EditDefaultRibbonHeight=30,n.EditLowerRibbonHeightMousePx=94,n.EditLowerRibbonHeightTouchPx=108,n.StatusBarHeight=23,n.EditNotesHeightPeek=32,n.AreaWidth=238,n.SlidePadding=10,n}(),QueryStringParamForwarder=function(){function n(){}return n.Forward=function(t,i){return!t||t.substr(0,2)!="wd"||n.noForwardArray.indexOf(t)>=0?null:t+"="+i},n.noForwardArray=["wdPodsUrl","wdPopsUrl","wdNewPodsFrame","wdNewEnabled","wdfs","wdfsection","wdIncludeHostUrl","wdoverrides"],n}(),UrlOverrideUtils=function(){function n(){}return n.UpdateOverride=function(n){for(var h,e,i,u,o,c,t,r="",l=window.location.search.substring(1,window.location.search.length).split("&"),f=0,s=l;f<s.length;f++)h=s[f],t=h.split("="),t[0]=="wdoverrides"&&(r=t[1]),e=QueryStringParamForwarder.Forward(t[0],t[1]),e&&(n+="&"+e);for(r=r||"",i=[],u=0,o=r.split(",");u<o.length;u++)(c=o[u],t=c.split(":"),t.length==2&&t[0].toLowerCase()!="devicepixelratio")&&i.push(t[0]+":"+t[1]);return i.push("devicepixelratio:"+BrowserUtils.DevicePixelRatio()),i.push("RenderGifSlideShow:true"),UrlUtils.addOrReplaceParameterValue(n,"wdoverrides",i.join(","))},n.ForwardMissingWdParamsFromApplicationUrl=function(n,t){var e=t.indexOf("?"),o,s,i,u,h,r,f;if(-1===e)return n;for(o=t.substr(e+1),s=o.split("&"),i=0,u=s;i<u.length;i++)h=u[i],r=h.split("="),UrlUtils.getParameterValue(n,r[0])==""&&(f=QueryStringParamForwarder.Forward(r[0],r[1]),f&&(n+="&"+f));return n},n}(),WacFallbackController=function(){function n(n,t,i,r,u,f,e){this.BootFailed=!1;this.InitializeWopiPendingParameters=n;this.m_forceWacFallback=t;this.GetFallbackUrl=i;this.OnSuccessWopiInfoCallback=r;this.logger=u;this.windowVisibilityMetrics=f;this.m_postMessageToken=e}return n.prototype.WopiPendingApplicationComplete=function(n,t){this.m_forceWacFallback||this.BootFailed?PPTBootstrapper.LaunchWacFallback(n,this.InitializeWopiPendingParameters,this.GetFallbackUrl,this.BootFailureInfo,this.logger,this.windowVisibilityMetrics,this.m_postMessageToken):(this.ReturnedWopiInfo=n,this.OnSuccessWopiInfoCallback&&this.OnSuccessWopiInfoCallback(this.ReturnedWopiInfo,t))},n.prototype.OnBootFailed=function(n){for(this.logger.ULS.traceTag(35997389,logCategory.PptSession,logLevel.Error,"Failed to Boot Previewer"),this.BootFailed=!0,this.BootFailureInfo=n;this.InitializeWopiPendingParameters.Container.firstChild;)this.InitializeWopiPendingParameters.Container.removeChild(this.InitializeWopiPendingParameters.Container.firstChild);this.ReturnedWopiInfo&&PPTBootstrapper.LaunchWacFallback(this.ReturnedWopiInfo,this.InitializeWopiPendingParameters,this.GetFallbackUrl,this.BootFailureInfo,this.logger,this.windowVisibilityMetrics,this.m_postMessageToken)},n.prototype.WopiPendingApplicationFail=function(n){n;this.logger.ULS.traceTag(38293905,logCategory.PptSession,logLevel.Info,"Host failed to give us WopiInfo")},n}(),FeatureIds,WopiPendingApplication,ApplicationBootstrapper,DocRebootSupportMode,MessageType,PodsSessionFactory,PreviewSessionLoader;(function(n){n.H2StaticContent="H2StaticContent";n.InstantShell="InstantShell";n.EnterpriseTemplates="EnterpriseTemplates";n.HashedUrl="HashedUrl";n.OfficeComUiHost="OfficeComUiHost";n.ODCShareLinkPreload="ODCShareLinkPreload"})(FeatureIds||(FeatureIds={}));WopiPendingApplication=function(){function n(){}return n.newGuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n==="x"?t:t&3|8;return i.toString(16)})},n.GetApplicationParameters=function(t){return{container:t.Container,sessionInformation:t.SessionInformation,applicationUrl:t.ApplicationUrl,wopiPrecheckInfo:t.WopiPrecheckInfo,applicationCustomSettings:t.ApplicationCustomSettings,diagnostics:t.Diagnostics,fnOnInitializeSuccess:t.FnOnInitializeSuccess,fnOnInitializeFailure:t.FnOnInitializeFailure,sessionId:t.SessionInformation&&t.SessionInformation.HostSessionId?t.SessionInformation.HostSessionId:n.newGuid(),applicationBaseUrl:UrlUtils.getApplicationBaseUrl(t.ApplicationUrl)}},n}();ApplicationBootstrapper=function(){function n(){}return n.validateParametersWopiPending=function(n){var i,t,r,u,f,e;if(n===undefined)throw new TypeError("initParams");if(i=n.Container,i===undefined||i.appendChild===undefined)throw new TypeError("Container");if(t=n.SessionInformation,t===undefined||t.HostName===undefined||t.HostSessionId===undefined||t.UserId===undefined)throw new TypeError("SessionInformation");if(r=n.ApplicationUrl,r===undefined||typeof r!="string")throw new TypeError("ApplicationUrl");if(u=n.WopiPrecheckInfo,u===undefined||u.FileName===undefined)throw new TypeError("WopiPrecheckInfo");if(f=n.FnOnInitializeSuccess,f===undefined)throw new TypeError("FnOnInitializeSuccess");if(e=n.FnOnInitializeFailure,e===undefined)throw new TypeError("FnOnInitializeFailure");},n}(),function(n){n[n.NotSupported=0]="NotSupported";n[n.SameDocOnly=1]="SameDocOnly";n[n.AnyDoc=2]="AnyDoc"}(DocRebootSupportMode||(DocRebootSupportMode={}));var PostMessageHandler=function(){function n(n,t,i){var r=this;if(this.messageListener=function(n){return r.handleWacFramePostMessage(n)},this.eventHandlers={},!n)throw new Error("Missing origin for PostMessageHandler");this.innerApplicationFrame=i;this.logger=t;this.origin=n.toLowerCase();window.addEventListener("message",this.messageListener,!1)}return n.prototype.RegisterMessagePayloadHandler=function(n,t){if(this.eventHandlers[n])throw new Error("Duplicate registration!");this.eventHandlers[n]=t},n.prototype.RemoveMessageHandler=function(n){delete this.eventHandlers[n]},n.prototype.SendPostMessage=function(n,t,i){this.logger.ULS.traceTag(594121927,logCategory.WopiPendingApplication,logLevel.Info,"PostMessageHandler - Sending message: "+t);var r={MessageId:t,SendTime:Date.now(),Values:i};this.sendPostMessageInternal(n,JSON.stringify(r),this.origin)},n.prototype.Dispose=function(){window.removeEventListener("message",this.messageListener,!1);delete this.eventHandlers},n.prototype.handleWacFramePostMessage=function(n){var r,i,t,f,u;if(n.origin&&n.origin.toLowerCase()===this.origin){this.innerApplicationFrame?n.source!==this.innerApplicationFrame.contentWindow&&(r="ev.source.location = "+n.source.location+" doesnt match innerApplicationFrame.contentwindow",this.innerApplicationFrame.contentWindow&&(r+=" = "+this.innerApplicationFrame.contentWindow.location),this.logger.ULS.traceTag(593884162,logCategory.WopiPendingApplication,logLevel.Error,r)):this.logger.ULS.traceTag(593884163,logCategory.WopiPendingApplication,logLevel.Error,"inner application frame is null");try{i=JSON.parse(n.data)}catch(e){this.logger.ULS.traceTag(594121926,logCategory.WopiPendingApplication,logLevel.Error,"PostMessageHandler - failed to parse event data: "+JSON.stringify(e));return}if(t=i.MessageId,t){if(t=="App_RefreshSessionInfo"&&(f=i.CorrelationId,this.logger.ULS.traceTag(594121925,logCategory.PptSession,logLevel.Info,"Got App_RefreshSessionInfo message from app. CorrelationId: "+f)),u=this.eventHandlers[t],!u){this.logger.ULS.traceTag(594121924,logCategory.WopiPendingApplication,logLevel.Info,"PostMessageHandler - no handler found for message id: "+t);return}this.logger.ULS.traceTag(594121923,logCategory.WopiPendingApplication,logLevel.Info,"PostMessageHandler - processing message: "+t);u(i.Values||{})}}},n.prototype.sendPostMessageInternal=function(n,t,i){n.postMessage(t,i)},n}(),SHA1=function(){function n(){}return n.RotateLeft=function(n,t){return n<<t|n>>32-t},n.ConvertHex=function(n){for(var i=[],r,t=7;t>=0;t--)r=n>>t*4&15,i.push(r.toString(16));return i.join("")},n.Utf8Encode=function(n){var i,r,t;for(n=n.replace("\r\n","\n"),i="",r=0;r<n.length;r++)t=n.charCodeAt(r),t<128?i+=String.fromCharCode(t):t>127&&t<2048?(i+=String.fromCharCode(t>>6|192),i+=String.fromCharCode(t&63|128)):(i+=String.fromCharCode(t>>12|224),i+=String.fromCharCode(t>>6&63|128),i+=String.fromCharCode(t&63|128));return i},n.GenerateSHA1=function(t){var i,k,a,v=1732584193,y=4023233417,p=2562383102,w=271733878,b=3285377520,e,r,u,f,h,o=0,c=new Array(80),s,l,d;for(t=n.Utf8Encode(t),s=t.length,l=[],i=0;i<s-3;i+=4)k=t.charCodeAt(i)<<24|t.charCodeAt(i+1)<<16|t.charCodeAt(i+2)<<8|t.charCodeAt(i+3),l.push(k);switch(s%4){case 0:o=2147483648;break;case 1:o=t.charCodeAt(s-1)<<24|8388608;break;case 2:o=t.charCodeAt(s-2)<<24|t.charCodeAt(s-1)<<16|32768;break;case 3:o=t.charCodeAt(s-3)<<24|t.charCodeAt(s-2)<<16|t.charCodeAt(s-1)<<8|128}for(l.push(o);l.length%16!=14;)l.push(0);for(l.push(s>>29),l.push(s<<3&4294967295),a=0;a<l.length;a+=16){for(i=0;i<16;i++)c[i]=l[a+i];for(i=16;i<=79;i++)c[i]=n.RotateLeft(c[i-3]^c[i-8]^c[i-14]^c[i-16],1);for(e=v,r=y,u=p,f=w,h=b,i=0;i<=19;i++)o=n.RotateLeft(e,5)+(r&u|~r&f)+h+c[i]+1518500249&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;for(i=20;i<=39;i++)o=n.RotateLeft(e,5)+(r^u^f)+h+c[i]+1859775393&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;for(i=40;i<=59;i++)o=n.RotateLeft(e,5)+(r&u|r&f|u&f)+h+c[i]+2400959708&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;for(i=60;i<=79;i++)o=n.RotateLeft(e,5)+(r^u^f)+h+c[i]+3395469782&4294967295,h=f,f=u,u=n.RotateLeft(r,30),r=e,e=o;v=v+e&4294967295;y=y+r&4294967295;p=p+u&4294967295;w=w+f&4294967295;b=b+h&4294967295}return d=n.ConvertHex(v)+n.ConvertHex(y)+n.ConvertHex(p)+n.ConvertHex(w)+n.ConvertHex(b),d.toLowerCase()},n}(),UrlUtils=function(){function n(){}return n.getApplicationBaseUrl=function(n){var t,i,r;if(!n)return"";if(t=n.indexOf("/",8),t<0)throw new Error("URL should contain a / after domain");if(i=n.indexOf(".",t),i>=0&&(r=n.lastIndexOf("/",i),r>=0))return n.substr(0,r+1);throw new Error("URL should contain a . after domain");},n.getParameterValue=function(n,t){var i=n.indexOf("&"+t+"="),r,u;return(i===-1&&(i=n.indexOf("?"+t+"=")),i===-1)?"":(r=i+(t.length+2),u=n.indexOf("&",r),u===-1)?n.substr(r):n.substring(r,u)},n.getParameterValueDecoded=function(t,i){var r=n.getParameterValue(t,i);return r?decodeURI(r):r},n.getOrigin=function(n){return n.replace(/^(.*\/\/[^\/?#]*).*$/,"$1")},n.addQueryParam=function(n,t,i){var r=n,f=r.indexOf("?"),u="&";return(f===r.length-1?u="":f===-1&&(u="?"),u==="&"&&r.indexOf(t+"=",f)>=0)?r:r.concat(u,t,"=",i)},n.addOrReplaceParameterValue=function(n,t,i){var u;if(!t)return n;var r=n,f=i==null,s=r.indexOf("?");if(-1===s)return f?n:r+"?"+t+"="+i;var h=r.substr(s+1),e=h.split("&"),o=t+"=",c=!1;for(u=0;u<e.length;u=u+1)if(0===e[u].indexOf(o)){r=r.replace(e[u],f?"":o+i);c=!0;break}return c||f||(h.length>0&&(r+="&"),r+=o+i),r},n.HTMLEncode=function(t){return n.EncodeString(t,n.htmlEncodeReplacements)},n.GetQueryStringParam=function(t){return n.getParameterValue(window.location.href,t)},n.UrlKeyValueEncode=function(t){var i=encodeURIComponent(t);return n.EncodeString(i,n.urlKeyValueEncodeReplacements)},n.EncodeString=function(n,t){for(var r=n,u=t.length,i=0;i<u;i=i+1)r=r.replace(t[i].FindExpression,t[i].ReplaceValue);return r},n.Base64Decode=function(n){var t=(n+"===").substring(0,n.length+(4-n.length%4)%4);return t=t.replace(new RegExp("-","g"),"+"),t=t.replace(new RegExp("_","g"),"/"),atob(t)},n.urlKeyValueEncodeReplacements=[{FindExpression:new RegExp("!","g"),ReplaceValue:"%21"},{FindExpression:new RegExp("'","g"),ReplaceValue:"%27"},{FindExpression:new RegExp("\\(","g"),ReplaceValue:"%28"},{FindExpression:new RegExp("\\)","g"),ReplaceValue:"%29"},{FindExpression:new RegExp("\\*","g"),ReplaceValue:"%2A"},],n.htmlEncodeReplacements=[{FindExpression:new RegExp("&","g"),ReplaceValue:"&#"+"&".charCodeAt(0)+";"},{FindExpression:new RegExp("<","g"),ReplaceValue:"&#"+"<".charCodeAt(0)+";"},{FindExpression:new RegExp(">","g"),ReplaceValue:"&#"+">".charCodeAt(0)+";"},{FindExpression:new RegExp("'","g"),ReplaceValue:"&#"+"'".charCodeAt(0)+";"},{FindExpression:new RegExp("\\\\","g"),ReplaceValue:"&#"+"\\\\".charCodeAt(0)+";"},{FindExpression:new RegExp('"',"g"),ReplaceValue:"&#"+'"'.charCodeAt(0)+";"},],n}(),VisibilityChangeEvents=[],WindowVisibilityMetrics=function(){function n(){this.initialize()}return n.prototype.initialize=function(){if(document.visibilityState==="hidden"){var n={visibility:document.visibilityState,time:Date.now(),initialState:!0};VisibilityChangeEvents.push(n)}document.addEventListener("visibilitychange",this.handleVisibilityChange)},n.prototype.Stop=function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange)},n.prototype.GetVisibilityChangeEvents=function(){return VisibilityChangeEvents},n.prototype.handleVisibilityChange=function(){var n={visibility:document.visibilityState,time:Date.now(),initialState:!1};VisibilityChangeEvents.push(n)},n}(),CreateNewScenario;(function(n){n[n.UnifiedCreateNew=1]="UnifiedCreateNew";n[n.LegacyCreateNew=2]="LegacyCreateNew";n[n.NotCreateNew=3]="NotCreateNew"})(CreateNewScenario||(CreateNewScenario={}));var PODSRegion=function(){function n(n,t,i,r){t===void 0&&(t=1);i===void 0&&(i="https://c1-powerpoint-15.cdn.office.net/pods/s/");r===void 0&&(r="5");this.PodsURL=n;this.RolloutPercentage=t;this.WacCdnStaticServer=i;this.PreviewerRolloutRing=r}return n}(),UsePODSDetails=function(){function n(n,t,i,r){this.ShouldUsePODS=n;this.CanUsePODS=t;this.Reason=i;this.CreateNewScenario=r}return n}(),PodsRegionInfo=function(){function n(){}return n.GetWacToPodsUnifiedMap=function(){var t={};return t[n.ffcUrl]=new PODSRegion(n.ffcUrl+n.pods,1,"https://c5-powerpoint-15.cdn.office.net/pods/s/"),t[n.ppcUrl]=new PODSRegion(n.ppcUrl+n.pods,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/"),t[n.prodUrl]=new PODSRegion(n.prodUrl+n.pods),t[n.uscUrl]=new PODSRegion(n.uscUrl+n.pods),t[n.eucUrl]=new PODSRegion(n.eucUrl+n.pods),t[n.cacUrl]=new PODSRegion(n.cacUrl+n.pods),t[n.ukcUrl]=new PODSRegion(n.ukcUrl+n.pods),t[n.aucUrl]=new PODSRegion(n.aucUrl+n.pods),t[n.jpcUrl]=new PODSRegion(n.jpcUrl+n.pods),t[n.incUrl]=new PODSRegion(n.incUrl+n.pods),t[n.krcUrl]=new PODSRegion(n.krcUrl+n.pods),t[n.frcUrl]=new PODSRegion(n.frcUrl+n.pods),t[n.sgcUrl]=new PODSRegion(n.sgcUrl+n.pods),t[n.zacUrl]=new PODSRegion(n.zacUrl+n.pods),t[n.aecUrl]=new PODSRegion(n.aecUrl+n.pods),t[n.decUrl]=new PODSRegion(n.decUrl+n.pods),t[n.chcUrl]=new PODSRegion(n.chcUrl+n.pods),t[n.nocUrl]=new PODSRegion(n.nocUrl+n.pods),t[n.blackforestUrl]=new PODSRegion(n.blackforestUrl+n.pods,1,"https://powerpoint.cdn.office.de/pods/s/"),t[n.gallatinUrl]=new PODSRegion(n.gallatinUrl+n.pods,1,"https://cdn.partner.officewebapps.cn/pods/s/"),t[n.usGovUrl]=new PODSRegion(n.usGovUrl+n.pods,1,"https://powerpoint.cdn.office365.us/pods/s/"),t[n.gbcUrl]=new PODSRegion(n.gbcUrl+n.pods,1,"https://powerpoint.cdn.office365.us/pods/s/"),t[n.usDoDUrl]=new PODSRegion(n.usDoDUrl+n.pods,1,"https://powerpoint.dod.cdn.office365.us/pods/s/"),t},n.GetWacToPodsPreviewerMap=function(){var t={};return t[n.ffcUrl]=n.ShouldRerouteEdogToProd?new PODSRegion(n.https+"usc"+n.hostOSI,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/"):this.edogRegion,t[n.ppcUrl]=new PODSRegion(n.https+"usc"+n.hostOSI,1,"https://c4-powerpoint-15.cdn.office.net/pods/s/","2"),t[n.prodUrl]=new PODSRegion(n.https+n.hostOSI.substring(1)),t[n.uscUrl]=new PODSRegion(n.https+"usc"+n.hostOSI),t[n.eucUrl]=new PODSRegion(n.https+"euc"+n.hostOSI),t[n.cacUrl]=new PODSRegion(n.https+"canc"+n.hostOSI),t[n.ukcUrl]=new PODSRegion(n.https+"ukc"+n.hostOSI),t[n.aucUrl]=new PODSRegion(n.https+"ausc"+n.hostOSI),t[n.jpcUrl]=new PODSRegion(n.https+"jpc"+n.hostOSI),t[n.incUrl]=new PODSRegion(n.https+"inc"+n.hostOSI),t[n.krcUrl]=new PODSRegion(n.https+"krc"+n.hostOSI),t[n.frcUrl]=new PODSRegion(n.https+"frc"+n.hostOSI),t[n.sgcUrl]=new PODSRegion(n.https+"sea-000"+n.hostOSI),t[n.usGovUrl]=new PODSRegion(n.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),t[n.gbcUrl]=new PODSRegion(n.https+"pods.osi.office365.us/",1,"https://powerpoint.cdn.office365.us/pods/s/","6"),t[n.usDoDUrl]=new PODSRegion(n.https+"pods.osi.apps.mil/",1,"https://powerpoint.dod.cdn.office365.us/pods/s/","6"),t.edog=this.edogRegion,t},n.ShouldRouteToEdog=function(t,i){return!i||!i.SessionInformation?!1:i.SessionInformation.UiHostRing&&n.TeamsRingsInEdog.indexOf(i.SessionInformation.UiHostRing.toLowerCase())>=0?!0:n.HostsWithFFInEdog.indexOf(i.SessionInformation.HostName)>=0&&t==n.ffcUrl?!0:!1},n.TryGetPodsRegion=function(t,i,r){var u=t.substring(0,t.indexOf("/p/")),f;return r?n.WacToPodsUnifiedMap[u.toLowerCase()]:(f=n.WacToPodsPreviewerMap[u.toLowerCase()],n.ShouldRouteToEdog(u.toLowerCase(),i)&&(f=n.WacToPodsPreviewerMap.edog),f?f:n.WacToPodsUnifiedMap[u.toLowerCase()])},n.GetPodsRing=function(n){var t=this.TryGetPodsRegion(n.ApplicationUrl,n,!1);return t&&t.PreviewerRolloutRing?t.PreviewerRolloutRing:"-4"},n.GetWACRegion=function(n){return n?n.substring(0,n.indexOf("/p/")).toLowerCase():""},n.GetFileHost=function(n){if(!n)return"";if(n.Diagnostics&&n.Diagnostics.fileHost)return n.Diagnostics.fileHost;if(n.SessionInformation&&n.SessionInformation.HostName){var t=n.SessionInformation.HostName;switch(t){case"MSTeams":case"TeamsAndroid":case"TeamsiOS":case"OneDrive":case"ParticipantApp":case"DragonGate":return"SharePoint Online";default:return t}}return""},n.GetUiHost=function(n){if(!n)return"";switch(n){case"MSTeams":case"TeamsAndroid":case"TeamsiOS":return"teams";case"ParticipantApp":case"DragonGate":return n;default:return""}},n.ShouldRerouteEdogToProd=window.location.search.indexOf("wdTestPreviewerInEdog")>=0?!1:!0,n.HostsWithFFInEdog=["TeamsiOS"],n.TeamsRingsInEdog=["ring0","ring1"],n.https="https://",n.pods="/pods/",n.hostWAC="-powerpoint.officeapps.live.com",n.hostOSI=".pods.officeapps.live.com/",n.ffcUrl=n.https+"ffc"+n.hostWAC,n.ppcUrl=n.https+"ppc"+n.hostWAC,n.uscUrl=n.https+"usc"+n.hostWAC,n.eucUrl=n.https+"euc"+n.hostWAC,n.cacUrl=n.https+"cac"+n.hostWAC,n.ukcUrl=n.https+"ukc"+n.hostWAC,n.aucUrl=n.https+"auc"+n.hostWAC,n.jpcUrl=n.https+"jpc"+n.hostWAC,n.incUrl=n.https+"inc"+n.hostWAC,n.krcUrl=n.https+"krc"+n.hostWAC,n.frcUrl=n.https+"frc"+n.hostWAC,n.sgcUrl=n.https+"sgc"+n.hostWAC,n.zacUrl=n.https+"zac"+n.hostWAC,n.aecUrl=n.https+"aec"+n.hostWAC,n.gbcUrl=n.https+"gbc"+n.hostWAC,n.decUrl=n.https+"dec"+n.hostWAC,n.chcUrl=n.https+"chc"+n.hostWAC,n.nocUrl=n.https+"noc"+n.hostWAC,n.blackforestUrl=n.https+"powerpoint.online.office.de",n.gallatinUrl=n.https+"cnc-powerpoint.partner.officewebapps.cn",n.usGovUrl=n.https+"powerpoint.gov.online.office365.us",n.usDoDUrl=n.https+"powerpoint.dod.online.office365.us",n.prodUrl=n.https+n.hostWAC.substring(1),n.edogRegion=new PODSRegion(n.https+"pods.edog.officeapps.live.com/",1,"https://c5-powerpoint-15.cdn.office.net/pods/s/","1"),n.WacToPodsUnifiedMap=n.GetWacToPodsUnifiedMap(),n.WacToPodsPreviewerMap=n.GetWacToPodsPreviewerMap(),n}(),MathHelper=function(){function n(){}return n.Hash=function(n){for(var t=0,i=0;i<n.length;i++)t=(t<<5)-t+n.charCodeAt(i),t=t&t;return t},n}(),PPTBootstrapper=function(){function n(){}return n.SanitizeInitialParameters=function(n,t){if(n.SessionInformation&&n.SessionInformation.DocumentClickTime)try{var i=n.SessionInformation.DocumentClickTime.getTime()}catch(r){t.ULS.traceTag(590123598,logCategory.PptSession,logLevel.Warning,"DocumentClickTime was not of type Date");n.SessionInformation.DocumentClickTime=undefined}return n},n.EnsureInitializeParametersAreTheRightType=function(n){return n.WopiPrecheckInfo.PreseededSessionKey&&(n.WopiPrecheckInfo.PreseededSessionKey.slice(0,6)!="_._._."||n.WopiPrecheckInfo.PreseededSessionKey.slice(-6)!="-.-.-.")&&(n.WopiPrecheckInfo.PreseededSessionKey="_._._."+n.WopiPrecheckInfo.PreseededSessionKey+"-.-.-."),n.ApplicationCustomSettings&&n.ApplicationCustomSettings.EnableWacFallback==null&&(n.ApplicationCustomSettings.EnableWacFallback=!0),n},n.GetOnDemandServer=function(n,t){var i,r,u;if(t===void 0&&(t=!1),n&&n.ApplicationCustomSettings&&n.ApplicationCustomSettings.OnDemandServer)return n.ApplicationCustomSettings.OnDemandServer;if(n&&n.ApplicationUrl&&(i=PodsRegionInfo.TryGetPodsRegion(n.ApplicationUrl,n,t),i))return i.PodsURL;r=PPTBootstrapSettings.getAppMetadata();u=r?r.Environment:"";switch(u){case"int":return"https://PODS.officeapps.live-int.com/";case"edog":return"https://PODS.edog.officeapps.live.com/";case"prod":return"https://PODS.officeapps.live.com/";case"wac":return n&&n.ApplicationUrl?n.ApplicationUrl.substring(0,n.ApplicationUrl.indexOf("PowerPointFrame.aspx")).replace("/p/","/pods/"):"";default:return"https://localhost:8080/"}},n.GetWacStaticResourcesServer=function(n,t,i,r){var u,f;if(n&&n.WacStaticResourcesServer)return n.WacStaticResourcesServer;if(i)return u="pods/s/",i.split(u)[0]+u;if(t){if(f=PodsRegionInfo.TryGetPodsRegion(t,r,!1),f)return f.WacCdnStaticServer;throw Error("Application url provided but region not in region allowlist");}return"https://c1-powerpoint-15.cdn.office.net/pods/s/"},n.GenerateRandomHexChar=function(){var n=new Uint8Array(1);return window.self.crypto&&window.self.crypto.getRandomValues?(window.self.crypto.getRandomValues(n),Math.floor(n[0]/16).toString(16)):window.msCrypto&&window.msCrypto.getRandomValues?(window.msCrypto.getRandomValues(n),Math.floor(n[0]/16).toString(16)):Math.floor(Math.random()*16).toString(16)},n.GenerateRandomUUID=function(){return"xxxxxxxx-xxxx-4xxx-xxxx-xxxxxxxxxxxx".replace(/[x]/g,n.GenerateRandomHexChar)},n.GetSlideShowKind=function(n){return window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0?"Modern":n.SessionInformation&&n.SessionInformation.WdParams&&n.SessionInformation.WdParams.wdModernSlideShowInTeams&&n.SessionInformation.WdParams.wdBrowserShapeBuilderCompatible&&n.SessionInformation.WdParams.wdIsFileTypeSupportedForModernSlideShow?"Modern":"Legacy"},n.ShouldUseLegacySlideShowAspx=function(n){return n.ApplicationUrl==null?!1:window.location.search.indexOf("wdLegacySlideShowAspx")>=0?!0:n.SessionInformation&&n.SessionInformation.WdParams&&n.SessionInformation.WdParams.wdLegacyAspxInTeams?!0:n.SessionInformation&&n.SessionInformation.HostName&&n.SessionInformation.HostName.toLowerCase().indexOf("bluechicken")>=0?!0:!1},n.SendInitialLog=function(t,i,r,u){var e,a,f,h,y,o,c,v,s,l;this.s_bootstrapperInstanceIdentifier==""&&(this.s_bootstrapperInstanceIdentifier=this.GenerateRandomUUID());e={};e.BootstrapperType="TypeScript";e.Preview=i=="Previewer"?!0:!1;e.Scenario=i;e.ApplicationUrl=n.ExtractHostname(t.ApplicationUrl);e.IsDeepLink=!!UrlUtils.GetQueryStringParam("nav");e.BootstrapperInstanceId=this.s_bootstrapperInstanceIdentifier;a={};e.ApplicationCustomSettings=a;t.ApplicationCustomSettings&&(a.OnDemandServer=n.ExtractHostname(t.ApplicationCustomSettings.OnDemandServer),a.EnableWacFallback=t.ApplicationCustomSettings.EnableWacFallback);f={};e.SessionInformation=f;f.HostName=t.SessionInformation.HostName;f.HostSessionId=t.SessionInformation.HostSessionId;f.UiLocale=t.SessionInformation.UiLocale;f.DataLocale=t.SessionInformation.DataLocale;t.Diagnostics&&t.Diagnostics.userClickTime?f.DocumentClickTime=t.Diagnostics.userClickTime:t.SessionInformation&&t.SessionInformation.DocumentClickTime&&(f.DocumentClickTime=t.SessionInformation.DocumentClickTime.getTime());f.HostInitTime=t.SessionInformation.HostInitTime;f.CurrentTime=(new Date).getTime();f.ParticipantId=t.SessionInformation.ParticipantId;f.CallId=t.SessionInformation.CallId;f.TenantId=t.SessionInformation.TenantId;f.ContentId=t.SessionInformation.ContentId;f.EndpointId=t.SessionInformation.EndpointId;f.IsPresenter=t.SessionInformation.IsPresenter;f.UiHost=PodsRegionInfo.GetUiHost(t.SessionInformation.HostName);f.UiHostRing=t.SessionInformation.UiHostRing;f.PreviewerPosition=t.SessionInformation.Position;f.WdParams=t.SessionInformation.WdParams;f.HostExperience=t.SessionInformation.HostExperience;f.SlideShowKind=n.GetSlideShowKind(t);h={};e.Diagnostics=h;y=n.GetEntryPoint(t);h.EntryPoint=y;h.FileHost=PodsRegionInfo.GetFileHost(t);h.PodsRing=t.ApplicationUrl?PodsRegionInfo.GetPodsRing(t):"";o={};e.WopiPrecheckInfo=o;o.FileSize=t.WopiPrecheckInfo.FileSize;o.FileGetUrlBool=!!t.WopiPrecheckInfo.FileGetUrl;o.FileNameBool=!!t.WopiPrecheckInfo.FileName;o.ReadOnly=t.WopiPrecheckInfo.ReadOnly;o.IrmEnabled=t.WopiPrecheckInfo.IrmEnabled;o.SupportsDecryptedContentDownload=t.WopiPrecheckInfo.SupportsDecryptedContentDownload;o.ViewOnly=t.WopiPrecheckInfo.ViewOnly;o.PreseededSessionKey=!!t.WopiPrecheckInfo.PreseededSessionKey;c={};t.WopiPrecheckInfo.BundleInfo&&(v=t.WopiPrecheckInfo.BundleInfo,c.MajorVersion=v.MajorVersion,c.URLBool=!!v.Url,c.CrossOrigin=v.CrossOrigin);o.BundleInfo=c;s={};e.AppInfo=s;l=PPTBootstrapSettings.getAppMetadata();l&&(s.AppVersionMajor=l.AppVersionMajor,s.AppVersionMinor=l.AppVersionMinor,s.Environment=l.Environment);s.UserAgent=window.navigator.userAgent;r&&(e.AdditionalTelemetry=r);u.ULS.traceTag(22357763,logCategory.PptSession,logLevel.Info,JSON.stringify(e,n.UndefinedReplacer))},n.UndefinedReplacer=function(n,t){return typeof t=="undefined"?null:t},n.InferFileNewFromWopiPrecheckInfo=function(n,t,i,r){var f,u,o=n,e;return o.CreateNewInfo?(u=CreateNewScenario.UnifiedCreateNew,f="CreateNewInfo"):n.IsNewFile?(u=CreateNewScenario.UnifiedCreateNew,f="CreateNewInfoIsNewFile"):n.IsNewFileFromHostTemplate?(u=CreateNewScenario.UnifiedCreateNew,f="CreateNewInfoFromHostTemplate"):i&&i.FileGetUrl?(u=CreateNewScenario.UnifiedCreateNew,f="CreateNewInfoFromTemplateSourceUrl"):t.toLowerCase().indexOf("new=1")>=0&&n.FileSize!=0?(u=CreateNewScenario.LegacyCreateNew,f="ApplicationUrlContainsNewAndNonZeroByteFile"):t.toLowerCase().indexOf("new=1")>=0?(u=CreateNewScenario.UnifiedCreateNew,f="ApplicationUrlContainsNew"):(u=CreateNewScenario.NotCreateNew,f="NotCreateNew"),e={},e.CreateNewScenario=CreateNewScenario[u],e.reason=f,r.ULS.traceTag(34932951,logCategory.PptSession,logLevel.Info,JSON.stringify(e)),u},n.PODSFlighting=function(t,i,r){var u=n.InferFileNewFromWopiPrecheckInfo(t.WopiPrecheckInfo,t.ApplicationUrl,t.NewFileTemplateSource,r),f=PodsRegionInfo.TryGetPodsRegion(t.ApplicationUrl,t,i),e;return f?i&&u==CreateNewScenario.LegacyCreateNew?new UsePODSDetails(!1,!1,"Legacy Create New Scenario because application url contains new, but non-zero file size",u):window.location.search.indexOf("wdTestPreviewer=1")>=0||window.location.hash.indexOf("wdTestPreviewer=1")>=0?new UsePODSDetails(!0,!0,"Supported Region and wdTestPreviewer/wdTestUnified set to true in Host Page URL",u):i&&t.ApplicationUrl.indexOf("&Embed=1")!=-1?new UsePODSDetails(!1,!1,"Embed View fallback to WAC",u):f.RolloutPercentage<=0?new UsePODSDetails(!1,!1,"PODS region Disabled",u):(e=n.GetFlightingNumber(t),r.ULS.traceTag(38147723,logCategory.PptSession,logLevel.Info,"RolloutPercentage - "+f.RolloutPercentage+"; RolloutNumber - "+e),f.RolloutPercentage<e?new UsePODSDetails(!1,!0,"Could use PODS but this session was not selected as part of the rollout",u):new UsePODSDetails(!0,!0,"Supported Region",u)):(r.ULS.traceTag(589168768,logCategory.PptSession,logLevel.Info,"Wac region not currently supported by PODS"),new UsePODSDetails(!1,!1,"Wac region not currently supported by PODS",u))},n.GetFlightingNumber=function(n){return n.SessionInformation.UserId?Math.abs(MathHelper.Hash(n.SessionInformation.UserId))/100%1:Math.random()},n.LaunchWacFallback=function(n,t,i,r,u,f,e){var c,s,h,l,a,p,y,v;u.ULS.traceTag(38147724,logCategory.PptSession,logLevel.Info,"Launching Wac Fallback");var o=document.createElement("iframe");o.frameBorder="0";o.style.top=HTMLHelper.toPx(0);o.style.bottom=HTMLHelper.toPx(0);o.style.left=HTMLHelper.toPx(0);o.style.right=HTMLHelper.toPx(0);o.style.height=HTMLHelper.floatToPercent(1);o.style.width=HTMLHelper.floatToPercent(1);o.style.minWidth=HTMLHelper.toPx(300);o.style.minHeight=HTMLHelper.toPx(200);o.style.position="absolute";o.setAttribute("allowfullscreen",(!0).toString());o.setAttribute("allowTransparency",(!0).toString());o.id="WebApplicationFrame";o.title="Office Online Frame";o.name="wac_frame";c=HTMLHelper.floatToPercent(1);t.Container.style.width=c;t.Container.style.height=c;t.Container.style.minHeight=HTMLHelper.toPx(150);t.Container.style.left=HTMLHelper.toPx(0);t.Container.style.right=HTMLHelper.toPx(0);t.Container.style.bottom=HTMLHelper.toPx(0);t.Container.style.top=HTMLHelper.toPx(0);s=document.createElement("div");s.style.backgroundColor="#393a3d";s.style.backfaceVisibility="hidden";s.style.width=c;s.style.height=c;s.style.minHeight=HTMLHelper.toPx(150);s.style.left=HTMLHelper.toPx(0);s.style.right=HTMLHelper.toPx(0);s.style.bottom=HTMLHelper.toPx(0);s.style.top=HTMLHelper.toPx(0);o.style.width=c;o.style.minHeight=HTMLHelper.toPx(150);o.style.height=c;h=document.createElement("form");h.name="wac_form";h.id="wac_form";h.target="wac_frame";h.action=i(n,t);h.method="post";l=document.createElement("input");l.type="hidden";l.name="access_token";l.value=n.AccessToken;h.appendChild(l);a=document.createElement("input");a.type="hidden";a.name="access_token_ttl";a.value=!n.AccessTokenExpiry?"0":n.AccessTokenExpiry.getTime().toString();h.appendChild(a);t.Container.appendChild(h);t.Container.appendChild(s);s.appendChild(o);h.submit();p=r&&r.Code==5308440?"CannotLoadBundleItem":"FatalError";y={errorObject:{errorType:p,errorObject:r}};f.Stop();v=f.GetVisibilityChangeEvents();v&&v.length>0&&(y.documentLoadedWithTabSwitch=!0,u.ULS.traceTag(38147725,logCategory.PptSession,logLevel.Info,"Visibility Change Events:"+JSON.stringify(v)));t.FnOnInitializeSuccess(new PPTDisabledApplication(e),y)},n.ExtractHostname=function(n){return n?n.indexOf("://")>-1?n.split("/")[2]:n.split("/")[0]:null},n.GetEntryPoint=function(n){if(!n.ApplicationUrl)return null;var t=UrlUtils.getParameterValueDecoded(n.ApplicationUrl,"wdOrigin");return t?t:n.Diagnostics&&n.Diagnostics.entryPoint?n.Diagnostics.entryPoint:null},n.findBootstrapperPerfEntry=function(n,t,i){var r,u;if(n)for(r=0;r<n.length;r++)if(u=n[r],u.name.indexOf(t)>=0)return u.name.toLowerCase()!=t.toLowerCase()&&i.ULS.traceTag(38147726,logCategory.PptSession,logLevel.Info,"Found partial match for bootstrapper URL perf entry"),u;return null},n.logBootstrapperPerformanceInfo=function(t,i,r){var u,f;if(r)try{if(t||(r.ULS.traceTag(38147727,logCategory.PptSession,logLevel.Info,"Missing BootstrapperUrl, defaulting to https://contentstorage.osi.office.net/boot/ppt.boot.js"),t="https://contentstorage.osi.office.net/boot/ppt.boot.js"),!window.performance){r.ULS.traceTag(38147728,logCategory.PptSession,logLevel.Info,"Performance API not found on browser");return}if(u=undefined,window.performance.getEntriesByName&&(u=n.findBootstrapperPerfEntry(window.performance.getEntriesByName(t),t,r)),!u&&window.performance.getEntries&&(r.ULS.traceTag(38147729,logCategory.PptSession,logLevel.Info,"Searching all entries for bootstrapper timing entry."),u=n.findBootstrapperPerfEntry(window.performance.getEntries(),t,r)),!u){r.ULS.traceTag(38147730,logCategory.PptSession,logLevel.Info,"Unable to extract Bootstrapper perf info.");return}f={};f.name=t;f.logReason=i;f.nameMatchesExpected=u.name==t;f.connectEnd=u.connectEnd;f.connectStart=u.connectStart;f.domainLookupEnd=u.domainLookupEnd;f.domainLookupStart=u.domainLookupStart;f.fetchStart=u.fetchStart;f.initiatorType=u.initiatorType;f.redirectEnd=u.redirectEnd;f.redirectStart=u.redirectStart;f.requestStart=u.requestStart;f.responseEnd=u.responseEnd;f.responseStart=u.responseStart;f.duration=u.duration;f.entryType=u.entryType;f.startTime=u.startTime;f.nextHopProtocol=u.nextHopProtocol;f.workerStart=u.workerStart;f.secureConnectionStart=u.secureConnectionStart;f.transferSize=u.transferSize;f.encodedBodySize=u.encodedBodySize;f.decodedBodySize=u.decodedBodySize;r.ULS.traceTag(34928845,logCategory.PptSession,logLevel.Info,JSON.stringify(f))}catch(e){r.ULS.traceTag(38147731,logCategory.PptSession,logLevel.Warning,"Exception extracting Bootstrapper perf info. "+e)}},n.GetPostMessageToken=function(n){return!n||n.toLowerCase().indexOf("#")>-1?Math.random().toString(36).substring(2,25):n},n.AppendCommonFrameUrlQueryParams=function(t,i){var o=n.GetUI(i),r,u,f,e,s;return o&&(t=UrlUtils.addOrReplaceParameterValue(t,"ui",o)),r=n.GetDataLocale(i),r&&(t=UrlUtils.addOrReplaceParameterValue(t,"rs",r)),u=UrlUtils.getParameterValue(i.ApplicationUrl,"mscc"),u&&(t=UrlUtils.addOrReplaceParameterValue(t,"mscc",u)),f=UrlUtils.getParameterValue(i.ApplicationUrl,"wdFR"),f&&(t=UrlUtils.addOrReplaceParameterValue(t,"wdFR",f)),e=n.GetEntryPoint(i),e&&(t=UrlUtils.addOrReplaceParameterValue(t,"wdOrigin",UrlUtils.UrlKeyValueEncode(e))),s=n.GetPostMessageToken(i.PostMessageToken),i.PostMessageToken&&(t+="&postMessageToken="+s),(i.SessionInformation.DisableChat||i.ApplicationUrl.toLowerCase().indexOf("dchat=1")>-1)&&(t=UrlUtils.addOrReplaceParameterValue(t,"dchat","1")),UrlOverrideUtils.ForwardMissingWdParamsFromApplicationUrl(t,i.ApplicationUrl)},n.AppendCommonFallbackQueryParams=function(n,t,i){return t.SessionInformation.HostSessionId&&(n=UrlUtils.addOrReplaceParameterValue(n,"hid",t.SessionInformation.HostSessionId)),i&&(n=UrlUtils.addOrReplaceParameterValue(n,"WOPISrc",UrlUtils.UrlKeyValueEncode(i))),n},n.IsTeamsPreviewerSession=function(n,t){return!t&&!!n&&!!n.SessionInformation&&!!n.SessionInformation.HostName&&n.SessionInformation.HostName.indexOf("Teams")>=0},n.GetUI=function(n){return n.SessionInformation.UiLocale?n.SessionInformation.UiLocale:UrlUtils.getParameterValueDecoded(n.ApplicationUrl,"ui")},n.GetDataLocale=function(n){return n.SessionInformation.DataLocale?n.SessionInformation.DataLocale:UrlUtils.getParameterValueDecoded(n.ApplicationUrl,"rs")},n.s_bootstrapperInstanceIdentifier="",n}();window.Microsoft||(window.Microsoft={});Microsoft.Office||(Microsoft.Office={});Microsoft.Office.PowerPoint||(Microsoft.Office.PowerPoint={}),function(n){n[n.AppPageLoading=0]="AppPageLoading";n[n.AppReadyForPostMessage=1]="AppReadyForPostMessage";n[n.AppBootComplete=2]="AppBootComplete";n[n.DEPRECATED=3]="DEPRECATED";n[n.RefreshPage=4]="RefreshPage";n[n.UpdateInitializationComplete=6]="UpdateInitializationComplete";n[n.AppError=7]="AppError"}(MessageType||(MessageType={}));var WopiBootParams=function(){function n(){this.m_hasAppBooted=!1}return n.prototype.GetIfAllFieldsSet=function(){return!!this.m_wopiInfo&&this.m_hasAppBooted&&!!this.m_iframe&&!!this.m_podsUrl?{m_wopiInfo:this.m_wopiInfo,m_iframe:this.m_iframe,m_podsUrl:this.m_podsUrl,m_readonly:this.m_readonly,m_hasAppBooted:this.m_hasAppBooted,m_irmEnabled:this.m_irmEnabled,m_supportsDecryptedContentDownload:this.m_supportsDecryptedContentDownload,m_fileName:this.m_fileName}:undefined},n}(),PPTUnifiedSessionLoader=function(){function n(t){var v=this,i,nt,f,y,e,p,o,w,b,u,tt,s,k,h,r,it,l,a,d,g;this.m_wopiBootParams=new WopiBootParams;this.m_bootCompleted=!1;this.m_appErrors=[];this.c_appErrorThrottleCount=5;this.windowVisibilityMetrics=new WindowVisibilityMetrics;i=undefined;try{if(ApplicationBootstrapper.validateParametersWopiPending(t),t=PPTBootstrapper.EnsureInitializeParametersAreTheRightType(t),nt=t.SessionInformation.HostSessionId,t.ApplicationCustomSettings||(t.ApplicationCustomSettings={}),t.ApplicationCustomSettings.OnDemandServer=PPTBootstrapper.GetOnDemandServer(t,!0),f=PPTBootstrapper.GenerateRandomUUID(),y=!1,t.WopiPrecheckInfo&&t.WopiPrecheckInfo.PreseededWacSessionId&&(f=t.WopiPrecheckInfo.PreseededWacSessionId,y=!0),i=ULS.getLogger(f,t.ApplicationCustomSettings.OnDemandServer+"RemoteUls.ashx"),this.logger=i,TimeoutWrapper.AddTimeoutWrappersToHostCallbacks(t,i,this.pingInnerAppFrame.bind(this),"Unified",this.m_appErrors),i.ULS.traceTag(38580693,logCategory.PptSession,logLevel.Warning,"PPTBootstrapper - initializing session. Build version: "+this.GetVersion()+"; UserSessionId: "+f+"; IsSessionIdPreseeded: "+y),i.ULS.traceTag(38580694,logCategory.PptSession,logLevel.Info,"Bootstrapper Init Time: "+(new Date).getTime()),this.m_featureManager=createFeatureManager(t.FnIsFeatureEnabled,i),window.addEventListener("unload",function(){i.ULS.traceTag(41157219,logCategory.PptSession,logLevel.Warning,"Unloading bootstrapper window.");v.m_appErrors.length>0&&i.ULS.traceTag(588044118,logCategory.PptSession,logLevel.Warning,JSON.stringify(v.m_appErrors));i.ULS.flushOnClose()}),i.ULS.traceTag(38580695,logCategory.PptSession,logLevel.Info,"Application.InitializeWopiPending"),t.WopiPrecheckInfo.BundleInfo||(t.WopiPrecheckInfo.BundleInfo={MajorVersion:0}),e=PPTBootstrapper.GetPostMessageToken(nt),p={},p.PostMessageToken=e,PPTBootstrapper.SendInitialLog(t,"Unified App",p,i),o=this.ShouldUseUnifiedApp(t),this.LogShouldUsePods(o,t.ApplicationUrl),w=o.ShouldUsePODS,w){try{b=t.Diagnostics&&t.Diagnostics.userClickTime;b&&(u=parseInt(b),tt=(new Date).getTime(),u<=tt-6e4?i.ULS.traceTag(588804127,logCategory.PptSession,logLevel.Warning,"Bad userClickTime or Host took 60+s to kick off the InitializeWopiPending from click"):this.IsLocalStorageSupported()&&(s="lastUserClickTime",k=localStorage.getItem(s),k?(h=parseInt(k),h&&u<=h?i.ULS.traceTag(588804126,logCategory.PptSession,logLevel.Warning,"Bad userClickTime: it's less than or equal to lastUserClickTime; delta: "+(h-u)):localStorage.setItem(s,u.toString())):localStorage.setItem(s,u.toString())))}catch(c){i.ULS.traceTag(588804125,logCategory.PptSession,logLevel.Error,"Error when detecting bad userClickTime: "+c)}if(t.IsFileNew=o.CreateNewScenario!=CreateNewScenario.NotCreateNew?!0:!1,t.PostMessageToken=e,t.WopiPrecheckInfo.ReadOnly=t.WopiPrecheckInfo.ReadOnly||!1,r=this.CreateFrame(t.Container,t,f),r===null){it={Message:"Error creating IFrame",HostSessionId:t.SessionInformation.HostSessionId};i.ULS.traceTag(38580696,logCategory.PptSession,logLevel.Error,JSON.stringify(it));throw Error("Error Creating IFrame");}if(i.ULS.traceTag(50376725,logCategory.PptSession,logLevel.Warning,"Assigning wopiBootParams"),this.m_iframe=r.IFrameElement,this.m_wopiBootParams&&(this.m_wopiBootParams.m_iframe=r.IFrameElement,this.m_wopiBootParams.m_podsUrl=this.GetPodsUrl(t),this.m_wopiBootParams.m_readonly=t.WopiPrecheckInfo.ReadOnly,this.m_wopiBootParams.m_irmEnabled=t.WopiPrecheckInfo.IrmEnabled,this.m_wopiBootParams.m_supportsDecryptedContentDownload=t.WopiPrecheckInfo.SupportsDecryptedContentDownload,this.m_wopiBootParams.m_fileName=t.WopiPrecheckInfo.FileName),this.m_postMessageHandler=new PostMessageHandler(UrlUtils.getOrigin(t.ApplicationUrl),i,r?r.IFrameElement:null),this.m_postMessageHandler.RegisterMessagePayloadHandler("App_IsFrameTrusted",this.handleTrustFrameRequest.bind(this)),i.ULS.traceTag(50376726,logCategory.PptSession,logLevel.Warning,"Assigning SessionInformation.WdParams"),this.m_sessionContext=t.SessionInformation.SessionContext?t.SessionInformation.SessionContext:"",this.m_wdParams="",t.SessionInformation.WdParams)for(l in t.SessionInformation.WdParams)this.FWdPopOrPodParam(l)||(this.m_wdParams=this.m_wdParams+"&"+l+"="+t.SessionInformation.WdParams[l]);a=__assign({},t.Diagnostics,{hostName:t.SessionInformation.HostName});a.officeFrameCreateTime=r.FrameCreateTime;a.cacheHit=!1;this.m_appData={AppInitDiagnostics:a,InitParams:t};d=PPTMessageListenerRegistry.GetInstance();d&&d.Add(e,this,!1)}i.ULS.traceTag(50376727,logCategory.PptSession,logLevel.Warning,"Creating WacFallbackController");g=new WacFallbackController(t,!w,function(t,i){return n.GetWacFallbackUrl(t,i)},function(n,t){v.OnWopiInfoReceived(n,o.CreateNewScenario,t)},i,this.windowVisibilityMetrics,e);this.m_wopiPendingApplication={Complete:function(n,t){g.WopiPendingApplicationComplete(n,t)},Fail:function(n){g.WopiPendingApplicationFail(n)}};PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"UnifiedTSBoot",i);window.setTimeout(function(){i&&i.ULS.flush()},1e4)}catch(c){i&&(i.ULS.traceTag(38580697,logCategory.PptSession,logLevel.Error,"AppInitError: "+JSON.stringify(c,Object.getOwnPropertyNames(c))),i.ULS.flushOnClose());t.FnOnInitializeFailure({errorType:"AppInitError",errorObject:c})}}return n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.prototype.OnSliceLoaded=function(){},n.prototype.ShouldUseUnifiedApp=function(t){var i=UrlUtils.GetQueryStringParam("wdPodsEnabled"),r;return i?(r=PPTBootstrapper.InferFileNewFromWopiPrecheckInfo(t.WopiPrecheckInfo,t.ApplicationUrl,t.NewFileTemplateSource,this.logger),n.HasFileGetUrlForEdit(t,new UsePODSDetails(i!="false",!0,"wdPodsEnabled is available",r))):n.HasFileGetUrlForEdit(t,PPTBootstrapper.PODSFlighting(t,!0,this.logger))},n.HasFileGetUrlForEdit=function(n,t){return n.WopiPrecheckInfo.FileGetUrl||t.CreateNewScenario!=CreateNewScenario.NotCreateNew?t:new UsePODSDetails(!1,!1,t.Reason+"| FileGetUrl is empty",t.CreateNewScenario)},n.prototype.LogShouldUsePods=function(n,t){var i={ShouldUsePodsOrCached:n.ShouldUsePODS,ShouldUsePods:n.ShouldUsePODS,CanUsePods:n.CanUsePODS,ApplicationUrl:PPTBootstrapper.ExtractHostname(t),Reason:n.Reason,CreateNewScenario:CreateNewScenario[n.CreateNewScenario]};this.logger.ULS.traceTag(38580687,logCategory.PptSession,logLevel.Info,JSON.stringify(i))},n.GetHostSessionId=function(n){return!n||n.toLowerCase().indexOf("#")>-1?Math.random().toString(36).substring(2,25):n},n.prototype.CreateFrame=function(t,i,r){var c,p,f,a,v,k,ht,d,g,l,o,y,s,nt,u,it,rt,ut,ft,yt,pt;if(!i.IsFileNew){if(!i.WopiPrecheckInfo.FileGetUrl)throw Error("Missing FileGetUrl from contentParams");if(!i.WopiPrecheckInfo.FileName)throw Error("Null or Empty Filename");}if(c=this.GetPodsUrl(i),!c)throw Error("Invalid Pods URL");if(p=this.GetPopsUrl(i),!p)throw Error("Invalid Pops URL");var et=SlideDimensionsHelper.CalculateEditingAreaDimensions(),ot=SlideDimensionsHelper.GetAdjustedSlideDimensions(new Dimensions(848,477),et),w=UrlUtils.GetQueryStringParam("wdEmbedView")=="true"||i.ApplicationUrl.indexOf("&Embed=1")!=-1,b=w?"pptEmbed.aspx":"ppt.aspx",st=BrowserUtils.SupportsNewMobileWebExp()==!0;if(this.logger.ULS.traceTag(51380293,logCategory.PptSession,logLevel.Info,"IsRequestForMobileView:"+st),b=st?"pptMobileApp.aspx":b,f=c+b+"?wdPodsUrl="+UrlUtils.UrlKeyValueEncode(c)+"&wdPopsUrl="+UrlUtils.UrlKeyValueEncode(p)+"&fastBoot=true&sw="+ot.Width+"&sh="+ot.Height+"&thPanel="+et.Height+"&ro="+i.WopiPrecheckInfo.ReadOnly+"&sftc=1&NoAuth=1",i.WopiPrecheckInfo.FileName&&(f+="&fileName="+UrlUtils.UrlKeyValueEncode(i.WopiPrecheckInfo.FileName)),a=UrlUtils.GetQueryStringParam("wdfs"),a&&(f+="&fslide="+a),v=UrlUtils.GetQueryStringParam("wdfsection"),v&&(f+="&fsection="+v),k=UrlUtils.GetQueryStringParam("wdIncludeHostUrl"),(a||v||k&&k!="false")&&(f=UrlUtils.addOrReplaceParameterValue(f,"frameURL",UrlUtils.UrlKeyValueEncode(window.location.href))),f=UrlOverrideUtils.UpdateOverride(f),f=PPTBootstrapper.AppendCommonFrameUrlQueryParams(f,i),i.IsFileNew&&(f+="&new=1"),i.NewFileTemplateSource&&i.NewFileTemplateSource.FileSize?f+="&fs="+i.NewFileTemplateSource.FileSize:i.WopiPrecheckInfo.FileSize&&(f+="&fs="+i.WopiPrecheckInfo.FileSize),ht=n.GetHostSessionId(i.SessionInformation.HostSessionId),i.SessionInformation.HostSessionId&&(f+="&hid="+ht),d=UrlUtils.GetQueryStringParam("Automation"),d&&(f+="&Automation="+d),g=UrlUtils.GetQueryStringParam("StartRehearsal"),g&&(f+="&StartRehearsal="+g),r&&!w&&(f+="&usid="+r),i.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&(f+="&uiEmbed=1"),i.SessionInformation.SupportsAccessibilityLoop&&(f+="&accloop=1"),l=UrlUtils.getParameterValueDecoded(i.ApplicationUrl,"uih"),l&&(f+="&uih="+l),i.SessionInformation.HighContrastMode&&(f+="&hcm="+UrlUtils.UrlKeyValueEncode(i.SessionInformation.HighContrastMode)),o=UrlUtils.GetQueryStringParam("nav"),(o==null||o=="")&&(o=UrlUtils.getParameterValue(i.ApplicationUrl,"actNavId")),o)try{var wt=UrlUtils.Base64Decode(o),ct=JSON.parse(wt),lt=ct.sId;lt&&(f=UrlUtils.addOrReplaceParameterValue(f,"wdSlideId",lt),f=UrlUtils.addOrReplaceParameterValue(f,"DC","1"));y=ct.commentId;y&&y!=="null"&&(f=UrlUtils.addOrReplaceParameterValue(f,"wdCommentId",y))}catch(kt){this.logger.ULS.traceTag(38580688,logCategory.PptSession,logLevel.Error,"Failed to parse navigation ID: "+o)}if(t){var at=200,vt=300,e=document.createElement("iframe");e.frameBorder="0";e.style.top=HTMLHelper.toPx(0);e.style.bottom=HTMLHelper.toPx(0);e.style.left=HTMLHelper.toPx(0);e.style.right=HTMLHelper.toPx(0);e.style.height=HTMLHelper.floatToPercent(1);e.style.width=HTMLHelper.floatToPercent(1);e.style.minWidth=HTMLHelper.toPx(vt);e.style.minHeight=HTMLHelper.toPx(at);e.style.position="absolute";e.setAttribute("allowfullscreen",(!0).toString());e.setAttribute("allowTransparency",(!0).toString());s="autoplay;";BrowserUtils.IsSafariAtLeast(1)?(s+="microphone;",s+="camera;"):(nt=c+" "+PPTBootstrapper.GetWacStaticResourcesServer(i.ApplicationCustomSettings,i.ApplicationUrl,i.BootstrapperUrl,i)+";",s+="microphone "+nt,s+="camera "+nt);e.setAttribute("allow",s);e.id="WebApplicationFrame";e.name="wac_frame";e.title="Office Online Frame";t.style.top=HTMLHelper.toPx(0);t.style.bottom=HTMLHelper.toPx(0);t.style.left=HTMLHelper.toPx(0);t.style.right=HTMLHelper.toPx(0);t.style.height=HTMLHelper.floatToPercent(1);t.style.width=HTMLHelper.floatToPercent(1);t.style.minWidth=HTMLHelper.toPx(vt);t.style.minHeight=HTMLHelper.toPx(at);t.appendChild(e);var bt=Date.now(),h=void 0,tt=void 0;return i.NewFileTemplateSource&&i.NewFileTemplateSource.FileGetUrl&&(tt=i.NewFileTemplateSource.FileGetUrl),h=i.WopiPrecheckInfo.FileGetUrl,this.logger.ULS.traceTag(38580689,logCategory.PptSession,logLevel.Info,h?h.toString().length.toString():"null"),f+="&fileGetUrlBool="+!!h,u=document.createElement("form"),u.name="frameForm",u.id="frameForm",u.target="wac_frame",u.action=f,u.method="post",t.appendChild(u),i.WopiInfo&&(it=i.WopiInfo.WopiSrc,it&&u.appendChild(n.CreateHiddenInputElement("WOPISrc",it)),rt=i.WopiInfo.AccessToken,rt&&u.appendChild(n.CreateHiddenInputElement("access_token",UrlUtils.UrlKeyValueEncode(rt))),ut=i.WopiInfo.AccessTokenExpiry,ut&&u.appendChild(n.CreateHiddenInputElement("access_token_ttl",ut.getTime().toString()))),h&&u.appendChild(n.CreateHiddenInputElement("fileUrl",h)),tt&&u.appendChild(n.CreateHiddenInputElement("templateUrl",tt)),i.SessionInformation.UserId&&(u.appendChild(n.CreateHiddenInputElement("UserID",i.SessionInformation.UserId)),u.appendChild(n.CreateHiddenInputElement("user_id",i.SessionInformation.UserId))),i.WopiPrecheckInfo.IrmEnabled&&u.appendChild(n.CreateHiddenInputElement("irmEnabled",i.WopiPrecheckInfo.IrmEnabled.toString())),i.WopiPrecheckInfo.SupportsDecryptedContentDownload&&u.appendChild(n.CreateHiddenInputElement("SupportsDecryptedContentDownload",i.WopiPrecheckInfo.SupportsDecryptedContentDownload.toString())),i.WopiPrecheckInfo.ViewOnly&&u.appendChild(n.CreateHiddenInputElement("ViewOnly",i.WopiPrecheckInfo.ViewOnly.toString())),i.NewFileTemplateSource&&i.NewFileTemplateSource.ETag?u.appendChild(n.CreateHiddenInputElement("ETag",i.NewFileTemplateSource.ETag)):i.WopiPrecheckInfo.ETag&&u.appendChild(n.CreateHiddenInputElement("ETag",i.WopiPrecheckInfo.ETag)),i.WopiPrecheckInfo.CTag&&u.appendChild(n.CreateHiddenInputElement("RevID",i.WopiPrecheckInfo.CTag)),i.NewFileTemplateSource&&i.NewFileTemplateSource.DocUniqueId?u.appendChild(n.CreateHiddenInputElement("DocID",i.NewFileTemplateSource.DocUniqueId)):i.WopiPrecheckInfo.DocUniqueId&&u.appendChild(n.CreateHiddenInputElement("DocID",i.WopiPrecheckInfo.DocUniqueId)),i.WopiPrecheckInfo.BundleInfo.Url&&u.appendChild(n.CreateHiddenInputElement("bundleUrl",i.WopiPrecheckInfo.BundleInfo.Url)),i.WopiPrecheckInfo.PreseededSessionKey&&!w&&u.appendChild(n.CreateHiddenInputElement("PreseededSessionKey",i.WopiPrecheckInfo.PreseededSessionKey)),i.SessionInformation.HostName&&u.appendChild(n.CreateHiddenInputElement("fileSrc",i.SessionInformation.HostName)),i.ApplicationCustomSettings&&i.ApplicationCustomSettings.HostUIControls&&u.appendChild(n.CreateHiddenInputElement("huictrls",JSON.stringify(i.ApplicationCustomSettings.HostUIControls))),i.FnIsFeatureEnabled&&this.m_featureManager&&u.appendChild(n.CreateHiddenInputElement("feature_status",this.getAllFeatureStatuses(this.m_featureManager))),BrowserUtils.SupportsTouch()&&u.appendChild(n.CreateHiddenInputElement("touchDevice","1")),window.document.documentElement&&(window.document.documentElement.clientWidth!==undefined&&u.appendChild(n.CreateHiddenInputElement("windowWidth",window.document.documentElement.clientWidth.toString())),window.document.documentElement.clientHeight!==undefined&&u.appendChild(n.CreateHiddenInputElement("windowHeight",window.document.documentElement.clientHeight.toString()))),ft=UrlUtils.GetQueryStringParam("PreviousSessionID"),ft&&u.appendChild(n.CreateHiddenInputElement("PreviousSessionID",ft)),this.IsLocalStorageSupported()&&u.appendChild(n.CreateHiddenInputElement("LSSupported","1")),u.appendChild(n.CreateHiddenInputElement("postMessageToken",i.PostMessageToken)),(i.SessionInformation.HideHeader||l==="teams"||l==="owa")&&u.appendChild(n.CreateHiddenInputElement("hhdr","1")),i.SessionInformation.SupportsCreateNewDocument&&u.appendChild(n.CreateHiddenInputElement("scnd","1")),i.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&i.SessionInformation.SupportsDocReboot&&u.appendChild(n.CreateHiddenInputElement("sdr",i.SessionInformation.SupportsDocReboot===!0?"1":i.SessionInformation.SupportsDocReboot.toString())),i.SessionInformation.HideWACOneDriveFileLocationPicker&&u.appendChild(n.CreateHiddenInputElement("hodflp","1")),i.SessionInformation.SupportsAtMentions&&u.appendChild(n.CreateHiddenInputElement("sams","1")),i.WopiPrecheckInfo.RequestedCallThrottling&&(yt=i.WopiPrecheckInfo.RequestedCallThrottling,u.appendChild(n.CreateHiddenInputElement("rct",yt))),i.WopiPrecheckInfo.ClientThrottlingProtection&&(pt=i.WopiPrecheckInfo.ClientThrottlingProtection,u.appendChild(n.CreateHiddenInputElement("ctp",pt))),i.WopiPrecheckInfo.OpenViewByDefault&&u.appendChild(n.CreateHiddenInputElement("ovbd",i.WopiPrecheckInfo.OpenViewByDefault.toString())),u.submit(),{IFrameElement:e,FrameCreateTime:bt}}return null},n.CreateHiddenInputElement=function(n,t){var i=document.createElement("input");return i.type="hidden",i.name=n,i.value=t,i},n.prototype.validateUrlHostMatchesWindowHost=function(n){var t=document.createElement("a"),i,r;return t.href=n,i=t.port||80,r=window.location.port||80,t.hostname==window.location.hostname&&i==r},n.prototype.GetPodsUrl=function(n){var t=UrlUtils.GetQueryStringParam("wdPodsUrl");return t&&!this.validateUrlHostMatchesWindowHost(t)&&(t=""),t||(t=PPTBootstrapper.GetOnDemandServer(n,!0)),t.substr(t.length-1)!="/"&&(t+="/"),t},n.prototype.GetPopsUrl=function(n){var t=UrlUtils.GetQueryStringParam("wdPopsUrl");return t&&!this.validateUrlHostMatchesWindowHost(t)&&(t=""),t||(t=this.GetPodsUrl(n),t=t.substr(0,t.indexOf("/pods/"))),t.substr(t.length-1)!="/"&&(t+="/"),t},n.prototype.IsLocalStorageSupported=function(){var n="Test";try{return localStorage.setItem(n,n),localStorage.removeItem(n),!0}catch(t){return!1}},n.prototype.Log=function(n){this.logger.ULS.traceTag(39978262,logCategory.PptSession,logLevel.Info,n)},n.prototype.OnMessage=function(n,t){var o=this,i=n,u,f,r,e;try{if(!i||!this.m_appData){this.logger.ULS.traceTag(39978263,logCategory.PptSession,logLevel.Error,"Missing message data: "+!i+" or appData: "+!this.m_appData);return}this.m_iframe&&this.m_iframe.contentWindow==t||this.logger.ULS.traceTag(39978264,logCategory.PptSession,logLevel.Error,"Message with the right postMessageToken came from an unexpected iframe");!i.Data.officeSessionId&&this.m_appData.AppInitDiagnostics.officeSessionId&&(i.Data.officeSessionId=this.m_appData.AppInitDiagnostics.officeSessionId);i.Data.messageType||(i.Data.messageType=i.Type);this.logger.ULS.traceTag(38580691,logCategory.PptSession,logLevel.Warning,JSON.stringify(i.Data));switch(i.Type){case MessageType.AppReadyForPostMessage:this.m_wopiBootParams&&(this.m_wopiBootParams.m_hasAppBooted=!0);i.Data.officeSessionId&&(this.m_appData.AppInitDiagnostics.officeSessionId=i.Data.officeSessionId);window.setTimeout(function(){return o.TryPostWopiInfo()},1);break;case MessageType.AppBootComplete:if(this.m_bootCompleted=!0,this.m_appData.InitParams.FnOnInitializeSuccess){if(this.m_appData.AppInitDiagnostics.officeBootstrapperVersion=this.GetVersion(),i.Data.officeAppEndpoint&&(this.m_appData.AppInitDiagnostics.officeAppEndpoint=i.Data.officeAppEndpoint),i.Data.officeServerVersion&&(this.m_appData.AppInitDiagnostics.officeServerVersion=i.Data.officeServerVersion),i.Data.documentLoadedTime&&(this.m_appData.AppInitDiagnostics.documentLoadedTime=i.Data.documentLoadedTime,this.m_appData.AppInitDiagnostics.appCompletedTime=i.Data.documentLoadedTime),i.Data.officeFrameFirstFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameFirstFlushTime=i.Data.officeFrameFirstFlushTime),i.Data.officeFrameDocumentFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameDocumentFlushTime=i.Data.officeFrameDocumentFlushTime),i.Data.documentFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameServerDocumentFlushTime=i.Data.documentFlushTime),i.Data.serverFirstFlushTime&&(this.m_appData.AppInitDiagnostics.officeFrameServerFirstFlushTime=i.Data.serverFirstFlushTime),i.Data.serverStartTime&&(this.m_appData.AppInitDiagnostics.officeFrameServerStartTime=i.Data.serverStartTime),i.Data.bootStartMs&&(this.m_appData.AppInitDiagnostics.officeServerDocumentProcessStartTime=i.Data.bootStartMs),i.Data.bootEndMs&&(this.m_appData.AppInitDiagnostics.officeServerDocumentProcessEndTime=i.Data.bootEndMs),i.Data.cacheHit&&(this.m_appData.AppInitDiagnostics.cacheHit=i.Data.cacheHit),u={browserRequest:!1,status:200,isAppCompleteCritical:!0,isDocumentLoadCritical:!0,name:"BootRequest"},i.Data.downloadCorrelation&&(u.correlationId=i.Data.downloadCorrelation),i.Data.downloadStartMs&&(u.startTime=i.Data.downloadStartMs),i.Data.downloadEndMs&&(u.endTime=i.Data.downloadEndMs),i.Data.downloadSize&&(u.size=i.Data.downloadSize),i.Data.incDownload&&(u.incremental=i.Data.incDownload),this.m_appData.AppInitDiagnostics.fileRequestsData=[],this.m_appData.AppInitDiagnostics.fileRequestsData.push(u),this.windowVisibilityMetrics.Stop(),f=this.windowVisibilityMetrics.GetVisibilityChangeEvents(),f&&f.length>0&&(this.m_appData.AppInitDiagnostics.documentLoadedWithTabSwitch=!0,this.logger.ULS.traceTag(38580692,logCategory.PptSession,logLevel.Info,"Visibility Change Events:"+JSON.stringify(f))),this.logger.ULS.traceTag(34932955,logCategory.PptSession,logLevel.Warning,JSON.stringify(this.m_appData.AppInitDiagnostics)),!this.m_postMessageHandler){this.logger.ULS.traceTag(51448022,logCategory.PptSession,logLevel.Warning,"PPTUnifiedSessionLoader::OnMessage::AppBootComplete null m_postMessageHandler");throw Error("m_postMessageHandler");}e=function(){o.Dispose()};this.m_app=new PPTApplication(this.m_appData.InitParams.PostMessageToken,e,this.m_iframe||null,this.logger,!!this.m_appData.InitParams.SessionInformation.SupportsAccessibilityLoop,this.m_postMessageHandler);this.m_appData.InitParams.FnOnInitializeSuccess(this.m_app,this.m_appData.AppInitDiagnostics)}break;case MessageType.RefreshPage:if(this.m_appData.InitParams.ApplicationUrl.toLowerCase().indexOf("uiembed=1")>-1&&this.m_appData.InitParams.SessionInformation.SupportsDocReboot){if(!this.m_app){this.logger.ULS.traceTag(51448023,logCategory.PptSession,logLevel.Info,"PPTUnifiedSessionLoader::OnMessage::RefreshPage null m_app");throw Error("m_app");}this.m_app.TriggerDocReboot(i.Data);break}r=window.location.href;r.indexOf("&wdccsoff=1")!=-1&&(r=UrlUtils.addOrReplaceParameterValue(r,"wdccsoff"));i.Data.officeSessionId&&(r=UrlUtils.addOrReplaceParameterValue(r,"PreviousSessionID",i.Data.officeSessionId));i.Data.ControllerServicesParam&&(r=UrlUtils.addOrReplaceParameterValue(r,i.Data.ControllerServicesParamName,i.Data.ControllerServicesParam));this.logger.ULS.traceTag(594068673,logCategory.PptSession,logLevel.Info,"PPTUnifiedSessionLoader::OnMessage::RefreshPage Updating window.location.href");window.location.href=r;break;case MessageType.UpdateInitializationComplete:this.m_postMessageHandler||(this.logger.ULS.traceTag(51448024,logCategory.PptSession,logLevel.Info,"PPTUnifiedSessionLoader::OnMessage::AppBootComplete null m_postMessageHandler"),this.m_postMessageHandler=new PostMessageHandler(UrlUtils.getOrigin(this.m_appData.InitParams.ApplicationUrl),this.logger,this.m_iframe||null));e=function(){o.Dispose()};this.m_app=new PPTApplication(this.m_appData.InitParams.PostMessageToken,e,this.m_iframe||null,this.logger,!!this.m_appData.InitParams.SessionInformation.SupportsAccessibilityLoop,this.m_postMessageHandler);this.m_appData.InitParams.FnOnInitializeSuccess(this.m_app,this.m_appData.AppInitDiagnostics);break;case MessageType.AppError:if(this.m_appErrors.length>=this.c_appErrorThrottleCount)break;i.Data.ErrorName?this.m_appErrors.push({DuringBoot:!this.m_bootCompleted,ErrorName:i.Data.ErrorName,Tag:i.Data.Tag}):this.logger.ULS.traceTag(588044119,logCategory.PptSession,logLevel.Warning,"PPTUnifiedSessionLoader::OnMessage::AppError message data is missing required field")}}catch(s){this.logger.ULS.traceTag(594121922,logCategory.PptSession,logLevel.Error,"PPTUnifiedSessionLoader::OnMessage Caught exception: "+s)}},n.prototype.Dispose=function(){var n=PPTMessageListenerRegistry.GetInstance();n&&this.m_appData&&n.Remove(this.m_appData.InitParams.PostMessageToken,!1);this.m_postMessageHandler&&this.m_postMessageHandler.Dispose();this.m_iframe&&this.m_iframe.parentElement&&this.m_iframe.parentElement.removeChild(this.m_iframe);this.m_iframe&&delete this.m_iframe;this.m_iframe=null;this.logger.ULS.traceTag(587552790,logCategory.PptSession,logLevel.Warning,"PPTUnifiedSessionLoader::Dispose:: App dispose");this.windowVisibilityMetrics.Stop()},n.prototype.TryPostWopiInfo=function(){var t=this.m_wopiBootParams&&this.m_wopiBootParams.GetIfAllFieldsSet(),n,i;!this.m_wopiPostMessageCalled&&t&&t.m_iframe.contentWindow&&(n={},n.WopiSrc=t.m_wopiInfo.WopiSrc,n.AccessToken=t.m_wopiInfo.AccessToken,n.AccessTokenTTL=!t.m_wopiInfo.AccessTokenExpiry?0:t.m_wopiInfo.AccessTokenExpiry.getTime(),n.ReadOnly=t.m_readonly,n.IrmEnabled=t.m_irmEnabled,n.SupportsDecryptedContentDownload=t.m_supportsDecryptedContentDownload,n.FileName=t.m_fileName,n.SessionContext=this.m_sessionContext,n.WdParams=this.m_wdParams,n.DocumentURL=window.location.href,i=UrlUtils.GetQueryStringParam("PreviousSessionID"),i&&(n.PreviousSessionID=i),this.SetHostPerfData(n),t.m_iframe.contentWindow.postMessage(JSON.stringify(n),t.m_podsUrl),this.m_wopiPostMessageCalled=!0)},n.prototype.SetHostPerfData=function(n){var s=window.self.WOPIPerf_FirstPageFlush,r,u,f,e,o,t,i;s&&(n.FirstPageFlushTime=s);r=window.self.WOPIPerf_BootJsStartTime;r&&(n.BootJsStartTime=r);u=window.self.WOPIPerf_BootJsEndTime;u&&(n.BootJsEndTime=u);f=window.self.WOPIPerf_InitializeWac;f&&(n.InitializeWacTime=f);e=window.self.WOPIPerf_UserClick;o=this.m_appData&&this.m_appData.AppInitDiagnostics&&this.m_appData.AppInitDiagnostics.userClickTime;e?n.UserClickTime=e:o&&(n.UserClickTime=o);window.performance&&(t=window.performance.timing,t&&(n.NavigationStart=t.navigationStart,n.FetchStart=t.fetchStart,n.RequestStart=t.requestStart,n.ResponseStart=t.responseStart,n.ResponseEnd=t.responseEnd),i=window.performance.navigation,i&&(n.NavigationType=i.type,n.NavigationRedirects=i.redirectCount))},n.GetWacFallbackUrl=function(n,t){var r,u,f,i;return n.WopiSrc.indexOf("PowerPointFrame.aspx")>=0&&(r=n.WopiSrc.substr(n.WopiSrc.indexOf("WOPISrc=")+8),u=r.indexOf("&"),n.WopiSrc=u<0?decodeURIComponent(decodeURI(r)):decodeURIComponent(r.substring(0,u))),f=t.ApplicationUrl.indexOf("?"),i=t.ApplicationUrl.substring(0,f),i+="?wdEnableRoaming=1&wdo=1",i=UrlUtils.addOrReplaceParameterValue(i,"PowerPointView",UrlUtils.getParameterValue(t.ApplicationUrl,"PowerPointView")),t.ApplicationUrl.toLowerCase().indexOf("new=1")>=0&&(i=UrlUtils.addOrReplaceParameterValue(i,"New","1")),t.ApplicationUrl.indexOf("Embed=1")>=0&&(i=UrlUtils.addOrReplaceParameterValue(i,"Embed","1")),t.ApplicationCustomSettings&&t.ApplicationCustomSettings.OnDemandServer==""&&(i=UrlUtils.addOrReplaceParameterValue(i,"noLog","True")),n.WopiSrc&&(i=UrlUtils.addOrReplaceParameterValue(i,"WOPISrc",UrlUtils.UrlKeyValueEncode(n.WopiSrc))),UrlOverrideUtils.UpdateOverride(i)},n.prototype.UpdateBrowserHistoryForCreateNew=function(n){if(n&&n.NewFilePath)window.history.replaceState(null,"",n.NewFilePath),n.UpdatedPageTitle&&(window.document.title=n.UpdatedPageTitle);else if(window.location.href.indexOf("action=editnew")>=0){var t=window.location.href.replace("action=editnew","action=edit");window.history.replaceState(null,window.document.title||"",t)}},n.prototype.getAllFeatureStatuses=function(n){var r={},t,i;if(n)for(t in FeatureIds)i=n.isFeatureEnabled(t),i!=undefined&&(r[t]=i?"1":"0");return JSON.stringify(r)},n.prototype.OnWopiInfoReceived=function(n,t,i){var r=this;this.m_wopiBootParams&&(this.m_wopiBootParams.m_wopiInfo=n);t==CreateNewScenario.UnifiedCreateNew&&(i?this.UpdateBrowserHistoryForCreateNew(i):this.UpdateBrowserHistoryForCreateNew());window.setTimeout(function(){return r.TryPostWopiInfo()},1)},n.prototype.FWdPopOrPodParam=function(n){return n.toLocaleLowerCase().indexOf("pod")>=0||n.toLocaleLowerCase().indexOf("pop")>=0?!0:!1},n.prototype.handleTrustFrameRequest=function(){var n=window===window.top||window.parent===window.top&&window.location.origin===window.top.location.origin;this.m_iframe&&this.m_iframe.contentWindow&&this.m_postMessageHandler?this.m_postMessageHandler.SendPostMessage(this.m_iframe.contentWindow,"Host_IsFrameTrusted",{isTopFrameTrusted:n}):this.logger.ULS.traceTag(51237655,logCategory.PptSession,logLevel.Error,"Trust frame request received but the wac frame is null")},n.prototype.pingInnerAppFrame=function(){var n=this.m_wopiBootParams,t;this.logger.ULS.traceTag(593881033,logCategory.PptSession,logLevel.Warning,"Pinging app frame since bootstrapper timed out");n&&n.m_iframe&&n.m_iframe.contentWindow&&n.m_podsUrl?(t={},t.MessageType="PingApp",t.MessageTime=(new Date).getTime(),n.m_iframe.contentWindow.postMessage(JSON.stringify(t),n.m_podsUrl),this.m_wopiBootParams=null):this.logger.ULS.traceTag(593881032,logCategory.PptSession,logLevel.Warning,"Tried pinging app frame after bootstrapper timeout but iframe is null.")},n.prototype.GetWopiPendingApplication=function(){return this.m_wopiPendingApplication},n}(),PPTUnifiedBootstrapper=function(){function n(){}return n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.prototype.GetMinContentVersion=function(){return 1},n.prototype.Prefetch=function(){},n.prototype.InitializeWopiPending=function(n){var t=new PPTUnifiedSessionLoader(n);return t.GetWopiPendingApplication()},n}();Microsoft.Office.PowerPoint.Application=new PPTUnifiedBootstrapper;var PPTDisabledApplication=function(){function n(n){this.m_sessionId=n}return n.prototype.GetApplicationType=function(){return"PowerPoint"},n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.prototype.GetSessionId=function(){return this.m_sessionId},n.prototype.RegisterEventHandler=function(){},n.prototype.RemoveEventHandler=function(){},n.prototype.RegisterErrorHandler=function(){},n.prototype.RemoveErrorHandler=function(){},n.prototype.AddEventHandler=function(){},n.prototype.dispose=function(){},n.prototype.Dispose=function(){},n.prototype.GetIsDisabled=function(){return!0},n.prototype.GetPercievedBoot=function(){return null},n.prototype.UsingCached=function(){return!1},n.prototype.GetCurrentSlideDimensions=function(){},n.prototype.GetSlidesInShowCount=function(){},n.prototype.GetTimeLineInfos=function(){},n.prototype.GetCurrentPosition=function(){},n.prototype.GetId=function(){},n.prototype.Next=function(){},n.prototype.PausePresentation=function(){},n.prototype.PlayPresentation=function(){},n.prototype.GetPresentationPlaybackState=function(){},n.prototype.NextSlide=function(){},n.prototype.Prev=function(){},n.prototype.PrevSlide=function(){},n.prototype.GoToNextSlide=function(){},n.prototype.GoToPrevSlide=function(){},n.prototype.GoToSlide=function(){},n.prototype.GoToSlideId=function(){},n.prototype.DisplayBlackSlide=function(){},n.prototype.DisplayWhiteSlide=function(){},n.prototype.Popout=function(){},n.prototype.PlayMedia=function(){},n.prototype.PauseMedia=function(){},n.prototype.RestoreFocus=function(){},n.prototype.StopMedia=function(){},n.prototype.SeekMedia=function(){},n.prototype.GetCurrentMediaStates=function(){},n.prototype.SetNavigationOptions=function(){},n}(),TimeoutWrapper=function(){function n(n,t,i,r,u){var f=this,e,o;this.m_initialTicks=0;this.m_onSuccessTicks=0;this.m_onFailureTicks=0;this.m_onTimeoutTicks=0;this.m_fCallbackCalled=!1;this.m_scenario="";this.m_hostSessionId="";this.m_host="";this.errorCode=5;this.m_callbackTimeoutError={errorType:"AppInitError",errorObject:"Timed out waiting for FnOnInitializeSuccess",Category:0,Code:this.errorCode,EventType:13,ExtraInfo:"Initialization timeout"};this.m_scenario=r;this.m_appErrors=u;n&&(n.FnOnInitializeSuccess&&(e=n.FnOnInitializeSuccess,n.FnOnInitializeSuccess=function(i,r){f.m_onSuccessTicks=Date.now();f.m_fCallbackCalled||(f.m_fCallbackCalled=!0,f.m_onTimeoutTicks?f.LogCallbackArrivedAfterTimeout("success",r,t):(t&&(t.ULS.traceTag(38836226,logCategory.PptSession,logLevel.Info,"TimeoutWrapper: Calling fnOnInitializeSuccess"),PPTBootstrapperLogger.RecordBootCompleted(n,null,null,t,Date.now())),e(i,r)))}),n.FnOnInitializeFailure&&(o=n.FnOnInitializeFailure,n.FnOnInitializeFailure=function(i,r){if(f.m_onFailureTicks=Date.now(),!f.m_fCallbackCalled)if(f.m_fCallbackCalled=!0,f.m_onTimeoutTicks&&i!=f.m_callbackTimeoutError)f.LogCallbackArrivedAfterTimeout("failure",r,t,i);else{if(t){var u=i;t.ULS.traceTag(38836227,logCategory.PptSession,logLevel.Info,"TimeoutWrapper: Calling fnOnInitializeFailure");PPTBootstrapperLogger.RecordBootCompleted(n,u.Code,u.errorObject,t,Date.now())}o(i,r)}}),n.SessionInformation&&(this.m_hostSessionId=n.SessionInformation.HostSessionId,this.m_host=n.SessionInformation.HostName));this.TryStartTimeout(n,t,i)}return n.AddTimeoutWrappersToHostCallbacks=function(t,i,r,u,f){new n(t,i,r,u,f)},n.prototype.TryStartTimeout=function(n,t,i){var f=this,u,r;this.m_initialTicks=Date.now();u=Configuration.HostCallbackTimeout;r=UrlUtils.GetQueryStringParam("wdOnSuccessTimeout");!r||parseInt(r).toString()!=r||(u=parseInt(r));u&&window.setTimeout(function(){return f.CheckIfAppBootCompleteBeforeTimingOut(n,t,i)},u)},n.prototype.LogCallbackArrivedAfterTimeout=function(n,t,i,r){var u={};u.Message="Received "+n+" callback after timeout had elapsed";u.timeoutTimeMs=this.m_onTimeoutTicks;u.successTimeMs=this.m_onSuccessTicks;u.startTimeMs=this.m_initialTicks;u.appInitDiagnostics=t;r&&(u.error=r);i&&i.ULS.traceTag(38589660,logCategory.PptSession,logLevel.Info,JSON.stringify(u))},n.prototype.CheckIfAppBootCompleteBeforeTimingOut=function(n,t,i){var r=this;this.m_onFailureTicks||this.m_onSuccessTicks||this.m_onTimeoutTicks||(t.ULS.traceTag(593881031,logCategory.PptSession,logLevel.Warning,"Pinging App Frame. Timed out waiting for FnOnInitializeSuccess to be called. startMs:"+this.m_initialTicks+", timeoutMs:"+this.m_onTimeoutTicks),i&&i(),window.setTimeout(function(){return r.TimeoutIfSuccessNotCalled(n,t)},4e3))},n.prototype.TimeoutIfSuccessNotCalled=function(n,t){if(!this.m_onFailureTicks&&!this.m_onSuccessTicks&&!this.m_onTimeoutTicks){if(this.m_onTimeoutTicks=Date.now(),t){var i="Timed out waiting for FnOnInitializeSuccess to be called. startMs:"+this.m_initialTicks+", timeoutMs:"+this.m_onTimeoutTicks+", scenario:"+this.m_scenario+", hostSessionId:"+this.m_hostSessionId+", host: "+this.m_host;t.ULS.traceTag(38589661,logCategory.PptSession,logLevel.Error,i);PPTBootstrapperLogger.RecordBootFailure(n,this.errorCode,i,t,this.m_onTimeoutTicks,this.m_appErrors)}n.FnOnInitializeFailure&&n.FnOnInitializeFailure(this.m_callbackTimeoutError)}},n}(),PPTBootstrapperLogger=function(){function n(){}return n.RecordBootFailure=function(t,i,r,u,f,e){if(!n.IsBootSuccess(i,r)){var o={AppMetadata:n.GetAppMetadata(t,PPTBootstrapSettings.getAppMetadata()),BootInfo:n.GetBootInfo(t,f,n.IsBootSuccess(i,r)),BundleMetadata:"[]",FatalErrors:n.GetFatalErrorInfo(i,r),NonFatalErrors:"[]",WopiPrecheckInfo:n.GetWopiPrecheckInfo(t),AppErrors:e};u.ULS.traceTag(592007955,logCategory.PptSession,logLevel.Error,JSON.stringify(o));n.RecordBootCompleted(t,i,r,u,f)}},n.RecordBootCompleted=function(t,i,r,u,f){var e={AppMetadata:n.GetAppMetadata(t,PPTBootstrapSettings.getAppMetadata()),BootInfo:n.GetBootInfo(t,f,n.IsBootSuccess(i,r)),BundleMetadata:"[]",FatalErrors:n.GetFatalErrorInfo(i,r),NonFatalErrors:"[]",WopiPrecheckInfo:n.GetWopiPrecheckInfo(t)};u.ULS.traceTag(587843200,logCategory.PptSession,logLevel.Info,JSON.stringify(e))},n.GetWopiPrecheckInfo=function(t){return t&&t.WopiPrecheckInfo?{FileGetUrlBool:t.WopiPrecheckInfo.FileGetUrl?!0:!1,FileNameBool:t.WopiPrecheckInfo.FileName?!0:!1,ReadOnly:t.WopiPrecheckInfo.ReadOnly,SupportsDecryptedContentDownload:t.WopiPrecheckInfo.SupportsDecryptedContentDownload,ViewOnly:t.WopiPrecheckInfo.ViewOnly,PreseededSessionKey:t.WopiPrecheckInfo.PreseededSessionKey,BundleInfo:n.GetBundleInfo(t.WopiPrecheckInfo.BundleInfo)}:""},n.GetBundleInfo=function(n){if(n){var t=n;return{MajorVersion:t.MajorVersion,URLBool:t.Url,CrossOrigin:t.CrossOrigin}}return""},n.GetAppMetadata=function(n,t){return n?{BrowserTechnology:"",Browser:"",FileSizeHint:n.WopiPrecheckInfo.FileSize,ApiStartTime:0,HostInitTime:n.SessionInformation.HostInitTime,AppVersion:t.AppVersionMajor+"."+t.AppVersionMinor,ViewerMode:n.ApplicationCustomSettings&&n.ApplicationCustomSettings.ViewerMode?n.ApplicationCustomSettings.ViewerMode:0,UseBabylon:"",EntryPoint:PPTBootstrapper.GetEntryPoint(n),SessionId:n.SessionInformation.HostSessionId,UserAgent:window.navigator.userAgent,ApplicationUrl:n.ApplicationUrl,WACRegion:PodsRegionInfo.GetWACRegion(n.ApplicationUrl),FileHost:PodsRegionInfo.GetFileHost(n),Host:n.SessionInformation.HostName,PodsRing:n.ApplicationUrl?PodsRegionInfo.GetPodsRing(n):"",UiHost:PodsRegionInfo.GetUiHost(n.SessionInformation.HostName),UiHostRing:n.SessionInformation.UiHostRing,CallId:n.SessionInformation.CallId,ContentId:n.SessionInformation.ContentId,SlideShowKind:PPTBootstrapper.GetSlideShowKind(n),UseAspx:PPTBootstrapper.ShouldUseLegacySlideShowAspx(n)}:""},n.GetFatalErrorInfo=function(t,i){return n.IsBootSuccess(t,i)?"":{ErrorCategory:"fatal",ExtraInfo:"",CorrelationId:"",ErrorCode:t,ErrorName:n.GetErrorName(t),Message:i}},n.GetBootInfo=function(n,t,i){return{PreloadCompleteTime:0,DocumentClickTime:n.SessionInformation.DocumentClickTime?n.SessionInformation.DocumentClickTime.getTime():0,BootSuccess:i,BootTime:t,BootMode:""}},n.IsBootSuccess=function(n,t){return n==null&&t==null},n.GetErrorName=function(n){return n==1||n==5||n==100?"Timeout":"Unknown"},n}(),PPTBootstrapSettings=function(){function n(){}return n.getAppMetadata=function(){return{AppVersionMajor:1,AppVersionMinor:BuildVersionConfig.BUILD_NUMBER_MINOR,ContentVersionMajor:1,ContentVersionMinor:BuildVersionConfig.BUILD_NUMBER_MINOR,WacCdnVersion:BuildVersionConfig.BUILD_CDN_NUMBER,Environment:"wac"}},n.getCDNManifestMapping=function(){var n={};return n["pptscripts/reader.dione.js"]="pptscripts/d69bd75dec33d776.js",n["pptscripts/reader.calypso.js"]="pptscripts/a9b6dc1f695d7608.js",n["pptscripts/babylon.js"]="pptscripts/d942fcaf3b4268b7.js",n["pptpages/powerpointframe.html"]="pptpages/e42340d89d6b4789.html",n["pptscripts/powerpoint.boot.vslice.js"]="pptscripts/c56e84b94fc19a81.js",n},n.viewerSliceBootstrapper=function(){return"https://contentstorage.osi.office.net/scripts/pptscripts/c56e84b94fc19a81.js"},n}(),PPTPreviewerBootstrapper=function(){function n(){this.m_appErrors=[]}return n.TryLoadSlice=function(n,t,i,r){var u,f,o,e;try{return u=PPTBootstrapSettings.getAppMetadata(),f=PPTBootstrapSettings.viewerSliceBootstrapper(),u&&u.Environment=="wac"&&(o=PPTBootstrapper.GetWacStaticResourcesServer(n,t,i,r),f=o+u.WacCdnVersion+"_pptscripts/powerpoint.boot.vslice.js"),e=document.createElement("script"),e.src=f,document.head.insertBefore(e,document.head.firstChild),!0}catch(s){return!1}},n.prototype.InitializeWopiPending=function(t){var s,h,c,f,r,u,l,a,v,y,e,o;this.m_appErrors.length=0;var w=Date.now(),b=n.TryLoadSlice(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t),i=undefined;try{return s=t.SessionInformation.HostSessionId,t.ApplicationCustomSettings&&t.ApplicationCustomSettings.ForceHttp||(t.SessionInformation.HostSessionId=PPTBootstrapper.GenerateRandomUUID()),t=PPTBootstrapper.EnsureInitializeParametersAreTheRightType(t),t.ApplicationCustomSettings=n.InitAppSettingsWithDefaults(t.ApplicationCustomSettings),t.WopiPrecheckInfo.BundleInfo&&t.WopiPrecheckInfo.BundleInfo.Url||(t.WopiPrecheckInfo.BundleInfo={MajorVersion:0}),t.PreviewerRolloutRing=PodsRegionInfo.GetPodsRing(t),h=PPTBootstrapper.GetOnDemandServer(t),i=ULS.getLogger(t.SessionInformation.HostSessionId,h+"RemoteUls.ashx"),i.ULS.traceTag(38286563,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session. Build version: "+this.GetVersion()),i.ULS.traceTag(40206739,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session. Slice load initated: "+b),i.ULS.traceTag(590140833,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session for Host Session Id:  "+s),c=(new Date).getTime(),i.ULS.traceTag(38286592,logCategory.PptSession,logLevel.Info,"Bootstrapper Init Time: "+c),t!=null&&t.ApplicationCustomSettings!=null&&i.ULS.traceTag(593295124,logCategory.PptSession,logLevel.Info,"StartingSlideIndex: "+t.ApplicationCustomSettings.StartingSlideIndex),t=PPTBootstrapper.SanitizeInitialParameters(t,i),TimeoutWrapper.AddTimeoutWrappersToHostCallbacks(t,i,function(){},"Previewer",this.m_appErrors),this.windowVisibilityMetrics=new WindowVisibilityMetrics,f=PPTBootstrapper.GetPostMessageToken(t.SessionInformation.HostSessionId),t.PostMessageToken=f,r=n.ShouldUsePODS(t,i),n.LogShouldUsePodsOrCachedResult(r,t.ApplicationUrl,r.Reason,i),t.SessionInformation.WdParams=__assign({},t.SessionInformation.WdParams,{wdBrowserShapeBuilderCompatible:""+this.isBrowserShapeBuilderCompatible({},i),wdIsFileTypeSupportedForModernSlideShow:""+this.isFileTypeSupportedForModernSlideShow(t.WopiPrecheckInfo.FileName)}),u={},u.PostMessageToken=f,u.UsePODSDetails=r,u.HostSessionId=s,l=t,r.ShouldUsePODS||(u.FallbackPreBoot=!0,l=n.SanitizeInputParametersForFallbackLog(t)),PPTBootstrapper.SendInitialLog(l,"Previewer",u,i),r.ShouldUsePODS?(t.ApplicationCustomSettings.OnDemandServer=h,v=PPTBootstrapSettings.getAppMetadata(),v&&v.Environment=="wac"&&(t.ApplicationCustomSettings.WacStaticResourcesServer=PPTBootstrapper.GetWacStaticResourcesServer(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t)),(window.location.search.indexOf("wdTestPreviewer")>=0||window.location.hash.indexOf("wdTestPreviewer")>=0)&&t.WopiPrecheckInfo.BundleInfo&&(t.WopiPrecheckInfo.BundleInfo.Url=undefined),PPTBootstrapper.GetSlideShowKind(t)=="Modern"&&this.SendSnapDownloadUrlRequest(t,i),y={initWopiTime:w,bootstrapperInitTime:c},n.s_prefetchStartTime>0&&(y.prefetchStartTime=n.s_prefetchStartTime,n.s_prefetchStartTime=0),n.CreateViewer(t,i,y,this.m_appErrors),PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"PreviewerTSBoot",i),window.setTimeout(function(){i&&i.ULS.flush()},1e4),{Complete:function(){},Fail:function(r){n.WopiPendingFail(t.SessionInformation.HostSessionId,r,i)}}):(i.ULS.traceTag(38836228,logCategory.PptSession,logLevel.Info,"Previewer unsupported region"),e=void 0,t.ApplicationCustomSettings&&t.ApplicationCustomSettings.EnableWacFallback&&t.ApplicationUrl?(i.ULS.traceTag(38836229,logCategory.PptSession,logLevel.Info,"Previewer setting up wacFallbackController"),a=new WacFallbackController(t,!0,function(t,i){return n.GetWacPreviewURL(t,i)},null,i,this.windowVisibilityMetrics,f),e={Complete:function(n,t){a.WopiPendingApplicationComplete(n,t)},Fail:function(n){a.WopiPendingApplicationFail(n)}}):(i.ULS.traceTag(38836230,logCategory.PptSession,logLevel.Info,"Previewer returning error for unsupported region"),o={errorType:"AppInitError",errorObject:"Region not suppported",Category:0,Code:6,EventType:13,ExtraInfo:"Region not suppported"},t.FnOnInitializeFailure(o),e={Complete:function(){},Fail:function(r){n.WopiPendingFail(t.SessionInformation.HostSessionId,r,i)}}),e)}catch(p){i&&(PPTBootstrapperLogger.RecordBootFailure(t,1,"Bootstrapper InitializeWopiPending exception caught",i,Date.now(),this.m_appErrors),i.ULS.traceTag(38286593,logCategory.PptSession,logLevel.Error,"AppInitError: "+JSON.stringify(p)),i.ULS.traceTag(590140832,logCategory.PptSession,logLevel.Error,"Host Session Id from Teams: "+t.SessionInformation.HostSessionId),i.ULS.flushOnClose());o={errorType:"AppInitError",errorObject:p,Category:0,Code:1,EventType:13,ExtraInfo:"Exception caught"};t.FnOnInitializeFailure(o)}return undefined},n.prototype.isBrowserShapeBuilderCompatible=function(n,t){var f,i,r,u;try{if(f=document.createElement("canvas"),i=f.getContext("webgl"),i==null&&(i=f.getContext("experimental-webgl",{failIfMajorPerformanceCaveat:!0}),n.WebGLExperimental=!0),i==null)return n.GLIncompatible="CanvasRenderingContext",!1;if(!i.getExtension("EXT_blend_minmax"))return n.GLIncompatible="MinMax",!1;if(!i.getExtension("ANGLE_instanced_arrays"))return n.GLIncompatible="Instancing",!1;var o=i.getParameter(i.MAX_VERTEX_ATTRIBS),l=i.getParameter(i.MAX_VERTEX_UNIFORM_VECTORS),s=i.getParameter(i.MAX_VERTEX_TEXTURE_IMAGE_UNITS),h=i.getParameter(i.MAX_VARYING_VECTORS),c=i.getParameter(i.MAX_FRAGMENT_UNIFORM_VECTORS),a=i.getParameter(i.MAX_TEXTURE_IMAGE_UNITS),e=i.getParameter(i.MAX_TEXTURE_SIZE);if(e<4096)return n.GLIncompatible="TextureSize",!1;n.VERTEX_ATTRIBS=o;n.VERTEX_UNIFORM_VECTORS=l;n.VERTEX_TEXTURE_IMAGE_UNITS=s;n.VARYING_VECTORS=h;n.FRAGMENT_UNIFORM_VECTORS=c;n.TEXTURE_IMAGE_UNITS=a;n.TEXTURE_SIZE=e;try{r=i.getExtension("WEBGL_debug_renderer_info");r&&(u={},u.WebGLVendor=i.getParameter(r.UNMASKED_VENDOR_WEBGL),u.WebGLRenderer=i.getParameter(r.UNMASKED_RENDERER_WEBGL),t.ULS.traceTag(594583628,logCategory.PptSession,logLevel.Info,JSON.stringify(u)))}catch(v){}return o<16||s<4||h<8||c<64||e<4096?(n.GLIncompatible="InsufficientCapabilities",!1):!0}catch(y){return n.GLIncompatible="Exception",!1}finally{n.length>0&&t.ULS.traceTag(588105736,logCategory.PptSession,logLevel.Info,JSON.stringify(n))}},n.prototype.isFileTypeSupportedForModernSlideShow=function(n){if(n&&n.split(".")[1]){var t=n.split(".")[1];if(t=="pptx"||t=="ppsx")return!0}return!1},n.prototype.createCommonHeaders=function(n){var t=new Headers;return t.append("X-UserSessionId",n.SessionInformation.HostSessionId),t.append("callercorrelationid",PPTBootstrapper.GenerateRandomUUID()),t.append("X-WacNoAuth","1"),t.append("Scenario","Previewer"),t.append("Client",n.SessionInformation.HostName+"-Bootstrapper"),t.append("Content-Type","application/json; charset=utf-8"),t.append("ClientRequestId",n.SessionInformation.CallId||""),t},n.prototype.SendSnapDownloadUrlRequest=function(n,t){var u,r,f,e,i;try{if(n==null||n.ApplicationCustomSettings==null||n.SessionInformation==null)return;u=(new Date).getTime();r=n.SessionInformation.CallId||"";t&&t.ULS.traceTag(588107801,logCategory.PptSession,logLevel.Info,"SendSnapDownloadUrlRequest with callId: "+r);f=this.createCommonHeaders(n);e={DownloadUrl:n.WopiPrecheckInfo.FileGetUrl,DocID:n.WopiPrecheckInfo.DocUniqueId};fetch(n.ApplicationCustomSettings.OnDemandServer+"SnapUrlHandler.ashx",{method:"POST",headers:f,body:JSON.stringify(e)});i={};i.SendSnapDownloadUrlStart=u;i.SendSnapDownloadUrlEnd=(new Date).getTime();i.CallId=r;t.ULS.traceTag(588107800,logCategory.PptSession,logLevel.Info,JSON.stringify(i,PPTBootstrapper.UndefinedReplacer))}catch(o){t.ULS.traceTag(588107799,logCategory.PptSession,logLevel.Error,"Exception in SendSnapDownloadUrlRequest: "+o.message)}},n.InitAppSettingsWithDefaults=function(n){return n||(n={}),n.AddShadowBorder=n.AddShadowBorder!=undefined?n.AddShadowBorder:!1,n.EnableAdvanceOnClick=n.EnableAdvanceOnClick!=undefined?n.EnableAdvanceOnClick:!0,n.EnableAutoAdvance=n.EnableAutoAdvance!=undefined?n.EnableAutoAdvance:!0,n.EnableKeyboardNavigation=n.EnableKeyboardNavigation!=undefined?n.EnableKeyboardNavigation:!0,n.EnableWacFallback=n.EnableWacFallback!=undefined?n.EnableWacFallback:!0,n.ForceHttp=n.ForceHttp!=undefined?n.ForceHttp:!1,n.PreserveDrawingBuffer=n.PreserveDrawingBuffer!=undefined?n.PreserveDrawingBuffer:!1,n.TakeFocusOnBoot=n.TakeFocusOnBoot!=undefined?n.TakeFocusOnBoot:!0,n.UseTransparentBackground=n.UseTransparentBackground!=undefined?n.UseTransparentBackground:!0,n.EnableAdvanceOnTap=n.EnableAdvanceOnTap!=undefined?n.EnableAdvanceOnTap:!1,n},n.WopiPendingFail=function(t,i,r){var u=i,e=u==null?"":u.message,f;r.ULS.traceTag(38286594,logCategory.PptSession,logLevel.Warning,"WopiPendingFail - message"+e);f=u==null?!1:u.shutdownApp==!0;f&&n.CleanupWopiPending(t)},n.CleanupWopiPending=function(n){var i=PPTMessageListenerRegistry.GetInstance(),t=i.Get(n);t&&t.Dispose()},n.SanitizeInputParametersForFallbackLog=function(n){return{BootstrapperUrl:n.BootstrapperUrl,Container:n.Container,PostMessageToken:n.PostMessageToken,PreviewerRolloutRing:n.PreviewerRolloutRing,SessionInformation:{HostName:n.SessionInformation.HostName,HostSessionId:n.SessionInformation.HostSessionId,UserId:""},ApplicationUrl:n.ApplicationUrl,WopiPrecheckInfo:{FileName:""},NewFileTemplateSource:{},ApplicationCustomSettings:n.ApplicationCustomSettings,Diagnostics:n.Diagnostics,FnOnInitializeSuccess:n.FnOnInitializeSuccess,FnOnInitializeFailure:n.FnOnInitializeFailure}},n.ShouldUsePODS=function(n,t){var i=PPTBootstrapper.InferFileNewFromWopiPrecheckInfo(n.WopiPrecheckInfo,n.ApplicationUrl,n.NewFileTemplateSource,t);return window.location.search.indexOf("wdTestWac=1")>=0||window.location.search.indexOf("wdTestWac=1")>=0?new UsePODSDetails(!1,!1,"wdTestWac set to true in Host Page URL",i):n.ApplicationCustomSettings&&n.ApplicationCustomSettings.OnDemandServer?new UsePODSDetails(!0,!0,"OnDemandServer provided by Host",i):!n.ApplicationUrl&&n.SessionInformation.HostName!="MSTeams"&&n.SessionInformation.HostName!="TeamsiOS"&&n.SessionInformation.HostName!="apiTest"&&n.SessionInformation.HostName!="TeamsAndroid"?new UsePODSDetails(!1,!1,"No Application URL provided (Sharepoint)",i):n.ApplicationUrl?!n.WopiPrecheckInfo.FileGetUrl&&n.WopiPrecheckInfo.BundleInfo.Url?new UsePODSDetails(!0,!0,"No FileGetUrl was provided but a cached bundle URL was",i):window.location.search.indexOf("wdTestPreviewer=1")>=0||window.location.hash.indexOf("wdTestPreviewer=1")>=0||window.location.search.indexOf("wdTestWacPreviewer=1")>=0?new UsePODSDetails(!0,!0,"wdTestPreviewer set to true in Host Page URL",i):PPTBootstrapper.PODSFlighting(n,!1,t):new UsePODSDetails(!0,!0,"No Application URL provided",i)},n.LogShouldUsePodsOrCachedResult=function(n,t,i,r){var u={};u.ShouldUsePods=n.ShouldUsePODS;u.CanUsePods=n.CanUsePODS;u.ApplicationUrl=PPTBootstrapper.ExtractHostname(t);u.Reason=i;r.ULS.traceTag(38286595,logCategory.PptSession,logLevel.Info,JSON.stringify(u))},n.GetWacPreviewURL=function(n,t){var r,u,f,i;return n.WopiSrc.indexOf("PowerPointFrame.aspx")>=0&&(r=n.WopiSrc.substr(n.WopiSrc.indexOf("WOPISrc=")+8),u=r.indexOf("&"),n.WopiSrc=u<0?decodeURIComponent(decodeURI(r)):decodeURIComponent(r.substring(0,u))),f=t.ApplicationUrl.indexOf("?"),i=t.ApplicationUrl.substring(0,f),i+="?PowerPointView=ReadingView&wdnc=1&wdEnableRoaming=1&wdo=1",i=PPTBootstrapper.AppendCommonFrameUrlQueryParams(i,t),PPTBootstrapper.AppendCommonFallbackQueryParams(i,t,n.WopiSrc)},n.prototype.InitializePodsExisting=function(t){var o=n.TryLoadSlice(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t),i,r,u,f,e;t.WopiPrecheckInfo.BundleInfo||(t.WopiPrecheckInfo.BundleInfo={MajorVersion:0});t.ApplicationCustomSettings=n.InitAppSettingsWithDefaults(t.ApplicationCustomSettings);t.ApplicationCustomSettings.OnDemandServer||window.location.href&&(t.ApplicationCustomSettings.OnDemandServer=window.location.href.split("SlideShowFrame.html")[0]);i=undefined;i=ULS.getLogger(t.SessionInformation.HostSessionId,t.ApplicationCustomSettings.OnDemandServer+"RemoteUls.ashx");i.ULS.traceTag(40206740,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing PodsExisting. Slice load initated: "+o);PPTBootstrapper.SendInitialLog(t,"Slide Show",null,i);r=PPTBootstrapSettings.getAppMetadata();r&&r.Environment=="wac"&&(t.ApplicationCustomSettings.WacStaticResourcesServer=PPTBootstrapper.GetWacStaticResourcesServer(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t));u={};u.podsSessionId=t.WopiPrecheckInfo.PodSessionId;i.ULS.traceTag(38540374,logCategory.PptSession,logLevel.Info,JSON.stringify(u));f=PPTMessageListenerRegistry.GetInstance().Get(t.SessionInformation.HostSessionId);f&&(i.ULS.traceTag(39416217,logCategory.PptSession,logLevel.Error,"InitializePodsExisting found a session already created for this id. Disposing it"),f.DisposePreloadedApp());e=new PreviewSessionLoader(t,i,r,this.m_appErrors);e.LoadApp(t.WopiPrecheckInfo.PodSessionId,!1,{});e.LaunchFromSlide({PresentationId:t.WopiPrecheckInfo.PodSessionId,StartingSlideId:t.ApplicationCustomSettings.StartingSlideId,StartingSlideIndex:t.ApplicationCustomSettings.StartingSlideIndex,Diagnostics:t.Diagnostics,SendInitialLog:!1,StreamVideoUseThinEmbed:!1});PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"InitializePodsExisting",i)},n.prototype.PreloadApp=function(t){var e=(new Date).getTime(),o=n.TryLoadSlice(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t),i,r,f,u;return t.WopiPrecheckInfo.BundleInfo||(t.WopiPrecheckInfo.BundleInfo={MajorVersion:0}),t.ApplicationCustomSettings=n.InitAppSettingsWithDefaults(t.ApplicationCustomSettings),i=undefined,i=ULS.getLogger(t.SessionInformation.HostSessionId,t.ApplicationCustomSettings.OnDemandServer+"RemoteUls.ashx"),i.ULS.traceTag(40206741,logCategory.PptSession,logLevel.Info,"Bootstrap - initializing session. Slice load initated: "+o),PPTBootstrapper.SendInitialLog(t,"Preload App",null,i),r=PPTBootstrapSettings.getAppMetadata(),r&&r.Environment=="wac"&&(t.ApplicationCustomSettings.WacStaticResourcesServer=PPTBootstrapper.GetWacStaticResourcesServer(t.ApplicationCustomSettings,t.ApplicationUrl,t.BootstrapperUrl,t)),f=new PreviewSessionLoader(t,i,r,this.m_appErrors),f.LoadApp(null,!0,{}),u={},u.PreloadAppFunctionStart=e,u.PreloadAppFunctionEnd=(new Date).getTime(),i.ULS.traceTag(38286596,logCategory.PptSession,logLevel.Info,JSON.stringify(u,PPTBootstrapper.UndefinedReplacer)),PPTBootstrapper.logBootstrapperPerformanceInfo(t.BootstrapperUrl,"PreloadApp",i),f},n.prototype.GetVersion=function(){return BuildVersionConfig.BUILD_NUMBER},n.GetMinContentVersion=function(){return 1},n.Prefetch=function(t){n.s_prefetchStartTime=(new Date).getTime();n.PrefetchRequiredOnly(t,["pptscripts/reader.dione.js"])},n.PrefetchRequiredOnly=function(t,i){var e=t!=null&&t.IsLegacyAspxInTeamsEnabled!=null&&t.IsLegacyAspxInTeamsEnabled,o=t!=null&&t.IsModernSlideShowInTeamsEnabled!=null&&t.IsModernSlideShowInTeamsEnabled,r=[],u,f;e?o||(r=["pptscripts/microsoftajax.js","pptscripts/bootview.js","pptscripts/WebViewerPreboot.js","pptscripts/ppt.slideshowplayer.api.js","pptscripts/ppt.inkcanvasmanager.js","pptscripts/transitions.js","pptscripts/ppttelemetry.js"]):r=["powerpointframe.html"];u=PPTBootstrapSettings.getAppMetadata();t&&u&&u.Environment!="wac"&&r.push("AppMetadata.js");f=r.concat(i);n.PrefetchSpecifiedResources(t,f)},n.PrefetchSpecifiedResources=function(t,i){var r=PPTBootstrapSettings.getAppMetadata(),f,u;if(r&&(r.Environment=="int"||r.Environment=="edog"||r.Environment=="prod"))f=PPTBootstrapSettings.getCDNManifestMapping(),i.forEach(function(t){t=="powerpointframe.html"?n.CreatePrefetchLink("https://contentstorage.osi.office.net/pages/"+f["pptpages/powerpointframe.html"]+"#powerpointframe.html"):t=="powerpoint.boot.js"?n.CreatePrefetchLink("https://contentstorage.osi.office.net/boot/powerpoint.boot.js"):n.CreatePrefetchLink("https://contentstorage.osi.office.net/scripts/"+f[t]+"#"+t.split("//").pop())});else{if(u=null,r&&r.Environment=="wac")u=PPTBootstrapper.GetWacStaticResourcesServer(null,null,t?t.BootstrapperUrl:null,null)+r.WacCdnVersion+"_slideshowresources/";else if(t&&t.AppBundleParameters&&t.AppBundleParameters.appBundleCustomUrl)u=t.AppBundleParameters.appBundleCustomUrl;else throw Error("Error: Prefetch using custom hosting requires prefetchParameters be provided");i.forEach(function(t){try{BrowserUtils.SupportPreloadLink()?t==="powerpointframe.html"?n.CreatePrefetchLink(u+t):n.CreatePreloadLink(u+t,"script"):n.CreatePrefetchLink(u+t)}catch(i){}})}},n.CreatePreloadLink=function(n,t){var i=document.createElement("link");i.rel="preload";i.href=n;t!==""&&i.setAttribute("as",t);document.getElementsByTagName("head")[0].appendChild(i)},n.CreatePrefetchLink=function(n){var t=document.createElement("link");t.rel="prefetch";t.href=n;document.getElementsByTagName("head")[0].appendChild(t)},n.CreateViewer=function(n,t,i,r){var u,c,l,e;i.createViewerTime=Date.now();var o=PPTBootstrapSettings.getAppMetadata(),s=o&&o.AppVersionMajor!=n.WopiPrecheckInfo.BundleInfo.MajorVersion,h=BrowserUtils.BrowserSupportsRenderingSVGInWebGL();if((s||!h)&&(t.ULS.traceTag(38540375,logCategory.PptSession,logLevel.Info,"AppVersionMajor and ContentVersionMajor version mismatch: "+s+", or browser does not support SVG in WebGL: "+!h),n.WopiPrecheckInfo.BundleInfo.Url=undefined,!n.WopiPrecheckInfo.FileGetUrl)){n.FnOnInitializeFailure({errorType:"AppInitError",errorObject:"AppVersionMajor and ContentVersionMajor version mismatch: "+s+", or browser does not support SVG in WebGL: "+!h});return}if(!n.WopiPrecheckInfo.BundleInfo.Url&&!n.WopiPrecheckInfo.FileGetUrl){n.FnOnInitializeFailure({errorType:"AppInitError",errorObject:"Neither wopiPrecheckInfo.FileGetUrl or wopiPrecheckInfo.BundleInfo.Url provided"});return}if(!n.Container){n.FnOnInitializeFailure({errorType:"AppInitError",errorObject:"Container"});return}if(u="",n.SessionInformation&&n.SessionInformation.WdParams)for(c in n.SessionInformation.WdParams)u=u+"&"+c+"="+n.SessionInformation.WdParams[c];var a=BrowserUtils.DevicePixelRatio(),v=n.ApplicationCustomSettings.AddShadowBorder?10:0,y=n.Container.getBoundingClientRect(),p=Math.round(a*Math.max(Math.ceil(y.width),300)-2*v),w=Math.round(a*Math.max(Math.ceil(y.height),201)-2*v),f=n.SessionInformation.HostSessionId,b={FileName:n.WopiPrecheckInfo.FileName,FileUrl:n.WopiPrecheckInfo.FileGetUrl,FileSize:n.WopiPrecheckInfo.FileSize,OnDemandServer:n.ApplicationCustomSettings.OnDemandServer,AvailableWidth:p,AvailableHeight:w,UserSessionId:n.SessionInformation.HostSessionId,FRenderSlideShow:!0,wrsBundleUrl:n.WopiPrecheckInfo.BundleInfo.Url,WdOverrides:UrlUtils.getParameterValue(window.location.search,"wdoverrides"),DocId:n.WopiPrecheckInfo.DocUniqueId,ETag:n.WopiPrecheckInfo.ETag,UserId:n.SessionInformation.UserId,Scenario:n.SessionInformation.HostName,WdParams:u};f=PodsSessionFactory.CreateSession(b,t,r);l={};l.podsSessionId=f;t.ULS.traceTag(38540376,logCategory.PptSession,logLevel.Info,JSON.stringify(l));n.WopiPrecheckInfo.BundleInfo&&(n.WopiPrecheckInfo.BundleInfo.Url=undefined,t.ULS.traceTag(38540377,logCategory.PptSession,logLevel.Info,"Cleared bundle info url"));e=new PreviewSessionLoader(n,t,o,r);e.LoadApp(f,!1,i);e.LaunchFromSlide({PresentationId:f,StartingSlideId:n.ApplicationCustomSettings.StartingSlideId,StartingSlideIndex:n.ApplicationCustomSettings.StartingSlideIndex,Diagnostics:n.Diagnostics,SendInitialLog:!1,StreamVideoUseThinEmbed:!1});i.bootstrapperInitTime&&e.RecordBootStrapperInitTime(i.bootstrapperInitTime)},n.s_prefetchStartTime=0,n}();Microsoft.Office.PowerPoint.Bootstrap=new PPTPreviewerBootstrapper;Microsoft.Office.PowerPoint.Bootstrap.Prefetch=PPTPreviewerBootstrapper.Prefetch;Microsoft.Office.PowerPoint.Bootstrap.GetMinContentVersion=PPTPreviewerBootstrapper.GetMinContentVersion;PodsSessionFactory=function(){function n(){}return n.CreateSession=function(t,i,r){var o,e,u,f;if(t.FileName==null)throw Error("FileName");if(t.FileUrl==null)throw Error("FileUrl");if(t.AvailableWidth==null)throw Error("AvailableWidth");if(t.AvailableHeight==null)throw Error("AvailableHeight");return o=MathHelper.Hash(t.FileUrl),e=t.SessionId,e==undefined&&(e=n.GenerateSessionId(t.FileUrl)),u=t.OnDemandServer+"PodHandler.ashx?action=CreateSession&PodSID="+encodeURIComponent(e)+"&fn="+encodeURIComponent(t.FileName)+"&fileLengthHint="+t.FileSize+"&sw="+t.AvailableWidth+"&sh="+t.AvailableHeight+"&frss="+(t.FRenderSlideShow!=null?t.FRenderSlideShow.toString():"True")+"&fu="+encodeURIComponent(t.FileUrl)+"&usid="+encodeURIComponent(t.UserSessionId)+"&fuLength="+t.FileUrl.length.toString()+"&fuHash="+o.toString(),t.wrsBundleUrl!=undefined&&(u=u+"&wrsBundleUrl="+encodeURIComponent(t.wrsBundleUrl.toString())),t.WdOverrides!=undefined&&(u=u+"&wdoverrides="+encodeURIComponent(t.WdOverrides.toString())),t.DocId!=undefined&&(u=u+"&DocID="+encodeURIComponent(t.DocId)),t.ETag!=undefined&&(u=u+"&ETag="+encodeURIComponent(t.ETag)),t.UserId!=undefined&&(u=u+"&user_id="+encodeURIComponent(t.UserId)),t.Scenario!=undefined&&(u=u+"&scenario="+encodeURIComponent(t.Scenario)),t.WdParams!=""&&(u=u+t.WdParams),f=new XMLHttpRequest,f.open("GET",u,!0),f.setRequestHeader("X-SupportSVGInWebGL",BrowserUtils.BrowserSupportsRenderingSVGInWebGL()?"1":"0"),f.onreadystatechange=function(){if(f.readyState===XMLHttpRequest.DONE){var n=f.getResponseHeader("X-OfficeCluster");f.status===200?i.ULS.traceTag(588044117,logCategory.PptSession,logLevel.Info,"PodsSessionFactory::CreateSession succeeded; WacCluster: "+n):(r.push({DuringBoot:!0,ErrorName:"CreateSessionFailed_"+f.status,Tag:""}),i.ULS.traceTag(588044116,logCategory.PptSession,logLevel.Error,"PodsSessionFactory::CreateSession failed; HttpStatusCode: "+f.status+"; WacCluster: "+n))}},f.send(),e},n.GenerateSessionId=function(n){var f=4,i=new Uint32Array(f),r,u,t;if(window.self.crypto&&window.self.crypto.getRandomValues?window.self.crypto.getRandomValues(i):window.msCrypto&&window.msCrypto.getRandomValues&&window.msCrypto.getRandomValues(i),r="",i[0]!=0)for(u=[].slice.call(i),t=0;t<u.length;t++)r+=u[t].toString(36);else for(t=0;t<f;t++)r=Math.random().toString(36).substring(2,25);return"_._._."+r+SHA1.GenerateSHA1(n)+"-.-.-."},n}();PreviewSessionLoader=function(){function n(t,i,r,u){if(this.m_startingSlideId=-1,this.m_startingSlideIndex=-1,this.m_vetoAppSettingsStr="",this.m_disabledTransitionsList="",this.m_customTransitionResourceUrl="",this.m_streamUseThinEmbed=!1,this.m_disabledChangeGates="",this.m_iframe=null,this.m_bootTimingDict={},this.m_contentMetadata=null,this.m_iframeReadyForPostMessage=!1,this.m_fShouldUseLegacySlideShowAspx=!1,this.m_iframeLoadTimeout=undefined,this.m_retryPreviewerTimeout=undefined,this.m_bootCompleted=!1,this.c_appErrorThrottleCount=5,this.c_iframeLoaded="iframeLoaded",this.c_contentMetadataLoadedOrDoesNotExist="contentMetadataLoaded",this.c_activated="activated",this.c_minHeight=100,this.c_minIframeHeight=100,this.m_callbackIframeLoadFailed={errorType:"AppInitError",errorObject:"Failed to load iframe",Category:0,Code:"101",EventType:13,ExtraInfo:"Iframe load Error"},!t)throw Error("initParams is null");if(!t.SessionInformation.HostSessionId)throw Error("sessionId is null");this.m_apiId=t.SessionInformation.HostSessionId;this.m_appMetaData=r;this.m_apiStartTime=Date.now();this.m_logger=i;this.m_appErrors=u;t.ApplicationCustomSettings&&!t.ApplicationCustomSettings.OnDemandServer&&(t.ApplicationCustomSettings.OnDemandServer=PPTBootstrapper.GetOnDemandServer(null));this.m_initParams=t;this.m_fShouldUseLegacySlideShowAspx=PPTBootstrapper.ShouldUseLegacySlideShowAspx(this.m_initParams);this.m_anchor=t.Container;t.ApplicationCustomSettings?(this.m_fVariableWidth=!n.FIsUintValid(t.ApplicationCustomSettings.Width),this.m_fVariableHeight=!n.FIsUintValid(t.ApplicationCustomSettings.Height),this.m_startingSlideId=t.ApplicationCustomSettings.StartingSlideId||-1,this.m_startingSlideIndex=t.ApplicationCustomSettings.StartingSlideIndex||-1):(this.m_fVariableWidth=!0,this.m_fVariableHeight=!0);t.Diagnostics&&t.Diagnostics.userClickTime?this.m_bootTimingDict.DocumentClickTime=t.Diagnostics.userClickTime:t.SessionInformation.DocumentClickTime&&(this.m_bootTimingDict.DocumentClickTime=t.SessionInformation.DocumentClickTime.getTime());this.m_slideShowLoader=new SlideShowLoader(t,i,r);PPTMessageListenerRegistry.GetInstance().Get(this.m_apiId)&&i.ULS.traceTag(39203528,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader is about to overwrite value in PPTMessageListenerRegistry");PPTMessageListenerRegistry.GetInstance().Add(this.m_apiId,this,!0,"PreviewSessionLoader")}return n.FIsUintValid=function(n){return!(n==null||n<0||isNaN(n))},n.CreateBaseIframe=function(n){var t=document.createElement("iframe");return t.id="pptframe-"+n,t.frameBorder="0",t.style.top=HTMLHelper.toPx(0),t.style.bottom=HTMLHelper.toPx(0),t.style.left=HTMLHelper.toPx(0),t.style.right=HTMLHelper.toPx(0),t.style.width=HTMLHelper.floatToPercent(1),t.style.height=HTMLHelper.floatToPercent(1),t.setAttribute("allowfullscreen",(!0).toString()),t.setAttribute("allowTransparency",(!0).toString()),t.setAttribute("allow","autoplay;"),t},n.prototype.registerOnLoadEvent=function(){var n=this;this.removeIframeOnLoadEvent();this.m_onLoad=function(){return n.OnIframeLoaded()};this.m_iframe.addEventListener("load",this.m_onLoad,!1)},n.prototype.registerOnUnloadEvent=function(){var n=this;this.m_iframe.addEventListener("unload",function(){n.m_logger.ULS.traceTag(588044115,logCategory.PptSession,logLevel.Warning,"Unloading previewer iframe");n.m_appErrors.length>0&&n.m_logger.ULS.traceTag(588044114,logCategory.PptSession,logLevel.Warning,JSON.stringify(n.m_appErrors));n.m_logger.ULS.flushOnClose()})},n.prototype.registerOnLoadErrorEvent=function(){var n=this;this.m_onLoadError=function(){return n.OnIframeLoadError()};this.m_iframe.addEventListener("error",this.m_onLoadError,!1)},n.prototype.removeIframeOnLoadEvent=function(){this.m_onLoad&&this.m_iframe.removeEventListener("load",this.m_onLoad)},n.prototype.OnIframeLoaded=function(){var n=this;this.m_logger.ULS.traceTag(39416209,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::OnIframeLoaded");this.m_bootTimingDict.iFrameOnloadEventInApi=Date.now();this.m_iframeReadyForPostMessage||(this.m_iframeLoadTimeout=window.setTimeout(function(){return n.IframeLoadTimeout()},15e3))},n.prototype.OnIframeLoadError=function(){this.m_logger.ULS.traceTag(590424142,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::OnIframeLoadError : iframe Id: "+this.m_iframe.id);this.m_initParams.FnOnInitializeFailure&&this.m_initParams.FnOnInitializeFailure(this.m_callbackIframeLoadFailed);this.m_onLoadError&&this.m_iframe.removeEventListener("error",this.m_onLoadError)},n.prototype.IframeLoadTimeout=function(){if(this.m_iframeReadyForPostMessage){this.m_logger.ULS.traceTag(39416210,logCategory.PptSession,logLevel.Warning,"IFrameLoadTimeout called even though iframe is ready for postmessage");return}if(!this.m_apiId){this.m_logger.ULS.traceTag(39416211,logCategory.PptSession,logLevel.Warning,"IFrameLoadTimeout called after m_apiId is null");return}var n={EventType:13,Code:100,Category:0,ExtraInfo:"Timeout waiting for iframe to load",SessionId:this.m_apiId,errorType:"13",errorObject:null};PPTBootstrapperLogger.RecordBootFailure(this.m_initParams,100,"Timeout waiting for iframe to load",this.m_logger,Date.now(),this.m_appErrors);this.FailToBoot(n)},n.prototype.Activate=function(){if(!this.m_apiId||!this.m_presentationId){this.m_logger.ULS.traceTag(38540363,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::Activate is missing apiId or presentationId");return}this.m_logger.ULS.traceTag(38540364,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::Activate");(this.m_iframe==null||this.m_iframe.parentElement==null)&&this.m_logger.ULS.traceTag(39203531,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::Activate - iframe is null or detached from parent");this.m_bootTimingDict.ActivateInApi=Date.now();var n=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableKeyboardNavigation!=undefined?this.m_initParams.ApplicationCustomSettings.EnableKeyboardNavigation:!0,t=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnablePodPreviewStaticImage!=undefined?this.m_initParams.ApplicationCustomSettings.EnablePodPreviewStaticImage:!1,i=this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnTap!=undefined?this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnTap:!1;if(this.PostMessageDownward(new HandshakeWebViewerInternalMessage(this.m_apiId,n,this.m_contentMetadata,this.m_initParams.WopiPrecheckInfo.FileGetUrl,this.m_initParams.WopiPrecheckInfo.FileSize,this.m_initParams.WopiPrecheckInfo.FileName,this.m_presentationId,this.m_startingSlideId,this.m_startingSlideIndex,this.m_initParams.SessionInformation.HostName,this.m_initParams.Diagnostics?this.m_initParams.Diagnostics.entryPoint:"",this.m_apiStartTime,this.m_initParams.Diagnostics?this.m_initParams.Diagnostics.userClickTime?this.m_initParams.Diagnostics.userClickTime:0:0,this.m_initParams.SessionInformation.HostInitTime?this.m_initParams.SessionInformation.HostInitTime:0,t,i,PodsRegionInfo.GetFileHost(this.m_initParams),this.m_vetoAppSettingsStr,this.m_disabledTransitionsList,this.m_customTransitionResourceUrl,this.m_streamUseThinEmbed,this.m_disabledChangeGates,PodsRegionInfo.GetWACRegion(this.m_initParams.ApplicationUrl))),!this.m_finishedBootingConditional){this.m_logger.ULS.traceTag(51448026,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Conditional Action uninitialized");throw Error("m_finishedBootingConditional");}this.m_finishedBootingConditional.SetCondition(this.c_activated)},n.prototype.PostMessageDownward=function(n){var t=JSON.stringify(n),i=window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0||this.m_fShouldUseLegacySlideShowAspx;this.m_iframe&&(this.m_iframe.src.length!=0||i)&&this.m_iframe.contentWindow?this.m_iframe.contentWindow.postMessage(t,this.m_iframe.src==""?"*":this.m_iframe.src):this.m_logger.ULS.traceTag(39203532,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::PostMessageDownward - iframe is invalid")},n.prototype.FailToBoot=function(n){this.m_logger.ULS.traceTag(38540365,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::FailToBoot: "+JSON.stringify(n));this.Dispose();this.m_initParams.FnOnInitializeFailure(n)},n.prototype.FinishBoot=function(n,t){if(!this.m_apiId||!this.m_anchor||!this.m_iframe){this.m_logger.ULS.traceTag(38540366,logCategory.PptSession,logLevel.Error,"FinishBoot is missing parameters");return}this.m_logger.ULS.traceTag(38540367,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::FinishBoot");var u=this.m_appMetaData?this.m_appMetaData.AppVersionMajor+"."+this.m_appMetaData.AppVersionMinor:"Not Ready",f=this.m_initParams.WopiPrecheckInfo.BundleInfo!=undefined&&this.m_initParams.WopiPrecheckInfo.BundleInfo.Url!=null,e=function(n){var t=PPTMessageListenerRegistry.GetInstance();t&&t.Remove(n,!0,"FinishBoot::DisposeCallBack")},i=n.GetPreviewAPIV1(this.m_anchor,this.m_iframe,this.m_apiId,f,u,t.perceivedLoadTime,e,this.m_logger),r=PPTMessageListenerRegistry.GetInstance();r.Remove(this.m_apiId,!0,"FinishBoot::TransferRegistration");r.Add(this.m_apiId,i,!0,"FinishBoot::TransferRegistration");this.DisposeForTransferToPreviewAPI();this.m_logger.ULS.traceTag(38540368,logCategory.PptSession,logLevel.Info,"FinishBoot - returning FnOnInitializeSuccess");this.m_initParams.FnOnInitializeSuccess(i,t)},n.prototype.OnSliceLoaded=function(){this.m_apiId&&this.m_appInitDiagnostics&&n.s_previewAPIFactory?this.FinishBoot(n.s_previewAPIFactory,this.m_appInitDiagnostics):this.m_apiId&&this.m_logger.ULS.traceTag(38540369,logCategory.PptSession,logLevel.Info,"OnSliceLoaded: App is not ready yet - "+this.m_apiId.toString())},n.prototype.Log=function(n,t){this.m_logger.ULS.traceTag(39978265,logCategory.PptSession,logLevel.Info,n);t!=null&&this.m_logger.ULS.traceTag(591946190,logCategory.PptSession,logLevel.Info,t)},n.prototype.OnMessage=function(t,i){var u,e,o,r,s,h,f;if(this.m_iframe&&this.m_iframe.contentWindow==i){if(t=t,!t||t.m_type==undefined){this.m_logger.ULS.traceTag(39978266,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::OnMesssage - received message with the wrong syntax");return}switch(t.m_type){case 0:this.m_bootCompleted=!0;this.m_logger.ULS.traceTag(38540370,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::OnMesssage - received Handshake from iframe");u=t;this.m_appInitDiagnostics={};e=u.m_percievedBootTime?new Date(u.m_percievedBootTime):undefined;this.m_appInitDiagnostics.perceivedLoadTime=e;this.m_contentMetadata||(o={HttpStatus:this.m_contentMetadataHttpStatusCode},this.m_appInitDiagnostics.errorObject={errorType:"CannotLoadBundleItem",errorObject:o});n.s_previewAPIFactory?this.FinishBoot(n.s_previewAPIFactory,this.m_appInitDiagnostics):this.m_logger.ULS.traceTag(38540371,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Handshake received but PreviewAPIFactory is not available");break;case 10:r=t;!isNaN(r.m_code)&&r.m_code>=0&&(s=0,h={EventType:13,Code:r.m_code,Category:s,ExtraInfo:r.m_extraInfo,SessionId:r.m_sessionId,errorType:"13",errorObject:null},this.FailToBoot(h));break;case 28:if(this.m_bootTimingDict.AppReadyForPostMessage=Date.now(),this.m_logger.ULS.traceTag(39416212,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::OnMesssage - AppReadyForPostMessage"),this.m_iframeReadyForPostMessage=!0,this.m_iframeLoadTimeout&&(window.clearTimeout(this.m_iframeLoadTimeout),this.m_iframeLoadTimeout=undefined),this.m_retryPreviewerTimeout&&(window.clearTimeout(this.m_retryPreviewerTimeout),this.m_retryPreviewerTimeout=undefined),!this.m_readyToActivateConditional){this.m_logger.ULS.traceTag(51448027,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Conditional Action uninitialized");throw Error("m_readyToActivateConditional");}this.m_readyToActivateConditional.SetCondition(this.c_iframeLoaded);break;case 40:f=t.m_logs;f&&this.m_logger.ULS.traceTag(590885717,logCategory.PptSession,logLevel.Info,f);break;case 41:if(this.m_appErrors.length>=this.c_appErrorThrottleCount)break;t.ErrorName?this.m_appErrors.push({DuringBoot:!this.m_bootCompleted,ErrorName:t.ErrorName,Tag:t.Tag}):this.m_logger.ULS.traceTag(588044113,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMessage::PostFailureUpwards message data is missing required field")}}},n.prototype.GenerateSlideShowParams=function(t,i){var r={},o,f,s,h,e,u;if(this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.ExtraUrlParams)for(o=this.m_initParams.ApplicationCustomSettings.ExtraUrlParams.split("&"),f=0;f<o.length;f++)s=o[f].split("="),r[s[0]]=s[1];return this.m_fShouldUseLegacySlideShowAspx?(h=this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer+this.m_appMetaData.WacCdnVersion,r.staticCdn=encodeURIComponent(h)):this.m_appMetaData.Environment=="wac"&&(r.wacCdnVersion=this.m_appMetaData.WacCdnVersion),t&&(r.pid=encodeURIComponent(t)),r.PowerPointView="ChromelessView",n.FIsUintValid(this.m_startingSlideId)&&this.m_startingSlideId!=0?r.wdSlideId=UrlUtils.UrlKeyValueEncode(this.m_startingSlideId.toString()):n.FIsUintValid(this.m_startingSlideIndex)&&(r.wdSlideIndex=UrlUtils.UrlKeyValueEncode(this.m_startingSlideIndex.toString())),this.m_initParams.SessionInformation.DataLocale&&(r.rs=this.m_initParams.SessionInformation.DataLocale),this.m_initParams.SessionInformation.UiLocale&&(r.ui=this.m_initParams.SessionInformation.UiLocale),this.m_initParams.SessionInformation.HostSessionId&&(r.hsi=this.m_initParams.SessionInformation.HostSessionId),r.utb=UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.UseTransparentBackground!=undefined?this.m_initParams.ApplicationCustomSettings.UseTransparentBackground:!0).toString()),r.wdEaa=UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableAutoAdvance!=undefined?this.m_initParams.ApplicationCustomSettings.EnableAutoAdvance?1:0:0).toString()),r.eac=UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnClick!=undefined?this.m_initParams.ApplicationCustomSettings.EnableAdvanceOnClick:!0).toString()),r.vm=UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.ViewerMode?this.m_initParams.ApplicationCustomSettings.ViewerMode:0).toString()),r.co=UrlUtils.UrlKeyValueEncode(this.m_initParams.WopiPrecheckInfo.BundleInfo.CrossOrigin?this.m_initParams.WopiPrecheckInfo.BundleInfo.CrossOrigin:"anonymous"),r.lcid=UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.LCID?this.m_initParams.ApplicationCustomSettings.LCID:"1033").toString()),r.hostname=UrlUtils.UrlKeyValueEncode(n.GetHostName(this.m_initParams)),r.ua=UrlUtils.UrlKeyValueEncode((!0).toString()),r.asb=UrlUtils.UrlKeyValueEncode((this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.AddShadowBorder!=undefined?this.m_initParams.ApplicationCustomSettings.AddShadowBorder:!1).toString()),r.apiStartTime=UrlUtils.UrlKeyValueEncode(this.m_apiStartTime.toString()),r.preloadApp=UrlUtils.UrlKeyValueEncode(i.toString()),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.TakeFocusOnBoot&&(r.takeFocusOnBoot=UrlUtils.UrlKeyValueEncode(UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.TakeFocusOnBoot.toString()))),r.isCombineRequest=UrlUtils.UrlKeyValueEncode(UrlUtils.UrlKeyValueEncode((!0).toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.NoCacheToken&&(r.noCacheToken=UrlUtils.UrlKeyValueEncode(UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.NoCacheToken))),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EndSlideShowText&&(r.endSlideShowText=UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.EndSlideShowText)),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.HostSupportsSessionRefreshEnabled&&(r.hostSupportsSessionRefreshEnabled=UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.HostSupportsSessionRefreshEnabled.toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.InkingEnabled&&(r.inkingEnabled=UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.InkingEnabled.toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.IsNewSlideShowToolbarEnabled&&(r.isNewSlideShowToolbarEnabled=UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.IsNewSlideShowToolbarEnabled.toString())),this.m_appMetaData&&this.m_initParams.ApplicationCustomSettings&&!this.m_initParams.ApplicationCustomSettings.Url&&(r.aVMa=UrlUtils.UrlKeyValueEncode(this.m_appMetaData.AppVersionMajor.toString()),r.aVMi=UrlUtils.UrlKeyValueEncode(this.m_appMetaData.AppVersionMinor.toString()),r.cVMa=UrlUtils.UrlKeyValueEncode(this.m_appMetaData.ContentVersionMajor.toString()),r.cVMi=UrlUtils.UrlKeyValueEncode(this.m_appMetaData.ContentVersionMinor.toString()),r.env=UrlUtils.UrlKeyValueEncode(this.m_appMetaData.Environment.toString()),r.cdnMA=UrlUtils.UrlKeyValueEncode("1"),this.m_appMetaData.Environment!="wac"&&(e=PPTBootstrapSettings.getCDNManifestMapping(),r.cdnRD=UrlUtils.UrlKeyValueEncode(e["pptscripts/reader.dione.js"].toString()),r.cdnRC=UrlUtils.UrlKeyValueEncode(e["pptscripts/reader.calypso.js"].toString()),r.cdnB=UrlUtils.UrlKeyValueEncode(e["pptscripts/babylon.js"].toString()))),this.m_initParams.WopiPrecheckInfo.BundleInfo.Url&&(r.dce=encodeURIComponent(this.m_initParams.WopiPrecheckInfo.BundleInfo.Url)),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.OnDemandServer&&(r.odvs=this.m_initParams.ApplicationCustomSettings.OnDemandServer),r.odve="podView.svc/jsonAnonymous",this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.PreserveDrawingBuffer&&(r.wgl_pdb=this.m_initParams.ApplicationCustomSettings.PreserveDrawingBuffer.toString()),(window.location.search.indexOf("wdDev=1")>=0||window.location.hash.indexOf("wdDev=1")>=0)&&(r.wdDev="1"),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.WacCluster&&(r.wacCluster=this.m_initParams.ApplicationCustomSettings.WacCluster),this.isNeedToAddSBOverride()?(u=UrlUtils.getParameterValue(window.location.search,"wdoverrides"),u?u.indexOf("useshapebuilderviewing")<0&&(u=u+",useshapebuilderviewing:true,rendergifslideshow:true,videothrutransparentcanvas:true"):u="useshapebuilderviewing:true,rendergifslideshow:true,videothrutransparentcanvas:true",r.wdoverrides=u):window.location.search.indexOf("wdoverrides=")>=0&&(r.wdoverrides=UrlUtils.getParameterValue(window.location.search,"wdoverrides")),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.LiveBroadcastEnabled&&(r.LiveBroadcastEnabled=this.m_initParams.ApplicationCustomSettings.LiveBroadcastEnabled.toString()),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.IsVideoThruTransparentCanvas&&(r.isVideoThruTransparentCanvas=UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.IsVideoThruTransparentCanvas.toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.IsFlipgridVideoEnabled&&(r.isFlipgridVideoEnabled=UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.IsFlipgridVideoEnabled.toString())),this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.IsTEDVideoEnabled&&(r.isTEDVideoEnabled=UrlUtils.UrlKeyValueEncode(this.m_initParams.ApplicationCustomSettings.IsTEDVideoEnabled.toString())),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.UserId&&(r.user_id=encodeURIComponent(this.m_initParams.SessionInformation.UserId)),this.m_initParams.WopiPrecheckInfo&&this.m_initParams.WopiPrecheckInfo.DocUniqueId&&(r.docId=encodeURIComponent(this.m_initParams.WopiPrecheckInfo.DocUniqueId)),this.m_initParams.ApplicationUrl&&(r.ring=this.m_initParams.PreviewerRolloutRing),r.fh=encodeURIComponent(PodsRegionInfo.GetFileHost(this.m_initParams)),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.HostName&&(r.uih=encodeURIComponent(PodsRegionInfo.GetUiHost(this.m_initParams.SessionInformation.HostName))),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.UiHostRing&&(r.uihRing=encodeURIComponent(this.m_initParams.SessionInformation.UiHostRing)),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.CallId&&(r.callId=encodeURIComponent(this.m_initParams.SessionInformation.CallId)),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.ContentId&&(r.contentId=encodeURIComponent(this.m_initParams.SessionInformation.ContentId)),this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.IsPresenter&&(r.isPresenter=this.m_initParams.SessionInformation.IsPresenter),r},n.prototype.LoadIframe=function(t,i){if(i===void 0&&(i=undefined),this.m_anchor==null||this.m_iframe==null){this.m_logger.ULS.traceTag(39416213,logCategory.PptSession,logLevel.Error,"PreviewerSessionLoader::LoadIframe is missing parameters");return}this.m_iframe.parentNode||this.m_anchor.appendChild(this.m_iframe);var u=PPTBootstrapSettings.getCDNManifestMapping(),r;r=this.m_initParams&&this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.Url?UrlUtils.HTMLEncode(this.m_initParams.ApplicationCustomSettings.Url)+"powerpointframe.html":this.m_appMetaData.Environment=="wac"?this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer+this.m_appMetaData.WacCdnVersion+"_slideshowresources/powerpointframe.html":UrlUtils.HTMLEncode("https://contentstorage.osi.office.net/pages/"+u["pptpages/powerpointframe.html"].toString()+"#powerpointframe.html");(this.m_initParams.WopiPrecheckInfo.BundleInfo.Url&&this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.substr(0,5)=="http:"||this.m_initParams.ApplicationCustomSettings.Url&&this.m_initParams.ApplicationCustomSettings.Url.substr(0,4)!="http"&&window.location.protocol=="http:"||this.m_initParams.ApplicationCustomSettings.OnDemandServer&&this.m_initParams.ApplicationCustomSettings.OnDemandServer.substr(0,5)=="http:"||this.m_initParams.ApplicationCustomSettings.ForceHttp)&&r.substr(0,5)=="https"&&(r=n.RelativeUrlToAbsolute(r),r="http"+r.substr(5));t&&Object.keys(t).forEach(function(n){r=UrlUtils.addOrReplaceParameterValue(r,n,t[n])});r=r.replace("?","#");this.m_iframe&&(this.m_logger.ULS.traceTag(590424141,logCategory.PptSession,logLevel.Info,"Iframe src: "+r),i&&i(r),this.m_iframe.src=r)},n.prototype.isNeedToAddSBOverride=function(){if(!PPTBootstrapper.IsTeamsPreviewerSession(this.m_initParams,!1)||this.m_initParams&&this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.HostName&&this.m_initParams.SessionInformation.HostName.toLowerCase().indexOf("ios")>=0)return!1;var n=this.m_initParams.ApplicationUrl;return n?this.m_initParams.PreviewerRolloutRing!="6":!1},n.prototype.LoadApp=function(t,i,r){var e=this,f,u;r.previewSessionLoadAppTime=Date.now();this.m_logger.ULS.traceTag(38540372,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::LoadApp");r.prefetchStartTime&&(this.m_bootTimingDict.PrefetchStart=r.prefetchStartTime);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.WdParams!=null&&this.m_initParams.SessionInformation.WdParams.wdLegacyAspxInTeams!=null&&(this.m_bootTimingDict.wdLegacyAspxInTeams=this.m_initParams.SessionInformation.WdParams.wdLegacyAspxInTeams?1:0);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.WdParams!=null&&this.m_initParams.SessionInformation.WdParams.wdModernSlideShowInTeams!=null&&(this.m_bootTimingDict.wdModernSlideShowInTeams=this.m_initParams.SessionInformation.WdParams.wdModernSlideShowInTeams?1:0);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.HostExperience!=null&&(this.m_bootTimingDict.HostExperience=this.m_initParams.SessionInformation.HostExperience);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.UiHostRing!=null&&(this.m_bootTimingDict.UiHostRing=this.m_initParams.SessionInformation.UiHostRing);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.IsPresenter!=null&&(this.m_bootTimingDict.IsPresenter=this.m_initParams.SessionInformation.IsPresenter);this.m_initParams!=null&&this.m_initParams.SessionInformation!=null&&this.m_initParams.SessionInformation.Position!=null&&(this.m_bootTimingDict.PreviewerPosition=this.m_initParams.SessionInformation.Position);this.m_bootTimingDict.LoadApp=Date.now();this.m_readyToActivateConditional=new ConditionalAction(function(){return e.Activate()},[this.c_iframeLoaded,this.c_contentMetadataLoadedOrDoesNotExist]);this.m_iframe&&this.m_iframe.id&&this.m_logger.ULS.traceTag(590424140,logCategory.PptSession,logLevel.Info,"iframe about to be replaced with new iframe: Old iframe Id: "+this.m_iframe.id+"  , New iframe Id: "+this.m_initParams.SessionInformation.HostSessionId);this.m_iframe=n.CreateBaseIframe(this.m_initParams.SessionInformation.HostSessionId);this.m_logger.ULS.traceTag(39203533,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::LoadApp creating new iframe - "+this.m_iframe.id.toString());f=this.m_initParams&&this.m_initParams.ApplicationCustomSettings&&this.m_fShouldUseLegacySlideShowAspx&&this.m_appMetaData&&this.m_appMetaData.Environment=="wac"&&this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer!=null;u=this.GenerateSlideShowParams(t,i);f||window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0?this.m_slideShowLoader.LoadSlideShow(this.m_iframe,u,this.m_fShouldUseLegacySlideShowAspx,r):(this.registerOnLoadErrorEvent(),this.LoadIframe(u));this.registerOnLoadEvent();this.registerOnUnloadEvent();this.m_bootTimingDict.iframeURLset=Date.now()},n.prototype.LaunchFromSlide=function(n){var r=this,t,i;if(!this.m_iframe){this.m_logger.ULS.traceTag(39416214,logCategory.PptSession,logLevel.Error,"PreviewSessionLoader::LaunchFromSlide iframe is null");return}if(this.m_logger.ULS.traceTag(39416215,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::LaunchFromSlide"),this.m_initParams.ApplicationCustomSettings&&n.WacCluster&&(this.m_initParams.ApplicationCustomSettings.WacCluster=n.WacCluster),this.m_initParams.Diagnostics=n.Diagnostics,this.m_presentationId=n.PresentationId,this.m_apiStartTime=Date.now(),this.m_bootTimingDict.ApiStartTime=this.m_apiStartTime,this.m_streamUseThinEmbed=n.StreamVideoUseThinEmbed,n.SendInitialLog&&PPTBootstrapper.SendInitialLog(this.m_initParams,"Slide Show",null,this.m_logger),t=this.m_presentationId,this.m_startingSlideId=n.StartingSlideId||-1,this.m_startingSlideIndex=n.StartingSlideIndex||-1,this.m_vetoAppSettingsStr=n.VetoAppSettingsStr||"",this.m_disabledTransitionsList=n.DisabledTransitionsList||"",this.m_customTransitionResourceUrl=n.CustomTransitionResourceUrl||"",this.m_disabledChangeGates=n.DisabledChangeGates||"",i=HTMLHelper.floatToPercent(1),this.m_anchor.style.width=this.m_fVariableWidth?i:HTMLHelper.toPx(this.m_initParams.ApplicationCustomSettings.Width),this.m_anchor.style.height=this.m_fVariableHeight?i:HTMLHelper.toPx(this.m_initParams.ApplicationCustomSettings.Height),this.m_fVariableHeight&&(this.m_anchor.style.minHeight=HTMLHelper.toPx(this.c_minHeight)),this.m_anchor.style.left=HTMLHelper.toPx(0),this.m_anchor.style.right=HTMLHelper.toPx(0),this.m_anchor.style.bottom=HTMLHelper.toPx(0),this.m_anchor.style.top=HTMLHelper.toPx(0),this.m_fVariableHeight?this.m_iframe.style.minHeight=HTMLHelper.toPx(this.c_minIframeHeight):this.m_iframe.style.height=HTMLHelper.toPx(Math.max(this.m_initParams.ApplicationCustomSettings.Height,0)),(this.m_fShouldUseLegacySlideShowAspx||window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0)&&this.m_slideShowLoader.LaunchSlideShow(),this.m_finishedBootingConditional=new ConditionalAction(function(){return r.SendBootTelemetry()},[this.c_activated]),this.m_initParams.WopiPrecheckInfo.BundleInfo.Url)this.GetPreviewImage(t),this.GetContentMetadata();else{if(this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.EnablePodPreviewStaticImage&&this.m_startingSlideIndex>=1&&this.GetPreviewImageFromPods(t,this.m_startingSlideIndex),!this.m_readyToActivateConditional){this.m_logger.ULS.traceTag(51448028,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Conditional Action uninitialized");throw Error("m_readyToActivateConditional");}this.m_readyToActivateConditional.SetCondition(this.c_contentMetadataLoadedOrDoesNotExist)}this.sessionCanRetryPreviewerCreation()&&(this.m_retryPreviewerTimeout=window.setTimeout(function(){return r.retryPreviewer()},13e3))},n.prototype.sessionCanRetryPreviewerCreation=function(){if(this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.WdParams&&this.m_initParams.SessionInformation.WdParams.retryPptIFrameLoad!=undefined)return!!this.m_initParams.SessionInformation.WdParams.retryPptIFrameLoad;var n=this.m_initParams.SessionInformation.UiHostRing;return n&&(PodsRegionInfo.TeamsRingsInEdog.indexOf(n.toLowerCase())>=0||n.toLowerCase()=="ring2")?!0:!1},n.prototype.retryPreviewer=function(){try{this.retryPreviewerIFrameCreation()}catch(n){this.m_logger.ULS.traceTag(589088848,logCategory.PptSession,logLevel.Warning,"PreviewerSessionLoader::RetryPreviewer - retry failed. Exception: "+n)}},n.prototype.retryPreviewerIFrameCreation=function(){var t=this,r=function(n){var i=new XMLHttpRequest;i.addEventListener("load",function(n){t.m_logger.ULS.traceTag(588317710,logCategory.PptSession,logLevel.Warning,"Call to load iframe Complted. Status:  "+n.target.status+" , Status Text: "+n.target.statusText)});i.addEventListener("error",function(n){t.m_logger.ULS.traceTag(588317709,logCategory.PptSession,logLevel.Warning,"Retried fetching iframe src but request failed with with: "+n.target.status+" , Status Text: "+n.target.statusText)});i.addEventListener("abort",function(){t.m_logger.ULS.traceTag(588317708,logCategory.PptSession,logLevel.Warning,"Call to load iframe Aborted.")});i.open("GET",n);i.timeout=1e4;i.send()},u,i;this.m_iframeReadyForPostMessage!==!0?(this.m_logger.ULS.traceTag(589088847,logCategory.PptSession,logLevel.Warning,"PreviewerSessionLoader::retryPreviewerIFrameCreation - retrying iframe creation"),this.m_bootTimingDict.IframeRetryStart=Date.now(),this.m_iframe==null?this.m_logger.ULS.traceTag(589088846,logCategory.PptSession,logLevel.Warning,"PreviewerSessionLoader::retryPreviewerIFrameCreation - iframe not created"):this.m_iframe.parentNode.removeChild(this.m_iframe),this.m_iframe=n.CreateBaseIframe(this.m_initParams.SessionInformation.HostSessionId),u=this.m_initParams&&this.m_initParams.ApplicationCustomSettings&&this.m_fShouldUseLegacySlideShowAspx&&this.m_appMetaData&&this.m_appMetaData.Environment=="wac"&&this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer!=null,i=this.GenerateSlideShowParams(this.m_presentationId,!1),u||window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0?this.m_slideShowLoader.LoadSlideShow(this.m_iframe,i,this.m_fShouldUseLegacySlideShowAspx,{},r):(this.registerOnLoadErrorEvent(),this.LoadIframe(i,r)),this.registerOnLoadEvent(),this.registerOnUnloadEvent(),(this.m_fShouldUseLegacySlideShowAspx||window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0)&&this.m_slideShowLoader.LaunchSlideShow()):this.m_logger.ULS.traceTag(589088845,logCategory.PptSession,logLevel.Warning,"PreviewerSessionLoader::retryPreviewerIFrameCreation - retry timeout hit but iframe is ready for postmessage.")},n.prototype.SendBootTelemetry=function(){this.m_logger.ULS.traceTag(38540373,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::SendBootTelemetry");var n=new BootTimingFromApiInternalMessage(this.m_bootTimingDict);this.PostMessageDownward(n)},n.prototype.RecordStartedSlideShowTimestamp=function(n){this.m_logger.ULS.traceTag(39683465,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::RecordStartedSlideShowTimestamp Time that SlideShow started in ms: "+n);var t=new RecordStartedSlideShowTimestampInternalMessage(n);this.PostMessageDownward(t)},n.prototype.GetDataCdnEndpoint=function(){var t,n,i,r;return this.m_initParams.ApplicationCustomSettings&&this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.substr(0,1)=="/"?(n=document.createElement("a"),n.href=this.m_initParams.ApplicationCustomSettings.Url,i=n.protocol,r=n.host,t=i+"//"+r+this.m_initParams.WopiPrecheckInfo.BundleInfo.Url):t=this.m_initParams.WopiPrecheckInfo.BundleInfo.Url,t},n.prototype.GetPreviewImage=function(n){var i,t;this.m_logger.ULS.traceTag(39203536,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::GetPreviewImage");i=this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.indexOf("{1}")==-1?this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.replace(new RegExp("\\{0\\}","gim"),"f.jpg"):this.m_initParams.WopiPrecheckInfo.BundleInfo.Url.replace(new RegExp("\\{0\\}","gim"),n).replace(new RegExp("\\{1\\}","gim"),"0").replace(new RegExp("\\{2\\}","gim"),"fullSizePreview.jpg");t=document.createElement("img");t.style.visibility="hidden";t.style.position="absolute";t.src=i},n.prototype.GetPreviewImageFromPods=function(n,t){var u,i,f,r;this.m_initParams.ApplicationCustomSettings&&this.m_initParams.ApplicationCustomSettings.OnDemandServer&&(this.m_logger.ULS.traceTag(39203537,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::GetPreviewImageFromPods"),u=void 0,u=this.m_initParams.ApplicationCustomSettings.OnDemandServer,i="fullSizePreview.png",t>1&&(i=t-1+"_"+i),f=void 0,f=u+"imagehandler.ashx?PV=6&PF=4&Rid="+i+"&Pid="+n+"&X-SupportSVGInWebGL="+(BrowserUtils.BrowserSupportsRenderingSVGInWebGL()?"1":"0"),r=document.createElement("img"),r.style.visibility="hidden",r.style.position="absolute",r.src=f)},n.prototype.GetContentMetadata=function(){var i=this,t,n;this.m_logger.ULS.traceTag(39203538,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::GetContentMetadata");this.m_bootTimingDict.BeginLoadContentMetadata=Date.now();t=this.GetDataCdnEndpoint();n=new XhrRequest;n.Url=t.replace(new RegExp("\\{0\\}","gim"),"c.js");n.OnCompletedCallback=function(n){return i.OnCompletedMetadata(n)};n.State="c.js";n.Timeout=1e4;XhrHelper.GetJson(n)},n.prototype.OnCompletedMetadata=function(n){if(this.m_bootTimingDict.FinishedLoadContentMetadata=Date.now(),n.FSuccess){if(this.m_contentMetadata=n.Data||null,!this.m_readyToActivateConditional){this.m_logger.ULS.traceTag(51448029,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Conditional Action uninitialized");throw Error("m_readyToActivateConditional");}this.m_readyToActivateConditional.SetCondition(this.c_contentMetadataLoadedOrDoesNotExist);var t={};t.ContentLength=n.ContentLength;t.ResourceStringLength=n.ResourceStringLength;t.RetriesUsed=n.RetriesUsed;t.ServerCorrelation=n.serverCorrelation;this.m_logger.ULS.traceTag(38286561,logCategory.PptSession,logLevel.Info,JSON.stringify(t))}else{if(this.m_logger.ULS.traceTag(38286562,logCategory.PptSession,logLevel.Info,"ErrorDesription: Failed to load content metadata in api layer, HttpStatusCode: "+n.HttpStatusCode+", ID: "+n.State),this.m_contentMetadata=null,this.m_contentMetadataHttpStatusCode=n.HttpStatusCode.toString(),!this.m_readyToActivateConditional){this.m_logger.ULS.traceTag(51448030,logCategory.PptSession,logLevel.Warning,"PreviewSessionLoader::OnMesssage - Conditional Action uninitialized");throw Error("m_readyToActivateConditional");}this.m_readyToActivateConditional.SetCondition(this.c_contentMetadataLoadedOrDoesNotExist)}},n.GetHostName=function(n){return n.SessionInformation.HostName?n.SessionInformation.HostName:window.location.hostname},n.RelativeUrlToAbsolute=function(t){var i=document.createElement("div"),r;return i.innerHTML='<a href="'+n.EscapeHtml(t)+'">x<\/a>',r=i.firstChild,r.href},n.EscapeHtml=function(n){return n.split("&").join("&amp;").split("<").join("&lt;").split('"').join("&quot;")},n.prototype.Dispose=function(){this.m_logger.ULS.traceTag(39203539,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::Dispose - removeAnchor: "+(this.m_anchor!=null).toString()+", removeAPI: "+(this.m_apiId!=null).toString());this.m_anchor&&this.m_anchor.parentNode&&this.m_anchor.parentNode.removeChild(this.m_anchor);this.m_apiId&&PPTMessageListenerRegistry.GetInstance().Remove(this.m_apiId,!0,"Dispose from PreviewSessionLoader");this.DisposeForTransferToPreviewAPI()},n.prototype.DisposeForTransferToPreviewAPI=function(){this.m_anchor=null;this.m_iframe=null;this.m_apiId=null},n.prototype.DisposePreloadedApp=function(){this.m_logger.ULS.traceTag(39416216,logCategory.PptSession,logLevel.Info,"PreviewSessionLoader::DisposePreloadedApp");this.m_iframe&&this.m_iframe.parentNode&&this.m_iframe.parentNode.removeChild(this.m_iframe);this.m_apiId&&PPTMessageListenerRegistry.GetInstance().Remove(this.m_apiId,!0,"Dispose PreloadApp");this.DisposeForTransferToPreviewAPI()},n.prototype.RecordBootStrapperInitTime=function(n){this.m_bootTimingDict.BootstrapperInitTime=n},n}();Microsoft.Office.PowerPoint.Bootstrap.SetPreviewAPIFactory=function(n){PreviewSessionLoader.s_previewAPIFactory=n;PPTMessageListenerRegistry.GetInstance().SetSliceLoaded()};var SlideShowLoader=function(){function n(n,t,i){this.m_iframe=null;this.m_frameForm=null;this.m_appMetadata=i;this.m_logger=t;this.m_initParams=n;this.m_anchor=n.Container}return n.prototype.LoadSlideShow=function(t,i,r,u,f){var l=this,a,h,c,e,s,o;if(f===void 0&&(f=undefined),a=Date.now(),this.m_iframe=t,this.m_anchor==null||this.m_iframe==null){this.m_logger.ULS.traceTag(592732160,logCategory.PptSession,logLevel.Error,"PreviewerSessionLoader::LoadModernSlideShowFrame is missing parameters");return}if(h=r?this.m_initParams.ApplicationCustomSettings.OnDemandServer+"legacySlideshow.aspx":this.m_initParams.ApplicationCustomSettings.OnDemandServer+"Slideshow.aspx",c="slideshowframe-"+this.m_iframe.id.toString(),this.m_iframe.name=c,this.m_frameForm=document.createElement("form"),this.m_frameForm.name="frameform-"+this.m_iframe.id.toString(),this.m_frameForm.id="frameform-"+this.m_iframe.id.toString(),this.m_frameForm.target=c,this.m_frameForm.action=h,this.m_frameForm.method="post",this.m_iframe.parentNode||this.m_anchor.appendChild(this.m_iframe),e={},this.m_initParams.WopiPrecheckInfo.FileGetUrl&&(e.fileurl=this.m_initParams.WopiPrecheckInfo.FileGetUrl),this.m_initParams.WopiPrecheckInfo.FileName&&(e.fileName=this.m_initParams.ApplicationCustomSettings.DisabledChangeGates&&this.m_initParams.ApplicationCustomSettings.DisabledChangeGates.indexOf("EncodeFileName")>-1?this.m_initParams.WopiPrecheckInfo.FileName:UrlUtils.UrlKeyValueEncode(this.m_initParams.WopiPrecheckInfo.FileName)),s=this.GetPodsUrl(this.m_initParams),s!=null&&s!==""&&(e.podsurl=s),this.m_initParams.SessionInformation.HostSessionId!=null&&(e.hostsessionid=this.m_initParams.SessionInformation.HostSessionId,e["X-UserSessionId"]=this.m_initParams.SessionInformation.HostSessionId),this.m_initParams.ApplicationCustomSettings.StartingSlideIndex!=null&&(e.startingslideindex=this.m_initParams.ApplicationCustomSettings.StartingSlideIndex.toString()),this.m_initParams.SessionInformation.HostName!=null&&(e.hostname=this.m_initParams.SessionInformation.HostName),this.m_initParams.SessionInformation.DocumentClickTime!=null)try{e.startFromTime=this.m_initParams.SessionInformation.DocumentClickTime.getTime()}catch(v){this.m_logger.ULS.traceTag(590221380,logCategory.PptSession,logLevel.Error,"PreviewerSessionLoader::LoadSlideShow exception thrown: "+v)}this.m_initParams.SessionInformation&&this.m_initParams.SessionInformation.WdParams&&(this.m_initParams.SessionInformation.WdParams.wdModernSlideShowInTeams&&(e.wdModernSlideShowInTeams=this.m_initParams.SessionInformation.WdParams.wdModernSlideShowInTeams),this.m_initParams.SessionInformation.WdParams.wdBrowserShapeBuilderCompatible&&(e.wdBrowserShapeBuilderCompatible=this.m_initParams.SessionInformation.WdParams.wdBrowserShapeBuilderCompatible),this.m_initParams.SessionInformation.WdParams.wdIsFileTypeSupportedForModernSlideShow&&(e.wdIsFileTypeSupportedForModernSlideShow=this.m_initParams.SessionInformation.WdParams.wdIsFileTypeSupportedForModernSlideShow));u!=null&&(u.initWopiTime!=null&&(e.initWopiTime=u.initWopiTime.toFixed(),e.startFromTime||(e.startFromTime=u.initWopiTime.toFixed(),this.m_logger.ULS.traceTag(587830343,logCategory.PptSession,logLevel.Error,"PreviewerSessionLoader::LoadSlideShow startFromTime was not present, so will use initWopiTime instead"))),u.bootstrapperInitTime!=null&&(e.bootstrapperInitTime=u.bootstrapperInitTime.toFixed()),u.createViewerTime!=null&&(e.createViewerTime=u.createViewerTime.toFixed()),u.previewSessionLoadAppTime!=null&&(e.previewSessionLoadAppTime=u.previewSessionLoadAppTime.toFixed()));e.loadSlideShowTime=a.toFixed();this.m_appMetadata!=null&&this.m_appMetadata.Environment==="wac"&&this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer!=null&&(o=this.m_initParams.ApplicationCustomSettings.WacStaticResourcesServer+this.m_appMetadata.WacCdnVersion,e.slideshowappjsurl=o+"_pptscripts/SlideShowApp.js",e.CommonJsPath=o+"_pptscripts/common.min.js",e.Common50JsPath=o+"_pptscripts/common50.min.js",e.SlideShowToolbarStringJsPath=o+"_pptscripts/1033/powerpoint-slideshow-toolbar-strings.min.js",e.SlideShowToolbarJsPath=o+"_pptscripts/SlideshowToolbar.min.js",e.PresenterViewStringsJsPath=o+"_pptscripts/powerpoint-presenter-view-strings.min.js",e.PresenterViewJsFilePath=o+"_pptscripts/PresenterView.min.js",e.SlideGridCssFilePath=o+"_pptresources/1033/PPTGridComponent.css",e.PresenterViewCssFilePath=o+"_pptresources/1033/presenter.css");r&&(e.wdForceModernSlideShowInTeams=window.location.search.indexOf("wdForceModernSlideShowInTeams")>=0,i&&Object.keys(i).forEach(function(n){e[n.toLowerCase()]=i[n]}),e.wdpresenterviewinteams=window.location.search.indexOf("wdPresenterViewInTeams")>=0);Object.keys(e).forEach(function(t){l.m_frameForm!=null&&l.m_frameForm.appendChild(n.CreateHiddenInputElement(t,e[t]))});f&&f(h);this.m_anchor.appendChild(this.m_frameForm)},n.prototype.LaunchSlideShow=function(){this.m_frameForm!=null&&this.m_frameForm.submit()},n.CreateHiddenInputElement=function(n,t){var i=document.createElement("input");return i.type="hidden",i.name=n,i.value=t,i},n.prototype.GetPodsUrl=function(n){var t=UrlUtils.GetQueryStringParam("wdPodsUrl");return t&&!this.validateUrlHostMatchesWindowHost(t)&&(t=""),t||(t=PPTBootstrapper.GetOnDemandServer(n,!0)),t.substr(t.length-1)!="/"&&(t+="/"),t},n.prototype.validateUrlHostMatchesWindowHost=function(n){var t=document.createElement("a"),i,r;return t.href=n,i=t.port||80,r=window.location.port||80,t.hostname==window.location.hostname&&i==r},n}(),ConditionalAction=function(){function n(n,t){var i=this;if(this.m_conditions={},t.length==0)throw Error("conditions");this.m_action=n;t.forEach(function(n){i.m_conditions[n]=!1})}return n.prototype.SetCondition=function(n){if(this.m_conditions[n]==null)throw Error("condition");this.m_conditions[n]=!0;this.CheckConditions()},n.prototype.AddNewCondition=function(n){if(n in this.m_conditions)throw Error("condition");this.m_conditions[n]=!1},n.prototype.GetCondition=function(n){if(this.m_conditions[n]==null)throw Error("condition");return this.m_conditions[n]},n.prototype.CheckConditions=function(){var n,t;if(this.m_action!=null){n=!0;for(t in this.m_conditions)n=n&&this.m_conditions[t];n&&(this.m_action(),this.m_action=null)}},n}(),PPTMessageListenerRegistry=function(){function n(){this.m_apiRegistry={};window.addEventListener("message",this.OnMessage)}return n.GetInstance=function(){return this.s_singleton||(this.s_singleton=new n),this.s_singleton},n.prototype.Add=function(n,t,i,r){r===void 0&&(r="");this.m_apiRegistry[n]=t;i&&this.SendLogToAllListeners("Add to Message Registry: "+n+", Reason: "+r,this.GetLoggableDataFromMessageListenerRegistry())},n.prototype.Get=function(n){return this.m_apiRegistry[n]},n.prototype.Remove=function(n,t,i){i===void 0&&(i="");this.m_apiRegistry[n]=null;t&&this.SendLogToAllListeners("Remove from Message Registry: "+n+", Reason: "+i,this.GetLoggableDataFromMessageListenerRegistry())},n.prototype.SetSliceLoaded=function(){var t,n;for(t in this.m_apiRegistry)n=this.m_apiRegistry[t],n&&n.OnSliceLoaded()},n.prototype.SendLogToAllListeners=function(n,t){var r,i;for(r in this.m_apiRegistry)i=this.m_apiRegistry[r],i&&i.Log(n,t)},n.prototype.GetLoggableDataFromMessageListenerRegistry=function(){var i={},n,t;for(n in this.m_apiRegistry)t=this.m_apiRegistry[n],i[n]=t?t.hasOwnProperty("c_activated")?"PreviewSessionLoader":"PreviewSessionManagerV0":"API is Null";return JSON.stringify(i)},n.prototype.OnMessage=function(t){var i,r,u,f;try{i=JSON.parse(t.data)}catch(e){i=null}if(i&&(r=i.m_id||i.Token,r)){if(u=n.GetInstance(),f=u.Get(r),!f){u.SendLogToAllListeners("Message received with no targetApi. Id: "+r.toString(),t.data);return}f.OnMessage(i,t.source)}},n}(),WebViewerBaseMessage=function(){function n(n,t){this.m_id=n;this.m_type=t}return n}(),WebViewerBaseInternalMessage=function(){function n(n){this.m_type=n}return n}(),HandshakeWebViewerInternalMessage=function(n){function t(t,i,r,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it){var rt=n.call(this,0)||this;return rt.m_id=t,rt.m_fEnableKeyboardNavigation=i,rt.m_contentMetadata=r,rt.m_fileUrl=u,rt.m_fileSize=f,rt.m_fileName=e,rt.m_presentationId=o,rt.m_startingSlideId=s,rt.m_startingSlideIndex=h,rt.m_hostName=c,rt.m_entryPoint=l,rt.m_apiStartTime=a,rt.m_documentClickTime=v,rt.m_hostInitTime=y,rt.m_fEnablePodPreviewStaticImage=p,rt.m_fEnableAdvanceOnTap=w,rt.m_fileHost=b,rt.m_vetoAppSettingsStr=k,rt.m_disabledTransitionsList=d,rt.m_customTransitionResourceUrl=g,rt.m_streamUseThinEmbed=nt,rt.m_disabledChangeGates=tt,rt.m_wacRegion=it,rt}return __extends(t,n),t}(WebViewerBaseInternalMessage),BootTimingFromApiInternalMessage=function(n){function t(t){var i=n.call(this,26)||this;return i.m_apiTimings=t,i}return __extends(t,n),t}(WebViewerBaseInternalMessage),RecordStartedSlideShowTimestampInternalMessage=function(n){function t(t){var i=n.call(this,33)||this;return i.m_startSlideShowTime=t,i}return __extends(t,n),t}(WebViewerBaseInternalMessage),XhrRequest=function(){function n(){this.OnCompletedCallback=function(){};this.NumRetries=5;this.Timeout=0;this.Finished=!1;this.Aborted=!1}return n.prototype.Abort=function(){this.Finished||(this.Finished=!0,this.Aborted=!0,this.CurrentRequest&&this.CurrentRequest.abort())},n.prototype.Finish=function(n){this.Finished=!0;this.OnCompletedCallback(n)},n}(),XhrResponse=function(){function n(n,t,i,r,u,f,e,o,s){this.Data=n;this.FSuccess=t;this.HttpStatusCode=i;this.RetriesUsed=r;this.State=u;this.ContentLength=f;this.ResourceStringLength=e;this.Aborted=o;this.serverCorrelation=s}return n}(),XhrHelper=function(){function n(){}return n.GetBinary=function(n){this.GetWithRetries(n,0)},n.GetJson=function(n){this.GetWithRetries(n,0)},n.GetWithRetries=function(n,t){var r=this,i;if(!n.Url)throw Error("Url");if(n.ResponseType&&n.ResponseType!="arraybuffer"&&n.ResponseType!="blob")throw Error("ResponseType:"+n.ResponseType);i=new XMLHttpRequest;i.open("GET",n.Url,!0);i.timeout=n.Timeout;n.ResponseType&&(i.responseType=n.ResponseType);i.onreadystatechange=function(){i.readyState==4&&r.OnComplete(i,n,t)};i.send();n.CurrentRequest=i},n.OnComplete=function(n,t,i){var f=n.status,e=t.State,o=i,s=t.Aborted,r=!1,u,h;if(n.status!=200){!t.Aborted&&t.NumRetries>i&&n.status>=400&&n.status<500?this.GetWithRetries(t,i+1):t.Finish(new XhrResponse(undefined,r,f,o,e,undefined,undefined,s,undefined));return}t.ResponseType=="arraybuffer"||t.ResponseType=="blob"?u=n.response:(u=this.Deserialize(n.responseText),h=n.responseText.length);var c=n.getResponseHeader("Content-Length")?parseInt(n.getResponseHeader("Content-Length")):0,l=n.getResponseHeader("X-CorrelationId"),a=c?c:0;r=!0;t.Finish(new XhrResponse(u,r,f,o,e,a,h,s,l))},n.Deserialize=function(n){if(n.substr(n.length-2,2)==");"){var t=n.indexOf("(")+1,i=n.length-2;n=n.substring(t,i)}return JSON.parse(n)},n}();