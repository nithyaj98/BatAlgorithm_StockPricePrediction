!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.ShapeBuilder=t():e.ShapeBuilder=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=21)}([function(e,t,r){"use strict";r.d(t,"f",(function(){return n})),r.d(t,"d",(function(){return i})),r.d(t,"a",(function(){return a})),r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"h",(function(){return c})),r.d(t,"g",(function(){return u})),r.d(t,"e",(function(){return h})),r.d(t,"k",(function(){return l})),r.d(t,"j",(function(){return f})),r.d(t,"i",(function(){return d}));var n=.001,i=function(){function e(e,t){this.x=e,this.y=t}return e.Flip=function(t,r){return new e(t?-1:1,r?-1:1)},e.prototype.negate=function(){return new e(-this.x,-this.y)},e.prototype.inverse=function(){return new e(1/this.x,1/this.y)},e.prototype.normalized=function(){var e=this.length();return e?this.scale(1/e):void 0},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.ceil=function(){return new e(Math.ceil(this.x),Math.ceil(this.y))},e.prototype.sign=function(){return new e(this.x<0?-1:1,this.y<0?-1:1)},e.prototype.isZero=function(){return 0==this.x&&0==this.y},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.Distance=function(e,t){return e.subtract(t).length()},e.prototype.equals=function(e){return this.x==e.x&&this.y==e.y},e.prototype.equalsWithEpsilon=function(e,t){return void 0===t&&(t=n),Math.abs(this.x-e.x)<t&&Math.abs(this.y-e.y)<t},e.prototype.add=function(t){return new e(this.x+t.x,this.y+t.y)},e.prototype.subtract=function(t){return new e(this.x-t.x,this.y-t.y)},e.prototype.multiply=function(t){return new e(this.x*t.x,this.y*t.y)},e.prototype.divide=function(t){return new e(this.x/t.x,this.y/t.y)},e.prototype.dot=function(e){return this.x*e.x+this.y*e.y},e.prototype.scale=function(t){return new e(this.x*t,this.y*t)},e.prototype.rotate=function(t){return t?new e(this.x*Math.cos(t)-this.y*Math.sin(t),this.x*Math.sin(t)+this.y*Math.cos(t)):this},e.prototype.transformVector=function(e){return e.transformVector(this)},e.prototype.transformPoint=function(e){return e.transformPoint(this)},e.InterpolateLinear=function(e,t,r){return e.add(t.subtract(e).scale(r))},e.InterpolateQuadratic=function(t,r,n,i){return e.InterpolateLinear(e.InterpolateLinear(t,r,i),e.InterpolateLinear(r,n,i),i)},e.QuadraticTangent=function(t,r,n,i){return e.InterpolateLinear(r,n,i).subtract(e.InterpolateLinear(t,r,i)).normalized()},e.CalculateLineIntersection=function(t,r,i,a,o){void 0===o&&(o=n);var s=(a.x-i.x)*(t.y-i.y)-(a.y-i.y)*(t.x-i.x),c=(a.y-i.y)*(r.x-t.x)-(a.x-i.x)*(r.y-t.y);if(Math.abs(c)>o)return e.InterpolateLinear(t,r,s/c)},e.MeasureQuadraticLength=function(e,t,r){return f(e.x,e.y,t.x,t.y,r.x,r.y)},e.Zero=new e(0,0),e.One=new e(1,1),e}(),a=function(){function e(e,t,r,n,i,a,o,s,c){this.m=new Float32Array([e,t,r,n,i,a,o,s,c])}return e.prototype.toMatrix3=function(){return this},e.prototype.isIdentity=function(){return this==e.Identity||this.equals(e.Identity)},e.prototype.multiply=function(t){var r=this.m,n=t.m;return new e(r[0]*n[0]+r[1]*n[3]+r[2]*n[6],r[0]*n[1]+r[1]*n[4]+r[2]*n[7],r[0]*n[2]+r[1]*n[5]+r[2]*n[8],r[3]*n[0]+r[4]*n[3]+r[5]*n[6],r[3]*n[1]+r[4]*n[4]+r[5]*n[7],r[3]*n[2]+r[4]*n[5]+r[5]*n[8],r[6]*n[0]+r[7]*n[3]+r[8]*n[6],r[6]*n[1]+r[7]*n[4]+r[8]*n[7],r[6]*n[2]+r[7]*n[5]+r[8]*n[8])},e.prototype.transformVector=function(e){return new i(e.x*this.m[0]+e.y*this.m[3],e.x*this.m[1]+e.y*this.m[4])},e.prototype.transformPoint=function(e){return new i(e.x*this.m[0]+e.y*this.m[3]+this.m[6],e.x*this.m[1]+e.y*this.m[4]+this.m[7])},e.prototype.isSimpleScaleTranslationOnly=function(){return 0==this.m[1]&&0==this.m[2]&&0==this.m[3]&&0==this.m[5]&&1==this.m[8]},e.prototype.getSimpleScale=function(){return new i(this.m[0],this.m[4])},e.prototype.getSimpleTranslation=function(){return new i(this.m[6],this.m[7])},e.prototype.equals=function(e){for(var t=0;t<9;t++)if(this.m[t]!=e.m[t])return!1;return!0},e.prototype.tryGetTransform=function(e){var t=this.transformVector(new i(1,0)),r=this.transformVector(new i(0,1));if(!(Math.abs(t.x*r.x+t.y*r.y)>n)){var a=t.x*r.y-t.y*r.x>0?new i(t.length(),r.length()):new i(t.length(),-r.length()),s=t.y>0?Math.acos(t.x/a.x):-Math.acos(t.x/a.x),c=this.transformPoint(e.negate());return new o(e,a,s,c)}},e.Translation2D=function(t){return new e(1,0,0,0,1,0,t.x,t.y,1)},e.Scale2D=function(t){return new e(t.x,0,0,0,t.y,0,0,0,1)},e.ScaleTranslation2D=function(t,r){return new e(t.x,0,0,0,t.y,0,r.x,r.y,1)},e.RotationZ=function(t){var r=Math.cos(t),n=Math.sin(t);return new e(r,n,0,-n,r,0,0,0,1)},e.RotationAroundPoint=function(e,t){return new o(t.negate(),i.One,e,t).toMatrix3()},e.FromTransforms=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];if(0==t.length)return e.Identity;for(var n=t[0].toMatrix3(),i=1;i<t.length;i++)n=n.multiply(t[i].toMatrix3());return n},e.Identity=new e(1,0,0,0,1,0,0,0,1),e}(),o=function(){function e(e,t,r,n){this.preTranslation=e||i.Zero,this.scale=t||i.One,this.rotation=null!=r?r:0,this.translation=n||i.Zero}return e.prototype.toMatrix3=function(){var e=Math.cos(this.rotation),t=Math.sin(this.rotation),r=this.scale.x*e,n=this.scale.x*t,i=this.scale.y*-t,o=this.scale.y*e;return new a(r,n,0,i,o,0,this.preTranslation.x*r+this.preTranslation.y*i+this.translation.x,this.preTranslation.y*o+this.preTranslation.x*n+this.translation.y,1)},e.prototype.isIdentity=function(){return this==e.Identity||this.equals(e.Identity)},e.prototype.toInverseMatrix3=function(){var e=Math.cos(-this.rotation),t=Math.sin(-this.rotation),r=e/this.scale.x,n=t/this.scale.y,i=-t/this.scale.x,o=e/this.scale.y;return new a(r,n,0,i,o,0,-this.translation.x*r-this.translation.y*i-this.preTranslation.x,-this.translation.y*o-this.translation.x*n-this.preTranslation.y,1)},e.prototype.transformVector=function(e){return e.multiply(this.scale).rotate(this.rotation)},e.prototype.transformPoint=function(e){return e.add(this.preTranslation).multiply(this.scale).rotate(this.rotation).add(this.translation)},e.prototype.applyScaleAndTranslationBefore=function(t,r){return new e(this.preTranslation.add(r).divide(t),this.scale.multiply(t),this.rotation,this.translation)},e.prototype.applyTranslationAfter=function(t){return new e(this.preTranslation,this.scale,this.rotation,this.translation.add(t))},e.prototype.equals=function(e){return this.preTranslation.equals(e.preTranslation)&&this.scale.equals(e.scale)&&this.rotation==e.rotation&&this.translation.equals(e.translation)},e.fromScaleAndTranslation=function(t,r){return new e(void 0,t,void 0,r)},e.fromTransformAndPretranslation=function(t,r){return new e(r,t.scale,t.rotation,t.translation)},e.fromTransformAndScale=function(t,r){return new e(t.preTranslation,r,t.rotation,t.translation)},e.fromTransformAndRotation=function(t,r){return new e(t.preTranslation,t.scale,r,t.translation)},e.fromTransformAndTranslation=function(t,r){return new e(t.preTranslation,t.scale,t.rotation,r)},e.Identity=new e,e}(),s=function(){function e(e,t,r,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===n&&(n=0),this.left=e,this.top=t,this.right=r,this.bottom=n}return e.FromSize=function(t){return new e(0,0,t.x,t.y)},e.FromSizeAndCenter=function(t,r){return new e(r.x-.5*t.x,r.y-.5*t.y,r.x+.5*t.x,r.y+.5*t.y)},e.FromPoints=function(t,r){return new e(Math.min(t.x,r.x),Math.min(t.y,r.y),Math.max(t.x,r.x),Math.max(t.y,r.y))},e.prototype.isEmpty=function(){return this.left==this.right&&this.top==this.bottom},e.prototype.isValid=function(){return this.left<=this.right&&this.top<=this.bottom},Object.defineProperty(e.prototype,"width",{get:function(){return this.right-this.left},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.bottom-this.top},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return new i(this.right-this.left,this.bottom-this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"center",{get:function(){return new i((this.left+this.right)/2,(this.top+this.bottom)/2)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"leftTop",{get:function(){return new i(this.left,this.top)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rightBottom",{get:function(){return new i(this.right,this.bottom)},enumerable:!0,configurable:!0}),e.prototype.isPointInRect=function(e){return this.left<=e.x&&e.x<=this.right&&this.top<=e.y&&e.y<=this.bottom},e.prototype.equals=function(e){return this.left==e.left&&this.top==e.top&&this.right==e.right&&this.bottom==e.bottom},e.prototype.inflate=function(t){return new e(this.left-t,this.top-t,this.right+t,this.bottom+t)},e.prototype.multiply=function(t){return e.FromPoints(this.leftTop.multiply(t),this.rightBottom.multiply(t))},e.prototype.divide=function(t){return e.FromPoints(this.leftTop.divide(t),this.rightBottom.divide(t))},e.prototype.translate=function(t){return new e(this.left+t.x,this.top+t.y,this.right+t.x,this.bottom+t.y)},e.prototype.transformedBounds=function(t){for(var r=void 0,n=[new i(this.left,this.top),new i(this.right,this.top),new i(this.right,this.bottom),new i(this.left,this.bottom)],a=0;a<4;a++)r=e.UnionPoint(r,n[a].transformPoint(t));return r},e.UnionPoint=function(t,r){return t&&t.isValid()?new e(Math.min(t.left,r.x),Math.min(t.top,r.y),Math.max(t.right,r.x),Math.max(t.bottom,r.y)):new e(r.x,r.y,r.x,r.y)},e.UnionRect=function(t,r){return t&&r&&t.isValid()&&r.isValid()?new e(Math.min(t.left,r.left),Math.min(t.top,r.top),Math.max(t.right,r.right),Math.max(t.bottom,r.bottom)):t&&t.isValid()?t:r&&r.isValid()?r:void 0},e.SegmentBounds=function(t,r){return new e(Math.min(t.x,r.x),Math.min(t.y,r.y),Math.max(t.x,r.x),Math.max(t.y,r.y))},e.QuadraticBezierBounds=function(t,r,n){var a;a=e.SegmentBounds(t,n);var o=(t.x-r.x)/(t.x+n.x-2*r.x);0<o&&o<1&&(a=e.UnionPoint(a,i.InterpolateQuadratic(t,r,n,o)));var s=(t.y-r.y)/(t.y+n.y-2*r.y);return 0<s&&s<1&&(a=e.UnionPoint(a,i.InterpolateQuadratic(t,r,n,s))),a},e.Zero=new e(0,0,0,0),e}();function c(e){return Math.pow(2,Math.round(Math.log(e)/Math.log(2)))}function u(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.log(2)))}function h(e,t,r){return Math.min(r,Math.max(t,e))}function l(e,t,r){return e+(t-e)*r}function f(e,t,r,n,i,a){var o=i-2*r+e,s=a-2*n+t,c=2*r-2*i,u=2*n-2*a,h=4*(o*o+s*s),l=4*(o*c+s*u),f=c*c+u*u,d=2*Math.sqrt(h+l+f),p=Math.sqrt(h),g=2*Math.sqrt(f),_=l/p;return(p*(2*h*d+l*(d-g))+(4*f*h-l*l)*Math.log((2*p+_+d)/(_+g)))/(8*h*p)}function d(e,t,r,n){var i=(t-e)/(2*Math.PI);return i-=Math.floor(i),(n&&i>0||null==n&&i>.5)&&i--,l(e,e+i*(2*Math.PI),r)}},function(e,t,r){"use strict";r.d(t,"b",(function(){return u})),r.d(t,"f",(function(){return h})),r.d(t,"a",(function(){return l})),r.d(t,"j",(function(){return f})),r.d(t,"d",(function(){return d})),r.d(t,"c",(function(){return p})),r.d(t,"e",(function(){return g})),r.d(t,"g",(function(){return _})),r.d(t,"k",(function(){return m})),r.d(t,"i",(function(){return b})),r.d(t,"h",(function(){return y})),r.d(t,"l",(function(){return v})),r.d(t,"m",(function(){return T}));var n=r(7),i=r(10),a=r(0),o=r(2),s=r(5),c=r(3),u=function(){function e(e,t,r,n){void 0===n&&(n=1),this.r=e,this.g=t,this.b=r,this.a=n}return e.prototype.equals=function(e){return this.r==e.r&&this.g==e.g&&this.b==e.b&&this.a==e.a},e.Gray=function(t){return new e(t,t,t,1)},e.FromRGBA=function(t){return new e(t.r,t.g,t.b,t.a)},e.Transparent=new e(0,0,0,0),e.Black=new e(0,0,0,1),e.White=new e(1,1,1,1),e.Red=new e(1,0,0,1),e.Orange=new e(1,.5,0,1),e.Yellow=new e(1,1,0,1),e.Green=new e(0,1,0,1),e.Cyan=new e(0,1,1,1),e.Blue=new e(0,0,1,1),e.Magenta=new e(1,0,1,1),e}(),h=function(){function e(){this.renderDataMap={},this.m_changeTracker=new s.a}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.m_id},set:function(e){this.m_id!=e&&(this.m_changeTracker.notifyChange(),this.m_id=e)},enumerable:!0,configurable:!0}),e}(),l=function(){function e(){this.m_changeTracker=new s.a}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this.m_changeTracker.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotateWithShape",{get:function(){return!0},enumerable:!0,configurable:!0}),e.IsGradient=function(e){return 2<=e&&e<=5},e}(),f=function(e){function t(t){var r=e.call(this)||this;return r.m_color=t,r}return Object(n.c)(t,e),t.prototype.clone=function(){return new t(this.m_color)},Object.defineProperty(t.prototype,"color",{get:function(){return this.m_color},set:function(e){Object(c.c)(this.changeTracker,this.m_color,e),this.m_color=e},enumerable:!0,configurable:!0}),t.prototype.getType=function(){return 1},t}(l),d=function(){function e(e,t){this.position=e,this.color=t}return e.prototype.equals=function(e){return this.position==e.position&&this.color.equals(e.color)},e}(),p=function(e){function t(t,r){var n=e.call(this)||this;return n.m_type=t,n.m_angle=0,n.m_fillFromRect=new a.b(0,0,1,1),n.m_fillToRect=new a.b(.5,.5,.5,.5),n.m_rotateWithShape=!0,n.m_isStretched=!1,n.m_shadeFromTitle=!1,n.m_gradientStops=r?r.slice(0):[],n.m_isGammaCorrected=!0,n}return Object(n.c)(t,e),t.prototype.clone=function(){var e=new t(this.m_type,this.m_gradientStops);return e.m_angle=this.m_angle,e.m_fillFromRect=this.m_fillFromRect,e.m_fillToRect=this.m_fillToRect,e.m_rotateWithShape=this.m_rotateWithShape,e.m_isStretched=this.m_isStretched,e.m_shadeFromTitle=this.m_shadeFromTitle,e.m_isGammaCorrected=this.m_isGammaCorrected,e},Object.defineProperty(t.prototype,"gradientStops",{get:function(){return this.m_gradientStops},set:function(e){Object(c.d)(this.changeTracker,this.m_gradientStops,e),this.m_gradientStops=e.slice(0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"angle",{get:function(){return this.m_angle},set:function(e){Object(c.a)(this.changeTracker,this.m_angle,e),this.m_angle=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillFromRect",{get:function(){return this.m_fillFromRect},set:function(e){Object(c.c)(this.changeTracker,this.m_fillFromRect,e),this.m_fillFromRect=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fillToRect",{get:function(){return this.m_fillToRect},set:function(e){Object(c.c)(this.changeTracker,this.m_fillToRect,e),this.m_fillToRect=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isStretched",{get:function(){return this.m_isStretched},set:function(e){Object(c.a)(this.changeTracker,this.m_isStretched,e),this.m_isStretched=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"shadeFromTitle",{get:function(){return this.m_shadeFromTitle},set:function(e){Object(c.a)(this.changeTracker,this.m_shadeFromTitle,e),this.m_shadeFromTitle=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotateWithShape",{get:function(){return 5==this.m_type||this.m_rotateWithShape},set:function(e){Object(c.a)(this.changeTracker,this.m_rotateWithShape,e),this.m_rotateWithShape=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isGammaCorrected",{get:function(){return this.m_isGammaCorrected},set:function(e){Object(c.a)(this.changeTracker,this.m_isGammaCorrected,e),this.m_isGammaCorrected=e},enumerable:!0,configurable:!0}),t.prototype.getType=function(){return this.m_type},t}(l),g=function(e){function t(t){var r=e.call(this)||this;return r.changeTracker.replaceListener(void 0,t),r.m_image=t,r.m_isStretched=!0,r.m_scale=a.d.One,r.m_offset=a.d.Zero,r.m_alignment=4,r.m_opacity=1,r.m_rotateWithShape=!0,r}return Object(n.c)(t,e),t.prototype.clone=function(){var e=new t(this.m_image);return e.m_isStretched=this.m_isStretched,e.m_scale=this.m_scale,e.m_offset=this.m_offset,e.m_alignment=this.m_alignment,e.m_opacity=this.m_opacity,e.m_rotateWithShape=this.m_rotateWithShape,e},Object.defineProperty(t.prototype,"image",{get:function(){return this.m_image},set:function(e){this.changeTracker.replaceListener(this.m_image,e),this.m_image=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"wrapMode",{get:function(){return this.m_wrapMode},set:function(e){Object(c.a)(this.changeTracker,this.m_wrapMode,e),this.m_wrapMode=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isStretched",{get:function(){return this.m_isStretched},set:function(e){Object(c.a)(this.changeTracker,this.m_isStretched,e),this.m_isStretched=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"scale",{get:function(){return this.m_scale},set:function(e){Object(c.c)(this.changeTracker,this.m_scale,e),this.m_scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"offset",{get:function(){return this.m_offset},set:function(e){Object(c.c)(this.changeTracker,this.m_offset,e),this.m_offset=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"alignment",{get:function(){return this.m_alignment},set:function(e){Object(c.a)(this.changeTracker,this.m_alignment,e),this.m_alignment=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"opacity",{get:function(){return this.m_opacity},set:function(e){Object(c.a)(this.changeTracker,this.m_opacity,e),this.m_opacity=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotateWithShape",{get:function(){return this.m_rotateWithShape},set:function(e){Object(c.a)(this.changeTracker,this.m_rotateWithShape,e),this.m_rotateWithShape=e},enumerable:!0,configurable:!0}),t.prototype.getType=function(){return 6},t}(l),_=function(e){function t(t,r,n){var i=e.call(this)||this;return i.m_pattern=t,i.m_foregroundColor=r,i.m_backgroundColor=n,i}return Object(n.c)(t,e),t.prototype.clone=function(){return new t(this.m_pattern,this.m_foregroundColor,this.m_backgroundColor)},Object.defineProperty(t.prototype,"pattern",{get:function(){return this.m_pattern},set:function(e){Object(c.a)(this.changeTracker,this.m_pattern,e),this.m_pattern=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"foregroundColor",{get:function(){return this.m_foregroundColor},set:function(e){Object(c.c)(this.changeTracker,this.m_foregroundColor,e),this.m_foregroundColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"backgroundColor",{get:function(){return this.m_backgroundColor},set:function(e){Object(c.c)(this.changeTracker,this.m_backgroundColor,e),this.m_backgroundColor=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rotateWithShape",{get:function(){return!1},enumerable:!0,configurable:!0}),t.prototype.getType=function(){return 7},t}(l),m=function(e){function t(t){var r=e.call(this)||this;return r.m_type=t,8!=t&&9!=t&&o.a.Error(592520774,"SpecialBrush must be background or group"),r}return Object(n.c)(t,e),t.prototype.clone=function(){return new t(this.m_type)},t.prototype.getType=function(){return this.m_type},t}(l),b=function(e,t,r,n,i){this.widthMin=e,this.end=t,this.cap=r,this.width=n,this.length=i},y=function(){function e(e,t,r){void 0===e&&(e=0),void 0===t&&(t=2),void 0===r&&(r=8),this.headEnd=new b(0,0,0,1,1),this.tailEnd=new b(0,0,0,1,1),this.m_changeTracker=new s.a,this.m_lineWidth=e,this.m_lineJoin=t,this.m_miterLimit=r,this.m_dashType=0,this.m_compoundType=0,this.m_alignment=0,this.m_useRoundDash=!1}return e.prototype.clone=function(){var t=new e(this.m_lineWidth);return t.m_lineJoin=this.m_lineJoin,t.m_miterLimit=this.m_miterLimit,t.m_dashType=this.m_dashType,t.m_compoundType=this.m_compoundType,t.m_alignment=this.m_alignment,t.m_useRoundDash=this.m_useRoundDash,t},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this.m_changeTracker.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineWidth",{get:function(){return this.m_lineWidth?this.m_lineWidth:this.m_lineHeight?this.m_lineHeight:0},set:function(e){Object(c.a)(this.changeTracker,this.m_lineWidth,e),this.m_lineWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"adjustedLineWidth",{get:function(){return Math.max(i.k,this.lineWidth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"adjustedLineWidthForArrowHead",{get:function(){return Math.max(i.l,this.lineWidth)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineHeight",{get:function(){return this.m_lineHeight?this.m_lineHeight:this.m_lineWidth?this.m_lineWidth:0},set:function(e){Object(c.a)(this.changeTracker,this.m_lineHeight,e),this.m_lineHeight=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tipScale",{get:function(){return this.m_lineWidth&&this.m_lineHeight?new a.d(1,this.m_lineHeight/this.m_lineWidth):a.d.One},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineJoin",{get:function(){return this.m_lineJoin},set:function(e){Object(c.a)(this.changeTracker,this.m_lineJoin,e),this.m_lineJoin=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"miterLimit",{get:function(){return this.m_miterLimit},set:function(e){Object(c.a)(this.changeTracker,this.m_miterLimit,e),this.m_miterLimit=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dashType",{get:function(){return this.m_dashType},set:function(e){Object(c.a)(this.changeTracker,this.m_dashType,e),this.m_dashType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"useRoundDash",{get:function(){return this.m_useRoundDash},set:function(e){Object(c.a)(this.changeTracker,this.m_useRoundDash,e),this.m_useRoundDash=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dashOffset",{get:function(){return null==this.m_dashOffset?0:this.m_dashOffset},set:function(e){Object(c.a)(this.changeTracker,this.m_dashOffset,e),this.m_dashOffset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"compoundType",{get:function(){return this.m_compoundType},set:function(e){Object(c.a)(this.changeTracker,this.m_compoundType,e),this.m_compoundType=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alignment",{get:function(){return this.m_alignment},set:function(e){Object(c.a)(this.changeTracker,this.m_alignment,e),this.m_alignment=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tipType",{get:function(){return null==this.m_tipType?0:this.m_tipType},set:function(e){Object(c.a)(this.changeTracker,this.m_tipType,e),this.m_tipType=e},enumerable:!0,configurable:!0}),e}(),v=function(){function e(e,t,r,n){void 0===r&&(r=new y),void 0===n&&(n=0),this.m_changeTracker=new s.a,this.m_fillChangeTracker=new s.a,this.m_lineChangeTracker=new s.a,this.m_pictureChangeTracker=new s.a,this.m_penChangeTracker=new s.a,this.m_pen=r,this.fillBrush=e,this.lineBrush=t,this.m_blendingMode=n,this.m_penChangeTracker.replaceListener(void 0,r),s.a.AddListener(this.m_fillChangeTracker,this.m_changeTracker),s.a.AddListener(this.m_lineChangeTracker,this.m_changeTracker),s.a.AddListener(this.m_pictureChangeTracker,this.m_changeTracker),s.a.AddListener(this.m_penChangeTracker,this.m_changeTracker)}return e.prototype.clone=function(){var t=new e;return t.fillBrush=this.m_fillBrush?this.m_fillBrush.clone():void 0,t.lineBrush=this.m_lineBrush?this.m_lineBrush.clone():void 0,t.pictureBrush=this.m_pictureBrush?this.m_pictureBrush.clone():void 0,t.pen=this.m_pen.clone(),t.m_blendingMode=this.m_blendingMode,t},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"penChangeTracker",{get:function(){return this.m_penChangeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"version",{get:function(){return this.m_changeTracker.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillBrush",{get:function(){return this.m_fillBrush},set:function(e){this.m_fillChangeTracker.replaceListener(this.m_fillBrush,e),this.m_fillBrush=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineBrush",{get:function(){return this.m_lineBrush},set:function(e){this.m_lineChangeTracker.replaceListener(this.m_lineBrush,e),this.m_lineBrush=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pictureBrush",{get:function(){return this.m_pictureBrush},set:function(e){this.m_pictureChangeTracker.replaceListener(this.m_pictureBrush,e),this.m_pictureBrush=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pen",{get:function(){return this.m_pen},set:function(e){this.m_penChangeTracker.replaceListener(this.m_pen,e),this.m_pen=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasLine",{get:function(){return null!=this.m_lineBrush},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"blendingMode",{get:function(){return this.m_blendingMode},set:function(e){Object(c.a)(this.changeTracker,this.m_blendingMode,e),this.m_blendingMode=e},enumerable:!0,configurable:!0}),e.prototype.getBrushImages=function(e){T(e,this.fillBrush),T(e,this.lineBrush),T(e,this.pictureBrush)},e}();function T(e,t){if(t&&6==t.getType()){var r=t;r.image&&e.push(r.image)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n=function(){function e(){}return e.Error=function(t,r){return e.s_logger.sendTraceTag(t,306,10,r),new Error(r+" "+t)},e.Message=function(t,r){e.s_logger.sendTraceTag(t,306,50,r)},e.setLogger=function(t){t&&(e.s_logger=t)},e.s_logger={sendTraceTag:function(e,t,r,n){console.log(e,n)},shipAssertTag:function(){},debugAssertTag:function(){}},e}()},function(e,t,r){"use strict";function n(e,t,r){t!=r&&e.notifyChange()}function i(e,t,r){t==r||t&&r&&t.equals(r)||e.notifyChange()}function a(e,t,r){if(t!=r)if(t&&r&&t.length==r.length){for(var n=0;n<t.length;n++)if(t[n]!=r[n])return void e.notifyChange()}else e.notifyChange()}function o(e,t,r){if(t!=r)if(t&&r&&t.length==r.length){for(var n=0;n<t.length;n++)if(!t[n].equals(r[n]))return void e.notifyChange()}else e.notifyChange()}r.d(t,"a",(function(){return n})),r.d(t,"c",(function(){return i})),r.d(t,"b",(function(){return a})),r.d(t,"d",(function(){return o}))},function(e,t,r){"use strict";r.d(t,"c",(function(){return f})),r.d(t,"d",(function(){return d})),r.d(t,"b",(function(){return p})),r.d(t,"f",(function(){return g})),r.d(t,"e",(function(){return _})),r.d(t,"k",(function(){return m})),r.d(t,"i",(function(){return b})),r.d(t,"h",(function(){return y})),r.d(t,"g",(function(){return T})),r.d(t,"j",(function(){return x})),r.d(t,"a",(function(){return E}));var n=r(7),i=r(0),a=r(18),o=r(11),s=r(1),c=r(6),u=r(5),h=r(2),l=r(3),f=function(){function e(e,t){void 0===e&&(e=new o.a),void 0===t&&(t=i.c.Identity),this.m_changeTracker=new u.a,this.m_animationChangeTracker=new u.a,this.renderDataMap={},this.m_changeTracker.replaceListener(void 0,e),this.m_effects=e,this.m_isHidden=!1,this.m_transform=t}return e.prototype.cloneItemData=function(e){e.effects=this.m_effects.clone(),e.m_transform=this.m_transform,e.fade=this.m_fade?this.m_fade.clone():void 0,e.m_animationTransform=this.m_animationTransform,e.m_isHidden=this.m_isHidden,e.clientData=this.clientData},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationChangeTracker",{get:function(){return this.m_animationChangeTracker},enumerable:!0,configurable:!0}),e.prototype.notifyChange=function(){this.m_changeTracker.notifyChange()},Object.defineProperty(e.prototype,"version",{get:function(){return this.m_changeTracker.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effects",{get:function(){return this.m_effects},set:function(e){this.m_changeTracker.replaceListener(this.m_effects,e),this.m_effects=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this.m_transform},set:function(e){this.m_transform.equals(e)||(this.onTransformChanged(this.m_transform,e),this.notifyChange(),this.m_transform=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHidden",{get:function(){return this.m_isHidden},set:function(e){Object(l.a)(this.m_changeTracker,this.m_isHidden,e),this.m_isHidden=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"instanceOffsets",{get:function(){return this.m_instanceOffsets},set:function(e){this.m_instanceOffsets=e?e.slice(0):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fade",{get:function(){return this.m_fade},set:function(e){this.m_animationChangeTracker.replaceListener(this.m_fade,e),this.m_fade=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationTransform",{get:function(){return this.m_animationTransform},set:function(e){Object(l.c)(this.m_animationChangeTracker,this.m_animationTransform,e),this.m_animationTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillBoundsOverride",{get:function(){return this.m_fillBoundsOverride},set:function(e){Object(l.c)(this.m_changeTracker,this.m_fillBoundsOverride,e),this.m_fillBoundsOverride=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effectsBoundsOverride",{get:function(){return this.m_effectsBoundsOverride},set:function(e){Object(l.c)(this.m_changeTracker,this.m_effectsBoundsOverride,e),this.m_effectsBoundsOverride=e},enumerable:!0,configurable:!0}),e.prototype.getBounds=function(e,t,r,n){void 0===e&&(e=!0),void 0===t&&(t=!0),void 0===r&&(r=!0),void 0===n&&(n=void 0);var a=n?n.toMatrix3():i.a.Identity;return y(this,t,r?31:0,r?31:0,a=e&&this.animationTransform?a.multiply(this.animationTransform):a)},e.prototype.onTransformChanged=function(e,t){},e.prototype.clearCache=function(){for(var e in this.renderDataMap)this.renderDataMap[e].releaseGeneratedResources()},e}(),d=function(e){function t(t,r,n,a){void 0===t&&(t=void 0),void 0===r&&(r=new s.l),void 0===n&&(n=new o.a),void 0===a&&(a=i.c.Identity);var c=e.call(this,n,a)||this;return c.m_role=0,c.m_geometryTracker=new u.a,c.m_paths=t,c.m_overlapMode=0,c.m_mergeMode=0,c.changeTracker.replaceListener(void 0,r),u.a.AddListener(r.penChangeTracker,c.m_geometryTracker),c.m_style=r,c.shapeBoundsCache={},c}return Object(n.c)(t,e),t.prototype.clone=function(){var e=new t;return e.paths=this.m_paths?this.m_paths.slice(0):void 0,e.m_overlapMode=this.m_overlapMode,e.m_mergeMode=this.m_mergeMode,e.style=this.m_style.clone(),e.text=this.m_text?this.m_text.clone():void 0,e.m_role=this.m_role,this.cloneItemData(e),e},t.CreateRectangle=function(e,r,n,a){return void 0===r&&(r=new s.l),void 0===n&&(n=new o.a),void 0===a&&(a=i.c.Identity),new t([c.d.CreateFromRect(e)],r,n,a)},Object.defineProperty(t.prototype,"paths",{get:function(){return this.m_paths},set:function(e){this.m_paths!=e&&(this.notifyGeometryChange(),this.m_paths=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"incrementalPath",{get:function(){return this.m_incrementalPath},set:function(e){this.changeTracker.replaceListener(this.m_incrementalPath,e),this.m_incrementalPath=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"overlapMode",{get:function(){return this.m_overlapMode},set:function(e){this.m_overlapMode!=e&&(this.notifyGeometryChange(),this.m_overlapMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mergeMode",{get:function(){return this.m_mergeMode},set:function(e){this.m_mergeMode!=e&&(this.notifyGeometryChange(),this.m_mergeMode=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"style",{get:function(){return this.m_style},set:function(e){this.m_style!=e&&(u.a.RemoveListener(this.m_style.penChangeTracker,this.m_geometryTracker),u.a.AddListener(e.penChangeTracker,this.m_geometryTracker),this.changeTracker.replaceListener(this.m_style,e),this.m_style=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"text",{get:function(){return this.m_text},set:function(e){this.m_text!=e&&(this.m_text&&(this.m_text.cache&&this.m_text.cache.clearCache(),u.a.RemoveListener(this.m_text.changeTracker,this.changeTracker),u.a.RemoveListener(this.m_text.animationChangeTracker,this.animationChangeTracker)),this.text&&(u.a.RemoveListener(this.text.changeTracker,this.changeTracker),u.a.RemoveListener(this.text.animationChangeTracker,this.animationChangeTracker)),this.m_text=e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"textEffectMetrics",{get:function(){return this.m_textEffectMetrics},set:function(e){Object(l.c)(this.changeTracker,this.m_textEffectMetrics,e),this.m_textEffectMetrics=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"role",{get:function(){return this.m_role},set:function(e){this.m_role!=e&&(this.notifyChange(),this.m_geometryTracker.notifyChange(),this.m_role=e)},enumerable:!0,configurable:!0}),t.prototype.onTransformChanged=function(e,t){e.scale.equals(t.scale)||this.m_geometryTracker.notifyChange()},t.prototype.clearCache=function(){e.prototype.clearCache.call(this),this.text&&this.text.cache&&(this.text.cache.clearCache(),this.text.cache=void 0),this.shapeBoundsCache.pathsBounds=void 0,this.shapeBoundsCache.pathsBoundsWithLine=void 0,this.shapeBoundsCache.pathsBoundsContributors=void 0,this.shapeBoundsCache.pathsBoundsContributorsWithLine=void 0},Object.defineProperty(t.prototype,"geometryTracker",{get:function(){return this.m_geometryTracker},enumerable:!0,configurable:!0}),t.prototype.notifyGeometryChange=function(){this.notifyChange(),this.m_geometryTracker.notifyChange()},t.prototype.getBrushImages=function(e){this.style.getBrushImages(e),this.text&&this.text.getBrushImages(e)},t.prototype.isSolidRectGeometry=function(){return!(!this.m_paths||1!=this.m_paths.length||!this.m_paths[0].isUntransformedRect||this.m_paths[0].transform instanceof i.a||this.m_paths[0].transform instanceof i.c&&0!=this.m_paths[0].transform.rotation)},t.prototype.isSolidRect=function(){return!!this.isSolidRectGeometry()&&!this.style.hasLine},t.prototype.hasSmallDetails=function(){return 3==this.role||this.style.hasLine&&this.style.pen.lineWidth<3||this.m_paths&&this.m_paths.some((function(e){return e.hasPressureInfo}))},t.prototype.getType=function(){return 1},t}(f),p=function(e){function t(t,r,n){void 0===t&&(t=void 0),void 0===r&&(r=new o.a),void 0===n&&(n=i.c.Identity);var a=e.call(this,r,n)||this,s=t instanceof u.b?t:new u.b(t);return a.changeTracker.replaceListener(void 0,s),a.m_items=s,a}return Object(n.c)(t,e),t.prototype.clone=function(){for(var e=new t,r=0,n=this.m_items.elements;r<n.length;r++){var i=n[r];e.items.push(i.clone())}return e.groupFillBrush=this.m_groupFillBrush?this.m_groupFillBrush.clone():void 0,e.m_isDocumentShape=this.m_isDocumentShape,this.cloneItemData(e),e},Object.defineProperty(t.prototype,"items",{get:function(){return this.m_items},set:function(e){this.setItems(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"groupFillBrush",{get:function(){return this.m_groupFillBrush},set:function(e){this.m_groupFillBrush=e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isDocumentShape",{get:function(){return this.m_isDocumentShape},set:function(e){this.m_isDocumentShape=e},enumerable:!0,configurable:!0}),t.prototype.setItems=function(e){void 0===e&&(e=void 0);var t=e instanceof u.b?e:new u.b(e);this.changeTracker.replaceListener(this.m_items,t),this.m_items=t},t.prototype.clearCache=function(){e.prototype.clearCache.call(this);for(var t=0;t<this.m_items.length;t++)this.m_items.getAt(t).clearCache()},t.prototype.getBrushImages=function(e){Object(s.m)(e,this.groupFillBrush);for(var t=0,r=this.m_items.elements;t<r.length;t++)r[t].getBrushImages(e)},t.prototype.getType=function(){return 2},t}(f);function g(e,t){if(!e)return!0;if(1==e.getType()){var r=e;if(t(r),r.text&&r.text.cache){for(var n=0,i=r.text.cache.getTextShapes();n<i.length;n++)if(!g(i[n],t))return!1;for(var a=0,o=r.text.cache.getSelectionShapes()||[];a<o.length;a++)if(!g(o[a],t))return!1}}else{if(2!=e.getType())throw h.a.Error(591525086,"Unknown Item type");for(var s=0,c=e.items.elements;s<c.length;s++)if(!g(c[s],t))return!1}return!0}function _(e,t){g(e,(function(e){for(var r=0,n=e.paths||[];r<n.length;r++){var i=n[r];if(!t(i))return!1}return!0}))}function m(e){return 1==e.style.pen.alignment?-1:2==e.style.pen.alignment?1:0}function b(e,t,r){if(void 0===r&&(r=void 0),e.incrementalPath)return r?e.incrementalPath.bounds.transformedBounds(r):e.incrementalPath.bounds;var n=0;t&&e.style.hasLine&&(n=e.style.pen.adjustedLineWidth*(.5+Math.abs(Math.max(m(e)))));var o=!r||r.isSimpleScaleTranslationOnly(),s=n?e.shapeBoundsCache.pathsBoundsWithLine:e.shapeBoundsCache.pathsBounds;if(!s&&!n&&o&&e.paths&&(s=e.shapeBoundsCache.pathsBounds=Object(a.c)(e.paths)),s){if(!r)return s;if(o)return s.multiply(r.getSimpleScale()).translate(r.getSimpleTranslation())}var c=n?e.shapeBoundsCache.pathsBoundsContributorsWithLine:e.shapeBoundsCache.pathsBoundsContributors;if(!c){var u=i.a.Scale2D(e.transform.scale);c=[],e.paths&&Object(a.a)(e.paths,n,e.style,u,c),n?e.shapeBoundsCache.pathsBoundsContributorsWithLine=c:e.shapeBoundsCache.pathsBoundsContributors=c}for(var h=i.a.Scale2D(e.transform.scale.inverse()),l=r?h.multiply(r):h,f=void 0,d=0,p=c||[];d<p.length;d++){var g=p[d],_=Object(a.b)(g,l);f=i.b.UnionRect(f,_)}if(f&&o){var b=r?f.translate(r.getSimpleTranslation().negate()).multiply(r.getSimpleScale().inverse()):f;t?e.shapeBoundsCache.pathsBoundsWithLine=b:e.shapeBoundsCache.pathsBounds=b}return f}function y(e,t,r,n,a,o,s){void 0===a&&(a=void 0),void 0===o&&(o=!0);var c=a?e.transform.toMatrix3().multiply(a):e.transform.toMatrix3(),u=void 0;if(1==e.getType()){var h=e;if(s||(u=b(h,!0,c)),h.text&&t&&(o||s)){var l=new i.c(i.d.Zero,i.d.One,e.transform.rotation,e.transform.translation),f=a?l.toMatrix3().multiply(a):l.toMatrix3();u=i.b.UnionRect(u,h.text.getBoundsOfRange(s,f))}}else if(2==e.getType()&&!s&&o)for(var p=e,g=0;g<p.items.length;g++){var _=p.items.getAt(g),m=_ instanceof d&&3==_.role;!t&&m||(u=i.b.UnionRect(u,y(_,t,n,n,c)))}if(!s){var v=void 0,E=void 0,P=1&r&&e.effects&&e.effects.glow&&e.effects.glow.radius,S=2&r&&e.effects&&e.effects.shadow,w=4&r&&e.effects&&e.effects.reflection;if((P||S||w)&&(E=a?y(e,t,r,n):u),(S||w)&&(v=e.effectsBoundsOverride?e.effectsBoundsOverride:y(e,!1,0,1)),u&&E&&1&r&&e.effects&&e.effects.glow&&e.effects.glow.radius&&(E=E.inflate(2*e.effects.glow.radius),u=u.inflate(2*e.effects.glow.radius)),(S||w)&&!t&&e instanceof d&&e.text){var R=y(e,!0,r,n);R&&(E=i.b.UnionRect(E,R))}if(u&&E&&v&&2&r&&e.effects&&e.effects.shadow){var C=T(e.effects.shadow.alignment,v),A=x(e.effects.shadow.angle,e.effects.shadow.distance,e.effects.shadow.scale,e.effects.shadow.skew,C),F=(e.effects.shadow.radius?E.inflate(e.effects.shadow.radius):E).transformedBounds(a?A.multiply(a):A),B=(e.effects.shadow.radius?E.inflate(e.effects.shadow.radius):E).transformedBounds(a?A.multiply(a):A);E=i.b.UnionRect(E,F),u=i.b.UnionRect(u,B)}if(u&&E&&v&&4&r&&e.effects&&e.effects.reflection){var O=e.effects.reflection,I=v.bottom+e.effects.reflection.distance/2;e instanceof d&&e.textEffectMetrics&&(I-=e.textEffectMetrics.descent);var L=i.a.Translation2D(new i.d(0,-I)).multiply(i.a.Scale2D(new i.d(1,-1))).multiply(i.a.Translation2D(new i.d(0,I))),M=(O.radius?E.inflate(O.radius):E).transformedBounds(L),D=a?(O.radius?E.inflate(O.radius):E).transformedBounds(L.multiply(a)):M;u=i.b.UnionRect(u,D)}}return u}var v=[new i.d(0,0),new i.d(.5,0),new i.d(1,0),new i.d(0,.5),new i.d(.5,.5),new i.d(1,.5),new i.d(0,1),new i.d(.5,1),new i.d(1,1)];function T(e,t){return void 0===t&&(t=void 0),t?v[e].multiply(t.size).add(t.leftTop):v[e]}function x(e,t,r,n,a){var o=i.a.Translation2D(a.negate()),s=new i.d(t,0).rotate(e).add(a),c=new i.a(r.x,n.y,0,n.x,r.y,0,s.x,s.y,1);return o.multiply(c)}function E(e,t){var r=e.getType();if(1==r){var n=e.style;switch(t){case 0:return n.fillBrush;case 1:return n.lineBrush;case 2:return n.pictureBrush}}if(2==r&&0==t)return e.groupFillBrush;h.a.Error(591192835,"Invalid item or brush")}},function(e,t,r){"use strict";r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return a}));var n=r(2),i=function(){function e(e){this.m_changeTracker=new a,this.m_elements=[],e&&(this.elements=e)}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this.m_elements.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"elements",{get:function(){return this.m_elements},set:function(e){this.removeAll();for(var t=0,r=e;t<r.length;t++){var n=r[t];this.push(n)}},enumerable:!0,configurable:!0}),e.prototype.getAt=function(e){if(e<0||e>=this.elements.length)throw n.a.Error(592520775,"Out of range");return this.m_elements[e]},e.prototype.setAt=function(e,t){a.RemoveListener(this.getAt(e).changeTracker,this.m_changeTracker),a.AddListener(t.changeTracker,this.m_changeTracker),this.m_elements[e]=t},e.prototype.push=function(e){a.AddListener(e.changeTracker,this.m_changeTracker),this.m_elements.push(e)},e.prototype.insertAt=function(e,t){a.AddListener(t.changeTracker,this.m_changeTracker),this.m_elements.splice(e,0,t)},e.prototype.removeAll=function(){for(var e=0,t=this.m_elements;e<t.length;e++){var r=t[e];a.RemoveListener(r.changeTracker,this.m_changeTracker)}this.m_elements=[]},e.prototype.removeAt=function(e){a.RemoveListener(this.getAt(e).changeTracker,this.m_changeTracker),this.m_elements.splice(e,1)},e}(),a=function(){function e(){this.trackerId=e.s_nextUniqueId++,this.m_version=0,this.m_currentUniqueId="",this.m_listeners=[]}return Object.defineProperty(e.prototype,"version",{get:function(){return this.m_version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentUniqueId",{get:function(){return this.m_currentUniqueId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"listenerCount",{get:function(){return this.m_listeners.length},enumerable:!0,configurable:!0}),e.prototype.notifyChange=function(){this.m_version++,this.m_currentUniqueId=this.trackerId+"v"+this.m_version;for(var e=0,t=this.m_listeners;e<t.length;e++)t[e].notifyChange()},e.prototype.replaceListener=function(t,r){t!=r&&(t&&e.RemoveListener(t?t.changeTracker:void 0,this),r&&e.AddListener(r?r.changeTracker:void 0,this))},e.AddListener=function(e,t){e&&-1==e.m_listeners.indexOf(t)&&(e.m_listeners.push(t),t.notifyChange())},e.RemoveListener=function(e,t){if(e){var r=e.m_listeners.indexOf(t);-1!=r&&(e.m_listeners.splice(r,1),t.notifyChange())}},e.s_nextUniqueId=1,e}()},function(e,t,r){"use strict";r.d(t,"d",(function(){return o})),r.d(t,"i",(function(){return s})),r.d(t,"g",(function(){return c})),r.d(t,"a",(function(){return u})),r.d(t,"b",(function(){return h})),r.d(t,"f",(function(){return l})),r.d(t,"c",(function(){return f})),r.d(t,"e",(function(){return d})),r.d(t,"h",(function(){return p}));var n=r(0),i=r(2),a=r(5),o=function(){function e(t,r){if(t instanceof e)this.m_sharedPathStorage=t.m_sharedPathStorage,this.m_transform=r||t.transform;else{for(var i=[],a=0,o=t.figures;a<o.length;a++){var s=o[a];i.push(s instanceof h?s.createFigure():s)}this.m_sharedPathStorage={figures:i,fillMode:null==t.fillMode?1:t.fillMode,lineEnabled:null==t.lineEnabled||t.lineEnabled,extrusionEnabled:null==t.extrusionEnabled||t.extrusionEnabled,glyphCacheId:t.glyphCacheId?{fontId:t.glyphCacheId.fontId,glyphId:t.glyphCacheId.glyphId}:void 0,isUntransformedRect:p(i),untransformedBounds:d(i),renderDataMap:{}},this.m_transform=r||(t.transform?t.transform:n.c.Identity)}}return e.CreateFromFigure=function(t){return new e({figures:[t]})},e.CreateFromRect=function(t){return new e({figures:[u.CreateFromRect(t)]})},Object.defineProperty(e.prototype,"figures",{get:function(){return this.m_sharedPathStorage.figures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transform",{get:function(){return this.m_transform},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillMode",{get:function(){return this.m_sharedPathStorage.fillMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lineEnabled",{get:function(){return this.m_sharedPathStorage.lineEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"extrusionEnabled",{get:function(){return this.m_sharedPathStorage.extrusionEnabled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"glyphCacheId",{get:function(){return this.m_sharedPathStorage.glyphCacheId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxPressure",{get:function(){return 4096},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"renderDataMap",{get:function(){return this.m_sharedPathStorage.renderDataMap},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasPressureInfo",{get:function(){return this.figures.some((function(e){return!!(8&e.format)}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isUntransformedRect",{get:function(){return this.m_sharedPathStorage.isUntransformedRect},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"untransformedBounds",{get:function(){return this.m_sharedPathStorage.untransformedBounds},enumerable:!0,configurable:!0}),e.prototype.measureLength=function(e){void 0===e&&(e=n.c.Identity);for(var t=0,r=0,i=this.figures;r<i.length;r++)t+=i[r].measureLength(e);return t},e.prototype.equals=function(e){return this.m_sharedPathStorage==e.m_sharedPathStorage&&this.m_transform.equals(e.m_transform)},e}(),s=.1;function c(e){var t=(1&e?2:0)+(2&e?1:0)+(4&e?1:0)+(8&e?1:0)+(16&e?2:0);return 32&e&&(t=4*Math.ceil(t/4)),t}var u=function(){function e(e,t,r){if(void 0===t&&(t=!1),void 0===r&&(r=3),this.m_points=e,this.m_isClosed=t,this.m_format=r,this.m_pointDataSize=c(r),this.m_points.length%this.m_pointDataSize!=0)throw i.a.Error(592520776,"list of points invalid")}return e.CreateFromRect=function(t){return new e([t.left,t.top,1,t.right,t.top,1,t.right,t.bottom,1,t.left,t.bottom,1],!0)},Object.defineProperty(e.prototype,"points",{get:function(){return this.m_points},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"format",{get:function(){return this.m_format},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pointDataSize",{get:function(){return this.m_pointDataSize},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isClosed",{get:function(){return this.m_isClosed},enumerable:!0,configurable:!0}),e.prototype.isLastPointDuplicated=function(){return this.getPoint(0).equalsWithEpsilon(this.getPoint(-1),s)},e.prototype.getPointCount=function(){return this.m_points.length/this.m_pointDataSize},e.prototype.getPoint=function(e){var t=this.getPointCount(),r=e<0?e%t+t:e%t;return new n.d(this.m_points[r*this.m_pointDataSize],this.m_points[r*this.m_pointDataSize+1])},e.prototype.getPointType=function(e){if(!(2&this.m_format))return 1;var t=this.getPointCount(),r=e<0?e%t+t:e%t;return this.m_points[r*this.m_pointDataSize+2]},e.prototype.toPolygon=function(){for(var e=this.getPointCount(),t=new h([],this.m_isClosed,1),r=0;r<e;r++){var i=this.getPoint(r);if(2!=this.getPointType(r))t.pushPoint(i.x,i.y);else for(var a=this.getPoint(r-1),o=this.getPoint(r+1),s=1;s<8;s++){var c=n.d.InterpolateQuadratic(a,i,o,s/8);t.pushPoint(c.x,c.y)}}return t.createFigure()},e.prototype.measureLength=function(e){void 0===e&&(e=n.c.Identity);var t=0;return this.forEachSegment((function(e,r,i){return t+=r?n.d.MeasureQuadraticLength(e,r,i):n.d.Distance(e,i),!0}),e),t},e.prototype.getPointFromDist=function(e,t,r){void 0===t&&(t=n.c.Identity),void 0===r&&(r=!1);var i=0,a=void 0;return this.forEachSegment((function(t,r,o){var s=r?n.d.MeasureQuadraticLength(t,r,o):n.d.Distance(t,o);if(i+s>e){var c=(e-i)/s;a=r?n.d.InterpolateQuadratic(t,r,o,c):n.d.InterpolateLinear(t,o,c)}return(i+=s)<=e}),t,r),a||this.getPoint(r?0:this.getPointCount()-1).transformPoint(t)},e.prototype.getTangentFromDist=function(e,t,r){void 0===t&&(t=n.c.Identity),void 0===r&&(r=!1);var i=0,a=n.d.Zero;return this.forEachSegment((function(t,r,o){var s=r?n.d.MeasureQuadraticLength(t,r,o):n.d.Distance(t,o);return a=r?n.d.QuadraticTangent(t,r,o,(e-i)/s):o.subtract(t).scale(1/s),(i+=s)<e}),t,r),a},e.prototype.forEachSegment=function(e,t,r){void 0===t&&(t=n.c.Identity),void 0===r&&(r=!1);for(var i=this.getPointCount(),a=r?0:i-1,o=r?-1:1,s=r?i-1:0;s!=a;s+=o){var c=s+o,u=c+o,h=2==this.getPointType(c);if(2!=this.getPointType(s)&&(this.m_isClosed||c==c%i)&&(!h||this.m_isClosed||u==u%i)&&!e(this.getPoint(s).transformPoint(t),h?this.getPoint(c).transformPoint(t):void 0,this.getPoint(h?u:c).transformPoint(t)))return}},e}(),h=function(){function e(e,t,r){if(void 0===e&&(e=[]),void 0===t&&(t=!1),void 0===r&&(r=3),this._points=e,this.isClosed=t,this.format=r,this.pointDataSize=c(r),this.lastPointX=0,this.lastPointY=0,this._points.length%this.pointDataSize!=0)throw i.a.Error(592520777,"list of points invalid")}return e.prototype.createFigure=function(){return new u(this._points,this.isClosed,this.format)},e.prototype.pushPoint=function(e,t,r,n){switch(void 0===r&&(r=1),this.lastPointX=e,this.lastPointY=t,this.pointDataSize){case 2:return void this._points.push(e,t);case 3:return void this._points.push(e,t,r);case 4:return void this._points.push(e,t,r,n?n[0]:0);case 5:return void this._points.push(e,t,r,n?n[0]:0,n?n[1]:0);case 6:return void this._points.push(e,t,r,n?n[0]:0,n?n[1]:0,n?n[2]:0);case 7:return void this._points.push(e,t,r,n?n[0]:0,n?n[1]:0,n?n[2]:0,n?n[3]:0)}throw i.a.Error(592520778,"Unsupported data size")},e.prototype.moveTo=function(e,t,r){if(0!=this._points.length)throw i.a.Error(592520779,"Figures should have only one MoveTo");this.pushPoint(e,t,1,r)},e.prototype.moveToPoint=function(e,t){this.moveTo(e.x,e.y,t)},e.prototype.lineTo=function(e,t,r){if(this._points.length<this.pointDataSize)throw i.a.Error(592520780,"All figures should start with a MoveTo");(Math.abs(e-this.lastPointX)>s||Math.abs(t-this.lastPointY)>s)&&this.pushPoint(e,t,1,r)},e.prototype.lineToPoint=function(e,t){this.lineTo(e.x,e.y,t)},e.prototype.quadBezierTo=function(e,t,r,n,a){if(this._points.length<this.pointDataSize)throw i.a.Error(592520781,"All figures should start with a MoveTo");var o=this.lastPointX,c=this.lastPointY;if(Math.abs(r-o)>s||Math.abs(n-c)>s){var u=Math.sqrt((e-o)*(e-o)+(t-c)*(t-c)),h=Math.sqrt((r-e)*(r-e)+(n-t)*(n-t)),l=Math.abs(e-o)<s&&Math.abs(t-c)<s,f=Math.abs(r-e)<s&&Math.abs(n-t)<s;!l&&!f&&Math.abs(u/h)>s&&Math.abs(h/u)>s?(this.pushPoint(e,t,2),this.pushPoint(r,n,1,a)):this.pushPoint(r,n,1,a)}},e.prototype.quadBezierToPoint=function(e,t,r){this.quadBezierTo(e.x,e.y,t.x,t.y,r)},e.prototype.cubicBezierTo=function(e,t,r,i,a,o){this.cubicBezierToPoint(new n.d(e,t),new n.d(r,i),new n.d(a,o))},e.prototype.cubicBezierToPoint=function(e,t,r){if(this._points.length<this.pointDataSize)throw i.a.Error(592520782,"All figures should start with a MoveTo");for(var a=new n.d(this.lastPointX,this.lastPointY),o=a,s=e,c=0;c<4;c++){var u=(c+1)/4,h=n.d.InterpolateQuadratic(a,e,t,u),l=n.d.InterpolateQuadratic(e,t,r,u),f=n.d.InterpolateLinear(h,l,u),d=n.d.CalculateLineIntersection(o,s,h,l,.1);d?this.quadBezierTo(d.x,d.y,f.x,f.y):this.lineTo(f.x,f.y),o=h,s=l}},e.prototype.arcTo=function(e,t,r,a){if(this._points.length<this.pointDataSize)throw i.a.Error(592520783,"All figures should start with a MoveTo");if(!(0==e||0==t||Math.abs(e/t)<n.f||Math.abs(t/e)<n.f||Math.abs(a)<n.f)){var o=2*Math.PI,s=Math.atan2(e*Math.sin(r),t*Math.cos(r)),c=a<0?-1:1,u=Math.abs(a);if(u>=o)u=o;else{var h=r+u*c;(u=((h=Math.atan2(e*Math.sin(h),t*Math.cos(h)))-s)*c)<0&&(u+=o)}for(var l=this.lastPointX,f=this.lastPointY,d=l-Math.cos(s)*e,p=f-Math.sin(s)*t,g=Math.ceil(8*Math.abs(u)/o),_=0;_<g;_++){var m=c*o/8,b=s+_*m,y=_==g-1?c*u-_*m:m,v=b+y,T=b+y/2,x=1/Math.cos(y/2),E=new n.d(d+Math.cos(T)*x*e,p+Math.sin(T)*x*t),P=new n.d(d+Math.cos(v)*e,p+Math.sin(v)*t);Math.abs(y)>n.f?this.quadBezierTo(E.x,E.y,P.x,P.y):this.lineTo(P.x,P.y)}}},e.prototype.close=function(){if(this._points.length<this.pointDataSize)throw i.a.Error(592520784,"All figures should start with a MoveTo");this.isClosed=!0},e.prototype.isLastPointDuplicated=function(){return this.getPoint(0).equalsWithEpsilon(this.getPoint(-1),s)},e.prototype.getPointCount=function(){return this._points.length/this.pointDataSize},e.prototype.getPoint=function(e){var t=this.getPointCount(),r=e<0?e%t+t:e%t;return new n.d(this._points[r*this.pointDataSize],this._points[r*this.pointDataSize+1])},Object.defineProperty(e.prototype,"data",{get:function(){return this._points},enumerable:!0,configurable:!0}),e}();function l(e){for(var t="["+e.replace(/(M|L|Q|C|A|E|;)/g,(function(e){return"M"==e?"0":"L"==e?"1":"Q"==e?"2":"C"==e?"3":"A"==e?"4":"E"==e?"5":","}))+"]",r=new Float32Array(JSON.parse(t)),n=[],a=void 0,o=0,s=2*Math.PI/216e5;o<r.length;)switch(r[o++]){case 0:if(o+1>=r.length)throw i.a.Error(592520785,"Invalid LineTo");a&&n.push(a),(a=new h).moveTo(r[o++],r[o++]);break;case 1:if(!a||o+1>=r.length)throw i.a.Error(592520786,"Invalid LineTo");a.lineTo(r[o++],r[o++]);break;case 2:if(!a||o+3>=r.length)throw i.a.Error(592520787,"Invalid MoveTo");a.quadBezierTo(r[o++],r[o++],r[o++],r[o++]);break;case 3:if(!a||o+5>=r.length)throw i.a.Error(592520788,"Invalid CubicBezierTo");a.cubicBezierTo(r[o++],r[o++],r[o++],r[o++],r[o++],r[o++]);break;case 4:if(!a||o+3>=r.length)throw i.a.Error(592520789,"Invalid Arc of ellipse");a.arcTo(r[o++],r[o++],r[o++]*s,r[o++]*s);break;case 5:if(!a)throw i.a.Error(592520790,"All paths should start with a MoveTo");a.close(),n.push(a),a=void 0}return a&&n.push(a),n}var f=function(){function e(e,t){this.m_changeTracker=new a.a,this.bounds=e,this.format=t,this.pointDataSize=c(t),this.m_figures=[new h([],!1,t)]}return Object.defineProperty(e.prototype,"currentFigure",{get:function(){return this.m_figures[this.m_figures.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"figures",{get:function(){return this.m_figures},enumerable:!0,configurable:!0}),e.prototype.newFigure=function(){this.currentFigure.getPointCount()>0&&this.m_figures.push(new h([],!1,this.format))},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),e}();function d(e){for(var t=void 0,r=0,i=e;r<i.length;r++){var a=i[r];if(!a.cachedBounds){var o=a.points.length/a.pointDataSize;if(o<1)return;for(var s=a.points[0],c=s,u=a.points[1],h=u,l=0;l<o;l++){var f=l*a.pointDataSize,d=(l-1+o)%o*a.pointDataSize,p=(l+1)%o*a.pointDataSize,g=void 0,_=void 0,m=void 0;2&a.format?(g=a.points[f+2],_=a.points[d+2],m=a.points[p+2]):g=_=m=1;var b=a.points[f],y=a.points[f+1];if(1==g&&1==m)s=b<s?b:s,c=b>c?b:c,u=y<u?y:u,h=y>h?y:h;else if(1==_&&2==g&&1==m){var v=a.points[d],T=a.points[d+1],x=a.points[p],E=a.points[p+1];s=x<(s=v<s?v:s)?x:s,c=x>(c=v>c?v:c)?x:c,u=E<(u=T<u?T:u)?E:u,h=E>(h=T>h?T:h)?E:h;var P=(v-b)/(v+x-2*b);0<P&&P<1&&(s=(R=v*((w=(S=P)*S)-2*S+1)+x*w+2*b*(S-w))<s?R:s,c=R>c?R:c,u=(C=T*(w-2*S+1)+E*w+2*y*(S-w))<u?C:u,h=C>h?C:h);var S,w,R,C,A=(T-y)/(T+E-2*y);0<A&&A<1&&(s=(R=v*((w=(S=A)*S)-2*S+1)+x*w+2*b*(S-w))<s?R:s,c=R>c?R:c,u=(C=T*(w-2*S+1)+E*w+2*y*(S-w))<u?C:u,h=C>h?C:h)}}a.cachedBounds=new n.b(s,u,c,h)}t=n.b.UnionRect(t,a.cachedBounds)}return t}function p(e){if(1!=e.length)return!1;var t=e[0];if((4!=t.getPointCount()||!t.isClosed||t.isLastPointDuplicated())&&(5!=t.getPointCount()||!t.isClosed||!t.isLastPointDuplicated()))return!1;for(var r=[t.getPoint(0),t.getPoint(1),t.getPoint(2),t.getPoint(3)],i=new n.b(Math.min(r[0].x,r[1].x,r[2].x,r[3].x),Math.min(r[0].y,r[1].y,r[2].y,r[3].y),Math.max(r[0].x,r[1].x,r[2].x,r[3].x),Math.max(r[0].y,r[1].y,r[2].y,r[3].y)),a=0;a<4;a++){var o=r[a],s=r[(a+1)%4];if(o.x!=i.left&&o.x!=i.right||o.y!=i.top&&o.y!=i.bottom||o.x!=s.x&&o.y!=s.y)return!1}return!0}},function(e,t,r){"use strict";r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return o})),r.d(t,"d",(function(){return s})),r.d(t,"e",(function(){return c}));var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};function i(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}var a=function(){return(a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,r,n){return new(r||(r=Promise))((function(i,a){function o(e){try{c(n.next(e))}catch(e){a(e)}}function s(e){try{c(n.throw(e))}catch(e){a(e)}}function c(e){e.done?i(e.value):new r((function(t){t(e.value)})).then(o,s)}c((n=n.apply(e,t||[])).next())}))}function s(e,t){var r,n,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(i=2&a[0]?n.return:a[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,a[1])).done)return i;switch(n=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,n=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],n=0}finally{r=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function c(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),i=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)n[i]=a[o];return n}},function(e,t,r){"use strict";r.d(t,"e",(function(){return s})),r.d(t,"c",(function(){return c})),r.d(t,"i",(function(){return u})),r.d(t,"o",(function(){return h})),r.d(t,"j",(function(){return l})),r.d(t,"d",(function(){return f})),r.d(t,"m",(function(){return d})),r.d(t,"l",(function(){return p})),r.d(t,"h",(function(){return g})),r.d(t,"n",(function(){return _})),r.d(t,"k",(function(){return m})),r.d(t,"g",(function(){return b})),r.d(t,"q",(function(){return y})),r.d(t,"p",(function(){return v})),r.d(t,"b",(function(){return T})),r.d(t,"a",(function(){return x})),r.d(t,"f",(function(){return S}));var n=r(7),i=r(5),a=r(0),o=r(2),s=1,c=1,u=2048,h=0,l=0,f=4096,d=2048,p=2,g=256;function _(e){s=c=e}var m=!0;function b(e){m=e}function y(e){return{center:e.center,size:e.size,rotation:0,flipX:!1,flipY:!1}}function v(e,t){return{center:e.center.add(t.preTranslation).multiply(t.scale).rotate(t.rotation).add(t.translation),size:e.size.multiply(t.scale.abs()),rotation:t.rotation,flipX:t.scale.x<0,flipY:t.scale.y<0}}var T=function(){function e(e,t,r,n,o,s){void 0===s&&(s=!1),this.m_ownsTexture=!0,this.m_animatedContent=!1,this.m_originalSize=a.d.Zero,this.m_changeTracker=new i.a,this.m_compatibleGraphicsProcessorId=0,this.m_graphicsProcessor=e.getGraphicsProcessor(),this.m_wrapMode=n,this.updateTexture(e,t,r,o,s)}return e.prototype.setBabylonTexture=function(e,t,r,n){this.m_babylonTexture&&this.release(),this.m_babylonTexture=t,this.m_compatibleGraphicsProcessorId=e.getUniqueGraphicsProcessorId(),this.m_ownsTexture=r,this.m_animatedContent=n},e.prototype.updateTexture=function(e,t,r,n,i){if(this.m_graphicsProcessor=e.getGraphicsProcessor(),!this.m_graphicsProcessor)throw o.a.Error(592525214,"Unable to set texture if processor not initialized");this.m_originalSize=null!=r?r.ceil():this.m_originalSize;var a=t?this.m_graphicsProcessor.createTextureGraphicsResourceFromExternalWebGLTexture(r,t,void 0):void 0;this.setBabylonTexture(this.m_graphicsProcessor,a,n,i),this.initExternalTexture(e),this.m_changeTracker.notifyChange()},e.prototype.copyFromRGBABuffer=function(e,t,r,n,i,a,s){if(this.m_graphicsProcessor=e.getGraphicsProcessor(),this.m_graphicsProcessor){this.m_originalSize=t;var c=this.m_graphicsProcessor.createTextureGraphicsResource(t,r,n,i,!1,!1,a,s);this.setBabylonTexture(this.m_graphicsProcessor,c,!0,!1),this.initExternalTexture(e),this.m_changeTracker.notifyChange()}else o.a.Error(592525215,"No Graphics Processor")},e.prototype.copyFromHTMLImageElement=function(e,t,r,n){if(void 0===r&&(r=4),void 0===n&&(n=!0),this.m_graphicsProcessor=e.getGraphicsProcessor(),this.m_graphicsProcessor){var i=new a.d(t.width,t.height);this.m_originalSize=i;var s=this.m_graphicsProcessor.createTextureGraphicsResource(i,t,!0,!1,!1,!1,r,n);this.setBabylonTexture(this.m_graphicsProcessor,s,!0,!1),this.initExternalTexture(e),this.m_changeTracker.notifyChange()}else o.a.Error(592525216,"No Graphics Processor")},Object.defineProperty(e.prototype,"graphicsProcessor",{get:function(){return this.m_graphicsProcessor},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"babylonTexture",{get:function(){return this.m_babylonTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"wrapMode",{get:function(){return this.m_wrapMode},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ownsTexture",{get:function(){return this.m_ownsTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animatedContent",{get:function(){return this.m_animatedContent},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){return this.m_babylonTexture?new a.d(this.m_babylonTexture.width,this.m_babylonTexture.height):a.d.Zero},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"originalSize",{get:function(){return this.m_originalSize},set:function(e){this.m_changeTracker.notifyChange(),this.m_originalSize=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"contentLocation",{get:function(){var e=this.size;return this.m_contentLocation?this.m_contentLocation:{logicalCenter:e.scale(.5),logicalSize:e,physicalCenter:e.scale(.5),physicalSize:e,rotation:0,flipX:!1,flipY:!1}},set:function(e){this.m_changeTracker.notifyChange(),this.m_contentLocation=e},enumerable:!0,configurable:!0}),e.prototype.isValid=function(e){var t=e.getGraphicsProcessor();return this.m_babylonTexture&&t&&this.m_graphicsProcessor==t&&this.m_compatibleGraphicsProcessorId==t.getUniqueGraphicsProcessorId()},e.prototype.tryGetWebGLTexture=function(){return this.m_babylonTexture&&this.m_babylonTexture._webGLTexture||void 0},e.prototype.release=function(){this.m_babylonTexture&&this.m_ownsTexture&&this.m_babylonTexture.dispose(),this.m_babylonTexture=void 0,this.m_changeTracker.notifyChange()},e.prototype.cloneWithNewWrapMode=function(t,r){this.wrapMode==r&&o.a.Error(592472277,"Why cloning if the wrapmode is the same?");var n=new e(t,null,a.d.Zero,r,!1);return n.copyTextureFrom(t,this,this.size,r),n},e.prototype.copyTextureFrom=function(e,t,r,n){var i=this.m_graphicsProcessor;if(i){var s=i.needPowerOf2TexturesForTilingOrMipMap()&&4!=this.wrapMode?new a.d(Object(a.e)(Object(a.h)(r.x),1,u),Object(a.e)(Object(a.h)(r.y),1,u)):r,c=new x(e,s,!0,!1);e.drawTextureToTexture(c,t,s),this.m_ownsTexture=!0,this.m_originalSize=t.m_originalSize,this.m_babylonTexture&&this.release(),this.m_babylonTexture=c.m_babylonTexture,c.m_babylonTexture=void 0,c.release(),this.m_babylonTexture?i.setWrapMode(this.m_babylonTexture,n):o.a.Error(592472280,"Failed to copy texture")}else o.a.Error(592472278,"Failed to get graphicsProcessor")},e.prototype.initExternalTexture=function(e){var t=this.m_graphicsProcessor;t?this.babylonTexture&&t.needPowerOf2TexturesForTilingOrMipMap()&&4!=this.wrapMode&&this.copyTextureFrom(e,this,this.size,this.wrapMode):o.a.Error(592472281,"Failed to get graphicsProcessor")},e}(),x=function(e){function t(t,r,n,i,o,s,c){void 0===r&&(r=a.d.Zero),void 0===n&&(n=!0),void 0===i&&(i=!1);var u=e.call(this,t,null,a.d.Zero,4,!o&&!s)||this;return u.initTexture(t,r,n,i,o,s,c),u.originalSize=r.ceil(),u.hasAlpha=n,u.useFloat=i,u.isDirty=!1,u}return Object(n.c)(t,e),t.prototype.tryConvertToBufferRGBA=function(){if(this.m_graphicsProcessor&&this.babylonTexture)return this.m_graphicsProcessor.copyTexturePixelsToArray(this.babylonTexture,a.b.FromSize(this.size),!0)},t.prototype.tryConvertToCanvas=function(){if(this.m_graphicsProcessor&&this.babylonTexture){var e=document.createElement("canvas");e.width=this.babylonTexture.width,e.height=this.babylonTexture.height;var t=e.getContext("2d");if(t){var r=this.tryConvertToBufferRGBA();if(r){var n=this.size,i=t.createImageData(n.x,n.y);return i.data.set(r),t.putImageData(i,0,0),t.globalCompositeOperation="copy",t.setTransform(1,0,0,-1,0,n.y),t.drawImage(e,0,0),e}}}},t.prototype.tryConvertToDataURL=function(){var e=this.tryConvertToCanvas();if(e)return e.toDataURL()},t.prototype.getMemoryUsage=function(){if(!this.graphicsProcessor)return 0;var e=this.hasAlpha?4:3;return this.size.x*this.size.y*e*(this.useFloat?4:1)},t.prototype.getRenderBufferMemoryUsage=function(){return this.needsRenderBuffer?this.size.x*this.size.y:0},t.prototype.initTexture=function(e,t,r,n,i,a,s){var c=e.getGraphicsProcessor();if(!c)return o.a.Error(592525217,"Graphics processor not initialized"),!1;if(this.needsRenderBuffer=!!s,i){this.originalSize=t,this.hasAlpha=r,this.useFloat=n,this.m_graphicsProcessor=c;var u=c.createTextureGraphicsResourceFromExternalWebGLTexture(t,i,a);return this.setBabylonTexture(c,u,this.ownsTexture,!1),!0}if(this.size.x==t.x&&this.size.y==t.y&&this.hasAlpha==r&&this.useFloat==n&&this.babylonTexture&&this.isValid(e))return!0;if(this.originalSize=t,this.hasAlpha=r,this.useFloat=n,this.babylonTexture&&this.release(),t.isZero())return!1;this.m_graphicsProcessor=c;var f=c.createTextureGraphicsResource(t,void 0,this.hasAlpha,this.useFloat,!0,this.needsRenderBuffer,4,!0);return this.setBabylonTexture(c,f,this.ownsTexture,!1),h+=this.getMemoryUsage(),e.getCurrentFramePerformanceSummary().dynamicTextureAlloc+=this.getMemoryUsage(),this.needsRenderBuffer&&(l+=this.getRenderBufferMemoryUsage()),!0},t.prototype.generateMipMap=function(){var e=this.graphicsProcessor;e&&this.babylonTexture?e.generateMipMap(this.babylonTexture):o.a.Error(592525218,"Cannot generate mipmaps")},t.prototype.detachWebGLTexture=function(){if(this.ownsTexture){var e=this.tryGetWebGLTexture();return e||o.a.Error(592525248,"No texture to detach"),this.m_babylonTexture=void 0,this.release(),e}o.a.Error(592525219,"Cannot give away a texture the target doesn't own")},t.prototype.release=function(){e.prototype.release.call(this),h-=this.getMemoryUsage(),this.needsRenderBuffer&&(l-=this.getRenderBufferMemoryUsage())},t.RecycleOrReplace=function(e,r,n,i,a,o){var s=r.getGraphicsProcessor();if(e){if(e.graphicsProcessor==s&&e.size.equals(n)&&e.hasAlpha==i&&e.useFloat==a)return e;e.release()}return new t(r,n,i,a,void 0,void 0,o)},t}(T),E=[{attributeName:"a_0",attributeSize:4,offset:0}],P=[{attributeName:"a_1",attributeSize:4,offset:0}];function S(e,t,r,n,i,a,s){if(void 0===s&&(s=1),r.babylonTexture){var c=Math.max(n.length,i.length);if(0!=c){for(var u=new Float32Array(4*c),h=new Float32Array(4*c),l=0;l<c;l++){var f=n[Math.min(l,n.length-1)],d=i[Math.min(l,i.length-1)];u[4*l+0]=f.left/r.size.x,u[4*l+1]=f.top/r.size.y,u[4*l+2]=f.right/r.size.x,u[4*l+3]=f.bottom/r.size.y,h[4*l+0]=d.left/a.x,h[4*l+1]=d.top/a.y,h[4*l+2]=d.right/a.x,h[4*l+3]=d.bottom/a.y}var p=e.getBabylonEngine(),g=p.createVertexBuffer(u),_=p.createVertexBuffer(h);p.bindInstancesBuffer(g,E,!1),p.bindInstancesBuffer(_,P,!1),t.setTexture("t_0",r.babylonTexture),t.getBabylonEffect().setFloat("ufrag_0",s),t.drawQuadInstances(c),t.disableInstanceAttribute("a_0"),t.disableInstanceAttribute("a_1"),p._releaseBuffer(g),p._releaseBuffer(_)}}else o.a.Error(591192838,"No Texture")}},function(e,t,r){"use strict";r.d(t,"j",(function(){return f})),r.d(t,"b",(function(){return d})),r.d(t,"n",(function(){return p})),r.d(t,"m",(function(){return g})),r.d(t,"k",(function(){return _})),r.d(t,"a",(function(){return b})),r.d(t,"o",(function(){return v})),r.d(t,"f",(function(){return T})),r.d(t,"d",(function(){return x})),r.d(t,"c",(function(){return E})),r.d(t,"e",(function(){return P})),r.d(t,"h",(function(){return S})),r.d(t,"i",(function(){return w})),r.d(t,"l",(function(){return R})),r.d(t,"g",(function(){return C})),r.d(t,"p",(function(){return A})),r.d(t,"q",(function(){return F}));var n=r(7),i=r(0),a=r(2),o=r(11),s=r(1),c=r(6),u=r(5),h=r(3),l=256,f=function(){function e(e,t){this.start=e,this.length=t}return Object.defineProperty(e.prototype,"last",{get:function(){return this.start+this.length-1},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return this.start==e.start&&this.length==e.length},e.prototype.includes=function(e){return e>=this.start&&e<=this.last},e.prototype.intersects=function(e){return this.start<=e.last&&this.last>=e.start},e.prototype.contains=function(e){return this.start<=e.start&&e.last<=this.last},e.prototype.getIntersection=function(t){var r=e.FromFirstLast(Math.max(this.start,t.start),Math.min(this.last,t.last));return r.length>=0?r:void 0},e.prototype.move=function(t){return new e(this.start+t,this.length)},e.FromFirstLast=function(t,r){return new e(t,r+1-t)},e}(),d=function(){function e(e){this.m_defaultData=e}return e.prototype.onDataChange=function(){},e.prototype.onRangeChange=function(){},e.prototype.onDataRemoved=function(e){},e.prototype.onDataAdded=function(e){},Object.defineProperty(e.prototype,"defaultData",{get:function(){return this.m_defaultData},set:function(e){this.m_defaultData=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"ranges",{get:function(){for(var e=[],t=0,r=this.m_dataPerRange||[];t<r.length;t++){var n=r[t];e.push(n.range)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allData",{get:function(){for(var e=[this.m_defaultData],t=0,r=this.m_dataPerRange||[];t<r.length;t++){var n=r[t];e.push(n.data)}return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dataPerRange",{get:function(){return this.m_dataPerRange||[]},enumerable:!0,configurable:!0}),e.prototype.set=function(e,t){if(this.onDataChange(),t){for(var r=0,n=this.m_dataPerRange||[];r<n.length;r++)if((o=n[r]).range.start==t.start&&o.range.last==t.last)return this.onDataRemoved(o.data),o.data=e,void this.onDataAdded(o.data);for(var i=0,a=this.m_dataPerRange||[];i<a.length;i++){var o=a[i];this.onDataRemoved(o.data)}this.onRangeChange();for(var s=[],c=!1,u=0,h=this.m_dataPerRange||[];u<h.length;u++)(o=h[u]).range.start<t.start&&s.push({range:f.FromFirstLast(o.range.start,Math.min(o.range.last,t.start-1)),data:o.data}),t.last<o.range.last&&(c||(s.push({range:t,data:e}),c=!0),s.push({range:f.FromFirstLast(Math.max(o.range.start,t.last+1),o.range.last),data:o.data}));c||s.push({range:t,data:e}),this.m_dataPerRange=s;for(var l=0,d=this.m_dataPerRange||[];l<d.length;l++)o=d[l],this.onDataAdded(o.data)}else{for(var p=0,g=this.m_dataPerRange||[];p<g.length;p++){var _=g[p];this.onDataRemoved(_.data)}this.m_defaultData=e,this.m_dataPerRange=void 0}},e.prototype.getAt=function(e){for(var t=0,r=this.m_dataPerRange||[];t<r.length;t++){var n=r[t];if(n.range.start<=e&&e<=n.range.last)return n.data}return this.m_defaultData},e.prototype.shiftIndices=function(e,t){if(this.m_dataPerRange){for(var r=[],n=t-e.length,i=0,a=this.m_dataPerRange;i<a.length;i++){var o=a[i];if(e.contains(o.range)&&e.start!=o.range.start)this.onDataRemoved(o.data);else if(o.range.includes(e.start)){var s=Math.min(e.length,o.range.last+1-e.start);r.push({range:new f(o.range.start,o.range.length+t-s),data:o.data})}else o.range.start<=e.last&&e.last<=o.range.last?r.push({range:f.FromFirstLast(e.start+t,o.range.last+n),data:o.data}):e.last<o.range.start?r.push({range:o.range.move(n),data:o.data}):r.push(o)}this.m_dataPerRange=r}},e}(),p=function(e){function t(t){var r=e.call(this,t)||this;return r.m_changeTracker=new u.a,r.m_rangeChangeTracker=new u.a,r.m_changeTracker.replaceListener(void 0,t),r}return Object(n.c)(t,e),Object.defineProperty(t.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rangeChangeTracker",{get:function(){return this.m_rangeChangeTracker},enumerable:!0,configurable:!0}),t.prototype.onDataChange=function(){this.m_changeTracker.notifyChange()},t.prototype.onRangeChange=function(){this.rangeChangeTracker.notifyChange()},t.prototype.onDataRemoved=function(e){u.a.RemoveListener(e.changeTracker,this.m_changeTracker)},t.prototype.onDataAdded=function(e){u.a.AddListener(e.changeTracker,this.m_changeTracker)},t}(d),g=function(){function e(e,t,r,n){this.m_changeTracker=new u.a,this.m_type=e,this.m_verticalCenter=t,this.m_thickness=r,this.style=n}return e.prototype.clone=function(){return new e(this.m_type,this.m_verticalCenter,this.m_thickness,this.m_style?this.m_style.clone():void 0)},Object.defineProperty(e.prototype,"type",{get:function(){return this.m_type},set:function(e){Object(h.a)(this.changeTracker,this.m_type,e),this.m_type=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"verticalCenter",{get:function(){return this.m_verticalCenter},set:function(e){Object(h.a)(this.changeTracker,this.m_verticalCenter,e),this.m_verticalCenter=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"thickness",{get:function(){return this.m_thickness},set:function(e){Object(h.a)(this.changeTracker,this.m_thickness,e),this.m_thickness=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.m_style},set:function(e){this.changeTracker.replaceListener(this.m_style,e),this.m_style=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),e}(),_=function(){function e(e,t,r){void 0===r&&(r=!1),this.m_changeTracker=new u.a,this.m_animationTransform=t,this.m_isHidden=r,this.fade=e}return e.prototype.clone=function(){return new e(this.m_fade?this.m_fade.clone():void 0,this.m_animationTransform)},Object.defineProperty(e.prototype,"fade",{get:function(){return this.m_fade},set:function(e){this.m_changeTracker.replaceListener(this.m_fade,e),this.m_fade=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationTransform",{get:function(){return this.m_animationTransform},set:function(e){Object(h.c)(this.m_changeTracker,this.m_animationTransform,e),this.m_animationTransform=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isHidden",{get:function(){return!!this.m_isHidden},set:function(e){e!=this.isHidden&&(this.m_changeTracker.notifyChange(),this.m_isHidden=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),e}(),m=new i.a(0,-1,0,1,0,0,0,0,1),b=function(){function e(e,t,r,n,i,a){this.lineRect=e,this.path=t,this.alignment=r,this.scale=n,this.pivot=i,this.isVerticalLayout=a,this.pathLength=t.measureLength(),this.equivalentWarpingEnvelope=this.calculateEquivalentWarpingEnvelope()}return e.prototype.equals=function(e){return this.lineRect.equals(e.lineRect)&&this.path==e.path&&this.alignment==e.alignment&&this.scale==e.scale&&this.pivot==e.pivot&&this.isVerticalLayout==e.isVerticalLayout},e.prototype.getPathPosition=function(e){var t=this.isVerticalLayout?e.transformedBounds(m):e,r=this.isVerticalLayout?this.lineRect.transformedBounds(m):this.lineRect;if(t&&r){var n=r.width,i=0;if(n*this.scale<this.pathLength){var a=this.pathLength-n*this.scale;i=this.alignment*(a/this.pathLength)}var o=(t.left-r.left)*this.scale/this.pathLength+i;return(o+(o+t.width/this.pathLength*this.scale))/2}},e.prototype.getTransform=function(e){var t=this.getPathPosition(e),r=this.isVerticalLayout?e.transformedBounds(m):e;if(t&&r){var n=Object(i.e)(t,0,1)*this.pathLength,a=this.path.getPointFromDist(n),o=this.path.getTangentFromDist(n);if(o){var s=(r.left+r.right)/2,c=r.top+r.height*this.pivot,u=i.a.Translation2D(new i.d(-s,-c));u=u.multiply(i.a.Scale2D(new i.d(this.scale,this.scale)));var h=o.x,l=o.y;return u=(u=u.multiply(new i.a(h,l,0,-l,h,0,0,0,1))).multiply(i.a.Translation2D(a)),this.isVerticalLayout&&(u=m.multiply(u)),u}}},e.prototype.calculateEquivalentWarpingEnvelope=function(){for(var e=new c.b,t=new c.b,r=1/l,n=this.isVerticalLayout?0:this.lineRect.height/2,a=this.isVerticalLayout?this.lineRect.top:this.lineRect.left,o=this.isVerticalLayout?this.lineRect.bottom:this.lineRect.right,s=this.lineRect,u=0;u<=1;u+=r){var h=a+(o-a)*u,f=this.isVerticalLayout?new i.b(this.lineRect.right,h-n,this.lineRect.left,h+n):new i.b(h-n,this.lineRect.top,h+n,this.lineRect.bottom),d=this.getPathPosition(f);if(null!=d&&d>=0&&d<=1){var p=h+(2*u-1)*n,g=this.getTransform(f);if(g){var _=g.transformPoint(this.isVerticalLayout?new i.d(f.left,p):new i.d(p,f.top)),m=g.transformPoint(this.isVerticalLayout?new i.d(f.right,p):new i.d(p,f.bottom));0==e.getPointCount()?(e.moveToPoint(_),t.moveToPoint(m),s=new i.b(this.isVerticalLayout?s.left:p,this.isVerticalLayout?p:s.top,s.right,s.bottom)):(e.lineToPoint(_),t.lineToPoint(m),s=new i.b(s.left,s.top,this.isVerticalLayout?s.right:p,this.isVerticalLayout?p:s.bottom))}}}return new v(s,e.createFigure(),t.createFigure(),this.isVerticalLayout)},e}(),y=function(){function e(e){this.currentX=0,this.currentY=0,this.m_samplesX=new Float32Array(l+1),this.m_samplesY=new Float32Array(l+1);for(var t=e.measureLength(),r=0;r<=l;r++){var n=e.getPointFromDist(t*r/l);this.m_samplesX[r]=n.x,this.m_samplesY[r]=n.y}}return e.prototype.moveTo=function(e){var t=Math.floor(e*l),r=Math.min(t+1,l),n=e*l-t;this.currentX=this.m_samplesX[t]*(1-n)+this.m_samplesX[r]*n,this.currentY=this.m_samplesY[t]*(1-n)+this.m_samplesY[r]*n},e.prototype.equals=function(e){for(var t=0;t<=l;t++)if(this.m_samplesX[t]!=e.m_samplesX[t]||this.m_samplesY[t]!=e.m_samplesY[t])return!1;return!0},e}(),v=function(){function e(e,t,r,n){void 0===n&&(n=!1),this.sourceRect=e,this.topPath=t,this.bottomPath=r,this.isVerticalLayout=n,this.topCurve=new y(t),this.bottomCurve=new y(r)}return e.prototype.equals=function(e){return this.sourceRect.equals(e.sourceRect)&&this.topCurve.equals(e.topCurve)&&this.bottomCurve.equals(e.bottomCurve)&&this.isVerticalLayout==e.isVerticalLayout},e.prototype.warpPoint=function(e){var t=Object(i.e)(this.isVerticalLayout?(e.y-this.sourceRect.top)/this.sourceRect.height:(e.x-this.sourceRect.left)/this.sourceRect.width,0,1),r=Object(i.e)(this.isVerticalLayout?1-(e.x-this.sourceRect.left)/this.sourceRect.width:(e.y-this.sourceRect.top)/this.sourceRect.height,0,1);return this.topCurve.moveTo(t),this.bottomCurve.moveTo(t),new i.d(Object(i.k)(this.topCurve.currentX,this.bottomCurve.currentX,r),Object(i.k)(this.topCurve.currentY,this.bottomCurve.currentY,r))},e.prototype.warpPath=function(e){for(var t=this,r=[],n=Math.max(this.sourceRect.width)/4,a=i.a.FromTransforms(e.transform),o=function(e){if(e.getPointCount()>0){var o=new c.b;o.moveToPoint(s.warpPoint(e.getPoint(0).transformPoint(a))),e.forEachSegment((function(e,r,s){for(var c=r||i.d.InterpolateLinear(e,s,.5),u=Math.max(1,Math.ceil(Math.abs(s.x-e.x)/n)),h=0;h<u;h++){var l=t.warpPoint(i.d.InterpolateQuadratic(e,c,s,h/u).transformPoint(a)),f=t.warpPoint(i.d.InterpolateQuadratic(e,c,s,(h+.5)/u).transformPoint(a)),d=t.warpPoint(i.d.InterpolateQuadratic(e,c,s,(h+1)/u).transformPoint(a)),p=f.add(f.subtract(i.d.InterpolateLinear(l,d,.5)));o.quadBezierToPoint(p,d)}return!0})),e.isClosed&&o.close(),r.push(o.createFigure())}},s=this,u=0,h=e.figures;u<h.length;u++)o(h[u]);return new c.d({figures:r,fillMode:e.fillMode,lineEnabled:e.lineEnabled,extrusionEnabled:e.extrusionEnabled,transform:void 0})},e}(),T=function(){function e(e,t,r){this.image=e,this.rect=t,this.transform=r}return e.prototype.equals=function(e){return this.image==e.image&&this.rect==e.rect},e}(),x=function(){function e(e,t,r,n,i){this.layoutBounds=e,this.paths=t instanceof Array?t.slice(0):t,this.forceWarping=r,this.isWhiteSpace=n,this.textImage=i}return e.prototype.equals=function(e){if(!this.layoutBounds.equals(e.layoutBounds))return!1;if(!this.paths&&!e.paths)return!0;if(this.paths instanceof c.d&&e.paths instanceof c.d)return this.paths.equals(e.paths);if(this.paths instanceof Array&&e.paths instanceof Array){if(this.paths.length!=e.paths.length)return!1;for(var t=0;t<this.paths.length;t++)if(!this.paths[t].equals(e.paths[t]))return!1;return!0}return!this.paths&&!e.paths},e.prototype.getTranslatedCopy=function(t){var r=void 0;if(this.paths instanceof c.d)r=new c.d(this.paths,this.paths.transform.applyTranslationAfter(t));else if(this.paths){r=new Array(this.paths.length);for(var n=0;n<this.paths.length;n++)r[n]=new c.d(this.paths[n],this.paths[n].transform.applyTranslationAfter(t))}return new e(this.layoutBounds.translate(t),r,this.forceWarping)},e}(),E=function(){function e(e,t,r,n){this.m_changeTracker=new u.a,this.m_character=e,this.style=t,this.effects=r,this.strokes=n}return e.prototype.clone=function(){var t=new e(this.m_character,this.m_style?this.m_style.clone():void 0,this.m_effects?this.m_effects.clone():void 0);if(this.m_strokes){t.m_strokes=new u.b;for(var r=0,n=this.m_strokes.elements;r<n.length;r++){var i=n[r];t.m_strokes.push(i.clone())}}return t},Object.defineProperty(e.prototype,"character",{get:function(){return this.m_character},set:function(e){this.m_character.equals(e)||(this.m_changeTracker.notifyChange(),this.m_character=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.m_style},set:function(e){this.m_changeTracker.replaceListener(this.m_style,e),this.m_style=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effects",{get:function(){return this.m_effects},set:function(e){this.m_changeTracker.replaceListener(this.m_effects,e),this.m_effects=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strokes",{get:function(){return this.m_strokes},set:function(e){this.m_changeTracker.replaceListener(this.m_strokes,e),this.m_strokes=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return!!this.m_character.equals(e.m_character)&&this.m_style==e.m_style&&this.m_effects==e.effects&&this.m_strokes==e.m_strokes},e}(),P=function(){function e(e,t,r){this.ascent=e,this.descent=t,this.fontHeightInPoints=r}return e.prototype.equals=function(e){return this.ascent==e.ascent&&this.descent==e.descent&&this.fontHeightInPoints==e.fontHeightInPoints},e}(),S=function(){function e(e,t){this.m_changeTracker=new u.a,this.m_characters=[],this.m_localRange=e,this.m_layoutBounds=t,this.m_fillBounds=t,this.m_offset=i.d.Zero}return e.prototype.clone=function(){for(var t=new e(this.m_localRange,this.m_layoutBounds),r=0,n=this.m_characters;r<n.length;r++){var i=n[r];t.addCharacter(i)}return t.m_fillBounds=this.m_fillBounds,t.m_textEffectMetrics=this.m_textEffectMetrics,t.bender=this.m_bender,t},Object.defineProperty(e.prototype,"characters",{get:function(){return this.m_characters},set:function(e){Object(h.d)(this.m_changeTracker,this.m_characters,e),this.m_characters=e.slice(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localRange",{get:function(){return this.m_localRange},set:function(e){Object(h.c)(this.m_changeTracker,this.m_localRange,e),this.m_localRange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this.m_offset},set:function(e){Object(h.c)(this.m_changeTracker,this.m_offset,e),this.m_offset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutBounds",{get:function(){return this.m_layoutBounds},set:function(e){Object(h.c)(this.m_changeTracker,this.m_layoutBounds,e),this.m_layoutBounds=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"fillBounds",{get:function(){return this.m_fillBounds},set:function(e){Object(h.c)(this.m_changeTracker,this.m_fillBounds,e),this.m_fillBounds=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textEffectMetrics",{get:function(){return this.m_textEffectMetrics},set:function(e){Object(h.c)(this.m_changeTracker,this.m_textEffectMetrics,e),this.m_textEffectMetrics=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bender",{get:function(){return this.m_bender},set:function(e){this.bender==e||this.bender instanceof b&&e instanceof b&&this.bender.equals(e)||this.bender instanceof v&&e instanceof v&&this.bender.equals(e)||(this.m_changeTracker.notifyChange(),this.m_bender=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flowDirection",{get:function(){return 0==this.m_characters.length?0:Math.sign(this.m_characters[this.m_characters.length-1].layoutBounds.left-this.m_characters[0].layoutBounds.left)},enumerable:!0,configurable:!0}),e.prototype.removeAllCharacters=function(){this.characters=[]},e.prototype.addCharacter=function(e){this.m_changeTracker.notifyChange(),this.m_characters.push(e)},e}(),w=function(){function e(e,t){this.m_lines=[],this.m_localWordRanges=[],this.m_changeTracker=new u.a,this.m_globalRange=e,this.m_stylePerLocalRange=new p(t),this.m_effectsPerLocalRange=new p(new o.a),this.m_strokesPerLocalRange=new p(new u.b),this.m_changeTracker.replaceListener(void 0,this.m_stylePerLocalRange),this.m_offset=i.d.Zero}return e.prototype.clone=function(){for(var t=new e(this.m_globalRange,this.m_stylePerLocalRange.defaultData),r=0,n=this.m_lines;r<n.length;r++){var i=n[r];t.addLine(i.clone())}t.m_offset=this.m_offset,t.bullet=this.m_bullet?this.m_bullet.clone():void 0;for(var a=0,o=this.m_stylePerLocalRange.ranges;a<o.length;a++){var s=o[a];t.m_stylePerLocalRange.set(this.m_stylePerLocalRange.getAt(s.start).clone(),s)}t.m_effectsPerLocalRange.defaultData=this.m_effectsPerLocalRange.defaultData;for(var c=0,h=this.m_effectsPerLocalRange.ranges;c<h.length;c++){var l=h[c];t.m_effectsPerLocalRange.set(this.m_effectsPerLocalRange.getAt(l.start).clone(),l)}t.m_strokesPerLocalRange.defaultData=this.m_strokesPerLocalRange.defaultData;for(var f=0,d=this.m_strokesPerLocalRange.ranges;f<d.length;f++){for(var p=d[f],g=this.m_strokesPerLocalRange.getAt(p.start),_=new u.b,m=0,b=g.elements;m<b.length;m++){var y=b[m];_.push(y.clone())}t.m_strokesPerLocalRange.set(_,p)}return t.m_localWordRanges=this.m_localWordRanges.slice(0),t},Object.defineProperty(e.prototype,"lines",{get:function(){return this.m_lines},set:function(e){this.removeAllLines();for(var t=0,r=e;t<r.length;t++){var n=r[t];this.addLine(n)}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stylePerLocalRange",{get:function(){return this.m_stylePerLocalRange},set:function(e){this.m_changeTracker.replaceListener(this.m_stylePerLocalRange,e),this.m_stylePerLocalRange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"effectsPerLocalRange",{get:function(){return this.m_effectsPerLocalRange},set:function(e){this.m_changeTracker.replaceListener(this.m_effectsPerLocalRange,e),this.m_effectsPerLocalRange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"strokesPerLocalRange",{get:function(){return this.m_strokesPerLocalRange},set:function(e){this.m_changeTracker.replaceListener(this.m_strokesPerLocalRange,e),this.m_strokesPerLocalRange=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"globalRange",{get:function(){return this.m_globalRange},set:function(e){this.m_globalRange.equals(e)||(this.m_changeTracker.notifyChange(),this.m_globalRange=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return this.m_offset},set:function(e){Object(h.c)(this.m_changeTracker,this.m_offset,e),this.m_offset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"bullet",{get:function(){return this.m_bullet},set:function(e){this.m_changeTracker.replaceListener(this.m_bullet,e),this.m_bullet=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"localWordRanges",{get:function(){return this.m_localWordRanges},set:function(e){Object(h.d)(this.m_changeTracker,this.m_localWordRanges,e),this.m_localWordRanges=e.slice(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),e.prototype.removeAllLocalWordRanges=function(){this.localWordRanges=[]},e.prototype.addLocalWordRange=function(e){this.m_changeTracker.notifyChange(),this.m_localWordRanges.push(e)},e.prototype.removeAllLines=function(){for(var e=0,t=this.m_lines;e<t.length;e++){var r=t[e];u.a.RemoveListener(r.changeTracker,this.m_changeTracker)}this.m_lines=[]},e.prototype.addLine=function(e){u.a.AddListener(e.changeTracker,this.m_changeTracker),this.m_lines.push(e)},e}(),R=function(){function e(e,t,r,n){this.m_isAnchoredToPrevious=!1,this.m_changeTracker=new u.a,this.m_changeTracker.replaceListener(void 0,t),this.m_range=e,this.m_style=t,this.m_caretWidth=r,this.m_isAnchoredToPrevious=n}return e.CreateCaret=function(t,r,n,i){return new e(new f(t,0),i||new s.l(new s.j(s.b.White),void 0,new s.h,2),r,n)},e.CreateRangeSelection=function(t,r){return new e(t,r,0,!1)},e.prototype.clone=function(){return new e(this.m_range,this.m_style.clone(),this.m_caretWidth,this.m_isAnchoredToPrevious)},Object.defineProperty(e.prototype,"range",{get:function(){return this.m_range},set:function(e){this.m_range.equals(e)||(this.m_changeTracker.notifyChange(),this.m_range=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"style",{get:function(){return this.m_style},set:function(e){this.m_changeTracker.replaceListener(this.m_style,e),this.m_style=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"caretWidth",{get:function(){return this.m_caretWidth},set:function(e){Object(h.a)(this.m_changeTracker,this.m_caretWidth,e),this.m_caretWidth=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isAnchoredToPrevious",{get:function(){return this.m_isAnchoredToPrevious},set:function(e){Object(h.a)(this.m_changeTracker,this.m_isAnchoredToPrevious,e),this.m_isAnchoredToPrevious=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),e}(),C=function(){function e(){this.m_paragraphs=[],this.m_changeTracker=new u.a,this.m_animationChangeTracker=new u.a,this.m_selectionChangeTracker=new u.a,this.m_layoutToFrame=i.c.Identity,this.m_frameToShape=i.c.Identity}return e.prototype.clone=function(){for(var t=new e,r=0,n=this.m_paragraphs;r<n.length;r++){var i=n[r];t.addParagraph(i.clone())}if(t.m_layoutToFrame=this.m_layoutToFrame,t.m_frameToShape=this.m_frameToShape,this.m_animationProps){t.m_animationProps=new p(new _),t.m_animationProps.defaultData=this.m_animationProps.defaultData;for(var a=0,o=this.m_animationProps.ranges;a<o.length;a++){var s=o[a];t.m_animationProps.set(this.m_animationProps.getAt(s.start).clone(),s)}}if(this.m_selectionHighlights){t.m_selectionHighlights=[];for(var c=0,u=this.m_selectionHighlights;c<u.length;c++){var h=u[c];t.m_selectionHighlights.push(h.clone())}}return t},e.prototype.createAnimationProps=function(){this.animationProps=new p(new _)},e.prototype.hasAnimationProps=function(){return!!this.animationProps},Object.defineProperty(e.prototype,"paragraphs",{get:function(){return this.m_paragraphs},set:function(e){if(this.m_paragraphs!=e){this.removeAllParagraphs();for(var t=0,r=e;t<r.length;t++){var n=r[t];this.addParagraph(n)}}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"layoutToFrame",{get:function(){return this.m_layoutToFrame},set:function(e){Object(h.c)(this.m_changeTracker,this.m_layoutToFrame,e),this.m_layoutToFrame=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frameToShape",{get:function(){return this.m_frameToShape},set:function(e){Object(h.c)(this.m_changeTracker,this.m_frameToShape,e),this.m_frameToShape=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationProps",{get:function(){return this.m_animationProps},set:function(e){this.m_animationProps!=e&&(this.m_animationProps&&(u.a.RemoveListener(this.m_animationProps.changeTracker,this.m_animationChangeTracker),u.a.RemoveListener(this.m_animationProps.rangeChangeTracker,this.m_changeTracker)),e&&(u.a.AddListener(e.changeTracker,this.m_animationChangeTracker),u.a.AddListener(e.rangeChangeTracker,this.m_changeTracker)),this.m_animationProps=e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionHighlights",{get:function(){return this.m_selectionHighlights},set:function(e){Object(h.b)(this.m_selectionChangeTracker,this.m_selectionHighlights,e),this.m_selectionHighlights=e?e.slice(0):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"animationChangeTracker",{get:function(){return this.m_animationChangeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textVersion",{get:function(){return this.m_changeTracker.version},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selectionVersion",{get:function(){return this.m_selectionChangeTracker.version},enumerable:!0,configurable:!0}),e.prototype.forceSplit=function(e){(!this.m_explicitTextSplit||e>this.m_explicitTextSplit)&&(this.m_changeTracker.notifyChange(),this.m_explicitTextSplit=e)},e.prototype.removeAllParagraphs=function(){for(var e=0,t=this.m_paragraphs;e<t.length;e++){var r=t[e];u.a.RemoveListener(r.changeTracker,this.m_changeTracker)}this.m_paragraphs=[]},e.prototype.addParagraph=function(e){u.a.AddListener(e.changeTracker,this.m_changeTracker),this.m_paragraphs.push(e)},e.prototype.removeParagraph=function(e){u.a.RemoveListener(this.m_paragraphs[e].changeTracker,this.m_changeTracker),this.m_paragraphs.splice(e)},e.prototype.getFullRange=function(){return this.paragraphs.length<1?void 0:f.FromFirstLast(this.paragraphs[0].globalRange.start,this.paragraphs[this.paragraphs.length-1].globalRange.last)},e.prototype.getRunRanges=function(){var e=this.getFullRange();if(e){for(var t=[],r=0,n=this.paragraphs;r<n.length;r++){var i=n[r];if(2==this.m_explicitTextSplit)for(var a=i.globalRange.start;a<=i.globalRange.last;a++)A(t,a);else{for(var o=i.globalRange.start,s=0,c=i.lines;s<c.length;s++){var u=c[s];A(t,o+u.localRange.start),A(t,o+u.localRange.last+1)}for(var h=0,l=i.stylePerLocalRange.ranges;h<l.length;h++){var f=l[h];A(t,o+f.start),A(t,o+f.last+1)}for(var d=0,p=i.effectsPerLocalRange.ranges;d<p.length;d++)f=p[d],A(t,o+f.start),A(t,o+f.last+1);for(var g=0,_=i.strokesPerLocalRange.ranges;g<_.length;g++)f=_[g],A(t,o+f.start),A(t,o+f.last+1);if(1==this.m_explicitTextSplit)for(var m=0,b=i.localWordRanges;m<b.length;m++)f=b[m],A(t,o+f.start),A(t,o+f.last+1)}}if(this.animationProps)for(var y=function(e){t.some((function(t){return t==e.start}))||t.push(e.start),t.some((function(t){return t==e.last+1}))||t.push(e.last+1)},v=0,T=this.animationProps.ranges;v<T.length;v++)y(T[v]);return F(t,e)}return[]},e.prototype.getAnimatablePartRanges=function(e,t,r){var n=t||this.getFullRange();if(n&&0!=n.length){if(t&&r){if(t.start<0||t.start>=this.paragraphs.length||t.last<0||t.last>=this.paragraphs.length)return void a.a.Error(592525336,"bad paragraph range");n=f.FromFirstLast(this.paragraphs[t.start].globalRange.start,this.paragraphs[t.last].globalRange.last)}if(0==e)return n?[n]:void 0;for(var i=[],o=0,s=this.paragraphs;o<s.length;o++){for(var c=s[o],u=c.globalRange.start,h=0,l=c.lines;h<l.length;h++){var d=l[h];if(A(i,u+d.localRange.start),A(i,u+d.localRange.last+1),2==e)for(var p=u+d.localRange.start,g=!1,_=0;_<d.characters.length;_++)g||A(i,p+_),g=1==d.characters[_].isWhiteSpace}if(1==e)for(var m=0,b=c.localWordRanges;m<b.length;m++)A(i,u+b[m].start)}return F(i,n)}},e.prototype.getTextPathsForCharacter=function(e,t,r){for(var n=[],o=0,s=e.paths instanceof c.d?[e.paths]:e.paths?e.paths:[];o<s.length;o++){var u=s[o],h=i.a.Translation2D(t).multiply(this.layoutToFrame.toMatrix3()),l=u.transform.toMatrix3().multiply(h).tryGetTransform(u.transform.preTranslation);if(!l)throw a.a.Error(592525337,"unexpected transform");var f=new c.d(u,l),d=r instanceof v?r:void 0;if(r instanceof b){var p=e.layoutBounds.isEmpty()?void 0:e.layoutBounds.transformedBounds(h);if(e.forceWarping||!p)d=r.equivalentWarpingEnvelope;else{var g=r.getTransform(p);g&&(f=(l=l.toMatrix3().multiply(g.toMatrix3()).tryGetTransform(u.transform.preTranslation))?new c.d(u,l):void 0)}}d&&f&&(f=d.warpPath(f)),f&&n.push(f)}return n},e.prototype.getTextPathsForRange=function(e){for(var t=[],r=0,n=this.paragraphs;r<n.length;r++){var i=n[r];if(i.globalRange.intersects(e))for(var a=0,o=i.lines;a<o.length;a++){var s=o[a],c=new f(0,s.characters.length).getIntersection(e.move(-i.globalRange.start-s.localRange.start));if(c)for(var u=c.start;u<=c.last;u++){var h=this.getTextPathsForCharacter(s.characters[u],s.offset.add(i.offset),s.bender);t.push.apply(t,h)}}}return t},e.prototype.getLineAndParagraphAt=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++){var n=r[t];if(n.globalRange.includes(e))for(var i=e-n.globalRange.start,a=0,o=n.lines;a<o.length;a++){var s=o[a];if(s.localRange.includes(i))return{line:s,paragraph:n}}}},e.prototype.getStyleAt=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++){var n=r[t];if(n.globalRange.includes(e))return n.stylePerLocalRange.getAt(e-n.globalRange.start)}},e.prototype.getEffetcsAt=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++){var n=r[t];if(n.globalRange.includes(e))return n.effectsPerLocalRange.getAt(e-n.globalRange.start)}},e.prototype.getStrokesAt=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++){var n=r[t];if(n.globalRange.includes(e))return n.strokesPerLocalRange.getAt(e-n.globalRange.start)}},e.prototype.getPathFromLayoutRect=function(e,t,r){var n=i.a.Translation2D(r).multiply(this.layoutToFrame.toMatrix3()).tryGetTransform(i.d.Zero);if(n){var a=new c.d({figures:[c.a.CreateFromRect(e)],transform:n}),o=t.bender instanceof b?t.bender.equivalentWarpingEnvelope:t.bender;return o&&(a=o.warpPath(a)),a}},e.prototype.getSelectionRectPaths=function(e){for(var t=void 0,r=0,n=this.paragraphs;r<n.length;r++)for(var a=n[r],o=e?e.move(-a.globalRange.start):void 0,s=0,c=a.lines;s<c.length;s++){var u=c[s],h=void 0;if(!o||u.characters&&o.intersects(u.localRange))for(var l=0;l<u.characters.length;l++){var f=u.localRange.start+l;(!o||o.start<=f&&f<=o.last)&&(h=i.b.UnionRect(h,u.characters[l].layoutBounds))}if(h){var d=this.getPathFromLayoutRect(h,u,u.offset.add(a.offset));d&&(t||(t=[]),t.push(d))}}return t},e.prototype.getBoundsOfRange=function(e,t){for(var r,n=t?this.frameToShape.toMatrix3().multiply(t.toMatrix3()):this.frameToShape,a=this.getSelectionRectPaths(e),o=0,s=this.paragraphs;o<s.length;o++){var c=s[o];c.bullet&&c.lines.length>0&&(!e||e.includes(c.globalRange.start))&&(l=this.getPathFromLayoutRect(c.bullet.character.layoutBounds,c.lines[0],c.offset))&&(a=a?a.concat(l):[l])}for(var u=0,h=a||[];u<h.length;u++){var l;(l=h[u]).untransformedBounds&&(r=i.b.UnionRect(r,l.untransformedBounds.transformedBounds(l.transform.toMatrix3().multiply(n.toMatrix3()))))}return r},e.prototype.getSelectionLayoutCaretPath=function(e,t,r){for(var n=0,o=this.paragraphs;n<o.length;n++)for(var s=o[n],c=e-s.globalRange.start,u=0,h=s.lines;u<h.length;u++){var l=h[u];l.localRange.length!=l.characters.length&&a.a.Error(592525338,"character count mismatch");var f=e-l.localRange.start,d=void 0;if(0<=f&&f<l.characters.length){var p=l.characters[f].layoutBounds,g=l.flowDirection>0?p.left:p.right;d=new i.b(g-.5*t,p.top,g+.5*t,p.bottom)}else 0==f&&0==l.characters.length?(g=l.flowDirection>0?l.layoutBounds.left:l.layoutBounds.right,d=new i.b(g-.5*t,l.layoutBounds.top,g+.5*t,l.layoutBounds.bottom)):r&&c==l.localRange.last+1&&(p=l.characters[l.characters.length-1].layoutBounds,g=l.flowDirection>0?p.right:p.left,d=new i.b(g-.5*t,p.top,g+.5*t,p.bottom));if(d)return this.getPathFromLayoutRect(d,l,l.offset.add(s.offset))}},e.prototype.getLineAndParagraphFromLayoutPosition=function(e){for(var t=void 0,r=void 0,n=0,i=this.paragraphs;n<i.length;n++)for(var a=i[n],o=0,s=a.lines;o<s.length;o++){var c=s[o];if(e.subtract(a.offset).subtract(c.offset).y<c.layoutBounds.bottom)return{paragraph:a,line:c};t=c,r=a}return{paragraph:r,line:t}},e.prototype.getSelectionFromLayoutPosition=function(e){var t=this.getLineAndParagraphFromLayoutPosition(e);if(t.paragraph&&t.line&&t.line.characters){for(var r=e.subtract(t.paragraph.offset).subtract(t.line.offset),n=0;n<t.line.characters.length;n++)if(r.x<(t.line.characters[n].layoutBounds.right+t.line.characters[n].layoutBounds.left)/2)return{characterIndex:t.paragraph.globalRange.start+t.line.localRange.start+n,isAnchoredToPrevious:!1};return{characterIndex:t.paragraph.globalRange.start+t.line.localRange.last+1,isAnchoredToPrevious:!0}}},e.prototype.hitTest=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++)for(var n=r[t],i=0,a=n.lines||[];i<a.length;i++){var o=a[i],s=e.subtract(n.offset).subtract(o.offset);if(o.layoutBounds.isPointInRect(s))return!0}return!1},e.prototype.getBrushImages=function(e){for(var t=0,r=this.paragraphs;t<r.length;t++){var n=r[t];n.bullet&&n.bullet.style&&n.bullet.style.getBrushImages(e),n.stylePerLocalRange.allData.forEach((function(t){t.getBrushImages(e)})),n.strokesPerLocalRange.allData.forEach((function(t){for(var r=0,n=t.elements;r<n.length;r++){var i=n[r];i.style&&i.style.getBrushImages(e)}}));for(var i=0,a=n.lines;i<a.length;i++)for(var o=0,s=a[i].characters;o<s.length;o++){var c=s[o];c.textImage&&e.push(c.textImage.image)}}},e}();function A(e,t){e.some((function(e){return e==t}))||e.push(t)}function F(e,t){A(e,t.start),A(e,t.last+1),e.sort((function(e,t){return e-t}));for(var r=[],n=0;n<e.length-1;n++){var i=f.FromFirstLast(e[n],e[n+1]-1).getIntersection(t);i&&i.length>0&&r.push(i)}return r}},function(e,t,r){"use strict";r.d(t,"j",(function(){return i})),r.d(t,"n",(function(){return a})),r.d(t,"k",(function(){return o})),r.d(t,"l",(function(){return s})),r.d(t,"p",(function(){return c})),r.d(t,"b",(function(){return u})),r.d(t,"d",(function(){return h})),r.d(t,"h",(function(){return l})),r.d(t,"e",(function(){return f})),r.d(t,"g",(function(){return d})),r.d(t,"f",(function(){return p})),r.d(t,"c",(function(){return g})),r.d(t,"i",(function(){return _})),r.d(t,"a",(function(){return m})),r.d(t,"m",(function(){return b})),r.d(t,"o",(function(){return y}));var n=r(2),i=!0;function a(e){i=e}var o=1,s=8;function c(e,t){o=e,s=t}var u=0,h=1,l=2,f=3,d=4,p=5,g=6,_=7,m=u;function b(e){m=e}function y(e){n.a.setLogger(e)}},function(e,t,r){"use strict";r.d(t,"b",(function(){return s})),r.d(t,"e",(function(){return c})),r.d(t,"c",(function(){return u})),r.d(t,"d",(function(){return h})),r.d(t,"f",(function(){return l})),r.d(t,"a",(function(){return f}));var n=r(1),i=r(0),a=r(5),o=r(3),s=function(){function e(e,t){void 0===e&&(e=n.b.Transparent),void 0===t&&(t=0),this.m_changeTracker=new a.a,this.m_color=e,this.m_radius=t}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.m_color},set:function(e){Object(o.c)(this.m_changeTracker,this.m_color,e),this.m_color=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){Object(o.a)(this.m_changeTracker,this.m_radius,e),this.m_radius=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.m_color,this.m_radius)},e}(),c=function(){function e(e,t,r,o,s,c,u,h,l){void 0===e&&(e=n.b.Transparent),void 0===t&&(t=0),void 0===r&&(r=0),void 0===o&&(o=0),void 0===s&&(s=i.d.One),void 0===c&&(c=i.d.Zero),void 0===u&&(u=4),void 0===h&&(h=!1),void 0===l&&(l=0),this.m_changeTracker=new a.a,this.m_color=e,this.m_radius=t,this.m_angle=r,this.m_distance=o,this.m_scale=s,this.m_skew=c,this.m_alignment=u,this.m_rotateWithShape=h,this.m_shadowType=l}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.m_color},set:function(e){Object(o.c)(this.m_changeTracker,this.m_color,e),this.m_color=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){Object(o.a)(this.m_changeTracker,this.m_radius,e),this.m_radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.m_angle},set:function(e){Object(o.a)(this.m_changeTracker,this.m_angle,e),this.m_angle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this.m_distance},set:function(e){Object(o.a)(this.m_changeTracker,this.m_distance,e),this.m_distance=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"scale",{get:function(){return this.m_scale},set:function(e){Object(o.c)(this.m_changeTracker,this.m_scale,e),this.m_scale=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"skew",{get:function(){return this.m_skew},set:function(e){Object(o.c)(this.m_changeTracker,this.m_skew,e),this.m_skew=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alignment",{get:function(){return this.m_alignment},set:function(e){Object(o.a)(this.m_changeTracker,this.m_alignment,e),this.m_alignment=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rotateWithShape",{get:function(){return this.m_rotateWithShape},set:function(e){Object(o.a)(this.m_changeTracker,this.m_rotateWithShape,e),this.m_rotateWithShape=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadowType",{get:function(){return this.m_shadowType},set:function(e){Object(o.a)(this.m_changeTracker,this.m_shadowType,e),this.m_shadowType=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.m_color,this.m_radius,this.m_angle,this.m_distance,this.m_scale,this.m_skew,this.m_alignment,this.m_rotateWithShape,this.m_shadowType)},e}(),u=function(){function e(e,t,r,i){void 0===e&&(e=n.b.Transparent),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),this.m_changeTracker=new a.a,this.m_color=e,this.m_radius=t,this.m_angle=r,this.m_distance=i}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"color",{get:function(){return this.m_color},set:function(e){Object(o.c)(this.m_changeTracker,this.m_color,e),this.m_color=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){Object(o.a)(this.m_changeTracker,this.m_radius,e),this.m_radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"angle",{get:function(){return this.m_angle},set:function(e){Object(o.a)(this.m_changeTracker,this.m_angle,e),this.m_angle=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this.m_distance},set:function(e){Object(o.a)(this.m_changeTracker,this.m_distance,e),this.m_distance=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.m_color,this.m_radius,this.m_angle,this.m_distance)},e}(),h=function(){function e(e,t,r,n,i,o){void 0===e&&(e=0),void 0===t&&(t=1),void 0===r&&(r=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===o&&(o=0),this.m_changeTracker=new a.a,this.m_radius=e,this.m_startAlpha=t,this.m_startPosition=r,this.m_endAlpha=n,this.m_endPosition=i,this.m_distance=o}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){Object(o.a)(this.m_changeTracker,this.m_radius,e),this.m_radius=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startAlpha",{get:function(){return this.m_startAlpha},set:function(e){Object(o.a)(this.m_changeTracker,this.m_startAlpha,e),this.m_startAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startPosition",{get:function(){return this.m_startPosition},set:function(e){Object(o.a)(this.m_changeTracker,this.m_startPosition,e),this.m_startPosition=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endAlpha",{get:function(){return this.m_endAlpha},set:function(e){Object(o.a)(this.m_changeTracker,this.m_endAlpha,e),this.m_endAlpha=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endPosition",{get:function(){return this.m_endPosition},set:function(e){Object(o.a)(this.m_changeTracker,this.m_endPosition,e),this.m_endPosition=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"distance",{get:function(){return this.m_distance},set:function(e){Object(o.a)(this.m_changeTracker,this.m_distance,e),this.m_distance=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.m_radius,this.m_startAlpha,this.m_startPosition,this.m_endAlpha,this.m_endPosition,this.m_distance)},e}(),l=function(){function e(e){void 0===e&&(e=0),this.m_changeTracker=new a.a,this.m_radius=e}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),e.prototype.notifyChange=function(){this.m_changeTracker.notifyChange()},Object.defineProperty(e.prototype,"radius",{get:function(){return this.m_radius},set:function(e){this.m_radius!=e&&(this.notifyChange(),this.m_radius=e)},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.m_radius)},e}(),f=function(){function e(e,t,r,n,i){this.m_changeTracker=new a.a,this.glow=e,this.shadow=t,this.innerShadow=r,this.reflection=n,this.softEdges=i}return Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),e.prototype.notifyChange=function(){this.m_changeTracker.notifyChange()},Object.defineProperty(e.prototype,"glow",{get:function(){return this.m_glow},set:function(e){this.m_changeTracker.replaceListener(this.m_glow,e),this.m_glow=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"shadow",{get:function(){return this.m_shadow},set:function(e){this.m_changeTracker.replaceListener(this.m_shadow,e),this.m_shadow=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"innerShadow",{get:function(){return this.m_innerShadow},set:function(e){this.m_changeTracker.replaceListener(this.m_innerShadow,e),this.m_innerShadow=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reflection",{get:function(){return this.m_reflection},set:function(e){this.m_changeTracker.replaceListener(this.m_reflection,e),this.m_reflection=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"softEdges",{get:function(){return this.m_softEdges},set:function(e){this.m_changeTracker.replaceListener(this.m_softEdges,e),this.m_softEdges=e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e(this.m_glow?this.m_glow.clone():void 0,this.m_shadow?this.m_shadow.clone():void 0,this.m_innerShadow?this.m_innerShadow.clone():void 0,this.m_reflection?this.m_reflection.clone():void 0,this.m_softEdges?this.m_softEdges.clone():void 0)},e}()},function(e,t,r){"use strict";r.d(t,"g",(function(){return s})),r.d(t,"d",(function(){return l})),r.d(t,"f",(function(){return d})),r.d(t,"a",(function(){return g})),r.d(t,"c",(function(){return _})),r.d(t,"b",(function(){return m})),r.d(t,"e",(function(){return y}));var n=r(7),i=r(0),a=r(1),o=r(2),s=!1,c=[{attributeName:"a_0",attributeSize:2,offset:0,divisor:0}],u=[{attributeName:"a_1",attributeSize:2,offset:0,divisor:0}],h=function(){function e(e,t,r){void 0===r&&(r=0),this.a=e,this.b=t,this.progress=r}return e.prototype.getValue=function(e){return null!=this.a&&null!=this.b?e(this.a,this.b,this.progress):this.a?this.a:this.b},e}();function l(e,t,r,n,s){var c=e.getGraphicsProcessor();if(c){var u=e.ensureScratchBuffers(),h=u[0],l=u[1],d=1==n?.12*r:16==n?.47*r:r,p=1==n?.3*r:r,g=1==n?3:16==n?2:s?1:0,_=s?1:0,m=1!=n&&16!=n;f(c,l.size.divide(t.size),t,l,s?a.b.Black:void 0,d,g,new i.d(1,0),m),f(c,i.d.One,l,h,s?a.b.Black:void 0,d,g,new i.d(0,1),m),f(c,i.d.One,h,l,s?a.b.Black:void 0,p,_,new i.d(1,0),!0),f(c,t.size.divide(h.size),l,t,s,p,_,new i.d(0,1),!0)}else o.a.Error(592525249,"No GraphicsProcessor")}function f(e,t,r,n,i,s,c,u,h){if(r.babylonTexture){var l=e.activateShaderProgram(3);l.begin(n.babylonTexture,a.b.Transparent,!1);var f=l.getBabylonEffect();f.setFloat("u_0",s),f.setVector2("u_1",t),f.setVector2("u_2",u),f.setVector2("u_3",r.size),f.setInt("u_4",h?1:2),l.setTexture("tex_0",r.babylonTexture),f.setDirectColor4("ufrag_0",i||a.b.Transparent),f.setFloat("ufrag_2",Math.log(s/4)/Math.log(2)),f.setInt("ufrag_3",c),f.setInt("ufrag_4",h?1:2),l.drawQuads(1),l.end(),n.generateMipMap()}else o.a.Error(592525250,"No Texture")}function d(e){var t=i.a.Scale2D(e.contentLocation.logicalSize.multiply(i.d.Flip(e.contentLocation.flipX,e.contentLocation.flipY)));return(t=(t=(t=t.multiply(i.a.RotationZ(e.contentLocation.rotation))).multiply(i.a.Translation2D(e.contentLocation.logicalCenter))).multiply(i.a.Scale2D(e.size.inverse()))).multiply(i.a.Translation2D(new i.d(-.5,-.5)))}function p(e){return e?e.size.x+"x"+e.size.y:"undefined"}var g=function(){function e(e,t){this.contentRotation=0,this.depth=0,this.depthFar=0,this.depthNear=0,this.contentCenter=e?e.center:i.d.Zero,this.contentSize=e?e.size:i.d.One,this.contentFlip=e?i.d.Flip(e.flipX,e.flipY):i.d.One,this.contentRotation=e?e.rotation:0,this.customMesh=t}return e.prototype.getDebugStringInfo=function(){return["Layer"]},e}(),_=function(e){function t(t,r,n){var i=e.call(this,r,n)||this;return i.texture=t,i}return Object(n.c)(t,e),t.prototype.getDebugStringInfo=function(){return["Texture: "+p(this.texture),(this.fadeInfo?" +Fade ":"")+(this.reflectionGradient?" + Reflection ":"")+(this.customMesh?" + CustomMesh ":"")]},t}(g),m=function(e){function t(t,r,n,a,o){var s=e.call(this,{center:i.d.Zero,size:i.d.One,rotation:0,flipX:!1,flipY:!1},o)||this;return s.progress=0,s.textureA=t,s.textureB=r,n&&a&&(s.morphingGrid=[n,a]),s}return Object(n.c)(t,e),t.prototype.getDebugStringInfo=function(){return["Textures: "+p(this.textureA)+"  "+p(this.textureB),(this.fadeInfo?" +Fade ":"")+(this.customMesh?" + CustomMesh ":"")+(this.morphingGrid?" + MorphingGrid ":"")]},t}(g);function b(e,t){var r=new i.c(i.d.Zero,e.contentLocation.logicalSize.multiply(i.d.Flip(e.contentLocation.flipX,e.contentLocation.flipY)),e.contentLocation.rotation,e.contentLocation.logicalCenter);return i.b.FromSize(e.size).transformedBounds(r.toInverseMatrix3().multiply(t.toMatrix3()))}function y(e,t,r,n,s){var l,f,p=e instanceof _?e:void 0,g=e instanceof m?e:void 0,y=g?g.textureA:p?p.texture:void 0,v=g?g.textureB:void 0,T=g?g.progress:0,x=(f=function(e,t,r){return{opacity0:Object(i.k)(e.opacity0,t.opacity0,r),opacity1:Object(i.k)(e.opacity1,t.opacity1,r),y0:Object(i.k)(e.y0,t.y0,r),y1:Object(i.k)(e.y1,t.y1,r)}},(l=p?p.reflectionGradient:void 0)instanceof h?l.getValue(f):l);if(y&&y.babylonTexture||v&&v.babylonTexture){var E=i.a.ScaleTranslation2D(e.contentSize,e.contentCenter),P=y?b(y,E):void 0,S=v?b(v,E):void 0,w=P&&S?i.b.UnionRect(P,S):P||S;if(w){var R=i.d.Zero.transformPoint(E),C=i.a.Identity,A=i.a.Identity,F=t.getBabylonEffect(),B=t.getBabylonEngine();if(g&&g.morphingGrid&&2==g.morphingGrid.length)F.setInt("u_16",1),F.setFloat("u_17",g.progress),B.bindInstancesBuffer(g.morphingGrid[0],c),B.bindInstancesBuffer(g.morphingGrid[1],u),C=i.a.Scale2D(e.contentSize),F.setFloat2("u_12",0,0);else{F.setInt("u_16",0),F.setFloat("u_17",0),t.setDummyPointerAttribute("a_0"),t.setDummyPointerAttribute("a_1");var O=w.size,I=w.center;A=i.a.ScaleTranslation2D(O,I.subtract(e.contentCenter)).multiply(i.a.Scale2D(e.contentSize.inverse()));var L=w.top-I.y,M=w.bottom-I.y,D=M-L;C=i.a.Scale2D(O).multiply(i.a.Translation2D(I.subtract(R))),F.setFloat2("u_12",x?M-D*x.y0:0,x?M-D*x.y1:0)}var k=y?A.multiply(d(y)):i.a.Identity,N=v?A.multiply(d(v)):i.a.Identity,G=i.a.RotationZ(e.contentRotation).multiply(i.a.Translation2D(R));n&&(G=G.multiply(n)),F.setMatrix3x3("u_0",C.m),F.setVector2("u_15",e.contentFlip),F.setMatrix3x3("u_1",G.m),F.setVector2("u_2",r),F.setMatrix3x3("u_3",k.m),F.setMatrix3x3("u_4",N.m),F.setInt("u_13",0),F.setInt("u_14",0),F.setFloat2("ufrag_12",x?x.opacity0:1,x?x.opacity1:1),F.setInt("ufrag_15",2),F.setInt("ufrag_10",2),F.setDirectColor4("ufrag_13",s||a.b.Transparent),F.setInt("ufrag_24",0),F.setInt("ufrag_25",0),F.setInt("ufrag_34",0),F.setInt("ufrag_35",0),F.setFloat("ufrag_36",T),t.setTexture("t_0",y?y.babylonTexture:void 0),t.setTexture("t_1",v?v.babylonTexture:void 0),t.setTexture("t_2",void 0),t.setTexture("t_3",e.fadeInfo&&e.fadeInfo.fadeTexture&&e.fadeInfo.fadeTexture.babylonTexture?e.fadeInfo.fadeTexture.babylonTexture:void 0),t.setTexture("t_4",void 0),t.setTexture("t_5",void 0),t.setTexture("t_6",void 0);var j=0;if(e.fadeInfo&&e.fadeInfo.fade){j=1;var U=e.fadeInfo.fade,W=U.reverse?1-U.progress:U.progress;F.setVector2("ufrag_17",U.getFadeScaleOffset(W,0)),0!=U.preset&&(e.fadeInfo.fadeTexture&&e.fadeInfo.fadeTexture.babylonTexture?(j=2,F.setMatrix3x3("u_10",13==U.preset?A.multiply(d(e.fadeInfo.fadeTexture)).m:k.multiply(U.getFadeTransform()).m)):o.a.Error(592525254,"fade texture missing"))}F.setInt("ufrag_16",j),F.setFloat("u_18",e.depthFar),F.setFloat("u_19",e.depthNear),t.setBlendingMode(0),e.customMesh?t.drawMesh(e.customMesh):t.drawQuads(1)}else o.a.Error(592525253,"Undefined physical bounds")}else o.a.Error(592525252,"No Texture")}},function(e,t,r){"use strict";r.d(t,"c",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"a",(function(){return c}));var n=r(0),i=r(2),a=r(4),o=function(){function e(e,t,r,n,i){this.renderDataMap={},this.contents=e,this.location=t,this.zPosition=r,this.parentTransform=i,this.morphingGrid=n}return e.prototype.clearCache=function(){for(var e in this.renderDataMap)this.renderDataMap[e].releaseGeneratedResources()},e.CreateFromItem=function(t,r,i,a,o,s){var c=n.a.FromTransforms(t.transform,s||n.a.Identity,t.animationTransform||n.a.Identity),u=c.transformVector(new n.d(1,0)),h=c.transformVector(new n.d(0,1)),l=i.transformedBounds(c);return new e([{item:t,includeSubtree:a,textRange:o}],{center:l?l.center:n.d.Zero,size:l?i.size.multiply(new n.d(u.length(),h.length())):n.d.Zero,rotation:t.transform.rotation,flipX:t.transform.scale.x<0,flipY:t.transform.scale.y<0},r,void 0,s)},e.TryCreateFromShape=function(t,r,n,i){var o=Object(a.i)(t,!1);return o?e.CreateFromItem(t,r,o,n,void 0,i):void 0},e.TryCreateFromText=function(t,r,a,o){if(t.text){var s=t.text.getFullRange(),c=a||s;if(s&&c&&s.contains(c)){var u=t.text.getBoundsOfRange(c);if(u){var h=u.transformedBounds(n.c.fromScaleAndTranslation(t.transform.scale.inverse(),t.transform.preTranslation.negate()));return h?e.CreateFromItem(t,r,h,!0,c,o):void 0}}else i.a.Error(592525387,"TryCreateFromText out of range: "+(a?(a.start,a.last,"]"):void 0)+" fullRange: "+(s?(s.start,s.last,"]"):"undefined"))}else i.a.Error(592525386,"TryCreateFromText on Shape with no Text")},e.TryCreateFromGroup=function(t,r,n,i){var o=Object(a.h)(t,!1,0,0,t.transform.toInverseMatrix3());return o?e.CreateFromItem(t,r,o,n,void 0,i):void 0},e}(),s=function(){function e(e){void 0===e&&(e=[]),this.renderDataMap={},this.keyFrames=e}return e.prototype.clearCache=function(){for(var e=0,t=this.keyFrames||[];e<t.length;e++){var r=t[e];r&&r.clearCache()}},e}(),c=function(){function e(){this.elements=[]}return e.prototype.clearCache=function(){this.elements.forEach((function(e){return e.clearCache()}))},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return _})),r.d(t,"g",(function(){return m})),r.d(t,"e",(function(){return y})),r.d(t,"h",(function(){return v})),r.d(t,"b",(function(){return E})),r.d(t,"f",(function(){return W})),r.d(t,"c",(function(){return V})),r.d(t,"d",(function(){return H}));var n=r(7),i=r(0),a=r(10),o=r(15),s=r(19),c=r(18),u=r(4),h=r(1),l=r(6),f=r(9),d=r(8),p=r(16),g=r(2),_=function(e){function t(t,r,n,o,s){void 0===n&&(n=1),void 0===o&&(o=0),void 0===s&&(s=0);var c=this,u=t,h=u.getGraphicsProcessor();if(!h)throw g.a.Error(591524386,"no graphicsProcessor");var l=a.a==a.f&&h.isFloatTextureSupported();return(c=e.call(this,t,i.d.Zero,!0,l)||this).m_renderer=u,c.pathIndexRange=r,c.fillMode=n,c.distRangeSize=0,c.contentQuality=0,c.enableMipMap=!1,c.mergeMode=0,c.distanceFieldMode=s,c}return Object(n.c)(t,e),t.prototype.refresh=function(e,t,r,n){if(!e.getGraphicsProcessor())throw g.a.Error(591524387,"Graphics processor not initialized");t instanceof u.d&&t.incrementalPath&&(this.contentBoundsOverride=t.incrementalPath.bounds);var i=this.getRequiredTextureSize(t,r),a=this.babylonTexture;return!!this.initTexture(e,i,this.hasAlpha,this.useFloat,void 0,void 0,!0)&&(n&&a!=this.babylonTexture?(g.a.Error(591524416,"Cannot update incrementally: texture had to be recreated"),!1):(i.isZero()||this.rasterize(t,r,n,e.getCurrentFramePerformanceSummary()),!0))},t.prototype.getQualityToUse=function(e){return this.contentBoundsOverride?1:e.hasSmallDetails()?2*d.e:d.e},t.prototype.getContentBounds=function(e){if(this.contentBoundsOverride)return this.contentBoundsOverride;var t=Object(u.i)(e,!0);return t?t.inflate(this.getPixelPadding()):void 0},t.prototype.getRequiredTextureSize=function(e,t){if(1!=e.getType())throw g.a.Error(591524417,"item not a shape");var r=e,n=this.getContentBounds(r);if(!n)return i.d.Zero;var a=n.size.multiply(r.transform.scale.abs()),o=this.getQualityToUse(r),s=new i.d(Math.ceil(a.x*o),Math.ceil(a.y*o));return this.enableMipMap&&(s=new i.d(Object(i.g)(s.x),Object(i.g)(s.y))),new i.d(Object(i.e)(s.x,16,d.d),Object(i.e)(s.y,16,d.d))},t.prototype.getFillBrightness=function(){return 2==this.fillMode?.4:3==this.fillMode?.2:4==this.fillMode?-.4:5==this.fillMode?-.2:0},t.prototype.getPixelPadding=function(){return 4},t.prototype.rasterize=function(e,t,r,n){if(!this.graphicsProcessor)throw g.a.Error(591524418,"No gl context");if(1!=e.getType())throw g.a.Error(591524419,"item not a shape");var o=e,s=this.getContentBounds(o),c=Object(u.i)(o,!1);if(!s||!c)return g.a.Error(591524420,"Nothing to render"),!1;this.localBounds=s;var p=this.getPixelPadding(),_=this.getQualityToUse(o),m=s.size.multiply(o.transform.scale.abs()),b=Math.min(Math.min(this.size.x-2*p,m.x*_)/m.x,Math.min(this.size.y-2*p,m.y*_)/m.y),y=m.scale(b);this.contentQuality=b,this.renderScale=y.divide(m.multiply(this.size)),this.uvScale=m.multiply(this.renderScale).multiply(o.transform.scale.sign());var T=this.size.scale(.5);if(this.m_contentLocation={logicalCenter:T.add(c.center.subtract(s.center).scale(b)),logicalSize:c.size.scale(b),physicalCenter:T,physicalSize:y,rotation:0,flipX:o.transform.scale.x<0,flipY:o.transform.scale.y<0},!this.localBounds||!this.renderScale)return g.a.Error(591524421,"no bounds or renderScale"),!1;n.pixelCountDistanceField+=Math.floor(this.size.x*this.size.y);var x=a.a==a.f,E=.5*(o.style.pen?o.style.pen.adjustedLineWidth*(1+Math.min(Math.abs(Object(u.k)(o)),1)):0);return o.distRangeSize=this.distRangeSize=x?Math.max(m.x/2,m.y/2):E+p/b,function(e,t,r,n,o,s,c,u,p,_,m){if(!n.distRangeSize)return g.a.Error(592525083,"distRangeSize not initialized"),!1;var b,y=_?void 0:h.b.Transparent;if(n.paths&&!n.incrementalPath)b=D(e,t,n.paths,n.style.hasLine?n.style.pen:void 0,!1,1!=p,2==p,o,m);else if(n.incrementalPath){var T=r.tag,x=T&&T.incrementalPathTrackerId==n.incrementalPath.changeTracker.trackerId;(!x||T&&(0==T.figureCount||1==T.figureCount&&0==T.lastFigurePointCount))&&(y=h.b.Transparent);for(var E=x&&T.figureCount>0?T.figureCount-1:0,P=[],S=E;S<n.incrementalPath.figures.length;S++){var w=n.incrementalPath.figures[S],R=x&&S==E&&T.lastFigurePointCount>0?T.lastFigurePointCount-1:0,C=w.getPointCount();P.push(new l.a(w.data.slice(R*n.incrementalPath.pointDataSize,C*n.incrementalPath.pointDataSize),!1,n.incrementalPath.format))}r.tag={incrementalPathTrackerId:n.incrementalPath.changeTracker.trackerId,figureCount:n.incrementalPath.figures.length,lastFigurePointCount:n.incrementalPath.figures.length>0?n.incrementalPath.figures[n.incrementalPath.figures.length-1].getPointCount():0},b=D(e,t,[new l.d({figures:P,fillMode:0})],n.style.hasLine?n.style.pen:void 0,!1,1!=p,2==p,o,m)}if(!b)return g.a.Error(592525084,"Nothing to render"),!1;var A=e.activateShaderProgram(0);A.begin(r.babylonTexture,y,!1);var F=A.getBabylonEffect();F.setVector2("u_0",s.center.multiply(n.transform.scale)),F.setVector2("u_1",n.transform.scale),F.setVector2("u_2",c),F.setFloat("u_3",n.distRangeSize),F.setFloat("ufrag_10",n.style&&n.style.pen?2*n.distRangeSize/(n.style.pen.adjustedLineWidthForArrowHead+1):0),F.setFloat("ufrag_11",n.transform.scale.x*n.transform.scale.y),F.setInt("ufrag_7",a.a),F.setInt("u_13",a.a),F.setInt("u_15",0==n.style.pen.compoundType?0:1),F.setVector2("u_17",n.style.pen.tipScale?n.style.pen.tipScale:i.d.One),F.setInt("u_18",n.style.pen.tipType?n.style.pen.tipType:0);var B=(n.style.pen.adjustedLineWidth/2+1/r.contentQuality)/(2*n.distRangeSize);F.setFloat("ufrag_15",0==n.style.pen.alignment?B:2*B);for(var O=0,I=b.transformedPaths;O<I.length;O++){var G=I[O],U=L(u);if(U)for(var W=U.start;W<=U.last;W++)M(W,!0,G,u,m)&&(N(A,W,!0,n),2==W?A.drawQuads(1):j(A,W,!0,n,[G],u,p,m,t.getCurrentFramePerformanceSummary()))}var V=function(e){return 1==e?f.j.FromFirstLast(0,0):f.j.FromFirstLast(0,a.a==a.d||a.a==a.h?0:2)}(u);if(V)for(W=V.start;W<=V.last;W++)N(A,W,!1,n),2==W?A.drawQuads(1):j(A,W,!1,n,b.transformedPaths,u,p,m,t.getCurrentFramePerformanceSummary());if(A.end(),d.k&&v&&b.cachedGlyphsPages.length>0){var z=e.activateShaderProgram(5);if(z.begin(r.babylonTexture,void 0,!1),k(z,0,0),r.localBounds&&r.uvScale)for(var H=0,X=b.cachedGlyphsPages;H<X.length;H++){var q=X[H];if(q.cachedGlyphInstances.length>0){for(var Y=new Array(q.cachedGlyphInstances.length),K=new Array(q.cachedGlyphInstances.length),Q=0;Q<q.cachedGlyphInstances.length;Q++){var Z=q.cachedGlyphInstances[Q];Y[Q]=Z.srcRect,K[Q]=Z.dstRect.translate(r.localBounds.center.negate()).multiply(r.size.multiply(r.uvScale).multiply(r.localBounds.size.inverse())).translate(r.size.scale(.5))}Object(d.f)(e,z,v[q.page],Y,K,r.size,v[q.page].distRangeSize/r.distRangeSize*(q.cachedGlyphInstances[0].dstRect.size.y/q.cachedGlyphInstances[0].srcRect.size.y))}}z.end()}return!0}(this.graphicsProcessor,this.m_renderer,this,o,this.pathIndexRange,this.localBounds,this.renderScale,this.mergeMode,this.distanceFieldMode,r,1==this.generateDrawFadeMask)&&(this.geometryVersion=o.geometryTracker.version,this.enableMipMap&&this.generateMipMap()),!1},t}(d.a),m=!1;function b(e){return e?e.fontId+":"+e.glyphId:void 0}function y(e){var t=b(e);if(t){var r=T[t];if(r)return r.page}}var v,T={},x=[];function E(){T={},x=[],v=void 0}var P=4096,S=1024,w=16,R=S/w,C=7*R/8,A=R/16,F=w*w,B=C/P,O=[{attributeName:"a_p0",attributeSize:4,offset:0},{attributeName:"a_p1",attributeSize:4,offset:16},{attributeName:"a_p2",attributeSize:4,offset:32},{attributeName:"a_p3",attributeSize:4,offset:48},{attributeName:"a_p4",attributeSize:4,offset:64}],I=[{attributeName:"a_d1",attributeSize:1,offset:4},{attributeName:"a_d2",attributeSize:1,offset:8}];function L(e){if(1==e)return f.j.FromFirstLast(0,3)}function M(e,t,r,n,i){return!(i&&0!=e||1!=n&&t||0!=e&&0==r.fillMode)}function D(e,t,r,n,a,c,u,h,f){var _=Object(p.b)(),m=[],y=[];if(0==r.length)return{transformedPaths:m,cachedGlyphsPages:y};h&&(h.start<0||h.last>=r.length)&&g.a.Error(592525078,"pathIndexRange out of range");for(var x=h?Math.max(h.start,0):0,E=h?Math.min(h.last,r.length-1):r.length-1,P=n&&(G(n.headEnd,n.adjustedLineWidthForArrowHead)>0||G(n.tailEnd,n.adjustedLineWidthForArrowHead)>0),w=f||!!n&&0!=n.dashType||P,R=d.k&&!n,C=function(h){var f=r[h];f.glyphCacheId?t.getCurrentFramePerformanceSummary().glyphCount++:t.getCurrentFramePerformanceSummary().pathCount++;var d=t.ensurePathRenderData(f);d.refreshCachedHwTapeBuffers(f,e);var p=!1,x=b(f.glyphCacheId);if(x&&R&&v&&0==f.transform.rotation&&Math.abs(f.transform.scale.x-f.transform.scale.y)<i.f&&f.transform.scale.x<B&&T[x]){var E=T[x];if(E.page<0||E.page>=v.length)g.a.Error(592525079,"Invalid glyph page");else{var P=v[E.page],C=P.localBounds?P.localBounds.center:void 0,A=P.localBounds&&C&&P.uvScale?P.localBounds.translate(C.negate()).multiply(P.uvScale.inverse()).translate(C):void 0,F=P.localBounds&&A&&P.uvScale?E.bounds.multiply(P.uvScale).translate(A.leftTop.negate()):void 0,O=E.bounds.translate(E.offset.negate()).multiply(new i.d(1/E.scale,1/E.scale)).transformedBounds(f.transform);if(F)if(O)if(F.right<0||F.bottom<0||F.left>=S||F.top>=S)g.a.Error(592525082,"Cached glyph src rect out of bounds");else{for(var I={srcRect:F,dstRect:O,distanceScale:1},L=void 0,M=0;M<y.length&&!L;M++)y[M].page==E.page&&(L=y[M]);L||(L={page:E.page,cachedGlyphInstances:[]},y.push(L)),L.cachedGlyphInstances.push(I),p=!0}else g.a.Error(592525081,"Cached glyph dst rect undefined");else g.a.Error(592525080,"Cached glyph src rect undefined")}}if(!p){var D=d.tapeBuffers,k=void 0,N=0;if(!D||w||a)if(w||a){var G=Object(s.a)(f,_,a,w,w?f.transform.scale:void 0);D=G.buffers,k=G.distanceBuffers,N=G.endDistance}else D=d.refreshCachedTapeBuffers(f);var j=e.getBabylonEngine(),U=d.hwTapeBuffers;U||(U=D.map((function(e){return j.createVertexBuffer(e)})));var W=void 0;k&&(W=k.map((function(e){return j.createVertexBuffer(e)})));var V=f.transform.toMatrix3(),z={tapeBuffers:D,hwTapeBuffers:U,hwDistanceBuffers:W,fillMode:u?0:f.fillMode,lineEnabled:c&&f.lineEnabled,isArrowHead:!1,transform:V,startDistance:0,endDistance:N};if(m.push(z),u&&n&&(0!=n.headEnd.end||0!=n.tailEnd.end))for(var H=n.adjustedLineWidthForArrowHead,X=0,q=f.figures;X<q.length;X++){var Y=q[X],K=Y.isClosed||Y.isLastPointDuplicated();if(n.headEnd&&0!=n.headEnd.end&&!K){var Q=Object(o.a)(n.headEnd,H);if(Q){var Z=Object(o.c)(Y,!1,n.headEnd,H,V),J=Object(s.a)(l.d.CreateFromFigure(Q),_).buffers;m.push({tapeBuffers:J,hwTapeBuffers:J.map((function(e){return j.createVertexBuffer(e)})),hwDistanceBuffers:void 0,fillMode:5==n.headEnd.end?0:1,lineEnabled:!0,isArrowHead:!0,transform:Z,startDistance:0,endDistance:0})}}if(n.tailEnd&&0!=n.tailEnd.end&&!K){var $=Object(o.a)(n.tailEnd,H);if($){var ee=Object(o.c)(Y,!0,n.tailEnd,H,V),te=Object(s.a)(l.d.CreateFromFigure($),_).buffers;m.push({tapeBuffers:te,hwTapeBuffers:te.map((function(e){return j.createVertexBuffer(e)})),hwDistanceBuffers:void 0,fillMode:5==n.tailEnd.end?0:1,lineEnabled:!0,isArrowHead:!0,transform:ee,startDistance:0,endDistance:0})}}}}},A=x;A<=E;A++)C(A);return{transformedPaths:m,cachedGlyphsPages:y}}function k(e,t,r){var n=e.getBabylonEngine();0==t?(n.setColorWrite(!0),n.depthCullingState.depthMask=!0,n.stencilState.stencilTest=!1,n.stencilState.stencilMask=255,n.stencilState.stencilFunc=519,n.stencilState.stencilFuncRef=0,n.stencilState.stencilFuncMask=3,n.alphaState.alphaBlend=!0,n.alphaState.setAlphaBlendFunctionParameters(1,1,1,1),n.alphaState.setAlphaEquationParameters(32776,32776),n.clear(null,!1,!1,!0)):1==t?(n.setColorWrite(!1),n.depthCullingState.depthMask=!1,n.stencilState.stencilTest=!0,n.stencilState.stencilMask=255,n.stencilState.stencilFunc=519,n.stencilState.stencilFuncRef=1,n.stencilState.stencilFuncMask=255):(n.setColorWrite(!0),n.depthCullingState.depthMask=!0,n.stencilState.stencilMask=0,2==t?(n.stencilState.stencilTest=!0,n.stencilState.stencilFunc=517,n.stencilState.stencilFuncRef=0,n.stencilState.stencilFuncMask=1==r?255:3,n.alphaState.alphaBlend=!0,n.alphaState.setAlphaBlendFunctionParameters(775,769,773,771),n.alphaState.setAlphaEquationParameters(32774,32774)):3==t&&(n.stencilState.stencilTest=!1,n.alphaState.alphaBlend=!0,n.alphaState.setAlphaBlendFunctionParameters(772,1,0,0),n.alphaState.setAlphaEquationParameters(32774,32774)))}function N(e,t,r,n){var i=r&&!(3==t);k(e,t,n.overlapMode);var a=e.getBabylonEffect();a.setInt("u_7",t),a.setInt("ufrag_0",t),a.setFloat("ufrag_8",i?1:0);var o=0,s=z(n);if(s&&s.length>0)for(var c=0;c<s.length;c++)o+=s[c];0==o&&(o=1),a.setFloat("ufrag_4",s&&s.length>0?Math.max(n.transform.scale.x,n.transform.scale.y)/(o*(n.style.pen?n.style.pen.adjustedLineWidth:0)):0);var u=0==n.style.pen.headEnd.cap?1:0;a.setFloat("ufrag_5",s&&s.length>0?.5-(s[0]-u)/(2*o):0)}function G(e,t){return e?0==e.end||4==e.end||3==e.end?0:5==e.end||2==e.end?t*Object(o.b)(e.length,e.end)/Object(o.d)(e.width,e.end):2*t:0}function j(e,t,r,n,o,s,c,u,h){if(0!=t||a.a!=a.e){var l=-performance.now(),f=e.getBabylonEffect(),d=e.getBabylonEngine();f.setFloat("u_12",n.style.pen.adjustedLineWidth),f.setFloat("u_5",n.style.pen.miterLimit);var p=0,g=z(n),_=g?g.length:0;if(n.style.pen&&g){for(var m=0;m<_;m++)p+=g[m];p=p>0?p:1,f.setFloat("ufrag_12",p/2),f.setFloat4("ufrag_13",_>=2?g[0]/2:p,_>=3?g[0]/2+g[1]:p,_>=4?g[0]/2+g[1]+g[2]:p,_>=5?g[0]/2+g[1]+g[2]+g[3]:p)}else f.setFloat("ufrag_12",.5),f.setFloat4("ufrag_13",1,1,1,1);f.setFloat("u_14",o.length>0&&o[0].isArrowHead||0==n.style.pen.headEnd.cap?1:0);for(var b=0,y=o;b<y.length;b++){var v=y[b];if(M(t,r,v,s,u)){var T=(0!=v.fillMode||2==c)&&2==c==v.isArrowHead&&(0==s||1==s&&r),x=v.lineEnabled&&!v.isArrowHead,E=v.isArrowHead&&0==v.fillMode,P=E?x:T,S=E?T:x;f.setMatrix3x3("u_8",v.transform?v.transform.m:i.a.Identity.m),f.setInt("ufrag_17",u?1:0),u&&f.setFloat("ufrag_12",1/v.endDistance),f.setFloat("ufrag_19",v.isArrowHead&&0==v.fillMode&&n.distRangeSize?n.style.pen.adjustedLineWidth/4/n.distRangeSize:0);var w=o.length>0&&v.isArrowHead?1:n.style.pen?n.style.pen.lineJoin:0;for(f.setInt("u_4",w),f.setInt("ufrag_1",w),m=0;m<v.tapeBuffers.length;m++){var R=v.tapeBuffers[m],C=v.hwTapeBuffers[m],A=v.hwDistanceBuffers?v.hwDistanceBuffers[m]:void 0,F=R.length/4-4;if(d.bindInstancesBuffer(C,O,!1),A?(f.setInt("u_19",0),d.bindInstancesBuffer(A,I,!1)):(f.setInt("u_19",1),e.setDummyPointerAttribute("a_d1"),e.setDummyPointerAttribute("a_d2")),0==R[2]&&v.startDistance!=v.endDistance){var B=G(n.style.pen.headEnd,n.style.pen.adjustedLineWidthForArrowHead),L=G(n.style.pen.tailEnd,n.style.pen.adjustedLineWidthForArrowHead);f.setFloat2("ufrag_16",v.startDistance+B,v.endDistance-L)}else f.setFloat2("ufrag_16",0,0);f.setFloat("ufrag_2",P?1:0),f.setFloat("ufrag_3",S?1:0),f.setFloat("ufrag_18",E?1:0),1==t?(f.setFloat("ufrag_6",1),e.setDistanceFieldStencilSumIncrement(!0),e.drawQuadInstances(F),f.setFloat("ufrag_6",-1),e.setDistanceFieldStencilSumIncrement(!1),e.drawQuadInstances(F)):e.drawQuadInstances(F)}}}e.disableInstanceAttribute("a_p0"),e.disableInstanceAttribute("a_p1"),e.disableInstanceAttribute("a_p2"),e.disableInstanceAttribute("a_p3"),e.disableInstanceAttribute("a_p4"),e.disableInstanceAttribute("a_d1"),e.disableInstanceAttribute("a_d2"),l+=performance.now(),h.drawTapeCostMs+=l}}function U(e,t,r,n){for(var i=[],a=0,o=x[t];a<o.length;a++){var s=o[a];n&&s.ready||(i.push(s.path),s.ready=!0)}if(i.length>0){var c=new u.d(i);return c.style.pen.lineWidth=A,r.refresh(e,c,!0,n)}return!0}function W(e,t){if(d.k&&e.getGraphicsProcessor()){var r=performance.now(),n=v;v=void 0,n||(n=[]),Object(u.e)(t,(function(e){return function(e){var t=b(e.glyphCacheId);if(t&&null==T[t]){var r=new l.d(e,i.c.Identity),n=Object(c.c)([r]);if(n){0!=x.length&&x[x.length-1].length!=F||x.push([]);var a=x.length-1,o=x[a],s=n.size,u=C/Math.max(P,Math.max(s.x,s.y)),h=new i.d(u,u),f=o.length,d=.5+f%w,p=.5+(f-d)/w,g=n.center.scale(-u).add(new i.d(d*R,p*R)),_=i.c.fromScaleAndTranslation(h,g),m={page:a,scale:u,offset:g,bounds:n.multiply(h).translate(g).inflate(A),path:new l.d(r,_),ready:!1};o.push(m),T[t]=m}}}(e),!0}));for(var a=0;a<x.length;a++){var o=!0,s=a<n.length?n[a]:void 0;if(s)s.isValid(e)||(g.a.Error(592525085,"invalid glyph table texture. recreating."),o=!1);else{for(;n.length<a+1;)n.push(new _(e));(s=n[a]).contentBoundsOverride=new i.b(0,0,S,S),o=!1}var h=!1;o&&(h=U(e,a,s,!0)),h||U(e,a,s,!1)}v=n,e.getCurrentFramePerformanceSummary().distanceFieldForGlyphTableCostMs+=performance.now()-r}}function V(e,t){var r=e.activateShaderProgram(5);if(r.begin(void 0,void 0,!1),v&&v.length>0){var n=v[0];Object(d.f)(e,r,n,[new i.b(0,0,S,S)],[new i.b(0,0,.25*S,.25*S)],t)}r.end()}function z(e){if(e.style.pen&&(!e.style.pen.tipType||0==e.style.pen.tipType))return e.style.pen.dashType>=0&&e.style.pen.dashType<X.length?X[e.style.pen.dashType]:void g.a.Error(591192836,"unsupported dashType")}function H(e){return!e.style.pen||!e.style.pen.compoundType||e.style.pen.tipType&&0!=e.style.pen.tipType?q[0]:e.style.pen.compoundType>=0&&e.style.pen.compoundType<q.length?q[e.style.pen.compoundType]:(g.a.Error(591192837,"unsupported compoundType"),q[0])}var X=[null,new Float32Array([3,1]),new Float32Array([1,1]),new Float32Array([3,1,1,1]),new Float32Array([3,1,1,1,1,1]),new Float32Array([1,3]),new Float32Array([4,3]),new Float32Array([8,3]),new Float32Array([4,3,1,3]),new Float32Array([8,3,1,3]),new Float32Array([8,3,1,3,1,3])],q=[{centers:new Float32Array([0,0,0]),slopes:new Float32Array([1,1,1])},{centers:new Float32Array([-2/3,2/3,2/3]),slopes:new Float32Array([3,3,3])},{centers:new Float32Array([-.4,.8,.8]),slopes:new Float32Array([5/3,5,5])},{centers:new Float32Array([-.8,.4,.4]),slopes:new Float32Array([5,5/3,5/3])},{centers:new Float32Array([-5/6,0,5/6]),slopes:new Float32Array([6,3,6])}]},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"d",(function(){return s})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return u}));var n=r(0),i=r(2),a=r(6);function o(e,t){var r,o=new n.d(t*s(e.width,e.end),t*c(e.length,e.end));if(1==e.end||5==e.end)r=new a.a([-.5*o.x,-1*o.y,1,0,0,1,.5*o.x,-1*o.y,1],1==e.end);else if(2==e.end)r=new a.a([-.5*o.x,-1*o.y,1,0,0,1,.5*o.x,-1*o.y,1,0,-.5*o.y,1],!0);else if(3==e.end)r=new a.a([0,.5*o.y,1,.5*o.x,0,1,0,-.5*o.y,1,-.5*o.x,0,1],!0);else if(4==e.end){var u=new a.b;u.moveTo(.5*o.x,0),u.arcTo(.5*o.x,.5*o.y,0,2*Math.PI),u.close(),r=u.createFigure()}return r||i.a.Error(592525391,"bad arrow head"),r}function s(e,t){return 0==e?5==t?2.5:2:1==e?5==t?3.5:3:2==e?5:(i.a.Error(592525392,"bad arrow head"),0)}function c(e,t){return 0==e?2:1==e?3:2==e?5==t?4.5:5:(i.a.Error(592525393,"bad arrow head"),0)}function u(e,t,r,i,a){var o=(3==r.end||4==r.end?.5:1)*c(r.length,r.end)*i,s=(t?e.getPoint(e.getPointCount()-1):e.getPoint(0)).transformPoint(a),u=e.getPointFromDist(o,a,t),h=s.subtract(u).normalized();if(h){var l=new n.d(-h.y,h.x);return new n.a(l.x,l.y,0,h.x,h.y,0,0,0,1).multiply(n.a.Translation2D(s))}}},function(e,t,r){"use strict";r.d(t,"b",(function(){return a})),r.d(t,"a",(function(){return o}));var n=r(0),i=1024;function a(){return 4*i}var o=function(){function e(e,t,r,n){this.triangleCount=t,this.vertexBuffer=r,this.indexBuffer=n,this.m_engine=e.getBabylonEngine(),this.m_compatibleGraphicsProcessorId=e.getUniqueGraphicsProcessorId()}return e.prototype.isValid=function(e){return this.m_compatibleGraphicsProcessorId==e.getUniqueGraphicsProcessorId()},e.prototype.discard=function(){this.m_engine._releaseBuffer(this.vertexBuffer),this.m_engine._releaseBuffer(this.indexBuffer)},e.CreateGridXY=function(t,r,i){for(var a=new Float32Array(r.x*r.y*2),o=0;o<r.y;o++)for(var s=Object(n.k)(i.top,i.bottom,o/(r.y-1)),c=0;c<r.x;c++)a[h=2*(c+o*r.x)]=Object(n.k)(i.left,i.right,c/(r.x-1)),a[h+1]=s;var u=new Uint16Array((r.x-1)*(r.y-1)*2*3);for(o=0;o<r.y-1;o++)for(c=0;c<r.x-1;c++){var h;u[h=6*(c+o*(r.x-1))]=c+o*r.x,u[h+1]=c+1+o*r.x,u[h+2]=c+(o+1)*r.x,u[h+3]=c+1+(o+1)*r.x,u[h+4]=c+(o+1)*r.x,u[h+5]=c+1+o*r.x}var l=t.getBabylonEngine();return new e(t,(r.x-1)*(r.y-1)*2,l.createVertexBuffer(a),l.createIndexBuffer(u))},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return u})),r.d(t,"j",(function(){return h})),r.d(t,"h",(function(){return l})),r.d(t,"k",(function(){return f})),r.d(t,"f",(function(){return p})),r.d(t,"g",(function(){return g})),r.d(t,"d",(function(){return _})),r.d(t,"b",(function(){return b})),r.d(t,"o",(function(){return y})),r.d(t,"q",(function(){return v})),r.d(t,"p",(function(){return T})),r.d(t,"n",(function(){return x})),r.d(t,"m",(function(){return E})),r.d(t,"u",(function(){return P})),r.d(t,"e",(function(){return S})),r.d(t,"x",(function(){return w})),r.d(t,"y",(function(){return R})),r.d(t,"l",(function(){return C})),r.d(t,"v",(function(){return A})),r.d(t,"w",(function(){return F})),r.d(t,"s",(function(){return B})),r.d(t,"r",(function(){return O})),r.d(t,"c",(function(){return I})),r.d(t,"t",(function(){return L})),r.d(t,"i",(function(){return D}));var n=r(7),i=r(0),a=r(9),o=r(4),s=r(1),c=r(6),u=function(){function e(){}return e.prototype.getDebugStringForItem=function(e,t){return h(e,0,t)},e.prototype.getDebugStringForMorph=function(e,t){return D(e,t)},e}();function h(e,t,r){for(var n="",i=l(e,!0,r),a=0;a<i.length;a++)n+=" ".repeat(t+(0==a?0:2))+i[a]+"\n";if(e instanceof o.b)for(var s=0,c=e.items.elements;s<c.length;s++)n+=h(c[s],t+1,r);return n}function l(e,t,r){if(e instanceof o.d){var a=1==e.role?" background":2==e.role?" title Placeholder":3==e.role?" text":"",s=void 0;if(e.isSolidRect())s=[" Solid rect"];else if(e.isSolidRectGeometry())s=[" Rect with line"];else if(s=[e.paths?""+_(e.paths.length,"path"):" no paths!"],t&&e.paths instanceof Array)for(var c=0,u=e.paths;c<u.length;c++){for(var h=u[c],l=[" "," "," "," "],d=0,g=h.figures;d<g.length;d++)p(g[d],l,8);if(h.glyphCacheId&&r){var m=r.getDebugGlyphCacheInfo(h.glyphCacheId);s.push(" Font:"+h.glyphCacheId.fontId+", Glyph: "+h.glyphCacheId.glyphId+m==void 0?"Not cached":"Cached on page "+m)}s.push.apply(s,l)}var y=e.getBounds()?B(e.getBounds()||i.b.Zero):"undefined:",v=Object(n.e)(["Shape"+a+", Bounds: "+y+(e.textRange?", TextRange: "+O(e.textRange):"")],s,[" Transform: "+F(e.transform)," Style: "+P(e.style,r)]);return(e.effects.glow||e.effects.shadow||e.effects.innerShadow||e.effects.reflection||e.effects.softEdges)&&v.push(" Effects: "+S(e.effects)),e.text&&v.push.apply(v,f(e.text,r)),v}return e instanceof o.b?(y=e.getBounds()?B(e.getBounds()||i.b.Zero):"undefined:",v=["Group: "+_(e.items.length,"item")+", Bounds: "+y," Transform: "+F(e.transform)],(e.effects.glow||e.effects.shadow||e.effects.innerShadow||e.effects.reflection||e.effects.softEdges)&&v.push(" Effects: "+S(e.effects)),e.groupFillBrush&&v.push(" Group Fill: "+b(e.groupFillBrush,r)),v):["Unknown"]}function f(e,t){var r=[" Text "+_(e.paragraphs.length,"paragraph")];r.push(" LayoutToFrame: "+F(e.layoutToFrame)),r.push(" FrameToShape:  "+F(e.frameToShape));for(var n=0;n<e.paragraphs.length;n++){var i=e.paragraphs[n];r.push("  Paragraph "+n+(i.bullet?" (with bullet)":" ")+"globalRange: "+O(i.globalRange)+", "+i.globalRange.length+" characters");var o=i.stylePerLocalRange.dataPerRange,s=i.effectsPerLocalRange.dataPerRange,u=i.strokesPerLocalRange.dataPerRange;if(o){for(var h="",l=0;l<o.length;l++)h+=(0==l?"":", ")+O(o[l].range)+"("+P(o[l].data,t)+")";r.push("   Styles:  "+h)}if(s){var f="";for(l=0;l<s.length;l++)f+=(0==l?"":", ")+O(s[l].range)+"("+S(s[l].data)+")";r.push("   Effects: "+f)}if(u){var d="";for(l=0;l<u.length;l++)d+=(0==l?"":", ")+O(u[l].range)+"("+L(u[l].data)+")";r.push("   Stokes:  "+d)}for(var p=0;p<i.lines.length;p++){var g=i.lines[p];r.push("   Line "+p+" localRange:"+O(g.localRange)+", bounds:"+B(g.layoutBounds));for(var m="     Paths/Char: ",b=0,y=g.characters;b<y.length;b++){var v=y[b];m+=v.textImage?"":v.paths instanceof c.d?"":v.paths?0==v.paths.length?"":v.paths.length>9?"+":v.paths.length:""}r.push(m),g.bender instanceof a.o?r.push("    Warping Source Bounds "+B(g.bender.sourceRect)):g.bender instanceof a.a&&r.push("    Pathing Source Bounds "+B(g.bender.lineRect))}}return r}var d=" ";function p(e,t,r){var n=new i.d(2*r,2*t.length),a=new Array(n.x*n.y).fill(!1),o=function(e,t){e[Object(i.e)(Math.floor(t.x),0,n.x-1)+Object(i.e)(Math.floor(t.y),0,n.y-1)*n.x]=!0},s=Object(c.e)([e]);s&&n.x>0&&e.forEachSegment((function(e,t,r){for(var s=0;s<=1;s+=1/n.x)o(a,t?i.d.InterpolateQuadratic(e,t,r,s):i.d.InterpolateLinear(e,r,s));return!0}),new i.c(s.leftTop.negate(),n.scale(1/Math.max(s.size.x,s.size.y))));for(var u=0;u<t.length;u++)for(var h=0;h<r;h++){var l=2*h+2*u*n.x;t[u]=t[u]+d[(a[l]?1:0)+(a[l+1]?2:0)+(a[l+n.x]?4:0)+(a[l+1+n.x]?8:0)]+(h==r-1?"  ":"")}}function g(e,t,r,n){void 0===n&&(n=i.a.Identity);var a=new i.d(2*r,2*t.length),s=new Array(a.x*a.y).fill(!1),c=function(e,t){e[Object(i.e)(Math.floor(t.x),0,a.x-1)+Object(i.e)(Math.floor(t.y),0,a.y-1)*a.x]=!0},u=Object(o.i)(e,!1,n);if(u&&a.x>0)for(var h=0,l=e.paths||[];h<l.length;h++)for(var f=l[h],p=0,g=f.figures;p<g.length;p++)g[p].forEachSegment((function(e,t,r){for(var n=0;n<=1;n+=1/a.x)c(s,t?i.d.InterpolateQuadratic(e,t,r,n):i.d.InterpolateLinear(e,r,n));return!0}),i.a.FromTransforms(f.transform,n,new i.c(u.leftTop.negate(),a.scale(1/Math.max(u.size.x,u.size.y)))));for(var _=0;_<t.length;_++)for(var m=0;m<r;m++){var b=2*m+2*_*a.x;t[_]=t[_]+d[(s[b]?1:0)+(s[b+1]?2:0)+(s[b+a.x]?4:0)+(s[b+1+a.x]?8:0)]+(m==r-1?"  ":"")}}function _(e,t){return e+" "+(e>1?t+"s":t)}function m(e){var t=Math.round(1e4*e)/1e4;return e!=t?t+"":t}function b(e,t){if(e instanceof s.j)return I(e.color);if(e instanceof s.c)return" Gradient";if(e instanceof s.e){var r=" ImageBrush(";if(e.image){if(e.image.id&&(r+="id:"+e.image.id),t){var n=t.tryGetImageDebugData(e.image);if(n){var i=n.getState(),a=n.getSize();r+=0==i?"uninitialized":2==i?"deleted":a?a.x+"x"+a.y:"no texture + bad state"}}}else r+="no image";return r+")"}return e instanceof s.g?" Pattern":e instanceof s.k?8==e.getType()?"Background":9==e.getType()?"Group":" Unknown Custom":" Unknown Brush"}function y(e){switch(e){case 5:return">";case 3:return"";case 0:return"";case 4:return"";case 2:return"";case 1:return""}}function v(e,t){var r="";switch(e){case 5:r+="<";break;case 3:r+="";break;case 0:r+="";break;case 4:r+="";break;case 2:r+="";break;case 1:r+=""}switch(r+="",t){case 5:r+=">";break;case 3:r+="";break;case 0:r+="";break;case 4:r+="";break;case 2:r+="";break;case 1:r+=""}return r}function T(e){switch(e){case 1:return"medium";case 0:return"narrow";case 2:return"wide"}}function x(e){switch(e){case 2:return"long";case 1:return"medium";case 0:return"short"}}function E(e){var t="(";return 0!=e.cap&&(t+=(1==e.cap?"square":"flat")+"cap"),t+=", "+T(e.width),(t+=", "+x(e.length))+")"}function P(e,t){var r=(e.fillBrush?b(e.fillBrush,t):"No ")+" fill";return e.pictureBrush&&(r+=" +  picture"),e.lineBrush&&(r+=", "+b(e.lineBrush,t)+" line, width="+m(e.pen.lineWidth),e.pen.lineHeight!=e.pen.lineWidth&&(r+=", height="+m(e.pen.lineHeight)),1==e.pen.tipType?r+=",  Square Tip":0==e.pen.tipType&&(r+=",  Ball Tip"),0==e.pen.headEnd.end&&0==e.pen.tailEnd.end||(r+=", LineEnd ("+v(e.pen.headEnd.end,e.pen.tailEnd.end),0!=e.pen.headEnd.end&&(r+=" head "+E(e.pen.headEnd)),0!=e.pen.tailEnd.end&&(r+=" tail "+E(e.pen.tailEnd)),r+=")")),0!=e.blendingMode&&(r+=", blendingMode: "+(3==e.blendingMode?"cutout":1==e.blendingMode?"darken":2==e.blendingMode?"exclusion":" unknown")),r}function S(e){return(e.glow?"Glow ":"")+(e.shadow?"Shadow ":"")+(e.innerShadow?"InnerShadow ":"")+(e.reflection?"Reflection ":"")+(e.softEdges?"SoftEdges ":"")}function w(e){return"("+m(e.x)+", "+m(e.y)+")"}function R(e,t){var r=Math.round(10*e.x)/10,n=Math.round(10*(t?e.y:-e.y))/10;return(n<0?r<0?"":0==r?"":"":0==n?r<0?"":0==r?"":"":r<0?"":0==r?"":"")+w(e)}function C(e){return"[["+e.m[0]+", "+e.m[1]+", "+e.m[2]+"], ["+e.m[3]+", "+e.m[4]+", "+e.m[5]+"], ["+e.m[6]+", "+e.m[7]+", "+e.m[8]+"]]"}function A(e){var t=[];return 0!=e.preTranslation.x&&0!=e.preTranslation.y&&t.push("PreTranslation "+R(e.preTranslation,!0)),1!=e.scale.x&&1!=e.scale.y&&t.push("Scale x"+w(e.scale)),0!=e.rotation&&t.push("Rotation "+(e.rotation>0?"":"")+Math.round(180*e.rotation/Math.PI)+""),0!=e.translation.x&&0!=e.translation.y&&t.push("Translation "+R(e.translation,!0)),0==t.length&&t.push("No Transform"),t}function F(e){var t="";return 0!=e.preTranslation.x&&0!=e.preTranslation.y&&(t+="PreTranslation "+R(e.preTranslation,!0)),1!=e.scale.x&&1!=e.scale.y&&(t+=", Scale x"+w(e.scale)),0!=e.rotation&&(t+=", Rotation "+(e.rotation>0?"":"")+Math.round(180*e.rotation/Math.PI)+""),t+", Translation "+R(e.translation,!0)}function B(e){return"[("+m(e.left)+", "+m(e.top)+"), ("+m(e.right)+", "+m(e.bottom)+")]"}function O(e){return 0==e.length?"]"+e.start+"[":1==e.length?"["+e.start+"]":e.length>1?"["+e.start+"-"+e.last+"]":"invalid(start="+e.start+", length="+e.length+")"}function I(e,t){void 0===t&&(t=!1);var r=function(e){var t=Math.floor(255*e);return t<10?"0"+t:t.toString(16)};if(t)return"#"+r(e.r)+r(e.g)+r(e.b);var n="#"+r(e.r)+r(e.g)+r(e.b)+r(e.a);switch(n){case"#00000000":return"Transparent";case"#000000ff":return"Black";case"#ffffffff":return"White";case"#ff0000ff":return"Red";case"fffff00ff":return"Yellow";case"#00ff00ff":return"Green";case"#0000ffff":return"Blue"}return n}function L(e){var t="";if(e.elements)for(var r=0;r<e.elements.length;r++)switch(t+=0==r?"":", ",e.elements[r].type){case 0:t+="";break;case 1:t+="-";break;case 2:t+="=";break;default:t+="~"}return t}function M(e,t,r,n){var a=new Array(r);if(!e)return a.fill(" ".repeat(t)),a[Math.floor(r/2)]=" ".repeat(Math.floor((t-1)/2))+"",a[Math.floor(r/2)]+=" ".repeat(t-a[r/2].length),a;n?a=function(e,t,r,n){var i=new Array(r);if(i.fill(""),n){var a=n.tryGetImageDebugDataForMorphKeyFrame(e);if(a){var o=a.getSize();if(o){var s=a.tryConvertToBufferRGBA();if(s){for(var c=Math.max(o.x,o.y),u=Math.max(1,Math.floor(c/t)),h=Math.max(1,Math.floor(c/r)),l=1/(255*u*h),f=0;f<r;f++)for(var d=0;d<t;d++)if(d*u<o.x&&f*h<o.y){for(var p=0,g=0,_=0,m=0,b=0;b<h;b++)for(var y=0;y<u;y++){var v=4*(Math.min(d*u+y,o.x-1)+(S=o.y-1-Math.min(f*h+b,o.y-1))*o.x);p+=s[v]*l,g+=s[v+1]*l,_+=s[v+2]*l,m+=s[v+3]*l}var T=0==m?0:(.2126*p+.7152*g+.0722*_)/m;i[f]+=m<.1?"":" "[Math.max(0,Math.min(4,Math.floor(5*T)))]}else i[f]+=" ";var x=a.getLogicalCenter();if(x){var E=Math.floor(x.x/u),P=Math.floor(x.y/h);E>=0&&E<t&&P>=0&&P<r&&(i[P]=i[P].slice(0,E)+"X"+i[P].slice(E+1,i[P].length))}}else i[0]=" Failed to get bufffer"}else i[0]="No texture yet?"}for(var S=0;S<r;S++)i[S].length<t&&(i[S]+=" ".repeat(t-i[S].length)),i[S].length>t&&(i[S]=i[S].slice(0,t));return i}return i}(e,2*r,r,n):a.fill(" ".repeat(t));var s=[];if(0==e.contents.length)s.push(" KeyFrame has no content");else if(1==e.contents.length)if((T=e.contents[0]).item instanceof o.d){var c=void 0;if(T.textRange)s.push("TEXT Only: "+O(T.textRange)),T.item.text?c=new o.d(T.item.text.getTextPathsForRange(T.textRange)):s.push(" Shape has no text");else{s.push(T.includeSubtree?"SHAPE + Text":"SHAPE Only");var u=T.item.getBounds();s.push("Bounds:"+(u?B(u):" bad rect")),T.item.paths||s.push(" Shape has no path"),T.item.paths&&T.item.isSolidRectGeometry()?s.push("Rect Geometry"):c=T.item,s.push((T.item.style.fillBrush?b(T.item.style.fillBrush,n):"No ")+" fill"),T.item.style.pictureBrush&&s.push("+  picture"),T.item.style.lineBrush&&(s.push(b(T.item.style.lineBrush,n)+" line"),s.push("width = "+m(T.item.style.pen.lineWidth)))}if(c){var h=[" "," "," "," "," "," "],l=t-2*r-2;g(c,h,l,i.a.Scale2D(new i.d(2,l/h.length)));for(var f=0,d=h;f<d.length;f++){var p=d[f];s.push(p)}}}else T.item instanceof o.b&&(s.push(T.textRange?" Group with TextRange ?!":T.includeSubtree?"Group + Subtree":"Group Effects Only"),s.push(function e(t){for(var r="",n=0,i=t.items.elements;n<i.length;n++){var a=i[n];r+=a instanceof o.b?"G("+e(a)+")":a instanceof o.d?"S":""}return r}(T.item)),u=T.item.getBounds(),s.push("Bounds:"+(u?B(u):" bad rect")));else{s.push(_(e.contents.length,"content"));for(var y="",v=0;v<e.contents.length;v++){var T;(T=e.contents[v]).item instanceof o.d?y+=T.textRange?"T"+O(T.textRange):T.includeSubtree?"S+":"S-":T.item instanceof o.b&&(y+=T.textRange?"GT":T.includeSubtree?"G+":"G-"),v!=e.contents.length-1&&(y+=",")}s.push(y)}s.push(""),s.push("Center: ("+Math.floor(e.location.center.x)+", "+Math.floor(e.location.center.y)+")"),s.push("Size: "+Math.floor(e.location.size.x)+" x "+Math.floor(e.location.size.y)),s.push("Rotation: "+Math.round(180*e.location.rotation/Math.PI)),s.push("Flip: "+(e.location.flipX||e.location.flipY?(e.location.flipX?"FlipX ":"")+(e.location.flipY?"FlipY":""):"none")),s.push("Grid: "+(e.morphingGrid?e.morphingGrid.size.x+"x"+e.morphingGrid.size.y:"none")),s.push("ZPos: "+e.zPosition);for(var x=0;x<r;x++)x<s.length&&(a[x]+=" "+s[x]),a[x].length<t&&(a[x]+=" ".repeat(t-a[x].length)),a[x].length>t&&(a[x]=a[x].slice(0,t));return a}function D(e,t){for(var r="Morph "+_(e.elements.length,"MorphElement")+":\n",n=0;n<e.elements.length;n++){for(var i=e.elements[n],a=[],o=0,s=i.keyFrames;o<s.length;o++){var c=s[o];a.push(M(c,70,16,t))}var u="-----"+"-".repeat(71).repeat(i.keyFrames.length);0==n&&(r+=u+"\n");for(var h=0;h<16;h++){r+="|",r+=3==h?n<10?" "+n+" ":n<100?" "+n:n<1e3?n:"1K+":5==h?null==i.rotateClockwise?"   ":i.rotateClockwise?"  ":"  ":"   ";for(var l=0;l<a.length;l++)r+="|"+a[l][h];r+="|\n"}r+=u+"\n"}return r}},function(e,t,r){"use strict";r.d(t,"a",(function(){return o})),r.d(t,"b",(function(){return s})),r.d(t,"c",(function(){return c}));var n=r(0),i=r(15);function a(e,t,r,i,a){if(0==r&&e.cachedBoundsContributor)return{points:e.cachedBoundsContributor.points,curves:e.cachedBoundsContributor.curves,transform:t};for(var o=0!=r,s={points:new Array,curves:new Array,transform:o?void 0:t},c=e.getPointCount(),u=0;u<c;u++){var h=e.getPoint(u-1),l=e.getPoint(u),f=e.getPoint(u+1);if(o&&(h=t.transformPoint(h),l=t.transformPoint(l),f=t.transformPoint(f)),2==e.getPointType(u))r?(s.curves.push([h.add(new n.d(-r,0)),l.add(new n.d(-r,0)),f.add(new n.d(-r,0))]),s.curves.push([h.add(new n.d(r,0)),l.add(new n.d(r,0)),f.add(new n.d(r,0))]),s.curves.push([h.add(new n.d(0,-r)),l.add(new n.d(0,-r)),f.add(new n.d(0,-r))]),s.curves.push([h.add(new n.d(0,r)),l.add(new n.d(0,r)),f.add(new n.d(0,r))])):s.curves.push([h,l,f]);else if(s.points.push(l),r)if(2==i)r?(s.points.push(l.add(new n.d(-r,0))),s.points.push(l.add(new n.d(r,0))),s.points.push(l.add(new n.d(0,-r))),s.points.push(l.add(new n.d(0,r)))):s.points.push(l);else{var d=l.subtract(h).normalized(),p=f.subtract(l).normalized();if(d&&p){d=d.scale(r),p=p.scale(r);var g=new n.d(-d.y,d.x),_=new n.d(-p.y,p.x);d.dot(_)<0&&(g=g.negate(),_=_.negate());var m=l.add(g),b=l.add(_);if(s.points.push(m),s.points.push(b),1==i||3==i){var y=n.d.CalculateLineIntersection(m,m.add(d),b,b.subtract(p));y&&(n.d.Distance(y,l)<a*r?s.points.push(y):1==i&&(s.points.push(m.add(d.scale(a))),s.points.push(b.subtract(p.scale(a)))))}}}}return 0!=r||e.cachedBoundsContributor||(e.cachedBoundsContributor={points:s.points,curves:s.curves,transform:void 0}),s}function o(e,t,r,n,o){for(var s=0,c=e;s<c.length;s++)for(var u=c[s],h=u.transform.toMatrix3().multiply(n),l=0,f=u.figures;l<f.length;l++){var d=f[l];if(o.push(a(d,h,t,r.pen.lineJoin,r.pen.miterLimit)),t&&!d.isClosed&&r.pen){if(r.pen.headEnd&&0!=r.pen.headEnd.end){var p=Object(i.a)(r.pen.headEnd,r.pen.adjustedLineWidthForArrowHead);if(p){var g=Object(i.c)(d,!1,r.pen.headEnd,2*t,h);g&&o.push(a(p,g,t,1,r.pen.miterLimit))}}if(r.pen.tailEnd&&0!=r.pen.tailEnd.end){var _=Object(i.a)(r.pen.tailEnd,r.pen.adjustedLineWidthForArrowHead);if(_){var m=Object(i.c)(d,!0,r.pen.tailEnd,2*t,h);m&&o.push(a(_,m,t,1,r.pen.miterLimit))}}}}}function s(e,t){var r=!0,i=0,a=0,o=0,s=0,c=e.transform&&t?e.transform.multiply(t):t||e.transform,u=!c||c.isSimpleScaleTranslationOnly(),h=u?void 0:c,l=e.points,f=e.curves,d=l&&l.length>0?l[0]:f&&f.length>0?f[0][0]:void 0;if(d){var p=0,g=0,_=0,m=0,b=0,y=0;if(h&&(p=h.m[0],g=h.m[1],_=h.m[3],m=h.m[4],b=h.m[6],y=h.m[7]),r&&(a=i=h?d.x*p+d.y*_+b:d.x,s=o=h?d.x*g+d.y*m+y:d.y,r=!1),l&&l.length>0)for(var v=1;v<l.length;v++){var T=l[v];i=(D=h?T.x*p+T.y*_+b:T.x)<i?D:i,a=D>a?D:a,o=(k=h?T.x*g+T.y*m+y:T.y)<o?k:o,s=k>s?k:s}for(var x=0,E=f||[];x<E.length;x++){var P=E[x],S=P[0],w=P[1],R=P[2],C=h?S.x*p+S.y*_+b:S.x,A=h?S.x*g+S.y*m+y:S.y,F=h?w.x*p+w.y*_+b:w.x,B=h?w.x*g+w.y*m+y:w.y,O=h?R.x*p+R.y*_+b:R.x,I=h?R.x*g+R.y*m+y:R.y;i=O<(i=C<i?C:i)?O:i,a=O>(a=C>a?C:a)?O:a,o=I<(o=A<o?A:o)?I:o,s=I>(s=A>s?A:s)?I:s;var L=(C-F)/(C+O-2*F);0<L&&L<1&&(i=(D=C*((M=L*L)-2*L+1)+O*M+2*F*(L-M))<i?D:i,a=D>a?D:a,o=(k=A*(M-2*L+1)+I*M+2*B*(L-M))<o?k:o,s=k>s?k:s);var M,D,k,N=(A-B)/(A+I-2*B);if(0<N&&N<1)i=(D=C*((M=N*N)-2*N+1)+O*M+2*F*(N-M))<i?D:i,a=D>a?D:a,o=(k=A*(M-2*N+1)+I*M+2*B*(N-M))<o?k:o,s=k>s?k:s}var G=new n.b(i,o,a,s);return u&&(G=c?G.multiply(c.getSimpleScale()).translate(c.getSimpleTranslation()):G),G}}function c(e){for(var t=void 0,r=0,i=e;r<i.length;r++){var a=i[r];if(0!=a.transform.rotation)return;var o=a.untransformedBounds;o&&(t=n.b.UnionRect(t,o.transformedBounds(a.transform)))}return t}},function(e,t,r){"use strict";r.d(t,"a",(function(){return u}));var n=r(0),i=r(2),a=r(6),o=1,s=3,c=[1,1,2,4,8,16,16];function u(e,t,r,n,c){void 0===r&&(r=!1),void 0===n&&(n=!1),void 0===c&&(c=void 0);var u=[],f=n?[]:void 0;if(!e.figures||0==e.figures.length)return{buffers:u,endDistance:0};for(var d=o+s,p=0,g=0;g<e.figures.length;g++){var _=r?e.figures[g].toPolygon():e.figures[g],m=Object(a.g)(43),b=_.isLastPointDuplicated(),y=_.isClosed||b,v=h(_.points,_.format,43,0,b?_.points.length-_.pointDataSize:_.points.length,o,s,y,e.maxPressure),T=v.length/m,x=void 0;if(n){var E=l(v,43,y,p,c,o,s);x=E.distanceArray,p=E.endDistance}var P=v.length;if(P>t)for(var S=t/m-d,w=Math.ceil((T-d)/S),R=S+d,C=0,A=0;A<w;A++){var F=Math.min(R,T-C),B=F-d;u.push(v.subarray(C*m,(C+F)*m)),f&&x&&f.push(x.subarray(C,C+F)),C+=B}else{var O=new Float32Array(4*Math.ceil(P/4));O.set(v,0),u.push(O),f&&x&&f.push(x)}}return f&&f.length!=u.length&&i.a.Error(592525388,"Invalid distance array"),{buffers:u,distanceBuffers:f,endDistance:p}}function h(e,t,r,n,o,s,u,h,l){void 0===n&&(n=0),void 0===o&&(o=e.length),void 0===s&&(s=0),void 0===u&&(u=0),void 0===h&&(h=!0),void 0===l&&(l=1);var f=Object(a.g)(t),d=o-n;if(!(d%f==0&&1&t&&1&r))throw i.a.Error(592525389,"list of source points invalid");var p=e,g=d/f;1==g&&((p=new Float32Array(2*e.length)).set(e,0),p.set(e,e.length),g=2);var _=f;f=Object(a.g)(r);for(var m=new Float32Array((s+g+u)*f),b=0;b<g;b++)for(var y=n+b*_,v=(s+b)*f,T=0,x=c;T<x.length;T++){var E=x[T];E&r&&(m[v]=8==E?E&t?p[y]/l:1:E&t?p[y]:2==E?1:0,v++),E&t&&y++}if((s||u)&&(s>0&&m.copyWithin(0,m.length-(s+u)*f,m.length-u*f),u>0&&m.copyWithin(m.length-u*f,s*f,(s+u)*f),!h&&2&r)){for(var P=0;P<s;P++)m[P*f+2]=0;for(P=0;P<u;P++)m[m.length-(P+1)*f+2]=0}return m}function l(e,t,r,o,s,c,u){void 0===o&&(o=0),void 0===s&&(s=void 0),void 0===c&&(c=0),void 0===u&&(u=0);var h=Object(a.g)(t);if(e.length%h!=0||e.length/h<c+u+1||!(1&t))throw i.a.Error(592525390,"list of points for invalid for measuring distance");for(var l=new Float32Array(e.length/h),f=c*h,d=(e.length-u*h-f)/h,p=2&t,g=o||0,_=0;_<d;_++){var m=f+_*h;if(2!=(p?e[m+2]:1)&&(l[c+_]=g,r||_<d-1)){var b=f+(_+1)%d*h,y=p?e[b+2]:1;if(2!=y){var v=e[b]-e[m],T=e[b+1]-e[m+1];s&&(v*=s.x,T*=s.y),g+=Math.sqrt(v*v+T*T)}else if(2==y&&(r||_<d-2)){var x=f+(_+2)%d*h,E=e[m],P=e[m+1],S=e[b],w=e[b+1],R=e[x],C=e[x+1];s&&(E*=s.x,S*=s.x,R*=s.x,P*=s.y,w*=s.y,C*=s.y),g+=Object(n.j)(E,P,S,w,R,C)}}}for(var A=g-o,F=0;F<c;F++)l[F]=l[c+d-c+F]-A;for(F=c+d;F<e.length/h;F++)l[F]=l[F+c-(c+d)]+A;for(_=0;_<d;_++)if(m=f+_*h,p&&2==e[m+2]){var B=0==c&&0==_?d-1:c+_-1,O=0==u&&_==d-1?c:c+_+1;l[c+_]=.5*(l[B]+l[O])}return{distanceArray:l,endDistance:g}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return i}));var n=function(){function e(){this.totalCostMs=0,this.shapeRenderCostMs=0,this.distanceFieldForTextCostMs=0,this.distanceFieldForGlyphTableCostMs=0,this.distanceFieldForShapeCostMs=0,this.patternTextureCostMs=0,this.pathGradientTextureCostMs=0,this.gradientTextureCostMs=0,this.fadeTextureCostMs=0,this.effectsCostMs=0,this.cacheToSpriteCostMs=0,this.drawTapeCostMs=0,this.glResetCostMs=0,this.glRestoreCostMs=0,this.pathCount=0,this.glyphCount=0,this.pixelCountDistanceField=0,this.pixelCountShapeRender=0,this.dynamicTextureAlloc=0,this.beginTime=0,this.endTime=0}return e.prototype.add=function(e){this.totalCostMs+=e.totalCostMs,this.shapeRenderCostMs+=e.shapeRenderCostMs,this.distanceFieldForTextCostMs+=e.distanceFieldForTextCostMs,this.distanceFieldForGlyphTableCostMs+=e.distanceFieldForGlyphTableCostMs,this.distanceFieldForShapeCostMs+=e.distanceFieldForShapeCostMs,this.patternTextureCostMs+=e.patternTextureCostMs,this.pathGradientTextureCostMs+=e.pathGradientTextureCostMs,this.gradientTextureCostMs+=e.gradientTextureCostMs,this.fadeTextureCostMs+=e.fadeTextureCostMs,this.effectsCostMs+=e.effectsCostMs,this.cacheToSpriteCostMs+=e.cacheToSpriteCostMs,this.drawTapeCostMs+=e.drawTapeCostMs,this.glResetCostMs+=e.glResetCostMs,this.glRestoreCostMs+=e.glRestoreCostMs,this.pathCount+=e.pathCount,this.glyphCount+=e.glyphCount,this.pixelCountDistanceField+=e.pixelCountDistanceField,this.pixelCountShapeRender+=e.pixelCountShapeRender,this.dynamicTextureAlloc+=e.dynamicTextureAlloc,this.beginTime=0,this.endTime=0},e}(),i=function(){this.frameCount=0}},function(e,t,r){"use strict";r.r(t);var n=r(24);r.d(t,"ParseJson",(function(){return n.a}));var i=r(17);r.d(t,"DebugStringProvider",(function(){return i.a})),r.d(t,"getDebugStringTree",(function(){return i.j})),r.d(t,"getDebugStringInfo",(function(){return i.h})),r.d(t,"getTextDebugStringInfo",(function(){return i.k})),r.d(t,"getDebugRaster",(function(){return i.f})),r.d(t,"getDebugRasterShapePaths",(function(){return i.g})),r.d(t,"countToString",(function(){return i.d})),r.d(t,"brushToString",(function(){return i.b})),r.d(t,"penLineEndToString",(function(){return i.o})),r.d(t,"penLineEndsToString",(function(){return i.q})),r.d(t,"penLineEndWidthToString",(function(){return i.p})),r.d(t,"penLineEndLengthToString",(function(){return i.n})),r.d(t,"penEndToString",(function(){return i.m})),r.d(t,"styleToString",(function(){return i.u})),r.d(t,"effectsToString",(function(){return i.e})),r.d(t,"vector2ToString",(function(){return i.x})),r.d(t,"vector2ToStringWithArrow",(function(){return i.y})),r.d(t,"matrix3ToString",(function(){return i.l})),r.d(t,"transformToMultiLine",(function(){return i.v})),r.d(t,"transformToString",(function(){return i.w})),r.d(t,"rectToString",(function(){return i.s})),r.d(t,"rangeToString",(function(){return i.r})),r.d(t,"colorToString",(function(){return i.c})),r.d(t,"strokesToString",(function(){return i.t})),r.d(t,"getDebugStringMorph",(function(){return i.i}));var a=r(29);r.d(t,"TrackableArray",(function(){return a.TrackableArray})),r.d(t,"ChangeTracker",(function(){return a.ChangeTracker})),r.d(t,"Glow",(function(){return a.Glow})),r.d(t,"Shadow",(function(){return a.Shadow})),r.d(t,"InnerShadow",(function(){return a.InnerShadow})),r.d(t,"Reflection",(function(){return a.Reflection})),r.d(t,"SoftEdges",(function(){return a.SoftEdges})),r.d(t,"Effects",(function(){return a.Effects})),r.d(t,"Fade",(function(){return a.Fade})),r.d(t,"epsilon",(function(){return a.epsilon})),r.d(t,"Vector2",(function(){return a.Vector2})),r.d(t,"Matrix3",(function(){return a.Matrix3})),r.d(t,"Transform",(function(){return a.Transform})),r.d(t,"Rect",(function(){return a.Rect})),r.d(t,"getNearestPowerOfTwo",(function(){return a.getNearestPowerOfTwo})),r.d(t,"getGreaterPowerOfTwo",(function(){return a.getGreaterPowerOfTwo})),r.d(t,"clamp",(function(){return a.clamp})),r.d(t,"mix",(function(){return a.mix})),r.d(t,"measureQuadraticLength",(function(){return a.measureQuadraticLength})),r.d(t,"interpolateAngle",(function(){return a.interpolateAngle})),r.d(t,"Item",(function(){return a.Item})),r.d(t,"Shape",(function(){return a.Shape})),r.d(t,"Group",(function(){return a.Group})),r.d(t,"forEachShape",(function(){return a.forEachShape})),r.d(t,"forEachPath",(function(){return a.forEachPath})),r.d(t,"getPenAlignment",(function(){return a.getPenAlignment})),r.d(t,"getBoundsOfPaths",(function(){return a.getBoundsOfPaths})),r.d(t,"getBoundsForEffects",(function(){return a.getBoundsForEffects})),r.d(t,"getAlignmentPoint",(function(){return a.getAlignmentPoint})),r.d(t,"getEffectTransformsMatrix",(function(){return a.getEffectTransformsMatrix})),r.d(t,"GetBrush",(function(){return a.GetBrush})),r.d(t,"MorphKeyFrame",(function(){return a.MorphKeyFrame})),r.d(t,"MorphElement",(function(){return a.MorphElement})),r.d(t,"Morph",(function(){return a.Morph})),r.d(t,"Path",(function(){return a.Path})),r.d(t,"pathDistEpsilon",(function(){return a.pathDistEpsilon})),r.d(t,"getPointDataSize",(function(){return a.getPointDataSize})),r.d(t,"Figure",(function(){return a.Figure})),r.d(t,"FigureBuilder",(function(){return a.FigureBuilder})),r.d(t,"createFiguresFromPathString",(function(){return a.createFiguresFromPathString})),r.d(t,"IncrementalPath",(function(){return a.IncrementalPath})),r.d(t,"calculateBoundsOfFigures",(function(){return a.calculateBoundsOfFigures})),r.d(t,"isUntransformedRect",(function(){return a.isUntransformedRect})),r.d(t,"s_isAnimationTransformAbsolute",(function(){return a.s_isAnimationTransformAbsolute})),r.d(t,"setIsAnimationTransformAbsolute",(function(){return a.setIsAnimationTransformAbsolute})),r.d(t,"s_minLineWidth",(function(){return a.s_minLineWidth})),r.d(t,"s_minLineWidthForArrowHead",(function(){return a.s_minLineWidthForArrowHead})),r.d(t,"setMinLineWidth",(function(){return a.setMinLineWidth})),r.d(t,"debug_OFF",(function(){return a.debug_OFF})),r.d(t,"debug_edge",(function(){return a.debug_edge})),r.d(t,"debug_tape",(function(){return a.debug_tape})),r.d(t,"debug_fill",(function(){return a.debug_fill})),r.d(t,"debug_signed",(function(){return a.debug_signed})),r.d(t,"debug_relief",(function(){return a.debug_relief})),r.d(t,"debug_dash",(function(){return a.debug_dash})),r.d(t,"debug_thinLine",(function(){return a.debug_thinLine})),r.d(t,"debugMode",(function(){return a.debugMode})),r.d(t,"setDebugMode",(function(){return a.setDebugMode})),r.d(t,"setLogger",(function(){return a.setLogger})),r.d(t,"Color",(function(){return a.Color})),r.d(t,"ImageContainer",(function(){return a.ImageContainer})),r.d(t,"Brush",(function(){return a.Brush})),r.d(t,"SolidBrush",(function(){return a.SolidBrush})),r.d(t,"GradientStop",(function(){return a.GradientStop})),r.d(t,"GradientBrush",(function(){return a.GradientBrush})),r.d(t,"ImageBrush",(function(){return a.ImageBrush})),r.d(t,"PatternBrush",(function(){return a.PatternBrush})),r.d(t,"SpecialBrush",(function(){return a.SpecialBrush})),r.d(t,"PenEnd",(function(){return a.PenEnd})),r.d(t,"Pen",(function(){return a.Pen})),r.d(t,"Style",(function(){return a.Style})),r.d(t,"getBrushImagesFromBrush",(function(){return a.getBrushImagesFromBrush})),r.d(t,"TextRange",(function(){return a.TextRange})),r.d(t,"RangeDataPartition",(function(){return a.RangeDataPartition})),r.d(t,"TrackableRangeDataPartition",(function(){return a.TrackableRangeDataPartition})),r.d(t,"TextStroke",(function(){return a.TextStroke})),r.d(t,"TextRunAnimationProps",(function(){return a.TextRunAnimationProps})),r.d(t,"PathingLine",(function(){return a.PathingLine})),r.d(t,"WarpingEnvelope",(function(){return a.WarpingEnvelope})),r.d(t,"TextImage",(function(){return a.TextImage})),r.d(t,"TextCharacter",(function(){return a.TextCharacter})),r.d(t,"TextBullet",(function(){return a.TextBullet})),r.d(t,"TextEffectMetrics",(function(){return a.TextEffectMetrics})),r.d(t,"TextLine",(function(){return a.TextLine})),r.d(t,"TextParagraph",(function(){return a.TextParagraph})),r.d(t,"TextSelectionHighlight",(function(){return a.TextSelectionHighlight})),r.d(t,"TextLayout",(function(){return a.TextLayout})),r.d(t,"arrayPushIfNotThere",(function(){return a.arrayPushIfNotThere})),r.d(t,"runStartToRangeList",(function(){return a.runStartToRangeList}));var o=r(31);for(var s in o)["ParseJson","DebugStringProvider","getDebugStringTree","getDebugStringInfo","getTextDebugStringInfo","getDebugRaster","getDebugRasterShapePaths","countToString","brushToString","penLineEndToString","penLineEndsToString","penLineEndWidthToString","penLineEndLengthToString","penEndToString","styleToString","effectsToString","vector2ToString","vector2ToStringWithArrow","matrix3ToString","transformToMultiLine","transformToString","rectToString","rangeToString","colorToString","strokesToString","getDebugStringMorph","TrackableArray","ChangeTracker","Glow","Shadow","InnerShadow","Reflection","SoftEdges","Effects","Fade","epsilon","Vector2","Matrix3","Transform","Rect","getNearestPowerOfTwo","getGreaterPowerOfTwo","clamp","mix","measureQuadraticLength","interpolateAngle","Item","Shape","Group","forEachShape","forEachPath","getPenAlignment","getBoundsOfPaths","getBoundsForEffects","getAlignmentPoint","getEffectTransformsMatrix","GetBrush","MorphKeyFrame","MorphElement","Morph","Path","pathDistEpsilon","getPointDataSize","Figure","FigureBuilder","createFiguresFromPathString","IncrementalPath","calculateBoundsOfFigures","isUntransformedRect","s_isAnimationTransformAbsolute","setIsAnimationTransformAbsolute","s_minLineWidth","s_minLineWidthForArrowHead","setMinLineWidth","debug_OFF","debug_edge","debug_tape","debug_fill","debug_signed","debug_relief","debug_dash","debug_thinLine","debugMode","setDebugMode","setLogger","Color","ImageContainer","Brush","SolidBrush","GradientStop","GradientBrush","ImageBrush","PatternBrush","SpecialBrush","PenEnd","Pen","Style","getBrushImagesFromBrush","TextRange","RangeDataPartition","TrackableRangeDataPartition","TextStroke","TextRunAnimationProps","PathingLine","WarpingEnvelope","TextImage","TextCharacter","TextBullet","TextEffectMetrics","TextLine","TextParagraph","TextSelectionHighlight","TextLayout","arrayPushIfNotThere","runStartToRangeList","default"].indexOf(s)<0&&function(e){r.d(t,e,(function(){return o[e]}))}(s);var c=r(25);r.d(t,"createDebugStringProvider",(function(){return c.a}));var u=r(26);r.d(t,"createMorphPlayer",(function(){return u.a}));var h=r(27);r.d(t,"createRenderer",(function(){return h.a}));var l=r(28);r.d(t,"createStateRestorer",(function(){return l.a}));var f=r(20);r.d(t,"FramePerformanceSummary",(function(){return f.a})),r.d(t,"ScenePerformanceSummary",(function(){return f.b}));var d=r(8);r.d(t,"distanceFieldQuality",(function(){return d.e})),r.d(t,"blurQuality",(function(){return d.c})),r.d(t,"maxTileTextureResolution",(function(){return d.i})),r.d(t,"textureMemoryAllocated",(function(){return d.o})),r.d(t,"renderBufferMemoryAllocated",(function(){return d.j})),r.d(t,"distanceFieldMaxRes",(function(){return d.d})),r.d(t,"scratchBufferSize",(function(){return d.m})),r.d(t,"scratchBufferCount",(function(){return d.l})),r.d(t,"gradientResolution",(function(){return d.h})),r.d(t,"setQuality",(function(){return d.n})),r.d(t,"s_enableExperimentalGlyphTable",(function(){return d.k})),r.d(t,"enableExperimentalGlyphTable",(function(){return d.g})),r.d(t,"unrotatedRectLocation",(function(){return d.q})),r.d(t,"transformedRectLocation",(function(){return d.p})),r.d(t,"Texture",(function(){return d.b})),r.d(t,"TargetTexture",(function(){return d.a})),r.d(t,"drawTexture",(function(){return d.f}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return l}));var n=r(0),i=r(1),a=r(4),o=r(8),s=r(16),c=r(12),u=r(2),h=function(){function e(){}return e.prototype.releaseGeneratedResources=function(){this.texture&&this.texture.release()},e}(),l=function(){function e(){}return e.prototype.tryInitMorphKeyFrame=function(e,t){var r=e.ensureMorphKeyFrameRenderData(t);if(r.texture&&!r.texture.size.isZero()&&r.texture.isValid(e))return!0;for(var s=void 0,c=0,h=t.contents;c<h.length;c++){var l=h[c],f=n.a.FromTransforms(t.parentTransform||n.a.Identity,l.item.animationTransform||n.a.Identity),d=Object(a.h)(l.item,l.includeSubtree||null!=l.textRange,31,31,f,l.includeSubtree,l.textRange);s=n.b.UnionRect(s,d)}if(s){for(var p=Math.min(o.e,o.d/Math.max(s.width,s.height)),g=new o.a(e,new n.d(Math.max(1,Math.ceil(s.size.x*p)),Math.max(1,Math.ceil(s.size.y*p)))),_=new n.c(s.leftTop.negate(),new n.d(p,p)),m=0;m<t.contents.length;m++)if(l=t.contents[m],e.renderItemInWebGLRenderScope(l.item,0==m?i.b.Transparent:void 0,{target:g,noSubtree:!l.includeSubtree,textRange:l.textRange,transform:n.a.FromTransforms(t.parentTransform||n.a.Identity,n.a.FromTransforms(_))}),e.initOutOfTime())return!1;t.location?(g.contentLocation={logicalCenter:t.location.center.subtract(s.leftTop).scale(p),logicalSize:t.location.size.scale(p),physicalCenter:g.size.scale(.5),physicalSize:g.size,rotation:t.location.rotation,flipX:t.location.flipX,flipY:t.location.flipY},e.ensureMorphKeyFrameRenderData(t).texture=g):u.a.Error(591672911,"No KeyFrame location")}return!0},e.prototype.tryPrepareMorph=function(e,t,r){var n=e.getGraphicsProcessor();if(!n)return u.a.Error(591672912,"glContext must be provided"),!1;var i=n.isInRenderScope();if(i||n.beginRenderScope()){var o=performance.now();e.m_initDeadline=r?o+r:void 0;for(var s=[],c=0,h=t.elements;c<h.length;c++)for(var l=0,f=h[c].keyFrames;l<f.length;l++)if(S=f[l]){var d=e.ensureMorphKeyFrameRenderData(S);if(!d.texture||d.texture.size.isZero()||!d.texture.isValid(e))for(var p=function(e){if(e.item instanceof a.d){var t=e.item;if(e.textRange)if(t.text){var r=t.text.getFullRange();r&&r.contains(e.textRange)?e.textRange.equals(r)||t.text.forceSplit(2):u.a.Error(591672913,"Text KeyFrame out of range: ["+e.textRange.start+", "+e.textRange.last+"], fullRange: "+(r?"["+r.start+", "+r.last+"]":"undefined"))}else u.a.Error(591672914,"Text KeyFrame on Shape with no Text")}e.item&&!s.find((function(t){return t==e.item}))&&s.push(e.item)},g=0,_=S.contents;g<_.length;g++)p(_[g])}for(var m=0,b=s;m<b.length;m++){var y=b[m],v=e.m_initDeadline?e.m_initDeadline-performance.now():void 0;if(null!=v&&v<=0)return!1;if(!e.tryPrepareItemInWebGlScope(y,e.getGraphicsProcessor(),!0,v))return!1}for(var T=0,x=t.elements;T<x.length;T++)for(var E=0,P=x[T].keyFrames;E<P.length;E++){var S;if((S=P[E])&&!this.tryInitMorphKeyFrame(e,S))return!1}i||n.endRenderScope()}return!0},e.prototype.renderMorph=function(e,t,r,i,a){var o=e.getGraphicsProcessor();if(o){if(!o||o.beginRenderScope()){var h=o.getBabylonEngine();if(this.tryPrepareMorph(e,t,void 0)){for(var l=[],f=0,d=t.elements;f<d.length;f++){var p=d[f],g=p.keyFrames.length>0&&p.keyFrames[0]?p.keyFrames[0]:void 0,_=p.keyFrames.length>1&&p.keyFrames[1]?p.keyFrames[1]:void 0,m=g?g.location:_?_.location:void 0,b=_?_.location:m,y=g?e.ensureMorphKeyFrameRenderData(g):void 0,v=_?e.ensureMorphKeyFrameRenderData(_):void 0,T=y?y.texture:void 0,x=v?v.texture:void 0,E=e.ensureMorphElementRenderData(p);if(m&&b){if(!E.layer||E.layer.textureA!=T||E.layer.textureB!=x){var P=void 0,S=void 0,w=void 0;if(g&&_&&g.morphingGrid&&_.morphingGrid){var R=g.morphingGrid.size.x*g.morphingGrid.size.y*2;g.morphingGrid.size.equals(_.morphingGrid.size)&&R>0&&g.morphingGrid.data.length==R&&_.morphingGrid.data.length==R?(P=h.createVertexBuffer(g.morphingGrid.data),S=h.createVertexBuffer(_.morphingGrid.data),w=s.a.CreateGridXY(o,g.morphingGrid.size,new n.b(-1,-1,1,1))):u.a.Error(591672917,"Wrong morphing grid size")}else(g&&g.morphingGrid||_&&_.morphingGrid)&&u.a.Error(591672918,"Morphing grids should come by pair");E.layer=new c.b(y?y.texture:void 0,v?v.texture:void 0,P,S,w)}if(E.layer){var C=g?g.zPosition:_?_.zPosition:0,A=_?_.zPosition:C;E.layer.progress=g&&_?r:g?Object(n.e)(3*r,0,1):Object(n.e)(3*r-2,0,1),E.layer.contentCenter=n.d.InterpolateLinear(m.center,b.center,r),E.layer.contentSize=n.d.InterpolateLinear(m.size,b.size,r),E.layer.contentFlip=n.d.InterpolateLinear(n.d.Flip(m.flipX,m.flipY),n.d.Flip(b.flipX,b.flipY),r),E.layer.contentRotation=Object(n.i)(m.rotation,b.rotation,r,p.rotateClockwise),E.layer.depth=Object(n.k)(C,A,r),l.push(E.layer)}}}o.updateViewportSize();var F=o.getCurrentViewportSize(),B=o.activateShaderProgram(1);B.begin(void 0,i,!0),c.g&&B.clearAndEnbaleDepthBuffer(),l.sort((function(e,t){return e.depth-t.depth}));for(var O=0;O<l.length;O++){var I=l[O];I.depthFar=1-O/t.elements.length,I.depthNear=1-(O+.9)/t.elements.length,Object(c.e)(I,B,F,a?a.toMatrix3():void 0,void 0)}B.end(),o.endRenderScope()}else u.a.Error(591672916,"failed to initialize Morph")}}else u.a.Error(591672915,"glContext must be provided")},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return o}));var n=r(5),i=r(0),a=r(3),o=function(){function e(e,t,r,i,a,o,s){void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),this.m_changeTracker=new n.a,this.m_presetChangeTracker=new n.a,this.m_preset=e,this.m_param=t,this.m_flipX=r,this.m_flipY=i,this.m_transposeXY=a,this.m_reverse=o,this.m_isDistributedByLength=s,this.m_progress=0}return e.prototype.clone=function(){var t=new e(this.m_preset,this.m_param,this.m_flipX,this.m_flipY,this.m_transposeXY,this.m_reverse,this.m_isDistributedByLength);return t.m_progress=this.m_progress,t},Object.defineProperty(e.prototype,"changeTracker",{get:function(){return this.m_changeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"presetChangeTracker",{get:function(){return this.m_presetChangeTracker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"progress",{get:function(){return this.m_progress},set:function(e){Object(a.a)(this.m_changeTracker,this.m_progress,e),this.m_progress=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"preset",{get:function(){return this.m_preset},set:function(e){Object(a.a)(this.m_changeTracker,this.m_preset,e),Object(a.a)(this.m_presetChangeTracker,this.m_preset,e),this.m_preset=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"param",{get:function(){return this.m_param},set:function(e){Object(a.a)(this.m_changeTracker,this.m_param,e),this.m_param=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flipX",{get:function(){return this.m_flipX},set:function(e){Object(a.a)(this.m_changeTracker,this.m_flipX,e),this.m_flipX=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"flipY",{get:function(){return this.m_flipY},set:function(e){Object(a.a)(this.m_changeTracker,this.m_flipY,e),this.m_flipY=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"transposeXY",{get:function(){return this.m_transposeXY},set:function(e){Object(a.a)(this.m_changeTracker,this.m_flipY,e),this.m_flipY=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reverse",{get:function(){return this.m_reverse},set:function(e){Object(a.a)(this.m_changeTracker,this.m_reverse,e),this.m_reverse=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDistributedByLength",{get:function(){return this.m_isDistributedByLength},set:function(e){Object(a.a)(this.m_changeTracker,this.m_isDistributedByLength,e),this.m_isDistributedByLength=e},enumerable:!0,configurable:!0}),e.prototype.getFadeTransform=function(){var e=i.d.Flip(this.flipX,this.flipY);return new i.a(this.transposeXY?0:e.x,this.transposeXY?e.x:0,0,this.transposeXY?e.y:0,this.transposeXY?0:e.y,0,0,0,1)},e.prototype.getFadeScaleOffset=function(e,t){var r=0==this.preset?1:13==this.preset?Math.max(10,30-t):10;return this.reverse?new i.d(r-1,1-e*r):new i.d(1-r,e*r)},e}()},function(e,t,r){"use strict";var n=r(30);r.d(t,"a",(function(){return n.a}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(17);function i(){return new n.a}},function(e,t,r){"use strict";r.d(t,"a",(function(){return i}));var n=r(22);function i(){return new n.b}},function(e,t,r){"use strict";var n=r(7),i=r(10),a=r(0),o=r(13),s=r(9),c=r(1),u=r(18),h=r(6),l=r(2),f=r(4),d=r(11),p=function(){function e(){this.textShapes=[],this.hitTestLineShapes=[]}return e.prototype.clearCache=function(){for(var e=0,t=this.textShapes;e<t.length;e++)t[e].clearCache();for(var r=0,n=this.hitTestLineShapes;r<n.length;r++)n[r].clearCache();for(var i=0,a=this.selectionShapes||[];i<a.length;i++)a[i].clearCache()},e.prototype.getTextShapes=function(){return this.textShapes},e.prototype.getSelectionShapes=function(){return this.selectionShapes||[]},e.prototype.initShapeEffectsAndBoundsOverrides=function(e,t,r,n,i){if(t.effects=function(e,t){if(e){var r=t?t.fontHeightInPoints:0,n=e.clone(),i=0==r?1:r/C;return n.glow&&(n.glow.radius=b(n.glow.radius,r,y,v,T)/2),n.shadow&&(n.shadow.radius=b(n.shadow.radius,r,x,E,P),n.shadow.distance=b(n.shadow.distance,r,x,E,P)),n.innerShadow&&(n.innerShadow.radius=b(n.innerShadow.radius,r,S,w,R),n.innerShadow.distance=b(n.innerShadow.distance,r,S,w,R)),n.reflection&&(n.reflection.radius*=i,t&&(n.reflection.distance*=0!=t.ascent&&0!=t.descent?r*t.descent/t.ascent/A:i)),n.softEdges&&(n.softEdges.radius*=i),n}}(e.getEffetcsAt(i),r?r.textEffectMetrics:void 0)||new d.a,!r.bender){var o=r.fillBounds.translate(n).transformedBounds(a.a.FromTransforms(e.layoutToFrame,e.frameToShape));t.fillBoundsOverride=t.effectsBoundsOverride=o,t.textEffectMetrics=r.textEffectMetrics}},e.prototype.getTextShape=function(e,t){var r=new f.d(e.getTextPathsForRange(t),e.getStyleAt(t.start)),n=e.getLineAndParagraphAt(t.start);return n&&this.initShapeEffectsAndBoundsOverrides(e,r,n.line,n.line.offset.add(n.paragraph.offset),t.start),r.role=3,r.textRange=t,r.overlapMode=1,r.transform=e.frameToShape,r},e.prototype.getStrokeShape=function(e,t,r){var n=new f.d(this.getStrokePaths(e,t,r),r.style?r.style:e.getStyleAt(t.start)),i=e.getLineAndParagraphAt(t.start);return i&&this.initShapeEffectsAndBoundsOverrides(e,n,i.line,i.line.offset.add(i.paragraph.offset),t.start),n.role=3,n.textRange=t,n.overlapMode=1,n.transform=e.frameToShape,n},e.prototype.getSelectionHighlightShapes=function(e){if(e.selectionHighlights){for(var t=[],r=0,n=e.selectionHighlights;r<n.length;r++){var i=n[r];if(i.range.length>0){var a=e.getSelectionRectPaths(i.range);a&&t.push(new f.d(a,i.style))}else{var o=e.getSelectionLayoutCaretPath(i.range.start,i.caretWidth,i.isAnchoredToPrevious);o&&t.push(new f.d([o],i.style))}}return t}},e.prototype.update=function(e){var t;if(e.textVersion!=this.lastKnownTextVersion){this.lastKnownTextVersion=e.textVersion,this.clearCache(),this.textShapes=[],this.hitTestLineShapes=[];for(var r=0,n=e.paragraphs;r<n.length;r++){if((W=n[r]).bullet){var i=e.getLineAndParagraphAt(W.globalRange.start);if(i){for(var a=new s.j(W.globalRange.start,0),o=0,u=W.bullet.strokes?W.bullet.strokes.elements:[];o<u.length;o++)0==(G=u[o]).type&&this.textShapes.push(this.getStrokeShape(e,a,G));var h=e.getTextPathsForCharacter(W.bullet.character,W.offset,W.lines.length>0?W.lines[0].bender:void 0),l=new f.d(h,W.bullet.style?W.bullet.style:e.getStyleAt(a.start));this.initShapeEffectsAndBoundsOverrides(e,l,i.line,i.paragraph.offset,a.start),l.role=3,l.textRange=new s.j(W.globalRange.start,0),l.transform=e.frameToShape,this.textShapes.push(l);for(var d=0,p=W.bullet.strokes?W.bullet.strokes.elements:[];d<p.length;d++)0!=(G=p[d]).type&&this.textShapes.push(this.getStrokeShape(e,a,G))}}for(var g=0,_=e.getSelectionRectPaths(void 0)||[];g<_.length;g++){var m=_[g],b=new f.d([m],new c.l(new c.j(c.b.Black)));this.hitTestLineShapes.push(b)}}for(var y=[],v=0,T=e.getRunRanges();v<T.length;v++){var x=T[v],E=e.getBoundsOfRange(x);if(E&&E.width>2048)for(var P=Math.ceil(E.width/2048),S=0;S<P;S++){var w=Math.floor(x.start+S*x.length/P),R=S==P-1?x.last+1:Math.floor(x.start+(S+1)*x.length/P);w<R&&y.push(s.j.FromFirstLast(w,R-1))}else y.push(x)}for(var C=0,A=y;C<A.length;C++){x=A[C];for(var F=0,B=(D=e.getStrokesAt(x.start))?D.elements:[];F<B.length;F++)0==(G=B[F]).type&&this.textShapes.push(this.getStrokeShape(e,x,G))}for(var O=0,I=y;O<I.length;O++)x=I[O],this.textShapes.push(this.getTextShape(e,x));for(var L=0,M=y;L<M.length;L++){x=M[L];for(var D,k=0,N=(D=e.getStrokesAt(x.start))?D.elements:[];k<N.length;k++){var G;0!=(G=N[k]).type&&this.textShapes.push(this.getStrokeShape(e,x,G))}}for(var j=0,U=e.paragraphs;j<U.length;j++)for(var W,V=0,z=(W=U[j]).lines;V<z.length;V++)for(var H=0,X=z[V].characters;H<X.length;H++){var q=X[H];if(q.textImage){var Y=f.d.CreateRectangle(q.textImage.rect,new c.l(new c.e(q.textImage.image)));Y.transform=q.textImage.transform,this.textShapes.push(Y)}}}if(e.selectionVersion!=this.lastKnownSelectionVersion){this.lastKnownSelectionVersion=e.selectionVersion;var K=this.getSelectionHighlightShapes(e);if(K){if(this.selectionShapes=[],new c.l(new c.j(c.b.White)).blendingMode=2,K){(t=this.selectionShapes).push.apply(t,K);for(var Q=0,Z=this.selectionShapes;Q<Z.length;Q++)Z[Q].transform=e.frameToShape}}else{for(var J=0,$=this.selectionShapes||[];J<$.length;J++)$[J].clearCache();this.selectionShapes=void 0}}},e.prototype.getStrokePaths=function(e,t,r){for(var n=[],i=0,o=e.paragraphs;i<o.length;i++){var c=o[i];if(c.globalRange.intersects(t))for(var u=0,l=c.lines;u<l.length;u++){var f=l[u],d=void 0,p=void 0,g=new s.j(0,f.characters.length).getIntersection(t.move(-c.globalRange.start-f.localRange.start));if(g)for(var _=g.start;_<=g.last;_++){var b=f.characters[_].layoutBounds;b.isEmpty()||(d=null==d?b.left:Math.min(d,b.left),p=null==p?b.right:Math.max(p,b.right))}if(null!=d&&null!=p&&d<p){var y=a.a.Translation2D(f.offset.add(c.offset)).multiply(e.layoutToFrame.toMatrix3()).tryGetTransform(a.d.Zero);if(y){var v=new h.d({figures:m(r,d,p),transform:y}),T=f.bender instanceof s.a?f.bender.equivalentWarpingEnvelope:f.bender;T&&(v=T.warpPath(v)),n.push(v)}}}}return n},e}();function g(e,t,r){var n=t.y-r,i=Math.ceil(t.x/(2*n)),a=e.x,o=new h.b;o.moveTo(a,e.y),o.lineTo(a,e.y+r);for(var s=0;s<i;s++)a+=n,o.lineTo(a,e.y+t.y),a+=n,o.lineTo(a,e.y+r);for(o.lineTo(a,e.y),s=0;s<i;s++)a-=n,o.lineTo(a,e.y+t.y-r),a-=n,o.lineTo(a,e.y);return o.close(),o.createFigure()}function _(e,t,r,n,i,o){for(var s=[],c=e.x,u=t.y,l=t.y*r,f=t.y*n,d=o?e.y-t.y:e.y,p=o?e.y+t.y/2:e.y+t.y,g=0;c<e.x+t.x;){var _=i&&g%(i+1)!=0?u:l,m=Math.min(c+_,t.x+e.x);s.push(h.a.CreateFromRect(new a.b(c,d,m,p))),c+=f+_,g++}return s}function m(e,t,r){var n=new a.d(t,e.verticalCenter-.5*e.thickness),i=new a.d(r-t,e.thickness),o=[],s=3==e.type||5==e.type||7==e.type||9==e.type||11==e.type||13==e.type||15==e.type;switch(e.type){case 3:case 1:case 0:s?o.push(h.a.CreateFromRect(new a.b(n.x,n.y-i.y,n.x+i.x,n.y+Math.ceil(i.y/2)))):o.push(h.a.CreateFromRect(new a.b(n.x,n.y,n.x+i.x,n.y+i.y)));break;case 2:o.push.apply(o,function(e,t,r){var n=[];return n.push(h.a.CreateFromRect(new a.b(e.x,e.y-t.y,e.x+t.x,e.y-t.y/2))),n.push(h.a.CreateFromRect(new a.b(e.x,e.y+t.y/2,e.x+t.x,e.y+t.y))),n}(n,i));break;case 5:case 4:o.push.apply(o,_(n,i,1,1,1,s));break;case 7:case 6:o.push.apply(o,_(n,i,3,2,0,s));break;case 9:case 8:o.push.apply(o,_(n,i,7,4,0,s));break;case 10:case 11:o.push.apply(o,_(n,i,3,2,1,s));break;case 12:case 13:o.push.apply(o,_(n,i,3,2,2,s));break;case 14:case 15:var c=2*i.y,u=1;15==e.type&&(c=Math.floor(Math.max(3,2*i.y)),u=Math.max(2,Math.floor(i.y/2))),o.push(g(new a.d(n.x,n.y-Math.ceil(i.y/2)),new a.d(i.x,c),u));break;case 16:u=1,c=Math.max(2,i.y);var f=n.y-c;o.push(g(new a.d(n.x,f),new a.d(i.x,c),u)),o.push(g(n,new a.d(i.x,c),u));break;default:l.a.Error(591525085,"Unknown stroke type")}return o}function b(e,t,r,n,i){return 0!=t&&i<e?(e-i)*Math.pow(t,n)/Math.pow(r,n)+i:0==t?e:0}var y=72,v=.7,T=1,x=72,E=.7,P=.4,S=108,w=1,R=.001,C=72,A=4,F=r(20),B=r(8),O=r(16),I=r(12),L=r(14),M=r(19),D=function(){function e(){this.m_compatibleGraphicsProcessorId=0}return Object.defineProperty(e.prototype,"tapeBuffers",{get:function(){return this.m_tapeBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hwTapeBuffers",{get:function(){return this.m_hwTapeBuffers},enumerable:!0,configurable:!0}),e.prototype.releaseGeneratedResources=function(){if(this.m_hwTapeBuffers&&this.m_engine)for(var e=0,t=this.m_hwTapeBuffers;e<t.length;e++){var r=t[e];this.m_engine._releaseBuffer(r)}this.m_hwTapeBuffers=void 0},e.prototype.refreshCachedTapeBuffers=function(e){return this.m_tapeBuffers||(this.m_tapeBuffers=Object(M.a)(e,Object(O.b)()).buffers),this.m_tapeBuffers},e.prototype.refreshCachedHwTapeBuffers=function(e,t){if(!this.m_hwTapeBuffers||!this.m_engine||this.m_compatibleGraphicsProcessorId!=t.getUniqueGraphicsProcessorId()){var r=Object(M.a)(e,Object(O.b)(),!1,!1,void 0),n=t.getBabylonEngine();this.m_hwTapeBuffers=r.buffers.map((function(e){return n.createVertexBuffer(e)})),this.m_compatibleGraphicsProcessorId=t.getUniqueGraphicsProcessorId(),this.m_engine=t.getBabylonEngine()}return this.m_hwTapeBuffers},e}(),k=function(){function e(e,t){this.m_state=e,this.m_texture=t}return e.prototype.getState=function(){return this.m_state},e.prototype.getSize=function(){return this.m_texture&&this.m_texture.babylonTexture?this.m_texture.size:void 0},e.prototype.getLogicalCenter=function(){return this.m_texture&&this.m_texture.contentLocation?this.m_texture.contentLocation.logicalCenter:void 0},e.prototype.tryConvertToBufferRGBA=function(){return this.m_texture instanceof B.a?this.m_texture.tryConvertToBufferRGBA():void 0},e}(),N=function(){function e(){this.m_state=0}return e.prototype.releaseGeneratedResources=function(){this.m_texture&&(this.m_texture.release(),this.m_state=2)},Object.defineProperty(e.prototype,"texture",{get:function(){return this.m_texture},set:function(e){this.m_texture&&this.m_texture!=e&&this.m_texture.release(),this.m_texture=e,this.m_state=1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this.m_state},enumerable:!0,configurable:!0}),e}();function G(e,t,r,n){if(e.getGraphicsProcessor()){var i=t,o=Object(f.a)(r,n);if(o){var s=o.getType();if(6==s){var u=o;if(u.image){var h=e.ensureImageRenderData(u.image);2==h.state?l.a.Error(592472275,"Trying to use deleted texture id:"+u.image.id):0==h.state&&l.a.Error(592472276,"Trying to use uninitialized texture id:"+u.image.id);var d=h.texture;if(!t||!(t==d||d&&t.tag==d.changeTracker.currentUniqueId)){var p=o.wrapMode;i=null!=p&&d&&d.wrapMode!=p?d.cloneWithNewWrapMode(e,p):d}}else i=void 0}else if(7==s){var g=-performance.now();t&&t.tag==o.pattern||(i=function(e,t){if(!e.getGraphicsProcessor())throw l.a.Error(592525326,"Graphics processor not initialized");if(!(t<0||t>53)){for(var r=new Uint8Array(192),n=H[t],i=0;i<16;i++)for(var a=n[i],o=0;o<4;o++){var s=(a&3<<2*o)>>2*o,c=0==s?255:1==s?127:0,u=3*(4*i+o);r[u+0]=r[u+1]=r[u+2]=c?255:0}var h=new B.b(e,null,z,0,!0);return h.copyFromRGBABuffer(e,z,r,!1,!1,0,!1),h.tag=t,h}l.a.Error(592525327,"pattern out of range")}(e,o.pattern)),g+=performance.now(),e.getCurrentFramePerformanceSummary().patternTextureCostMs+=g}else if(c.a.IsGradient(s)){var _,m=-performance.now();5==s?((_=t instanceof B.a?t:void 0)&&_.isValid(e)&&_.tag==r.changeTracker.currentUniqueId||(r instanceof f.d?i=function(e,t,r,n){var i=e.getGraphicsProcessor();if(!i)throw l.a.Error(592525324,"Graphics processor not initialized");if(5!=n.getType())throw l.a.Error(592525325,"This is not a path gradient");var o=Object(f.i)(r,!1);if(!o||o.isEmpty()||!r.paths)return new B.a(e);var s=o.size.multiply(r.transform.scale.abs()),u=s.scale(Math.min(1,B.d/s.x,B.d/s.y)),h=new a.d(Math.floor(u.x+1),Math.floor(u.y+1)),d=B.a.RecycleOrReplace(t,e,h,!0,!1,!1);return d.tag=r.changeTracker.currentUniqueId,function(e,t,r,n,i,a){var o=U(r),s=o.colors,u=o.colors.length<4?c.b.Transparent:new c.b(s[s.length-4],s[s.length-3],s[s.length-2],s[s.length-1]),h=e.activateShaderProgram(2);h.begin(t.babylonTexture,u,!1);var l=h.getBabylonEffect(),f=h.getBabylonEngine();if(l.setInt("u_0",1),l.setVector2("u_1",i),l.setVector2("u_2",a),l.setFloatArray("bfrag_0",o.stops),l.setFloatArray4("bfrag_1",o.colors),l.setInt("ufrag_0",0),n){for(var d=Object(O.b)(),p=0,g=n;p<g.length;p++)for(var _=g[p],m=_.transform.toMatrix3(),b=Object(M.a)(_,d,!0).buffers,y=b.map((function(e){return f.createVertexBuffer(e)})),v=0;v<b.length;v++){var T=b[v].length/4-4;f.bindInstancesBuffer(y[v],V,!1),l.setMatrix3x3("u_3",m.m),h.drawQuadInstances(T),f._releaseBuffer(y[v])}h.disableInstanceAttribute("a_p1"),h.disableInstanceAttribute("a_p2")}h.end()}(i,d,n,r.paths,o.center,o.size.inverse()),d}(e,_,r,o):l.a.Error(592525320,"Path gradient only supported on Shape items")),m+=performance.now(),e.getCurrentFramePerformanceSummary().pathGradientTextureCostMs+=m):((_=t instanceof B.a?t:void 0)&&_.isValid(e)&&_.tag==o.changeTracker.currentUniqueId||(i=function(e,t,r){var n=e.getGraphicsProcessor();if(!n)throw l.a.Error(592525322,"Graphics processor not initialized");if(5==r.getType())throw l.a.Error(592525323,"pathGradient should not use this code");var i=2==r.getType()||4==r.getType(),o=new a.d(B.h,i?1:B.h),s=B.a.RecycleOrReplace(t,e,o,!0,!1,!1);return s.tag=r.changeTracker.currentUniqueId,function(e,t,r){var n=U(r),i=e.activateShaderProgram(2);i.begin(t.babylonTexture,c.b.Black,!1);var o=i.getBabylonEffect();i.setDummyPointerAttribute("a_p1"),i.setDummyPointerAttribute("a_p2"),o.setFloatArray("bfrag_0",n.stops),o.setFloatArray4("bfrag_1",n.colors),o.setInt("u_0",0);var s=r&&3==r.getType();if(o.setInt("ufrag_0",s?1:0),o.setInt("ufrag_3",r&&r.isGammaCorrected?1:0),r&&s){var u=r.fillToRect?r.fillToRect.center:new a.d(.5,.5),h=r.fillFromRect?u.subtract(r.fillFromRect.leftTop).divide(r.fillFromRect.size):u;o.setVector2("ufrag_2",h)}i.drawQuads(1),i.end()}(n,s,r),s}(e,_,o)),m+=performance.now(),e.getCurrentFramePerformanceSummary().gradientTextureCostMs+=m)}}else i=null;return t&&t!=i&&t.release(),i}}var j=new a.d(1024,1024);function U(e){for(var t=e.gradientStops.length,r=new Float32Array(t+2),n=new Float32Array(4*(t+2)),i=0;i<t+2;i++){var a=Math.min(Math.max(i-1,0),t-1),o=e.gradientStops[a].color;r[i]=0==i?0:i==t+1?1:e.gradientStops[a].position,n[4*i+0]=o.r,n[4*i+1]=o.g,n[4*i+2]=o.b,n[4*i+3]=o.a}return{stops:r,colors:n}}var W,V=[{attributeName:"a_p1",attributeSize:4,offset:16},{attributeName:"a_p2",attributeSize:4,offset:32}],z=new a.d(8,8),H=[[255,255,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[3,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0],[7,64,29,0,116,0,208,1,64,7,0,29,0,116,1,208],[1,208,0,116,0,29,64,7,208,1,116,0,29,0,7,64],[255,255,3,0,3,0,3,0,3,0,3,0,3,0,3,0],[7,208,29,116,116,29,208,7,208,7,116,29,29,116,7,208],[3,0,0,0,0,0,0,0,0,3,0,0,0,0,0,0],[3,0,0,0,0,3,0,0,3,0,0,0,0,3,0,0],[3,3,0,0,48,48,0,0,3,3,0,0,48,48,0,0],[3,3,48,48,3,3,48,48,3,3,48,48,3,3,48,48],[51,51,12,12,51,51,192,192,51,51,12,12,51,51,192,192],[51,51,204,204,51,51,204,192,51,51,204,204,51,51,192,204],[51,51,204,204,51,51,204,204,51,51,204,204,51,51,204,204],[63,63,204,204,243,243,204,204,63,63,204,204,243,243,204,204],[252,252,207,207,252,252,207,207,252,252,207,207,252,252,207,207],[252,252,255,255,207,207,255,255,252,252,255,255,207,207,255,255],[63,255,255,255,255,63,255,255,63,255,255,255,255,63,255,255],[255,255,255,255,255,255,255,252,255,255,255,255,255,255,252,255],[3,3,12,12,48,48,192,192,3,3,12,12,48,48,192,192],[192,192,48,48,12,12,3,3,192,192,48,48,12,12,3,3],[15,15,60,60,240,240,195,195,15,15,60,60,240,240,195,195],[240,240,60,60,15,15,195,195,240,240,60,60,15,15,195,195],[15,192,63,0,252,0,240,3,192,15,0,63,0,252,3,240],[3,240,0,252,0,63,192,15,240,3,252,0,63,0,15,192],[3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],[255,255,0,0,0,0,0,0,255,255,0,0,0,0,0,0],[204,204,204,204,204,204,204,204,204,204,204,204,204,204,204,204],[255,255,0,0,255,255,0,0,255,255,0,0,255,255,0,0],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[255,255,255,255,0,0,0,0,255,255,255,255,0,0,0,0],[0,0,0,0,3,3,12,12,48,48,192,192,0,0,0,0],[0,0,0,0,192,192,48,48,12,12,3,3,0,0,0,0],[255,0,0,0,0,0,0,0,0,255,0,0,0,0,0,0],[3,0,3,0,3,0,3,0,0,3,0,3,0,3,0,3],[3,0,0,3,12,0,0,48,192,0,0,192,48,0,0,12],[243,192,240,0,0,240,192,243,207,3,15,0,0,15,3,207],[3,192,12,48,48,12,192,3,3,192,12,48,48,12,192,3],[0,0,192,3,48,204,15,0,0,0,192,3,48,204,15,0],[0,192,0,48,0,12,0,3,192,3,48,12,12,48,3,192],[255,255,3,0,3,0,3,0,255,255,0,3,0,3,0,3],[3,3,204,12,48,48,12,204,3,3,192,12,48,48,204,192],[51,51,204,204,51,51,204,204,255,0,255,0,255,0,255,0],[0,0,192,0,0,3,192,0,0,0,3,0,0,192,3,0],[51,51,0,0,3,0,0,0,3,0,0,0,3,0,0,0],[3,0,0,0,48,48,0,0,0,3,0,0,48,48,0,0],[0,240,3,12,12,3,240,0,0,15,0,48,0,192,0,192],[255,255,60,60,255,255,195,195,255,255,60,60,255,255,195,195],[252,252,3,195,3,255,3,255,252,252,195,3,255,3,255,3],[255,255,3,3,3,3,3,3,255,255,3,3,3,3,3,3],[195,195,60,60,60,60,195,195,195,195,60,60,60,60,195,195],[255,0,255,0,255,0,255,0,0,255,0,255,0,255,0,255],[3,48,12,12,48,3,192,0,48,3,12,12,3,48,0,192],[192,0,240,3,252,15,255,63,252,15,240,3,192,0,0,0]];!function(e){e[e.fromBegining=0]="fromBegining",e[e.distanceFieldsReady=1]="distanceFieldsReady",e[e.brushTexturesReady=2]="brushTexturesReady",e[e.fadeReady=3]="fadeReady",e[e.effectsReady=4]="effectsReady"}(W||(W={}));var X=function(){function e(){this.cachedGraphicsProcessorId=-1,this.initTextureStage=W.fromBegining,this.isFillTextureDisposable=!1,this.isLineTextureDisposable=!1,this.isPictureTextureDisposable=!1}return e.prototype.checkIfUpdateNeeded=function(e,t){if(t.getUniqueGraphicsProcessorId()!=this.cachedGraphicsProcessorId&&this.clearTextures(),this.cachedGraphicsProcessorId=t.getUniqueGraphicsProcessorId(),e.version!=this.lastKnownShapeVersion&&(this.clearEffectsTextures(),this.lastKnownShapeVersion=e.version,this.drawDistribution=void 0),1==e.getType()){var r=e;r.geometryTracker.version!=this.lastKnownGeometryVersion&&(this.initTextureStage=W.fromBegining,this.lastKnownGeometryVersion=r.geometryTracker.version,this.setEffectsDirty())}},e.prototype.clearBounds=function(){this.initTextureStage=W.fromBegining},e.prototype.setEffectsDirty=function(){this.spriteTexture&&(this.spriteTexture.isDirty=!0)},e.prototype.clearEffectsTextures=function(){this.initTextureStage=W.fromBegining,this.fillTexture&&this.isFillTextureDisposable&&(this.fillTexture.release(),this.fillTexture=void 0),this.lineTexture&&this.isLineTextureDisposable&&(this.lineTexture.release(),this.lineTexture=void 0),this.pictureTexture&&this.isPictureTextureDisposable&&(this.pictureTexture.release(),this.pictureTexture=void 0),this.innerShadowTexture&&this.innerShadowTexture.release(),this.softEdgesTexture&&this.softEdgesTexture.release(),this.glowTexture&&this.glowTexture.release(),this.shadowTexture&&this.shadowTexture.release(),this.reflectionTexture&&this.reflectionTexture.release(),this.fadeTexture&&this.fadeTexture.release(),this.spriteTexture&&this.spriteTexture.release(),this.innerShadowTexture=this.softEdgesTexture=this.glowTexture=this.shadowTexture=this.reflectionTexture=this.fadeTexture=this.spriteTexture=void 0},e.prototype.clearTextures=function(){this.initTextureStage=W.fromBegining;for(var e=0,t=this.distanceFields||[];e<t.length;e++){var r=t[e];r&&r.release()}this.clearEffectsTextures(),this.distanceFields=void 0},e.prototype.clear=function(){this.clearBounds(),this.clearTextures()},e.prototype.initFadeTexture=function(e,t,r){if(e.getGraphicsProcessor()){var n=r?13==r.preset?t.changeTracker.currentUniqueId:r.param+":"+r.preset:"";if(!this.fadeTexture||r&&0!=r.preset&&this.fadeTexture.isValid(e)&&this.fadeTexture.tag==n||(this.fadeTexture.release(),this.fadeTexture=void 0),!this.fadeTexture)if(1==t.getType()&&r&&13==r.preset){var i=t;i.paths&&i.paths.length>0&&(this.fadeTexture=new L.a(e,void 0,1,i.mergeMode),this.fadeTexture.generateDrawFadeMask=!0,this.fadeTexture.refresh(e,t,!1,!1))}else r&&0!=r.preset&&13!=r.preset&&(this.fadeTexture=function(e,t,r,n,i){var a=e.getGraphicsProcessor();if(!a)throw l.a.Error(592525321,"Graphics processor not initialized");var o=B.a.RecycleOrReplace(t,e,j,!0,!1,!1);return o.tag=i,function(e,t,r,n){var i=e.activateShaderProgram(4);i.begin(t.babylonTexture,c.b.Black,!1);var a=i.getBabylonEffect();a.setInt("ufrag_0",r),a.setFloat("ufrag_1",n),i.drawQuads(1),i.end()}(a,o,r,n),o}(e,this.fadeTexture,r.preset,r.param,n))}},e.prototype.getBrushTexture=function(e){switch(e){case 0:return this.fillTexture;case 1:return this.lineTexture;case 2:return this.pictureTexture}l.a.Error(591192833,"Invalid brush source")},e.prototype.setBrushTexture=function(e,t,r){switch(e){case 0:this.fillTexture=t,this.isFillTextureDisposable=r;break;case 1:this.lineTexture=t,this.isLineTextureDisposable=r;break;case 2:this.pictureTexture=t,this.isPictureTextureDisposable=r;break;default:l.a.Error(591192834,"Invalid brush source")}},e.prototype.initBrushTexture=function(e,t,r){var n=Object(f.a)(t,r),i=this.getBrushTexture(r),a=G(e,i,t,r);i!=a&&this.setBrushTexture(r,a,!(n instanceof c.e))},e}(),q=r(22);function Y(e,t,r,n,i){var o=Object(f.a)(t,n);if(!o)return a.a.Identity;var s=o.getType();if(1==s)return a.a.Identity;if(7==s)return a.a.Scale2D(i.scale(1/16));var u=o.rotateWithShape,h=0,d=Object(f.i)(t,1==n,u?a.a.Scale2D(t.transform.scale):t.transform.toMatrix3());if(!d)return a.a.Identity;var p=d.size,g=c.a.IsGradient(s);if(6==s||g){var _=a.d.One,m=a.d.Zero,b=!0,y=4;if(6==s){var v=o;if(m=v.offset,_=v.scale.abs(),b=v.isStretched,y=v.alignment,b)_=_.multiply(p),m=m.multiply(p);else{var T=e.getTextureFromImage(v.image);T?_=_.multiply(T.originalSize):l.a.Error(590960595,"No texture")}}else if(5==s)_=p;else if(g){var x=o;if(_=x.fillFromRect?x.fillFromRect.size:a.d.One,m=(x.fillFromRect?x.fillFromRect.center:a.d.Zero).subtract(new a.d(.5,.5)).multiply(p),b=x.isStretched||4==s,2==s){_=_.multiply(p);var E=b?a.b.FromSize(a.d.One):a.b.FromSize(_),P=E.transformedBounds(a.a.RotationZ(x.angle));_=P?_.scale(P.width/E.width):_,h-=x.angle}else b?_=_.multiply(p):(_=_.scale(Math.max(p.x,p.y)),3==s&&(_=_.scale(Math.sqrt(p.x*p.x+p.y*p.y)/Math.max(p.x,p.y))))}else _=_.multiply(p);var S=new a.b(-p.x/2+_.x/2,-p.y/2+_.y/2,p.x/2-_.x/2,p.y/2-_.y/2);m=m.add(Object(f.g)(y,S)).multiply(new a.d(1,-1));var w=a.a.Identity;return w=(w=(w=w.multiply(a.a.Scale2D(new a.d(1,-1)))).multiply(a.a.Scale2D(t.transform.scale.abs()))).multiply(a.a.Scale2D(r.size)),u||(w=(w=w.multiply(a.a.Scale2D(t.transform.scale.sign()))).multiply(a.a.RotationZ(-t.transform.rotation))),w=w.multiply(a.a.Translation2D(m.negate())),2==s&&(b&&(w=w.multiply(a.a.Scale2D(p.inverse()))),w=w.multiply(a.a.RotationZ(-h)),b&&(w=w.multiply(a.a.Scale2D(p)))),(w=w.multiply(a.a.Scale2D(_.inverse()))).multiply(a.a.Scale2D(new a.d(1,-1)))}return a.a.Identity}function K(e,t,r,n,o,s,u,h,d,p){if((!p||0!=p.a||4==d)&&s.style){var g=s.isSolidRect();if(r||g){if(!g){if(r&&(!r.uvScale||!r.localBounds))return void l.a.Error(590960597,"Distance field uvScale or localBounds not initialized");if(r&&!r.babylonTexture)return void l.a.Error(590960598,"Distance field texture not initialized");if(void 0===s.distRangeSize)return void l.a.Error(590960599,"distRangeSize is null")}var _=!g&&r?r.localBounds:Object(f.i)(s,!1);if(_){var m=o.getBabylonEffect(),b=_.size,y=_.center,v=h.transformVector(b.multiply(s.transform.scale));e.getCurrentFramePerformanceSummary().pixelCountShapeRender+=Math.floor(v.x*v.y);var T=a.a.ScaleTranslation2D(b,y);m.setMatrix3x3("u_0",T.multiply(s.transform.toMatrix3()).m),m.setVector2("u_15",a.d.One),m.setMatrix3x3("u_1",h.m),m.setMatrix3x3("u_3",a.a.Scale2D(!g&&r&&r.uvScale?r.uvScale:a.d.One).m),m.setVector2("u_2",u),m.setFloat("ufrag_0",!g&&s.distRangeSize?.5/s.distRangeSize:1),m.setInt("ufrag_34",g?1:0),m.setFloat("ufrag_36",0),m.setInt("u_16",0),m.setFloat("u_17",0);var x=s.style.fillBrush?s.style.fillBrush.getType():0,E=6==x?t.fillTexture:void 0;6!=x||E||(x=0),m.setInt("ufrag_10",x),4==x?m.setFloatArray4("ufrag_3",Q(s.style.fillBrush)):m.setDirectColor4("ufrag_3",1==x?s.style.fillBrush.color:7==x?s.style.fillBrush.foregroundColor:c.b.Transparent),m.setInt("ufrag_18",6==x&&E&&4==E.wrapMode?1:0),m.setFloat("ufrag_20",6==x?s.style.fillBrush.opacity:1),m.setInt("u_13",7==x?1:0),m.setMatrix3x3("u_4",Y(e,s,_,0,u).m),m.setDirectColor4("ufrag_22",7==x?s.style.fillBrush.backgroundColor:c.b.Transparent),m.setFloat("ufrag_28",!g&&r?r.getFillBrightness():0);var P=t.pictureTexture;if(m.setInt("ufrag_30",P?1:0),P){var S=s.style.pictureBrush;m.setInt("ufrag_31",P&&4==P.wrapMode?1:0),m.setFloat("ufrag_32",S.opacity),m.setMatrix3x3("u_5",Y(e,s,_,2,u).m)}var w=s.style.lineBrush&&2!=d?s.style.lineBrush.getType():0,R=6==w?t.lineTexture:void 0;6!=w||R||(w=0);var C=s.style.hasLine?s.style.pen.adjustedLineWidth:0;m.setFloat("ufrag_1",C),m.setInt("ufrag_11",w),4==w?m.setFloatArray4("ufrag_4",Q(s.style.lineBrush)):m.setDirectColor4("ufrag_4",1==w?s.style.lineBrush.color:7==w?s.style.lineBrush.foregroundColor:c.b.Transparent),m.setInt("ufrag_19",6==w&&R&&4==R.wrapMode?1:0),m.setFloat("ufrag_21",6==w?s.style.lineBrush.opacity:1),m.setInt("u_14",7==w?1:0),m.setMatrix3x3("u_6",Y(e,s,_,1,u).m),m.setDirectColor4("ufrag_23",7==w?s.style.lineBrush.backgroundColor:c.b.Transparent),m.setFloat("ufrag_29",1==s.mergeMode?1:0),m.setFloat("ufrag_6",s.style.pen&&0!=s.style.pen.dashType&&s.style.pen.useRoundDash?1:0);var A=Object(L.d)(s);m.setFloatArray3("ufrag_8",A.centers),m.setFloatArray3("ufrag_9",A.slopes);var F=Math.sqrt(2)/2,B=new a.d(F,F),O=h.transformVector(B).length();m.setFloat("ufrag_2",1/O),m.setFloat("ufrag_27",Object(a.e)(Object(f.k)(s),-1,1)*C/2),m.setDirectColor4("ufrag_13",p||c.b.Transparent),m.setInt("ufrag_15",4==d?1:i.a==i.f?3:i.a!=i.b&&7!=i.a?i.a+10:0),i.a==i.i&&(m.setInt("ufrag_10",0),m.setInt("ufrag_11",1),m.setDirectColor4("ufrag_4",c.b.Red),m.setFloat("ufrag_1",3)),m.setFloat2("ufrag_12",1,1),m.setFloat2("u_12",0,1),m.setInt("ufrag_16",0),16&n&&s.effects&&s.effects.softEdges&&s.effects.softEdges.radius>0&&t.softEdgesTexture&&t.softEdgesTexture.babylonTexture&&t.softEdgesTexture.uvScale&&t.softEdgesTexture.localBounds?(m.setInt("ufrag_24",1),m.setVector2("u_7",t.softEdgesTexture.uvScale.multiply(b.divide(t.softEdgesTexture.localBounds.size)))):(m.setInt("ufrag_24",0),16&n&&s.effects&&s.effects.softEdges&&s.effects.softEdges.radius>0&&l.a.Error(590960601,"soft edges texture not ready")),8&n&&s.effects&&s.effects.innerShadow&&s.effects.innerShadow.color.a>0&&t.innerShadowTexture&&t.innerShadowTexture.babylonTexture&&t.innerShadowTexture.uvScale&&t.innerShadowTexture.localBounds?(m.setInt("ufrag_25",1),m.setVector2("u_8",t.innerShadowTexture.uvScale.multiply(b.divide(t.innerShadowTexture.localBounds.size))),m.setVector2("u_9",new a.d(s.effects.innerShadow.distance,0).rotate(-s.effects.innerShadow.angle).divide(b.multiply(s.transform.scale))),m.setDirectColor4("ufrag_26",s.effects.innerShadow.color)):(m.setInt("ufrag_25",0),8&n&&s.effects&&s.effects.innerShadow&&s.effects.innerShadow.color.a>0&&l.a.Error(590960602,"inner shadow  exture not ready")),o.setTexture("t_0",!g&&r?r.babylonTexture:void 0),o.setTexture("t_1",t.fillTexture?t.fillTexture.babylonTexture:void 0),o.setTexture("t_2",t.lineTexture?t.lineTexture.babylonTexture:void 0),o.setTexture("t_3",t.fadeTexture?t.fadeTexture.babylonTexture:void 0),o.setTexture("t_4",t.softEdgesTexture?t.softEdgesTexture.babylonTexture:void 0),o.setTexture("t_5",t.innerShadowTexture&&t.innerShadowTexture.babylonTexture?t.innerShadowTexture.babylonTexture:void 0),o.setTexture("t_6",t.pictureTexture&&t.pictureTexture.babylonTexture?t.pictureTexture.babylonTexture:void 0);var M=0;if(t.fade&&0==d){var D=t.fade;M=1;var k=D.reverse?1-D.progress:D.progress;if(m.setVector2("ufrag_17",D.getFadeScaleOffset(k,0)),0!=D.preset)if(t.fadeTexture&&t.fadeTexture.babylonTexture){M=2;var N=a.b.FromSizeAndCenter(t.fadeTexture.contentLocation.logicalSize,t.fadeTexture.contentLocation.logicalCenter.subtract(t.fadeTexture.contentLocation.physicalCenter)).divide(t.fadeTexture.size),G=a.b.FromSizeAndCenter(t.fadeTexture.contentLocation.physicalSize,a.d.Zero).divide(t.fadeTexture.size),j=a.a.Translation2D(N.leftTop.negate()).multiply(a.a.ScaleTranslation2D(G.size.divide(N.size),G.leftTop));m.setMatrix3x3("u_10",13==D.preset?j.multiply(Object(I.f)(t.fadeTexture)).m:j.multiply(D.getFadeTransform()).m)}else l.a.Error(590960603,"fade texture missing")}m.setInt("ufrag_16",M),m.setFloat("u_18",0),m.setFloat("u_19",0);var U=0==d;U&&3==s.style.blendingMode&&m.setDirectColor4("ufrag_13",c.b.White),m.setInt("ufrag_35",U&&1==s.style.blendingMode?1:0),o.setBlendingMode(U?s.style.blendingMode:0),m.setInt("ufrag_37",r&&2==r.distanceFieldMode?1:0),o.drawQuads(1)}else l.a.Error(590960600,"Unable to get bounds")}else l.a.Error(590960596,"Only solid rects can be drawn without distance fields")}}function Q(e){var t=e.fillToRect?e.fillToRect:new a.b(.5,.5,.5,.5),r=e.fillFromRect?e.fillFromRect:new a.b(0,0,1,1),n=t.translate(r.leftTop.negate()).multiply(r.size.inverse());return new Float32Array([1/n.left,1/n.top,1/(1-n.right),1/(1-n.bottom)])}var Z,J=function(){function e(e,t,r,n){void 0===t&&(t=!1),this.initalize(e,t,r,n)}return e.prototype.initalize=function(e,t,r,n){return void 0===t&&(t=!1),this.mask=e,this.skipNextObservers=t,this.target=r,this.currentTarget=n,this},e}(),$=function(e,t,r){void 0===r&&(r=null),this.callback=e,this.mask=t,this.scope=r,this._willBeUnregistered=!1,this.unregisterOnNextCall=!1},ee=(function(){function e(){}e.prototype.dispose=function(){if(this._observers&&this._observables)for(var e=0;e<this._observers.length;e++)this._observables[e].remove(this._observers[e]);this._observers=null,this._observables=null},e.Watch=function(t,r,n,i){void 0===n&&(n=-1),void 0===i&&(i=null);var a=new e;a._observers=new Array,a._observables=t;for(var o=0,s=t;o<s.length;o++){var c=s[o].add(r,n,!1,i);c&&a._observers.push(c)}return a}}(),function(){function e(e){this._observers=new Array,this._eventState=new J(0),e&&(this._onObserverAdded=e)}return Object.defineProperty(e.prototype,"observers",{get:function(){return this._observers},enumerable:!0,configurable:!0}),e.prototype.add=function(e,t,r,n,i){if(void 0===t&&(t=-1),void 0===r&&(r=!1),void 0===n&&(n=null),void 0===i&&(i=!1),!e)return null;var a=new $(e,t,n);return a.unregisterOnNextCall=i,r?this._observers.unshift(a):this._observers.push(a),this._onObserverAdded&&this._onObserverAdded(a),a},e.prototype.addOnce=function(e){return this.add(e,void 0,void 0,void 0,!0)},e.prototype.remove=function(e){return!!e&&-1!==this._observers.indexOf(e)&&(this._deferUnregister(e),!0)},e.prototype.removeCallback=function(e,t){for(var r=0;r<this._observers.length;r++){var n=this._observers[r];if(!(n._willBeUnregistered||n.callback!==e||t&&t!==n.scope))return this._deferUnregister(n),!0}return!1},e.prototype._deferUnregister=function(e){var t=this;e.unregisterOnNextCall=!1,e._willBeUnregistered=!0,setTimeout((function(){t._remove(e)}),0)},e.prototype._remove=function(e){if(!e)return!1;var t=this._observers.indexOf(e);return-1!==t&&(this._observers.splice(t,1),!0)},e.prototype.makeObserverTopPriority=function(e){this._remove(e),this._observers.unshift(e)},e.prototype.makeObserverBottomPriority=function(e){this._remove(e),this._observers.push(e)},e.prototype.notifyObservers=function(e,t,r,n){if(void 0===t&&(t=-1),!this._observers.length)return!0;var i=this._eventState;i.mask=t,i.target=r,i.currentTarget=n,i.skipNextObservers=!1,i.lastReturnValue=e;for(var a=0,o=this._observers;a<o.length;a++){var s=o[a];if(!s._willBeUnregistered&&(s.mask&t&&(s.scope?i.lastReturnValue=s.callback.apply(s.scope,[e,i]):i.lastReturnValue=s.callback(e,i),s.unregisterOnNextCall&&this._deferUnregister(s)),i.skipNextObservers))return!1}return!0},e.prototype.notifyObserversWithPromise=function(e,t,r,n){var i=this;void 0===t&&(t=-1);var a=Promise.resolve(e);if(!this._observers.length)return a;var o=this._eventState;return o.mask=t,o.target=r,o.currentTarget=n,o.skipNextObservers=!1,this._observers.forEach((function(r){o.skipNextObservers||r._willBeUnregistered||r.mask&t&&(a=r.scope?a.then((function(t){return o.lastReturnValue=t,r.callback.apply(r.scope,[e,o])})):a.then((function(t){return o.lastReturnValue=t,r.callback(e,o)})),r.unregisterOnNextCall&&i._deferUnregister(r))})),a.then((function(){return e}))},e.prototype.notifyObserver=function(e,t,r){void 0===r&&(r=-1);var n=this._eventState;n.mask=r,n.skipNextObservers=!1,e.callback(t,n)},e.prototype.hasObservers=function(){return this._observers.length>0},e.prototype.clear=function(){this._observers=new Array,this._onObserverAdded=null},e.prototype.clone=function(){var t=new e;return t._observers=this._observers.slice(0),t},e.prototype.hasSpecificMask=function(e){void 0===e&&(e=-1);for(var t=0,r=this._observers;t<r.length;t++){var n=r[t];if(n.mask&e||n.mask===e)return!0}return!1},e}()),te=function(){},re=function(){function e(){}return e.WarnImport=function(e){return e+" needs to be imported before as it contains a side-effect required by your code."},e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Url=1]="Url",e[e.Temp=2]="Temp",e[e.Raw=3]="Raw",e[e.Dynamic=4]="Dynamic",e[e.RenderTarget=5]="RenderTarget",e[e.MultiRenderTarget=6]="MultiRenderTarget",e[e.Cube=7]="Cube",e[e.CubeRaw=8]="CubeRaw",e[e.CubePrefiltered=9]="CubePrefiltered",e[e.Raw3D=10]="Raw3D",e[e.Raw2DArray=11]="Raw2DArray",e[e.Depth=12]="Depth",e[e.CubeRawRGBD=13]="CubeRawRGBD"}(Z||(Z={}));var ne=function(){function e(e,t,r){void 0===r&&(r=!1),this.isReady=!1,this.isCube=!1,this.is3D=!1,this.is2DArray=!1,this.isMultiview=!1,this.url="",this.samplingMode=-1,this.generateMipMaps=!1,this.samples=0,this.type=-1,this.format=-1,this.onLoadedObservable=new ee,this.width=0,this.height=0,this.depth=0,this.baseWidth=0,this.baseHeight=0,this.baseDepth=0,this.invertY=!1,this._invertVScale=!1,this._associatedChannel=-1,this._source=Z.Unknown,this._buffer=null,this._bufferView=null,this._bufferViewArray=null,this._bufferViewArrayArray=null,this._size=0,this._extension="",this._files=null,this._workingCanvas=null,this._workingContext=null,this._framebuffer=null,this._depthStencilBuffer=null,this._MSAAFramebuffer=null,this._MSAARenderBuffer=null,this._attachments=null,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedWrapR=null,this._cachedAnisotropicFilteringLevel=null,this._isDisabled=!1,this._compression=null,this._generateStencilBuffer=!1,this._generateDepthBuffer=!1,this._comparisonFunction=0,this._sphericalPolynomial=null,this._lodGenerationScale=0,this._lodGenerationOffset=0,this._colorTextureArray=null,this._depthStencilTextureArray=null,this._lodTextureHigh=null,this._lodTextureMid=null,this._lodTextureLow=null,this._isRGBD=!1,this._linearSpecularLOD=!1,this._irradianceTexture=null,this._webGLTexture=null,this._references=1,this._engine=e,this._source=t,r||(this._webGLTexture=e._createTexture())}return e.prototype.getEngine=function(){return this._engine},Object.defineProperty(e.prototype,"source",{get:function(){return this._source},enumerable:!0,configurable:!0}),e.prototype.incrementReferences=function(){this._references++},e.prototype.updateSize=function(e,t,r){void 0===r&&(r=1),this.width=e,this.height=t,this.depth=r,this.baseWidth=e,this.baseHeight=t,this.baseDepth=r,this._size=e*t*r},e.prototype._rebuild=function(){var t,r=this;switch(this.isReady=!1,this._cachedCoordinatesMode=null,this._cachedWrapU=null,this._cachedWrapV=null,this._cachedAnisotropicFilteringLevel=null,this.source){case Z.Temp:return;case Z.Url:return void(t=this._engine.createTexture(this.url,!this.generateMipMaps,this.invertY,null,this.samplingMode,(function(){t._swapAndDie(r),r.isReady=!0}),null,this._buffer,void 0,this.format));case Z.Raw:return(t=this._engine.createRawTexture(this._bufferView,this.baseWidth,this.baseHeight,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case Z.Raw3D:return(t=this._engine.createRawTexture3D(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case Z.Raw2DArray:return(t=this._engine.createRawTexture2DArray(this._bufferView,this.baseWidth,this.baseHeight,this.baseDepth,this.format,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case Z.Dynamic:return(t=this._engine.createDynamicTexture(this.baseWidth,this.baseHeight,this.generateMipMaps,this.samplingMode))._swapAndDie(this),void this._engine.updateDynamicTexture(this,this._engine.getRenderingCanvas(),this.invertY,void 0,void 0,!0);case Z.RenderTarget:var n=new te;if(n.generateDepthBuffer=this._generateDepthBuffer,n.generateMipMaps=this.generateMipMaps,n.generateStencilBuffer=this._generateStencilBuffer,n.samplingMode=this.samplingMode,n.type=this.type,this.isCube)t=this._engine.createRenderTargetCubeTexture(this.width,n);else{var i={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};t=this._engine.createRenderTargetTexture(i,n)}return t._swapAndDie(this),void(this.isReady=!0);case Z.Depth:var a={bilinearFiltering:2!==this.samplingMode,comparisonFunction:this._comparisonFunction,generateStencil:this._generateStencilBuffer,isCube:this.isCube},o={width:this.width,height:this.height,layers:this.is2DArray?this.depth:void 0};return(t=this._engine.createDepthStencilTexture(o,a))._swapAndDie(this),void(this.isReady=!0);case Z.Cube:return void(t=this._engine.createCubeTexture(this.url,null,this._files,!this.generateMipMaps,(function(){t._swapAndDie(r),r.isReady=!0}),null,this.format,this._extension));case Z.CubeRaw:return(t=this._engine.createRawCubeTexture(this._bufferViewArray,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression))._swapAndDie(this),void(this.isReady=!0);case Z.CubeRawRGBD:return t=this._engine.createRawCubeTexture(null,this.width,this.format,this.type,this.generateMipMaps,this.invertY,this.samplingMode,this._compression),void e._UpdateRGBDAsync(t,this._bufferViewArrayArray,this._sphericalPolynomial,this._lodGenerationScale,this._lodGenerationOffset).then((function(){t._swapAndDie(r),r.isReady=!0}));case Z.CubePrefiltered:return void((t=this._engine.createPrefilteredCubeTexture(this.url,null,this._lodGenerationScale,this._lodGenerationOffset,(function(e){e&&e._swapAndDie(r),r.isReady=!0}),null,this.format,this._extension))._sphericalPolynomial=this._sphericalPolynomial)}},e.prototype._swapAndDie=function(e){e._webGLTexture=this._webGLTexture,e._isRGBD=this._isRGBD,this._framebuffer&&(e._framebuffer=this._framebuffer),this._depthStencilBuffer&&(e._depthStencilBuffer=this._depthStencilBuffer),e._depthStencilTexture=this._depthStencilTexture,this._lodTextureHigh&&(e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureHigh=this._lodTextureHigh),this._lodTextureMid&&(e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureMid=this._lodTextureMid),this._lodTextureLow&&(e._lodTextureLow&&e._lodTextureLow.dispose(),e._lodTextureLow=this._lodTextureLow),this._irradianceTexture&&(e._irradianceTexture&&e._irradianceTexture.dispose(),e._irradianceTexture=this._irradianceTexture);var t,r=this._engine.getLoadedTexturesCache();-1!==(t=r.indexOf(this))&&r.splice(t,1),-1===(t=r.indexOf(e))&&r.push(e)},e.prototype.dispose=function(){this._webGLTexture&&(this._references--,0===this._references&&(this._engine._releaseTexture(this),this._webGLTexture=null))},e._UpdateRGBDAsync=function(e,t,r,n,i){throw re.WarnImport("environmentTextureTools")},e}(),ie=function(){function e(){}return e._AddLogEntry=function(t){e._LogCache=t+e._LogCache,e.OnNewCacheEntry&&e.OnNewCacheEntry(t)},e._FormatMessage=function(e){var t=function(e){return e<10?"0"+e:""+e},r=new Date;return"["+t(r.getHours())+":"+t(r.getMinutes())+":"+t(r.getSeconds())+"]: "+e},e._LogDisabled=function(e){},e._LogEnabled=function(t){var r=e._FormatMessage(t);console.log("BJS - "+r);var n="<div style='color:white'>"+r+"</div><br>";e._AddLogEntry(n)},e._WarnDisabled=function(e){},e._WarnEnabled=function(t){var r=e._FormatMessage(t);console.warn("BJS - "+r);var n="<div style='color:orange'>"+r+"</div><br>";e._AddLogEntry(n)},e._ErrorDisabled=function(e){},e._ErrorEnabled=function(t){e.errorsCount++;var r=e._FormatMessage(t);console.error("BJS - "+r);var n="<div style='color:red'>"+r+"</div><br>";e._AddLogEntry(n)},Object.defineProperty(e,"LogCache",{get:function(){return e._LogCache},enumerable:!0,configurable:!0}),e.ClearLogCache=function(){e._LogCache="",e.errorsCount=0},Object.defineProperty(e,"LogLevels",{set:function(t){(t&e.MessageLogLevel)===e.MessageLogLevel?e.Log=e._LogEnabled:e.Log=e._LogDisabled,(t&e.WarningLogLevel)===e.WarningLogLevel?e.Warn=e._WarnEnabled:e.Warn=e._WarnDisabled,(t&e.ErrorLogLevel)===e.ErrorLogLevel?e.Error=e._ErrorEnabled:e.Error=e._ErrorDisabled},enumerable:!0,configurable:!0}),e.NoneLogLevel=0,e.MessageLogLevel=1,e.WarningLogLevel=2,e.ErrorLogLevel=4,e.AllLogLevel=7,e._LogCache="",e.errorsCount=0,e.Log=e._LogEnabled,e.Warn=e._WarnEnabled,e.Error=e._ErrorEnabled,e}(),ae=function(){function e(){}return Object.defineProperty(e,"LastCreatedEngine",{get:function(){return 0===this.Instances.length?null:this.Instances[this.Instances.length-1]},enumerable:!0,configurable:!0}),Object.defineProperty(e,"LastCreatedScene",{get:function(){return this._LastCreatedScene},enumerable:!0,configurable:!0}),e.Instances=new Array,e._LastCreatedScene=null,e.UseFallbackTexture=!0,e.FallbackTexture="",e}(),oe=function(){function e(){}return e.IsWindowObjectExist=function(){return"undefined"!=typeof window},e.IsNavigatorAvailable=function(){return"undefined"!=typeof navigator},e.GetDOMTextContent=function(e){for(var t="",r=e.firstChild;r;)3===r.nodeType&&(t+=r.textContent),r=r.nextSibling;return t},e}(),se=function(){function e(){}return e.EndsWith=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},e.StartsWith=function(e,t){return 0===e.indexOf(t)},e.Decode=function(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return t},e.EncodeArrayBufferToBase64=function(e){for(var t,r,n,i,a,o,s,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u="",h=0,l=ArrayBuffer.isView(e)?new Uint8Array(e.buffer,e.byteOffset,e.byteLength):new Uint8Array(e);h<l.length;)i=(t=l[h++])>>2,a=(3&t)<<4|(r=h<l.length?l[h++]:Number.NaN)>>4,o=(15&r)<<2|(n=h<l.length?l[h++]:Number.NaN)>>6,s=63&n,isNaN(r)?o=s=64:isNaN(n)&&(s=64),u+=c.charAt(i)+c.charAt(a)+c.charAt(o)+c.charAt(s);return u},e}(),ce=function(){function e(){this.children=[]}return e.prototype.isValid=function(e){return!0},e.prototype.process=function(e,t){var r="";if(this.line){var n=this.line,i=t.processor;i&&(i.lineProcessor&&(n=i.lineProcessor(n,t.isFragment)),i.attributeProcessor&&se.StartsWith(this.line,"attribute")?n=i.attributeProcessor(this.line):i.varyingProcessor&&se.StartsWith(this.line,"varying")?n=i.varyingProcessor(this.line,t.isFragment):(i.uniformProcessor||i.uniformBufferProcessor)&&se.StartsWith(this.line,"uniform")&&(/uniform (.+) (.+)/.test(this.line)?i.uniformProcessor&&(n=i.uniformProcessor(this.line,t.isFragment)):i.uniformBufferProcessor&&(n=i.uniformBufferProcessor(this.line,t.isFragment),t.lookForClosingBracketForUniformBuffer=!0)),i.endOfUniformBufferProcessor&&t.lookForClosingBracketForUniformBuffer&&-1!==this.line.indexOf("}")&&(t.lookForClosingBracketForUniformBuffer=!1,n=i.endOfUniformBufferProcessor(this.line,t.isFragment))),r+=n+"\r\n"}return this.children.forEach((function(n){r+=n.process(e,t)})),this.additionalDefineKey&&(e[this.additionalDefineKey]=this.additionalDefineValue||"true"),r},e}(),ue=function(){function e(){}return Object.defineProperty(e.prototype,"currentLine",{get:function(){return this._lines[this.lineIndex]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canRead",{get:function(){return this.lineIndex<this._lines.length-1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lines",{set:function(e){this._lines=[];for(var t=0,r=e;t<r.length;t++){var n=r[t];if("#"!==n[0])for(var i=n.split(";"),a=0;a<i.length;a++){var o=i[a];(o=o.trim())&&this._lines.push(o+(a!==i.length-1?";":""))}else this._lines.push(n)}},enumerable:!0,configurable:!0}),e}(),he=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(n.c)(t,e),t.prototype.process=function(e,t){for(var r=0;r<this.children.length;r++){var n=this.children[r];if(n.isValid(e))return n.process(e,t)}return""},t}(ce),le=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(n.c)(t,e),t.prototype.isValid=function(e){return this.testExpression.isTrue(e)},t}(ce),fe=function(){function e(){}return e.prototype.isTrue=function(e){return!0},e}(),de=function(e){function t(t,r){void 0===r&&(r=!1);var n=e.call(this)||this;return n.define=t,n.not=r,n}return Object(n.c)(t,e),t.prototype.isTrue=function(e){var t=void 0!==e[this.define];return this.not&&(t=!t),t},t}(fe),pe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(n.c)(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)||this.rightOperand.isTrue(e)},t}(fe),ge=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(n.c)(t,e),t.prototype.isTrue=function(e){return this.leftOperand.isTrue(e)&&this.rightOperand.isTrue(e)},t}(fe),_e=function(e){function t(t,r,n){var i=e.call(this)||this;return i.define=t,i.operand=r,i.testValue=n,i}return Object(n.c)(t,e),t.prototype.isTrue=function(e){var t=e[this.define];void 0===t&&(t=this.define);var r=!1,n=parseInt(t),i=parseInt(this.testValue);switch(this.operand){case">":r=n>i;break;case"<":r=n<i;break;case"<=":r=n<=i;break;case">=":r=n>=i;break;case"==":r=n===i}return r},t}(fe),me=function(){function e(){}return e.Process=function(e,t,r){var n=this;this._ProcessIncludes(e,t,(function(e){var i=n._ProcessShaderConversion(e,t);r(i)}))},e._ProcessPrecision=function(e,t){var r=t.shouldUseHighPrecisionShader;return-1===e.indexOf("precision highp float")?e=r?"precision highp float;\n"+e:"precision mediump float;\n"+e:r||(e=e.replace("precision highp float","precision mediump float")),e},e._ExtractOperation=function(e){var t=/defined\((.+)\)/.exec(e);if(t&&t.length)return new de(t[1].trim(),"!"===e[0]);for(var r="",n=0,i=0,a=["==",">=","<=","<",">"];i<a.length&&(r=a[i],!((n=e.indexOf(r))>-1));i++);if(-1===n)return new de(e);var o=e.substring(0,n).trim(),s=e.substring(n+r.length).trim();return new _e(o,r,s)},e._BuildSubExpression=function(e){var t=e.indexOf("||");if(-1===t){var r=e.indexOf("&&");if(r>-1){var n=new ge,i=e.substring(0,r).trim(),a=e.substring(r+2).trim();return n.leftOperand=this._BuildSubExpression(i),n.rightOperand=this._BuildSubExpression(a),n}return this._ExtractOperation(e)}var o=new pe;return i=e.substring(0,t).trim(),a=e.substring(t+2).trim(),o.leftOperand=this._BuildSubExpression(i),o.rightOperand=this._BuildSubExpression(a),o},e._BuildExpression=function(e,t){var r=new le,n=e.substring(0,t),i=e.substring(t).trim();return r.testExpression="#ifdef"===n?new de(i):"#ifndef"===n?new de(i,!0):this._BuildSubExpression(i),r},e._MoveCursorWithinIf=function(e,t,r){for(var n=e.currentLine;this._MoveCursor(e,r);){var i=(n=e.currentLine).substring(0,5).toLowerCase();if("#else"===i){var a=new ce;return t.children.push(a),void this._MoveCursor(e,a)}if("#elif"===i){var o=this._BuildExpression(n,5);t.children.push(o),r=o}}},e._MoveCursor=function(e,t){for(;e.canRead;){e.lineIndex++;var r=e.currentLine,n=/(#ifdef)|(#else)|(#elif)|(#endif)|(#ifndef)|(#if)/.exec(r);if(n&&n.length)switch(n[0]){case"#ifdef":var i=new he;t.children.push(i);var a=this._BuildExpression(r,6);i.children.push(a),this._MoveCursorWithinIf(e,i,a);break;case"#else":case"#elif":return!0;case"#endif":return!1;case"#ifndef":i=new he,t.children.push(i),a=this._BuildExpression(r,7),i.children.push(a),this._MoveCursorWithinIf(e,i,a);break;case"#if":i=new he,a=this._BuildExpression(r,3),t.children.push(i),i.children.push(a),this._MoveCursorWithinIf(e,i,a)}else{var o=new ce;if(o.line=r,t.children.push(o),"#"===r[0]&&"d"===r[1]){var s=r.replace(";","").split(" ");o.additionalDefineKey=s[1],3===s.length&&(o.additionalDefineValue=s[2])}}}return!1},e._EvaluatePreProcessors=function(e,t,r){var n=new ce,i=new ue;return i.lineIndex=-1,i.lines=e.split("\n"),this._MoveCursor(i,n),n.process(t,r)},e._PreparePreProcessors=function(e){for(var t={},r=0,n=e.defines;r<n.length;r++){var i=n[r].replace("#define","").replace(";","").trim().split(" ");t[i[0]]=i.length>1?i[1]:""}return t.GL_ES="true",t.__VERSION__=e.version,t[e.platformName]="true",t},e._ProcessShaderConversion=function(e,t){var r=this._ProcessPrecision(e,t);if(!t.processor)return r;if(-1!==r.indexOf("#version 3"))return r.replace("#version 300 es","");var n=t.defines,i=this._PreparePreProcessors(t);return t.processor.preProcessor&&(r=t.processor.preProcessor(r,n,t.isFragment)),r=this._EvaluatePreProcessors(r,i,t),t.processor.postProcessor&&(r=t.processor.postProcessor(r,n,t.isFragment)),r},e._ProcessIncludes=function(t,r,n){for(var i=this,a=/#include<(.+)>(\((.*)\))*(\[(.*)\])*/g,o=a.exec(t),s=new String(t);null!=o;){var c=o[1];if(-1!==c.indexOf("__decl__")&&(c=c.replace(/__decl__/,""),r.supportsUniformBuffers&&(c=(c=c.replace(/Vertex/,"Ubo")).replace(/Fragment/,"Ubo")),c+="Declaration"),!r.includesShadersStore[c]){var u=r.shadersRepository+"ShadersInclude/"+c+".fx";return void e._FileToolsLoadFile(u,(function(e){r.includesShadersStore[c]=e,i._ProcessIncludes(s,r,n)}))}var h=r.includesShadersStore[c];if(o[2])for(var l=o[3].split(","),f=0;f<l.length;f+=2){var d=new RegExp(l[f],"g"),p=l[f+1];h=h.replace(d,p)}if(o[4]){var g=o[5];if(-1!==g.indexOf("..")){var _=g.split(".."),m=parseInt(_[0]),b=parseInt(_[1]),y=h.slice(0);h="",isNaN(b)&&(b=r.indexParameters[_[1]]);for(var v=m;v<b;v++)r.supportsUniformBuffers||(y=y.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),h+=y.replace(/\{X\}/g,v.toString())+"\n"}else r.supportsUniformBuffers||(h=h.replace(/light\{X\}.(\w*)/g,(function(e,t){return t+"{X}"}))),h=h.replace(/\{X\}/g,g)}s=s.replace(o[0],h),o=a.exec(t)}n(s)},e._FileToolsLoadFile=function(e,t,r,n,i,a){throw re.WarnImport("FileTools")},e}(),be=function(){function e(t,r,n,i,a,o,s,c,u,h){var l,f,d=this;if(void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),void 0===c&&(c=null),void 0===u&&(u=null),this.name=null,this.defines="",this.onCompiled=null,this.onError=null,this.onBind=null,this.uniqueId=0,this.onCompileObservable=new ee,this.onErrorObservable=new ee,this._onBindObservable=null,this._wasPreviouslyReady=!1,this._bonesComputationForcedToCPU=!1,this._uniformBuffersNames={},this._samplers={},this._isReady=!1,this._compilationError="",this._allFallbacksProcessed=!1,this._uniforms={},this._key="",this._fallbacks=null,this._vertexSourceCode="",this._fragmentSourceCode="",this._vertexSourceCodeOverride="",this._fragmentSourceCodeOverride="",this._transformFeedbackVaryings=null,this._pipelineContext=null,this._valueCache={},this.name=t,r.attributes){var p=r;if(this._engine=n,this._attributesNames=p.attributes,this._uniformsNames=p.uniformsNames.concat(p.samplers),this._samplerList=p.samplers.slice(),this.defines=p.defines,this.onError=p.onError,this.onCompiled=p.onCompiled,this._fallbacks=p.fallbacks,this._indexParameters=p.indexParameters,this._transformFeedbackVaryings=p.transformFeedbackVaryings||null,p.uniformBuffersNames)for(var g=0;g<p.uniformBuffersNames.length;g++)this._uniformBuffersNames[p.uniformBuffersNames[g]]=g}else this._engine=a,this.defines=null==o?"":o,this._uniformsNames=n.concat(i),this._samplerList=i?i.slice():[],this._attributesNames=r,this.onError=u,this.onCompiled=c,this._indexParameters=h,this._fallbacks=s;this._attributeLocationByName={},this.uniqueId=e._uniqueIdSeed++;var _=oe.IsWindowObjectExist()?this._engine.getHostDocument():null;t.vertexSource?l="source:"+t.vertexSource:t.vertexElement?(l=_?_.getElementById(t.vertexElement):null)||(l=t.vertexElement):l=t.vertex||t,t.fragmentSource?f="source:"+t.fragmentSource:t.fragmentElement?(f=_?_.getElementById(t.fragmentElement):null)||(f=t.fragmentElement):f=t.fragment||t;var m={defines:this.defines.split("\n"),indexParameters:this._indexParameters,isFragment:!1,shouldUseHighPrecisionShader:this._engine._shouldUseHighPrecisionShader,processor:this._engine._shaderProcessor,supportsUniformBuffers:this._engine.supportsUniformBuffers,shadersRepository:e.ShadersRepository,includesShadersStore:e.IncludesShadersStore,version:(100*this._engine.webGLVersion).toString(),platformName:this._engine.webGLVersion>=2?"WEBGL2":"WEBGL1"};this._loadShader(l,"Vertex","",(function(e){d._loadShader(f,"Fragment","Pixel",(function(r){me.Process(e,m,(function(e){m.isFragment=!0,me.Process(r,m,(function(r){d._useFinalCode(e,r,t)}))}))}))}))}return Object.defineProperty(e.prototype,"onBindObservable",{get:function(){return this._onBindObservable||(this._onBindObservable=new ee),this._onBindObservable},enumerable:!0,configurable:!0}),e.prototype._useFinalCode=function(e,t,r){if(r){var n=r.vertexElement||r.vertex||r.spectorName||r,i=r.fragmentElement||r.fragment||r.spectorName||r;this._vertexSourceCode="#define SHADER_NAME vertex:"+n+"\n"+e,this._fragmentSourceCode="#define SHADER_NAME fragment:"+i+"\n"+t}else this._vertexSourceCode=e,this._fragmentSourceCode=t;this._prepareEffect()},Object.defineProperty(e.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),e.prototype.isReady=function(){try{return this._isReadyInternal()}catch(e){return!1}},e.prototype._isReadyInternal=function(){return!!this._isReady||!!this._pipelineContext&&this._pipelineContext.isReady},e.prototype.getEngine=function(){return this._engine},e.prototype.getPipelineContext=function(){return this._pipelineContext},e.prototype.getAttributesNames=function(){return this._attributesNames},e.prototype.getAttributeLocation=function(e){return this._attributes[e]},e.prototype.getAttributeLocationByName=function(e){return this._attributeLocationByName[e]},e.prototype.getAttributesCount=function(){return this._attributes.length},e.prototype.getUniformIndex=function(e){return this._uniformsNames.indexOf(e)},e.prototype.getUniform=function(e){return this._uniforms[e]},e.prototype.getSamplers=function(){return this._samplerList},e.prototype.getCompilationError=function(){return this._compilationError},e.prototype.allFallbacksProcessed=function(){return this._allFallbacksProcessed},e.prototype.executeWhenCompiled=function(e){var t=this;this.isReady()?e(this):(this.onCompileObservable.add((function(t){e(t)})),this._pipelineContext&&!this._pipelineContext.isAsync||setTimeout((function(){t._checkIsReady(null)}),16))},e.prototype._checkIsReady=function(e){var t=this;try{if(this._isReadyInternal())return}catch(t){return void this._processCompilationErrors(t,e)}setTimeout((function(){t._checkIsReady(e)}),16)},e.prototype._loadShader=function(t,r,n,i){var a;"undefined"!=typeof HTMLElement&&t instanceof HTMLElement?i(oe.GetDOMTextContent(t)):"source:"!==t.substr(0,7)?"base64:"!==t.substr(0,7)?e.ShadersStore[t+r+"Shader"]?i(e.ShadersStore[t+r+"Shader"]):n&&e.ShadersStore[t+n+"Shader"]?i(e.ShadersStore[t+n+"Shader"]):(a="."===t[0]||"/"===t[0]||t.indexOf("http")>-1?t:e.ShadersRepository+t,this._engine._loadFile(a+"."+r.toLowerCase()+".fx",i)):i(window.atob(t.substr(7))):i(t.substr(7))},e.prototype._rebuildProgram=function(e,t,r,n){var i=this;this._isReady=!1,this._vertexSourceCodeOverride=e,this._fragmentSourceCodeOverride=t,this.onError=function(e,t){n&&n(t)},this.onCompiled=function(){var e=i.getEngine().scenes;if(e)for(var t=0;t<e.length;t++)e[t].markAllMaterialsAsDirty(31);i._pipelineContext._handlesSpectorRebuildCallback(r)},this._fallbacks=null,this._prepareEffect()},e.prototype._prepareEffect=function(){var e=this,t=this._attributesNames,r=this.defines;this._valueCache={};var n=this._pipelineContext;try{var i=this._engine;this._pipelineContext=i.createPipelineContext();var a=this._rebuildProgram.bind(this);this._vertexSourceCodeOverride&&this._fragmentSourceCodeOverride?i._preparePipelineContext(this._pipelineContext,this._vertexSourceCodeOverride,this._fragmentSourceCodeOverride,!0,a,null,this._transformFeedbackVaryings):i._preparePipelineContext(this._pipelineContext,this._vertexSourceCode,this._fragmentSourceCode,!1,a,r,this._transformFeedbackVaryings),i._executeWhenRenderingStateIsCompiled(this._pipelineContext,(function(){if(i.supportsUniformBuffers)for(var r in e._uniformBuffersNames)e.bindUniformBlock(r,e._uniformBuffersNames[r]);var a;if(i.getUniforms(e._pipelineContext,e._uniformsNames).forEach((function(t,r){e._uniforms[e._uniformsNames[r]]=t})),e._attributes=i.getAttributes(e._pipelineContext,t),t)for(var o=0;o<t.length;o++){var s=t[o];e._attributeLocationByName[s]=e._attributes[o]}for(a=0;a<e._samplerList.length;a++)null==e.getUniform(e._samplerList[a])&&(e._samplerList.splice(a,1),a--);e._samplerList.forEach((function(t,r){e._samplers[t]=r})),i.bindSamplers(e),e._compilationError="",e._isReady=!0,e.onCompiled&&e.onCompiled(e),e.onCompileObservable.notifyObservers(e),e.onCompileObservable.clear(),e._fallbacks&&e._fallbacks.unBindMesh(),n&&e.getEngine()._deletePipelineContext(n)})),this._pipelineContext.isAsync&&this._checkIsReady(n)}catch(e){this._processCompilationErrors(e,n)}},e.prototype._processCompilationErrors=function(e,t){void 0===t&&(t=null),this._compilationError=e.message;var r=this._attributesNames,n=this._fallbacks;ie.Error("Unable to compile effect:"),ie.Error("Uniforms: "+this._uniformsNames.map((function(e){return" "+e}))),ie.Error("Attributes: "+r.map((function(e){return" "+e}))),ie.Error("Defines:\r\n"+this.defines),ie.Error("Error: "+this._compilationError),t&&(this._pipelineContext=t,this._isReady=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this)),n?(this._pipelineContext=null,n.hasMoreFallbacks?(this._allFallbacksProcessed=!1,ie.Error("Trying next fallback."),this.defines=n.reduce(this.defines,this),this._prepareEffect()):(this._allFallbacksProcessed=!0,this.onError&&this.onError(this,this._compilationError),this.onErrorObservable.notifyObservers(this),this.onErrorObservable.clear(),this._fallbacks&&this._fallbacks.unBindMesh())):this._allFallbacksProcessed=!0},Object.defineProperty(e.prototype,"isSupported",{get:function(){return""===this._compilationError},enumerable:!0,configurable:!0}),e.prototype._bindTexture=function(e,t){this._engine._bindTexture(this._samplers[e],t)},e.prototype.setTexture=function(e,t){this._engine.setTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setDepthStencilTexture=function(e,t){this._engine.setDepthStencilTexture(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureArray=function(e,t){var r=e+"Ex";if(-1===this._samplerList.indexOf(r+"0")){for(var n=this._samplerList.indexOf(e),i=1;i<t.length;i++){var a=r+(i-1).toString();this._samplerList.splice(n+i,0,a)}for(var o=0,s=0,c=this._samplerList;s<c.length;s++){var u=c[s];this._samplers[u]=o,o+=1}}this._engine.setTextureArray(this._samplers[e],this._uniforms[e],t)},e.prototype.setTextureFromPostProcess=function(e,t){this._engine.setTextureFromPostProcess(this._samplers[e],t)},e.prototype.setTextureFromPostProcessOutput=function(e,t){this._engine.setTextureFromPostProcessOutput(this._samplers[e],t)},e.prototype._cacheMatrix=function(e,t){var r=this._valueCache[e],n=t.updateFlag;return(void 0===r||r!==n)&&(this._valueCache[e]=n,!0)},e.prototype._cacheFloat2=function(e,t,r){var n=this._valueCache[e];if(!n||2!==n.length)return n=[t,r],this._valueCache[e]=n,!0;var i=!1;return n[0]!==t&&(n[0]=t,i=!0),n[1]!==r&&(n[1]=r,i=!0),i},e.prototype._cacheFloat3=function(e,t,r,n){var i=this._valueCache[e];if(!i||3!==i.length)return i=[t,r,n],this._valueCache[e]=i,!0;var a=!1;return i[0]!==t&&(i[0]=t,a=!0),i[1]!==r&&(i[1]=r,a=!0),i[2]!==n&&(i[2]=n,a=!0),a},e.prototype._cacheFloat4=function(e,t,r,n,i){var a=this._valueCache[e];if(!a||4!==a.length)return a=[t,r,n,i],this._valueCache[e]=a,!0;var o=!1;return a[0]!==t&&(a[0]=t,o=!0),a[1]!==r&&(a[1]=r,o=!0),a[2]!==n&&(a[2]=n,o=!0),a[3]!==i&&(a[3]=i,o=!0),o},e.prototype.bindUniformBuffer=function(t,r){var n=this._uniformBuffersNames[r];void 0!==n&&e._baseCache[n]!==t&&(e._baseCache[n]=t,this._engine.bindUniformBufferBase(t,n))},e.prototype.bindUniformBlock=function(e,t){this._engine.bindUniformBlock(this._pipelineContext,e,t)},e.prototype.setInt=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t),this)},e.prototype.setIntArray=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray(this._uniforms[e],t),this},e.prototype.setIntArray2=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray2(this._uniforms[e],t),this},e.prototype.setIntArray3=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray3(this._uniforms[e],t),this},e.prototype.setIntArray4=function(e,t){return this._valueCache[e]=null,this._engine.setIntArray4(this._uniforms[e],t),this},e.prototype.setFloatArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},e.prototype.setFloatArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},e.prototype.setFloatArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},e.prototype.setFloatArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},e.prototype.setArray=function(e,t){return this._valueCache[e]=null,this._engine.setArray(this._uniforms[e],t),this},e.prototype.setArray2=function(e,t){return this._valueCache[e]=null,this._engine.setArray2(this._uniforms[e],t),this},e.prototype.setArray3=function(e,t){return this._valueCache[e]=null,this._engine.setArray3(this._uniforms[e],t),this},e.prototype.setArray4=function(e,t){return this._valueCache[e]=null,this._engine.setArray4(this._uniforms[e],t),this},e.prototype.setMatrices=function(e,t){return t?(this._valueCache[e]=null,this._engine.setMatrices(this._uniforms[e],t),this):this},e.prototype.setMatrix=function(e,t){return this._cacheMatrix(e,t)&&this._engine.setMatrices(this._uniforms[e],t.toArray()),this},e.prototype.setMatrix3x3=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix3x3(this._uniforms[e],t),this},e.prototype.setMatrix2x2=function(e,t){return this._valueCache[e]=null,this._engine.setMatrix2x2(this._uniforms[e],t),this},e.prototype.setFloat=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setFloat(this._uniforms[e],t),this)},e.prototype.setBool=function(e,t){var r=this._valueCache[e];return void 0!==r&&r===t?this:(this._valueCache[e]=t,this._engine.setInt(this._uniforms[e],t?1:0),this)},e.prototype.setVector2=function(e,t){return this._cacheFloat2(e,t.x,t.y)&&this._engine.setFloat2(this._uniforms[e],t.x,t.y),this},e.prototype.setFloat2=function(e,t,r){return this._cacheFloat2(e,t,r)&&this._engine.setFloat2(this._uniforms[e],t,r),this},e.prototype.setVector3=function(e,t){return this._cacheFloat3(e,t.x,t.y,t.z)&&this._engine.setFloat3(this._uniforms[e],t.x,t.y,t.z),this},e.prototype.setFloat3=function(e,t,r,n){return this._cacheFloat3(e,t,r,n)&&this._engine.setFloat3(this._uniforms[e],t,r,n),this},e.prototype.setVector4=function(e,t){return this._cacheFloat4(e,t.x,t.y,t.z,t.w)&&this._engine.setFloat4(this._uniforms[e],t.x,t.y,t.z,t.w),this},e.prototype.setFloat4=function(e,t,r,n,i){return this._cacheFloat4(e,t,r,n,i)&&this._engine.setFloat4(this._uniforms[e],t,r,n,i),this},e.prototype.setColor3=function(e,t){return this._cacheFloat3(e,t.r,t.g,t.b)&&this._engine.setFloat3(this._uniforms[e],t.r,t.g,t.b),this},e.prototype.setColor4=function(e,t,r){return this._cacheFloat4(e,t.r,t.g,t.b,r)&&this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,r),this},e.prototype.setDirectColor4=function(e,t){return this._cacheFloat4(e,t.r,t.g,t.b,t.a)&&this._engine.setFloat4(this._uniforms[e],t.r,t.g,t.b,t.a),this},e.prototype.dispose=function(){this._engine._releaseEffect(this)},e.RegisterShader=function(t,r,n){r&&(e.ShadersStore[t+"PixelShader"]=r),n&&(e.ShadersStore[t+"VertexShader"]=n)},e.ResetCache=function(){e._baseCache={}},e.ShadersRepository="src/Shaders/",e._uniqueIdSeed=0,e._baseCache={},e.ShadersStore={},e.IncludesShadersStore={},e}(),ye=function(){function e(){this._isDepthTestDirty=!1,this._isDepthMaskDirty=!1,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isDepthFuncDirty||this._isDepthTestDirty||this._isDepthMaskDirty||this._isCullFaceDirty||this._isCullDirty||this._isZOffsetDirty||this._isFrontFaceDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"zOffset",{get:function(){return this._zOffset},set:function(e){this._zOffset!==e&&(this._zOffset=e,this._isZOffsetDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cullFace",{get:function(){return this._cullFace},set:function(e){this._cullFace!==e&&(this._cullFace=e,this._isCullFaceDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"cull",{get:function(){return this._cull},set:function(e){this._cull!==e&&(this._cull=e,this._isCullDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthFunc",{get:function(){return this._depthFunc},set:function(e){this._depthFunc!==e&&(this._depthFunc=e,this._isDepthFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthMask",{get:function(){return this._depthMask},set:function(e){this._depthMask!==e&&(this._depthMask=e,this._isDepthMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"depthTest",{get:function(){return this._depthTest},set:function(e){this._depthTest!==e&&(this._depthTest=e,this._isDepthTestDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"frontFace",{get:function(){return this._frontFace},set:function(e){this._frontFace!==e&&(this._frontFace=e,this._isFrontFaceDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._depthMask=!0,this._depthTest=!0,this._depthFunc=null,this._cullFace=null,this._cull=null,this._zOffset=0,this._frontFace=null,this._isDepthTestDirty=!0,this._isDepthMaskDirty=!0,this._isDepthFuncDirty=!1,this._isCullFaceDirty=!1,this._isCullDirty=!1,this._isZOffsetDirty=!1,this._isFrontFaceDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isCullDirty&&(this.cull?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this._isCullDirty=!1),this._isCullFaceDirty&&(e.cullFace(this.cullFace),this._isCullFaceDirty=!1),this._isDepthMaskDirty&&(e.depthMask(this.depthMask),this._isDepthMaskDirty=!1),this._isDepthTestDirty&&(this.depthTest?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this._isDepthTestDirty=!1),this._isDepthFuncDirty&&(e.depthFunc(this.depthFunc),this._isDepthFuncDirty=!1),this._isZOffsetDirty&&(this.zOffset?(e.enable(e.POLYGON_OFFSET_FILL),e.polygonOffset(this.zOffset,0)):e.disable(e.POLYGON_OFFSET_FILL),this._isZOffsetDirty=!1),this._isFrontFaceDirty&&(e.frontFace(this.frontFace),this._isFrontFaceDirty=!1))},e}(),ve=function(){function e(){this._isStencilTestDirty=!1,this._isStencilMaskDirty=!1,this._isStencilFuncDirty=!1,this._isStencilOpDirty=!1,this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isStencilTestDirty||this._isStencilMaskDirty||this._isStencilFuncDirty||this._isStencilOpDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFunc",{get:function(){return this._stencilFunc},set:function(e){this._stencilFunc!==e&&(this._stencilFunc=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncRef",{get:function(){return this._stencilFuncRef},set:function(e){this._stencilFuncRef!==e&&(this._stencilFuncRef=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilFuncMask",{get:function(){return this._stencilFuncMask},set:function(e){this._stencilFuncMask!==e&&(this._stencilFuncMask=e,this._isStencilFuncDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilFail",{get:function(){return this._stencilOpStencilFail},set:function(e){this._stencilOpStencilFail!==e&&(this._stencilOpStencilFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpDepthFail",{get:function(){return this._stencilOpDepthFail},set:function(e){this._stencilOpDepthFail!==e&&(this._stencilOpDepthFail=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilOpStencilDepthPass",{get:function(){return this._stencilOpStencilDepthPass},set:function(e){this._stencilOpStencilDepthPass!==e&&(this._stencilOpStencilDepthPass=e,this._isStencilOpDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilMask",{get:function(){return this._stencilMask},set:function(e){this._stencilMask!==e&&(this._stencilMask=e,this._isStencilMaskDirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilTest",{get:function(){return this._stencilTest},set:function(e){this._stencilTest!==e&&(this._stencilTest=e,this._isStencilTestDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.reset=function(){this._stencilTest=!1,this._stencilMask=255,this._stencilFunc=e.ALWAYS,this._stencilFuncRef=1,this._stencilFuncMask=255,this._stencilOpStencilFail=e.KEEP,this._stencilOpDepthFail=e.KEEP,this._stencilOpStencilDepthPass=e.REPLACE,this._isStencilTestDirty=!0,this._isStencilMaskDirty=!0,this._isStencilFuncDirty=!0,this._isStencilOpDirty=!0},e.prototype.apply=function(e){this.isDirty&&(this._isStencilTestDirty&&(this.stencilTest?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this._isStencilTestDirty=!1),this._isStencilMaskDirty&&(e.stencilMask(this.stencilMask),this._isStencilMaskDirty=!1),this._isStencilFuncDirty&&(e.stencilFunc(this.stencilFunc,this.stencilFuncRef,this.stencilFuncMask),this._isStencilFuncDirty=!1),this._isStencilOpDirty&&(e.stencilOp(this.stencilOpStencilFail,this.stencilOpDepthFail,this.stencilOpStencilDepthPass),this._isStencilOpDirty=!1))},e.ALWAYS=519,e.KEEP=7680,e.REPLACE=7681,e}(),Te=function(){function e(){this._isAlphaBlendDirty=!1,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1,this._alphaBlend=!1,this._blendFunctionParameters=new Array(4),this._blendEquationParameters=new Array(2),this._blendConstants=new Array(4),this.reset()}return Object.defineProperty(e.prototype,"isDirty",{get:function(){return this._isAlphaBlendDirty||this._isBlendFunctionParametersDirty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaBlend",{get:function(){return this._alphaBlend},set:function(e){this._alphaBlend!==e&&(this._alphaBlend=e,this._isAlphaBlendDirty=!0)},enumerable:!0,configurable:!0}),e.prototype.setAlphaBlendConstants=function(e,t,r,n){this._blendConstants[0]===e&&this._blendConstants[1]===t&&this._blendConstants[2]===r&&this._blendConstants[3]===n||(this._blendConstants[0]=e,this._blendConstants[1]=t,this._blendConstants[2]=r,this._blendConstants[3]=n,this._isBlendConstantsDirty=!0)},e.prototype.setAlphaBlendFunctionParameters=function(e,t,r,n){this._blendFunctionParameters[0]===e&&this._blendFunctionParameters[1]===t&&this._blendFunctionParameters[2]===r&&this._blendFunctionParameters[3]===n||(this._blendFunctionParameters[0]=e,this._blendFunctionParameters[1]=t,this._blendFunctionParameters[2]=r,this._blendFunctionParameters[3]=n,this._isBlendFunctionParametersDirty=!0)},e.prototype.setAlphaEquationParameters=function(e,t){this._blendEquationParameters[0]===e&&this._blendEquationParameters[1]===t||(this._blendEquationParameters[0]=e,this._blendEquationParameters[1]=t,this._isBlendEquationParametersDirty=!0)},e.prototype.reset=function(){this._alphaBlend=!1,this._blendFunctionParameters[0]=null,this._blendFunctionParameters[1]=null,this._blendFunctionParameters[2]=null,this._blendFunctionParameters[3]=null,this._blendEquationParameters[0]=null,this._blendEquationParameters[1]=null,this._blendConstants[0]=null,this._blendConstants[1]=null,this._blendConstants[2]=null,this._blendConstants[3]=null,this._isAlphaBlendDirty=!0,this._isBlendFunctionParametersDirty=!1,this._isBlendEquationParametersDirty=!1,this._isBlendConstantsDirty=!1},e.prototype.apply=function(e){this.isDirty&&(this._isAlphaBlendDirty&&(this._alphaBlend?e.enable(e.BLEND):e.disable(e.BLEND),this._isAlphaBlendDirty=!1),this._isBlendFunctionParametersDirty&&(e.blendFuncSeparate(this._blendFunctionParameters[0],this._blendFunctionParameters[1],this._blendFunctionParameters[2],this._blendFunctionParameters[3]),this._isBlendFunctionParametersDirty=!1),this._isBlendEquationParametersDirty&&(e.blendEquationSeparate(this._blendEquationParameters[0],this._blendEquationParameters[1]),this._isBlendEquationParametersDirty=!1),this._isBlendConstantsDirty&&(e.blendColor(this._blendConstants[0],this._blendConstants[1],this._blendConstants[2],this._blendConstants[3]),this._isBlendConstantsDirty=!1))},e}(),xe=function(){function e(){}return e.prototype.attributeProcessor=function(e){return e.replace("attribute","in")},e.prototype.varyingProcessor=function(e,t){return e.replace("varying",t?"in":"out")},e.prototype.postProcessor=function(e,t,r){var n=-1!==e.search(/#extension.+GL_EXT_draw_buffers.+require/);if(e=(e=e.replace(/#extension.+(GL_OVR_multiview2|GL_OES_standard_derivatives|GL_EXT_shader_texture_lod|GL_EXT_frag_depth|GL_EXT_draw_buffers).+(enable|require)/g,"")).replace(/texture2D\s*\(/g,"texture("),r)e=(e=(e=(e=(e=(e=(e=e.replace(/texture2DLodEXT\s*\(/g,"textureLod(")).replace(/textureCubeLodEXT\s*\(/g,"textureLod(")).replace(/textureCube\s*\(/g,"texture(")).replace(/gl_FragDepthEXT/g,"gl_FragDepth")).replace(/gl_FragColor/g,"glFragColor")).replace(/gl_FragData/g,"glFragData")).replace(/void\s+?main\s*\(/g,(n?"":"out vec4 glFragColor;\n")+"void main(");else if(-1!==t.indexOf("#define MULTIVIEW"))return"#extension GL_OVR_multiview2 : require\nlayout (num_views = 2) in;\n"+e;return e},e}(),Ee=function(e){function t(t){var r=e.call(this)||this;return r._buffer=t,r}return Object(n.c)(t,e),Object.defineProperty(t.prototype,"underlyingResource",{get:function(){return this._buffer},enumerable:!0,configurable:!0}),t}(function(){function e(){this.references=0,this.capacity=0,this.is32Bits=!1}return Object.defineProperty(e.prototype,"underlyingResource",{get:function(){return null},enumerable:!0,configurable:!0}),e}()),Pe=function(){function e(){this.vertexCompilationError=null,this.fragmentCompilationError=null,this.programLinkError=null,this.programValidationError=null}return Object.defineProperty(e.prototype,"isAsync",{get:function(){return this.isParallelCompiled},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isReady",{get:function(){return!!this.program&&(!this.isParallelCompiled||this.engine._isRenderingStateCompiled(this))},enumerable:!0,configurable:!0}),e.prototype._handlesSpectorRebuildCallback=function(e){e&&this.program&&e(this.program)},e}(),Se=function(){function e(){}return e.CreateCanvas=function(e,t){if("undefined"==typeof document)return new OffscreenCanvas(e,t);var r=document.createElement("canvas");return r.width=e,r.height=t,r},e}(),we=function(){},Re=function(){function e(t,r,n,i){var a=this;void 0===i&&(i=!1),this._excludedCompressedTextures=[],this.forcePOTTextures=!1,this.isFullscreen=!1,this.cullBackFaces=!0,this.renderEvenInBackground=!0,this.preventCacheWipeBetweenFrames=!1,this.validateShaderPrograms=!1,this.useReverseDepthBuffer=!1,this.disableUniformBuffers=!1,this._uniformBuffers=new Array,this._windowIsBackground=!1,this._webGLVersion=1,this._highPrecisionShadersAllowed=!0,this._badOS=!1,this._badDesktopOS=!1,this._renderingQueueLaunched=!1,this._activeRenderLoops=new Array,this.onContextLostObservable=new ee,this.onContextRestoredObservable=new ee,this._contextWasLost=!1,this._doNotHandleContextLost=!1,this.disableVertexArrayObjects=!1,this._colorWrite=!0,this._colorWriteChanged=!0,this._depthCullingState=new ye,this._stencilState=new ve,this._alphaState=new Te,this._alphaMode=1,this._alphaEquation=0,this._internalTexturesCache=new Array,this._activeChannel=0,this._currentTextureChannel=-1,this._boundTexturesCache={},this._compiledEffects={},this._vertexAttribArraysEnabled=[],this._uintIndicesCurrentlySet=!1,this._currentBoundBuffer=new Array,this._currentFramebuffer=null,this._currentBufferPointers=new Array,this._currentInstanceLocations=new Array,this._currentInstanceBuffers=new Array,this._vaoRecordInProgress=!1,this._mustWipeVertexAttributes=!1,this._nextFreeTextureSlots=new Array,this._maxSimultaneousTextures=0,this._activeRequests=new Array,this._texturesSupported=new Array,this.premultipliedAlpha=!0,this.onBeforeTextureInitObservable=new ee,this._viewportCached={x:0,y:0,z:0,w:0},this._unpackFlipYCached=null,this.enableUnpackFlipYCached=!0,this._getDepthStencilBuffer=function(e,t,r,n,i,o){var s=a._gl,c=s.createRenderbuffer();return s.bindRenderbuffer(s.RENDERBUFFER,c),r>1&&s.renderbufferStorageMultisample?s.renderbufferStorageMultisample(s.RENDERBUFFER,r,i,e,t):s.renderbufferStorage(s.RENDERBUFFER,n,e,t),s.framebufferRenderbuffer(s.FRAMEBUFFER,o,s.RENDERBUFFER,c),s.bindRenderbuffer(s.RENDERBUFFER,null),c},this._boundUniforms={};var o=null;if(t){if(n=n||{},t.getContext){if(o=t,this._renderingCanvas=o,null!=r&&(n.antialias=r),void 0===n.deterministicLockstep&&(n.deterministicLockstep=!1),void 0===n.lockstepMaxSteps&&(n.lockstepMaxSteps=4),void 0===n.timeStep&&(n.timeStep=1/60),void 0===n.preserveDrawingBuffer&&(n.preserveDrawingBuffer=!1),void 0===n.audioEngine&&(n.audioEngine=!0),void 0===n.stencil&&(n.stencil=!0),!1===n.premultipliedAlpha&&(this.premultipliedAlpha=!1),this._doNotHandleContextLost=!!n.doNotHandleContextLost,navigator&&navigator.userAgent)for(var s=navigator.userAgent,c=0,u=e.ExceptionList;c<u.length;c++){var h=u[c],l=h.key,f=h.targets;if(new RegExp(l).test(s)){if(h.capture&&h.captureConstraint){var d=h.capture,p=h.captureConstraint,g=new RegExp(d).exec(s);if(g&&g.length>0&&parseInt(g[g.length-1])>=p)continue}for(var _=0,m=f;_<m.length;_++)switch(m[_]){case"uniformBuffer":this.disableUniformBuffers=!0;break;case"vao":this.disableVertexArrayObjects=!0}}}if(this._doNotHandleContextLost||(this._onContextLost=function(e){e.preventDefault(),a._contextWasLost=!0,ie.Warn("WebGL context lost."),a.onContextLostObservable.notifyObservers(a)},this._onContextRestored=function(){setTimeout((function(){a._initGLContext(),a._rebuildEffects(),a._rebuildInternalTextures(),a._rebuildBuffers(),a.wipeCaches(!0),ie.Warn("WebGL context successfully restored."),a.onContextRestoredObservable.notifyObservers(a),a._contextWasLost=!1}),0)},o.addEventListener("webglcontextlost",this._onContextLost,!1),o.addEventListener("webglcontextrestored",this._onContextRestored,!1),n.powerPreference="high-performance"),!n.disableWebGL2Support)try{this._gl=o.getContext("webgl2",n)||o.getContext("experimental-webgl2",n),this._gl&&(this._webGLVersion=2,this._gl.deleteQuery||(this._webGLVersion=1))}catch(e){}if(!this._gl){if(!o)throw new Error("The provided canvas is null or undefined.");try{this._gl=o.getContext("webgl",n)||o.getContext("experimental-webgl",n)}catch(e){throw new Error("WebGL not supported")}}if(!this._gl)throw new Error("WebGL not supported")}else{this._gl=t,this._renderingCanvas=this._gl.canvas,this._gl.renderbufferStorageMultisample&&(this._webGLVersion=2);var b=this._gl.getContextAttributes();b&&(n.stencil=b.stencil)}this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),void 0!==n.useHighPrecisionFloats&&(this._highPrecisionShadersAllowed=n.useHighPrecisionFloats);var y=oe.IsWindowObjectExist()&&window.devicePixelRatio||1,v=n.limitDeviceRatio||y;this._hardwareScalingLevel=i?1/Math.min(v,y):1,this.resize(),this._isStencilEnable=!!n.stencil,this._initGLContext();for(var T=0;T<this._caps.maxVertexAttribs;T++)this._currentBufferPointers[T]=new we;this.webGLVersion>1&&(this._shaderProcessor=new xe),this._badOS=/iPad/i.test(navigator.userAgent)||/iPhone/i.test(navigator.userAgent),this._badDesktopOS=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this._creationOptions=n,console.log("Babylon.js v"+e.Version+" - "+this.description)}}return Object.defineProperty(e,"NpmPackage",{get:function(){return"babylonjs@4.1.0-beta.27"},enumerable:!0,configurable:!0}),Object.defineProperty(e,"Version",{get:function(){return"4.1.0-beta.27"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"description",{get:function(){var e="WebGL"+this.webGLVersion;return this._caps.parallelShaderCompile&&(e+=" - Parallel shader compilation"),e},enumerable:!0,configurable:!0}),Object.defineProperty(e,"ShadersRepository",{get:function(){return be.ShadersRepository},set:function(e){be.ShadersRepository=e},enumerable:!0,configurable:!0}),e.prototype.excludedCompressedTextureFormats=function(e,t){return this._excludedCompressedTextures.some((function(t){var r="\\b"+t+"\\b";return e&&(e===t||e.match(new RegExp(r,"g")))}))?null:t},Object.defineProperty(e.prototype,"supportsUniformBuffers",{get:function(){return this.webGLVersion>1&&!this.disableUniformBuffers},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_shouldUseHighPrecisionShader",{get:function(){return!(!this._caps.highPrecisionShaderSupported||!this._highPrecisionShadersAllowed)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"needPOTTextures",{get:function(){return this._webGLVersion<2||this.forcePOTTextures},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"doNotHandleContextLost",{get:function(){return this._doNotHandleContextLost},set:function(e){this._doNotHandleContextLost=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"_supportsHardwareTextureRescaling",{get:function(){return!1},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"texturesSupported",{get:function(){return this._texturesSupported},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textureFormatInUse",{get:function(){return this._textureFormatInUse},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentViewport",{get:function(){return this._cachedViewport},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this._emptyTexture||(this._emptyTexture=this.createRawTexture(new Uint8Array(4),1,1,5,!1,!1,1)),this._emptyTexture},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture3D",{get:function(){return this._emptyTexture3D||(this._emptyTexture3D=this.createRawTexture3D(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture3D},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture2DArray",{get:function(){return this._emptyTexture2DArray||(this._emptyTexture2DArray=this.createRawTexture2DArray(new Uint8Array(4),1,1,1,5,!1,!1,1)),this._emptyTexture2DArray},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyCubeTexture",{get:function(){if(!this._emptyCubeTexture){var e=new Uint8Array(4),t=[e,e,e,e,e,e];this._emptyCubeTexture=this.createRawCubeTexture(t,1,5,0,!1,!1,1)}return this._emptyCubeTexture},enumerable:!0,configurable:!0}),e.prototype._rebuildInternalTextures=function(){for(var e=0,t=this._internalTexturesCache.slice();e<t.length;e++)t[e]._rebuild()},e.prototype._rebuildEffects=function(){for(var e in this._compiledEffects)this._compiledEffects[e]._prepareEffect();be.ResetCache()},e.prototype.areAllEffectsReady=function(){for(var e in this._compiledEffects)if(!this._compiledEffects[e].isReady())return!1;return!0},e.prototype._rebuildBuffers=function(){for(var e=0,t=this._uniformBuffers;e<t.length;e++)t[e]._rebuild()},e.prototype._initGLContext=function(){this._caps={maxTexturesImageUnits:this._gl.getParameter(this._gl.MAX_TEXTURE_IMAGE_UNITS),maxCombinedTexturesImageUnits:this._gl.getParameter(this._gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),maxVertexTextureImageUnits:this._gl.getParameter(this._gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize:this._gl.getParameter(this._gl.MAX_TEXTURE_SIZE),maxSamples:this._webGLVersion>1?this._gl.getParameter(this._gl.MAX_SAMPLES):1,maxCubemapTextureSize:this._gl.getParameter(this._gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxRenderTextureSize:this._gl.getParameter(this._gl.MAX_RENDERBUFFER_SIZE),maxVertexAttribs:this._gl.getParameter(this._gl.MAX_VERTEX_ATTRIBS),maxVaryingVectors:this._gl.getParameter(this._gl.MAX_VARYING_VECTORS),maxFragmentUniformVectors:this._gl.getParameter(this._gl.MAX_FRAGMENT_UNIFORM_VECTORS),maxVertexUniformVectors:this._gl.getParameter(this._gl.MAX_VERTEX_UNIFORM_VECTORS),parallelShaderCompile:this._gl.getExtension("KHR_parallel_shader_compile"),standardDerivatives:this._webGLVersion>1||null!==this._gl.getExtension("OES_standard_derivatives"),maxAnisotropy:1,astc:this._gl.getExtension("WEBGL_compressed_texture_astc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_astc"),s3tc:this._gl.getExtension("WEBGL_compressed_texture_s3tc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),pvrtc:this._gl.getExtension("WEBGL_compressed_texture_pvrtc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),etc1:this._gl.getExtension("WEBGL_compressed_texture_etc1")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc1"),etc2:this._gl.getExtension("WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBKIT_WEBGL_compressed_texture_etc")||this._gl.getExtension("WEBGL_compressed_texture_es3_0"),textureAnisotropicFilterExtension:this._gl.getExtension("EXT_texture_filter_anisotropic")||this._gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this._gl.getExtension("MOZ_EXT_texture_filter_anisotropic"),uintIndices:this._webGLVersion>1||null!==this._gl.getExtension("OES_element_index_uint"),fragmentDepthSupported:this._webGLVersion>1||null!==this._gl.getExtension("EXT_frag_depth"),highPrecisionShaderSupported:!1,timerQuery:this._gl.getExtension("EXT_disjoint_timer_query_webgl2")||this._gl.getExtension("EXT_disjoint_timer_query"),canUseTimestampForTimerQuery:!1,drawBuffersExtension:!1,maxMSAASamples:1,colorBufferFloat:this._webGLVersion>1&&this._gl.getExtension("EXT_color_buffer_float"),textureFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_float")),textureHalfFloat:!!(this._webGLVersion>1||this._gl.getExtension("OES_texture_half_float")),textureHalfFloatRender:!1,textureFloatLinearFiltering:!1,textureFloatRender:!1,textureHalfFloatLinearFiltering:!1,vertexArrayObject:!1,instancedArrays:!1,textureLOD:!!(this._webGLVersion>1||this._gl.getExtension("EXT_shader_texture_lod")),blendMinMax:!1,multiview:this._gl.getExtension("OVR_multiview2"),oculusMultiview:this._gl.getExtension("OCULUS_multiview"),depthTextureExtension:!1},this._glVersion=this._gl.getParameter(this._gl.VERSION);var e=this._gl.getExtension("WEBGL_debug_renderer_info");if(null!=e&&(this._glRenderer=this._gl.getParameter(e.UNMASKED_RENDERER_WEBGL),this._glVendor=this._gl.getParameter(e.UNMASKED_VENDOR_WEBGL)),this._glVendor||(this._glVendor="Unknown vendor"),this._glRenderer||(this._glRenderer="Unknown renderer"),this._gl.HALF_FLOAT_OES=36193,34842!==this._gl.RGBA16F&&(this._gl.RGBA16F=34842),34836!==this._gl.RGBA32F&&(this._gl.RGBA32F=34836),35056!==this._gl.DEPTH24_STENCIL8&&(this._gl.DEPTH24_STENCIL8=35056),this._caps.timerQuery&&(1===this._webGLVersion&&(this._gl.getQuery=this._caps.timerQuery.getQueryEXT.bind(this._caps.timerQuery)),this._caps.canUseTimestampForTimerQuery=this._gl.getQuery(this._caps.timerQuery.TIMESTAMP_EXT,this._caps.timerQuery.QUERY_COUNTER_BITS_EXT)>0),this._caps.maxAnisotropy=this._caps.textureAnisotropicFilterExtension?this._gl.getParameter(this._caps.textureAnisotropicFilterExtension.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,this._caps.textureFloatLinearFiltering=!(!this._caps.textureFloat||!this._gl.getExtension("OES_texture_float_linear")),this._caps.textureFloatRender=!(!this._caps.textureFloat||!this._canRenderToFloatFramebuffer()),this._caps.textureHalfFloatLinearFiltering=!!(this._webGLVersion>1||this._caps.textureHalfFloat&&this._gl.getExtension("OES_texture_half_float_linear")),this._webGLVersion>1&&(this._gl.HALF_FLOAT_OES=5131),this._caps.textureHalfFloatRender=this._caps.textureHalfFloat&&this._canRenderToHalfFloatFramebuffer(),this._webGLVersion>1)this._caps.drawBuffersExtension=!0,this._caps.maxMSAASamples=this._gl.getParameter(this._gl.MAX_SAMPLES);else{var t=this._gl.getExtension("WEBGL_draw_buffers");if(null!==t){this._caps.drawBuffersExtension=!0,this._gl.drawBuffers=t.drawBuffersWEBGL.bind(t),this._gl.DRAW_FRAMEBUFFER=this._gl.FRAMEBUFFER;for(var r=0;r<16;r++)this._gl["COLOR_ATTACHMENT"+r+"_WEBGL"]=t["COLOR_ATTACHMENT"+r+"_WEBGL"]}}if(this._webGLVersion>1)this._caps.depthTextureExtension=!0;else{var n=this._gl.getExtension("WEBGL_depth_texture");null!=n&&(this._caps.depthTextureExtension=!0,this._gl.UNSIGNED_INT_24_8=n.UNSIGNED_INT_24_8_WEBGL)}if(this.disableVertexArrayObjects)this._caps.vertexArrayObject=!1;else if(this._webGLVersion>1)this._caps.vertexArrayObject=!0;else{var i=this._gl.getExtension("OES_vertex_array_object");null!=i&&(this._caps.vertexArrayObject=!0,this._gl.createVertexArray=i.createVertexArrayOES.bind(i),this._gl.bindVertexArray=i.bindVertexArrayOES.bind(i),this._gl.deleteVertexArray=i.deleteVertexArrayOES.bind(i))}if(this._webGLVersion>1)this._caps.instancedArrays=!0;else{var a=this._gl.getExtension("ANGLE_instanced_arrays");null!=a?(this._caps.instancedArrays=!0,this._gl.drawArraysInstanced=a.drawArraysInstancedANGLE.bind(a),this._gl.drawElementsInstanced=a.drawElementsInstancedANGLE.bind(a),this._gl.vertexAttribDivisor=a.vertexAttribDivisorANGLE.bind(a)):this._caps.instancedArrays=!1}if(this._caps.astc&&this.texturesSupported.push("-astc.ktx"),this._caps.s3tc&&this.texturesSupported.push("-dxt.ktx"),this._caps.pvrtc&&this.texturesSupported.push("-pvrtc.ktx"),this._caps.etc2&&this.texturesSupported.push("-etc2.ktx"),this._caps.etc1&&this.texturesSupported.push("-etc1.ktx"),this._gl.getShaderPrecisionFormat){var o=this._gl.getShaderPrecisionFormat(this._gl.VERTEX_SHADER,this._gl.HIGH_FLOAT),s=this._gl.getShaderPrecisionFormat(this._gl.FRAGMENT_SHADER,this._gl.HIGH_FLOAT);o&&s&&(this._caps.highPrecisionShaderSupported=0!==o.precision&&0!==s.precision)}if(this._webGLVersion>1)this._caps.blendMinMax=!0;else{var c=this._gl.getExtension("EXT_blend_minmax");null!=c&&(this._caps.blendMinMax=!0,this._gl.MAX=c.MAX_EXT,this._gl.MIN=c.MIN_EXT)}this._depthCullingState.depthTest=!0,this._depthCullingState.depthFunc=this._gl.LEQUAL,this._depthCullingState.depthMask=!0,this._maxSimultaneousTextures=this._caps.maxCombinedTexturesImageUnits;for(var u=0;u<this._maxSimultaneousTextures;u++)this._nextFreeTextureSlots.push(u)},Object.defineProperty(e.prototype,"webGLVersion",{get:function(){return this._webGLVersion},enumerable:!0,configurable:!0}),e.prototype.getClassName=function(){return"ThinEngine"},Object.defineProperty(e.prototype,"isStencilEnable",{get:function(){return this._isStencilEnable},enumerable:!0,configurable:!0}),e.prototype._prepareWorkingCanvas=function(){if(!this._workingCanvas){this._workingCanvas=Se.CreateCanvas(1,1);var e=this._workingCanvas.getContext("2d");e&&(this._workingContext=e)}},e.prototype.resetTextureCache=function(){for(var e in this._boundTexturesCache)this._boundTexturesCache.hasOwnProperty(e)&&(this._boundTexturesCache[e]=null);this._currentTextureChannel=-1},e.prototype.getGlInfo=function(){return{vendor:this._glVendor,renderer:this._glRenderer,version:this._glVersion}},e.prototype.setHardwareScalingLevel=function(e){this._hardwareScalingLevel=e,this.resize()},e.prototype.getHardwareScalingLevel=function(){return this._hardwareScalingLevel},e.prototype.getLoadedTexturesCache=function(){return this._internalTexturesCache},e.prototype.getCaps=function(){return this._caps},e.prototype.stopRenderLoop=function(e){if(e){var t=this._activeRenderLoops.indexOf(e);t>=0&&this._activeRenderLoops.splice(t,1)}else this._activeRenderLoops=[]},e.prototype._renderLoop=function(){if(!this._contextWasLost){var e=!0;if(!this.renderEvenInBackground&&this._windowIsBackground&&(e=!1),e){this.beginFrame();for(var t=0;t<this._activeRenderLoops.length;t++)(0,this._activeRenderLoops[t])();this.endFrame()}}this._activeRenderLoops.length>0?this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow()):this._renderingQueueLaunched=!1},e.prototype.getRenderingCanvas=function(){return this._renderingCanvas},e.prototype.getHostWindow=function(){return oe.IsWindowObjectExist()?this._renderingCanvas&&this._renderingCanvas.ownerDocument&&this._renderingCanvas.ownerDocument.defaultView?this._renderingCanvas.ownerDocument.defaultView:window:null},e.prototype.getRenderWidth=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.width:this._gl.drawingBufferWidth},e.prototype.getRenderHeight=function(e){return void 0===e&&(e=!1),!e&&this._currentRenderTarget?this._currentRenderTarget.height:this._gl.drawingBufferHeight},e.prototype._queueNewFrame=function(t,r){return e.QueueNewFrame(t,r)},e.prototype.runRenderLoop=function(e){-1===this._activeRenderLoops.indexOf(e)&&(this._activeRenderLoops.push(e),this._renderingQueueLaunched||(this._renderingQueueLaunched=!0,this._boundRenderFunction=this._renderLoop.bind(this),this._frameHandler=this._queueNewFrame(this._boundRenderFunction,this.getHostWindow())))},e.prototype.clear=function(e,t,r,n){void 0===n&&(n=!1),this.applyStates();var i=0;t&&e&&(this._gl.clearColor(e.r,e.g,e.b,void 0!==e.a?e.a:1),i|=this._gl.COLOR_BUFFER_BIT),r&&(this.useReverseDepthBuffer?(this._depthCullingState.depthFunc=this._gl.GREATER,this._gl.clearDepth(0)):this._gl.clearDepth(1),i|=this._gl.DEPTH_BUFFER_BIT),n&&(this._gl.clearStencil(0),i|=this._gl.STENCIL_BUFFER_BIT),this._gl.clear(i)},e.prototype._viewport=function(e,t,r,n){e===this._viewportCached.x&&t===this._viewportCached.y&&r===this._viewportCached.z&&n===this._viewportCached.w||(this._viewportCached.x=e,this._viewportCached.y=t,this._viewportCached.z=r,this._viewportCached.w=n,this._gl.viewport(e,t,r,n))},e.prototype.setViewport=function(e,t,r){var n=t||this.getRenderWidth(),i=r||this.getRenderHeight(),a=e.x||0,o=e.y||0;this._cachedViewport=e,this._viewport(a*n,o*i,n*e.width,i*e.height)},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){this._badOS&&this.flushFramebuffer()},e.prototype.resize=function(){var e,t;oe.IsWindowObjectExist()?(e=this._renderingCanvas?this._renderingCanvas.clientWidth:window.innerWidth,t=this._renderingCanvas?this._renderingCanvas.clientHeight:window.innerHeight):(e=this._renderingCanvas?this._renderingCanvas.width:100,t=this._renderingCanvas?this._renderingCanvas.height:100),this.setSize(e/this._hardwareScalingLevel,t/this._hardwareScalingLevel)},e.prototype.setSize=function(e,t){this._renderingCanvas&&(e|=0,t|=0,this._renderingCanvas.width===e&&this._renderingCanvas.height===t||(this._renderingCanvas.width=e,this._renderingCanvas.height=t))},e.prototype.bindFramebuffer=function(e,t,r,n,i,a,o){void 0===t&&(t=0),void 0===a&&(a=0),void 0===o&&(o=0),this._currentRenderTarget&&this.unBindFramebuffer(this._currentRenderTarget),this._currentRenderTarget=e,this._bindUnboundFramebuffer(e._MSAAFramebuffer?e._MSAAFramebuffer:e._framebuffer);var s=this._gl;e.is2DArray?s.framebufferTextureLayer(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,e._webGLTexture,a,o):e.isCube&&s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,e._webGLTexture,a);var c=e._depthStencilTexture;if(c){var u=c._generateStencilBuffer?s.DEPTH_STENCIL_ATTACHMENT:s.DEPTH_ATTACHMENT;e.is2DArray?s.framebufferTextureLayer(s.FRAMEBUFFER,u,c._webGLTexture,a,o):e.isCube?s.framebufferTexture2D(s.FRAMEBUFFER,u,s.TEXTURE_CUBE_MAP_POSITIVE_X+t,c._webGLTexture,a):s.framebufferTexture2D(s.FRAMEBUFFER,u,s.TEXTURE_2D,c._webGLTexture,a)}this._cachedViewport&&!i?this.setViewport(this._cachedViewport,r,n):(r||(r=e.width,a&&(r/=Math.pow(2,a))),n||(n=e.height,a&&(n/=Math.pow(2,a))),this._viewport(0,0,r,n)),this.wipeCaches()},e.prototype._bindUnboundFramebuffer=function(e){this._currentFramebuffer!==e&&(this._gl.bindFramebuffer(this._gl.FRAMEBUFFER,e),this._currentFramebuffer=e)},e.prototype.unBindFramebuffer=function(e,t,r){void 0===t&&(t=!1),this._currentRenderTarget=null;var n=this._gl;e._MSAAFramebuffer&&(n.bindFramebuffer(n.READ_FRAMEBUFFER,e._MSAAFramebuffer),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,e._framebuffer),n.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,n.COLOR_BUFFER_BIT,n.NEAREST)),!e.generateMipMaps||t||e.isCube||(this._bindTextureDirectly(n.TEXTURE_2D,e,!0),n.generateMipmap(n.TEXTURE_2D),this._bindTextureDirectly(n.TEXTURE_2D,null)),r&&(e._MSAAFramebuffer&&this._bindUnboundFramebuffer(e._framebuffer),r()),this._bindUnboundFramebuffer(null)},e.prototype.flushFramebuffer=function(){this._gl.flush()},e.prototype.restoreDefaultFramebuffer=function(){this._currentRenderTarget?this.unBindFramebuffer(this._currentRenderTarget):this._bindUnboundFramebuffer(null),this._cachedViewport&&this.setViewport(this._cachedViewport),this.wipeCaches()},e.prototype._resetVertexBufferBinding=function(){this.bindArrayBuffer(null),this._cachedVertexBuffers=null},e.prototype.createVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.STATIC_DRAW)},e.prototype._createVertexBuffer=function(e,t){var r=this._gl.createBuffer();if(!r)throw new Error("Unable to create vertex buffer");var n=new Ee(r);return this.bindArrayBuffer(n),e instanceof Array?this._gl.bufferData(this._gl.ARRAY_BUFFER,new Float32Array(e),this._gl.STATIC_DRAW):this._gl.bufferData(this._gl.ARRAY_BUFFER,e,this._gl.STATIC_DRAW),this._resetVertexBufferBinding(),n.references=1,n},e.prototype.createDynamicVertexBuffer=function(e){return this._createVertexBuffer(e,this._gl.DYNAMIC_DRAW)},e.prototype._resetIndexBufferBinding=function(){this.bindIndexBuffer(null),this._cachedIndexBuffer=null},e.prototype.createIndexBuffer=function(e,t){var r=this._gl.createBuffer(),n=new Ee(r);if(!r)throw new Error("Unable to create index buffer");this.bindIndexBuffer(n);var i=this._normalizeIndexData(e);return this._gl.bufferData(this._gl.ELEMENT_ARRAY_BUFFER,i,t?this._gl.DYNAMIC_DRAW:this._gl.STATIC_DRAW),this._resetIndexBufferBinding(),n.references=1,n.is32Bits=4===i.BYTES_PER_ELEMENT,n},e.prototype._normalizeIndexData=function(e){if(e instanceof Uint16Array)return e;if(this._caps.uintIndices){if(e instanceof Uint32Array)return e;for(var t=0;t<e.length;t++)if(e[t]>=65535)return new Uint32Array(e);return new Uint16Array(e)}return new Uint16Array(e)},e.prototype.bindArrayBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ARRAY_BUFFER)},e.prototype.bindUniformBlock=function(e,t,r){var n=e.program,i=this._gl.getUniformBlockIndex(n,t);this._gl.uniformBlockBinding(n,i,r)},e.prototype.bindIndexBuffer=function(e){this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.bindBuffer(e,this._gl.ELEMENT_ARRAY_BUFFER)},e.prototype.bindBuffer=function(e,t){(this._vaoRecordInProgress||this._currentBoundBuffer[t]!==e)&&(this._gl.bindBuffer(t,e?e.underlyingResource:null),this._currentBoundBuffer[t]=e)},e.prototype.updateArrayBuffer=function(e){this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,e)},e.prototype._vertexAttribPointer=function(e,t,r,n,i,a,o){var s=this._currentBufferPointers[t],c=!1;s.active?(s.buffer!==e&&(s.buffer=e,c=!0),s.size!==r&&(s.size=r,c=!0),s.type!==n&&(s.type=n,c=!0),s.normalized!==i&&(s.normalized=i,c=!0),s.stride!==a&&(s.stride=a,c=!0),s.offset!==o&&(s.offset=o,c=!0)):(c=!0,s.active=!0,s.index=t,s.size=r,s.type=n,s.normalized=i,s.stride=a,s.offset=o,s.buffer=e),(c||this._vaoRecordInProgress)&&(this.bindArrayBuffer(e),this._gl.vertexAttribPointer(t,r,n,i,a,o))},e.prototype._bindIndexBufferWithCache=function(e){null!=e&&this._cachedIndexBuffer!==e&&(this._cachedIndexBuffer=e,this.bindIndexBuffer(e),this._uintIndicesCurrentlySet=e.is32Bits)},e.prototype._bindVertexBuffersAttributes=function(e,t){var r=t.getAttributesNames();this._vaoRecordInProgress||this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var n=0;n<r.length;n++){var i=t.getAttributeLocation(n);if(i>=0){var a=e[r[n]];if(!a)continue;this._gl.enableVertexAttribArray(i),this._vaoRecordInProgress||(this._vertexAttribArraysEnabled[i]=!0);var o=a.getBuffer();o&&(this._vertexAttribPointer(o,i,a.getSize(),a.type,a.normalized,a.byteStride,a.byteOffset),a.getIsInstanced()&&(this._gl.vertexAttribDivisor(i,a.getInstanceDivisor()),this._vaoRecordInProgress||(this._currentInstanceLocations.push(i),this._currentInstanceBuffers.push(o))))}}},e.prototype.recordVertexArrayObject=function(e,t,r){var n=this._gl.createVertexArray();return this._vaoRecordInProgress=!0,this._gl.bindVertexArray(n),this._mustWipeVertexAttributes=!0,this._bindVertexBuffersAttributes(e,r),this.bindIndexBuffer(t),this._vaoRecordInProgress=!1,this._gl.bindVertexArray(null),n},e.prototype.bindVertexArrayObject=function(e,t){this._cachedVertexArrayObject!==e&&(this._cachedVertexArrayObject=e,this._gl.bindVertexArray(e),this._cachedVertexBuffers=null,this._cachedIndexBuffer=null,this._uintIndicesCurrentlySet=null!=t&&t.is32Bits,this._mustWipeVertexAttributes=!0)},e.prototype.bindBuffersDirectly=function(e,t,r,n,i){if(this._cachedVertexBuffers!==e||this._cachedEffectForVertexBuffers!==i){this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=i;var a=i.getAttributesCount();this._unbindVertexArrayObject(),this.unbindAllAttributes();for(var o=0,s=0;s<a;s++)if(s<r.length){var c=i.getAttributeLocation(s);c>=0&&(this._gl.enableVertexAttribArray(c),this._vertexAttribArraysEnabled[c]=!0,this._vertexAttribPointer(e,c,r[s],this._gl.FLOAT,!1,n,o)),o+=4*r[s]}}this._bindIndexBufferWithCache(t)},e.prototype._unbindVertexArrayObject=function(){this._cachedVertexArrayObject&&(this._cachedVertexArrayObject=null,this._gl.bindVertexArray(null))},e.prototype.bindBuffers=function(e,t,r){this._cachedVertexBuffers===e&&this._cachedEffectForVertexBuffers===r||(this._cachedVertexBuffers=e,this._cachedEffectForVertexBuffers=r,this._bindVertexBuffersAttributes(e,r)),this._bindIndexBufferWithCache(t)},e.prototype.unbindInstanceAttributes=function(){for(var e,t=0,r=this._currentInstanceLocations.length;t<r;t++){var n=this._currentInstanceBuffers[t];e!=n&&n.references&&(e=n,this.bindArrayBuffer(n));var i=this._currentInstanceLocations[t];this._gl.vertexAttribDivisor(i,0)}this._currentInstanceBuffers.length=0,this._currentInstanceLocations.length=0},e.prototype.releaseVertexArrayObject=function(e){this._gl.deleteVertexArray(e)},e.prototype._releaseBuffer=function(e){return e.references--,0===e.references&&(this._deleteBuffer(e),!0)},e.prototype._deleteBuffer=function(e){this._gl.deleteBuffer(e.underlyingResource)},e.prototype.updateAndBindInstancesBuffer=function(e,t,r){if(this.bindArrayBuffer(e),t&&this._gl.bufferSubData(this._gl.ARRAY_BUFFER,0,t),void 0!==r[0].index)this.bindInstancesBuffer(e,r,!0);else for(var n=0;n<4;n++){var i=r[n];this._vertexAttribArraysEnabled[i]||(this._gl.enableVertexAttribArray(i),this._vertexAttribArraysEnabled[i]=!0),this._vertexAttribPointer(e,i,4,this._gl.FLOAT,!1,64,16*n),this._gl.vertexAttribDivisor(i,1),this._currentInstanceLocations.push(i),this._currentInstanceBuffers.push(e)}},e.prototype.bindInstancesBuffer=function(e,t,r){void 0===r&&(r=!0),this.bindArrayBuffer(e);var n=0;if(r)for(var i=0;i<t.length;i++)n+=4*(a=t[i]).attributeSize;for(i=0;i<t.length;i++){var a;void 0===(a=t[i]).index&&(a.index=this._currentEffect.getAttributeLocationByName(a.attributeName)),this._vertexAttribArraysEnabled[a.index]||(this._gl.enableVertexAttribArray(a.index),this._vertexAttribArraysEnabled[a.index]=!0),this._vertexAttribPointer(e,a.index,a.attributeSize,a.attributeType||this._gl.FLOAT,a.normalized||!1,n,a.offset),this._gl.vertexAttribDivisor(a.index,void 0===a.divisor?1:a.divisor),this._currentInstanceLocations.push(a.index),this._currentInstanceBuffers.push(e)}},e.prototype.disableInstanceAttributeByName=function(e){if(this._currentEffect){var t=this._currentEffect.getAttributeLocationByName(e);this.disableInstanceAttribute(t)}},e.prototype.disableInstanceAttribute=function(e){for(var t,r=!1;-1!==(t=this._currentInstanceLocations.indexOf(e));)this._currentInstanceLocations.splice(t,1),this._currentInstanceBuffers.splice(t,1),r=!0,t=this._currentInstanceLocations.indexOf(e);r&&(this._gl.vertexAttribDivisor(e,0),this.disableAttributeByIndex(e))},e.prototype.disableAttributeByIndex=function(e){this._gl.disableVertexAttribArray(e),this._vertexAttribArraysEnabled[e]=!1,this._currentBufferPointers[e].active=!1},e.prototype.draw=function(e,t,r,n){this.drawElementsType(e?0:1,t,r,n)},e.prototype.drawPointClouds=function(e,t,r){this.drawArraysType(2,e,t,r)},e.prototype.drawUnIndexed=function(e,t,r,n){this.drawArraysType(e?0:1,t,r,n)},e.prototype.drawElementsType=function(e,t,r,n){this.applyStates(),this._reportDrawCall();var i=this._drawMode(e),a=this._uintIndicesCurrentlySet?this._gl.UNSIGNED_INT:this._gl.UNSIGNED_SHORT,o=this._uintIndicesCurrentlySet?4:2;n?this._gl.drawElementsInstanced(i,r,a,t*o,n):this._gl.drawElements(i,r,a,t*o)},e.prototype.drawArraysType=function(e,t,r,n){this.applyStates(),this._reportDrawCall();var i=this._drawMode(e);n?this._gl.drawArraysInstanced(i,t,r,n):this._gl.drawArrays(i,t,r)},e.prototype._drawMode=function(e){switch(e){case 0:return this._gl.TRIANGLES;case 2:return this._gl.POINTS;case 1:return this._gl.LINES;case 3:return this._gl.POINTS;case 4:return this._gl.LINES;case 5:return this._gl.LINE_LOOP;case 6:return this._gl.LINE_STRIP;case 7:return this._gl.TRIANGLE_STRIP;case 8:return this._gl.TRIANGLE_FAN;default:return this._gl.TRIANGLES}},e.prototype._reportDrawCall=function(){},e.prototype._releaseEffect=function(e){this._compiledEffects[e._key]&&(delete this._compiledEffects[e._key],this._deletePipelineContext(e.getPipelineContext()))},e.prototype._deletePipelineContext=function(e){var t=e;t&&t.program&&(t.program.__SPECTOR_rebuildProgram=null,this._gl.deleteProgram(t.program))},e.prototype.createEffect=function(e,t,r,n,i,a,o,s,c){var u=(e.vertexElement||e.vertex||e)+"+"+(e.fragmentElement||e.fragment||e)+"@"+(i||t.defines);if(this._compiledEffects[u]){var h=this._compiledEffects[u];return o&&h.isReady()&&o(h),h}var l=new be(e,t,r,n,this,i,a,o,s,c);return l._key=u,this._compiledEffects[u]=l,l},e._ConcatenateShader=function(e,t,r){return void 0===r&&(r=""),r+(t?t+"\n":"")+e},e.prototype._compileShader=function(t,r,n,i){return this._compileRawShader(e._ConcatenateShader(t,n,i),r)},e.prototype._compileRawShader=function(e,t){var r=this._gl,n=r.createShader("vertex"===t?r.VERTEX_SHADER:r.FRAGMENT_SHADER);if(!n)throw new Error("Something went wrong while compile the shader.");return r.shaderSource(n,e),r.compileShader(n),n},e.prototype.createRawShaderProgram=function(e,t,r,n,i){void 0===i&&(i=null),n=n||this._gl;var a=this._compileRawShader(t,"vertex"),o=this._compileRawShader(r,"fragment");return this._createShaderProgram(e,a,o,n,i)},e.prototype.createShaderProgram=function(e,t,r,n,i,a){void 0===a&&(a=null),i=i||this._gl;var o=this._webGLVersion>1?"#version 300 es\n#define WEBGL2 \n":"",s=this._compileShader(t,"vertex",n,o),c=this._compileShader(r,"fragment",n,o);return this._createShaderProgram(e,s,c,i,a)},e.prototype.createPipelineContext=function(){var e=new Pe;return e.engine=this,this._caps.parallelShaderCompile&&(e.isParallelCompiled=!0),e},e.prototype._createShaderProgram=function(e,t,r,n,i){void 0===i&&(i=null);var a=n.createProgram();if(e.program=a,!a)throw new Error("Unable to create program");return n.attachShader(a,t),n.attachShader(a,r),n.linkProgram(a),e.context=n,e.vertexShader=t,e.fragmentShader=r,e.isParallelCompiled||this._finalizePipelineContext(e),a},e.prototype._finalizePipelineContext=function(e){var t=e.context,r=e.vertexShader,n=e.fragmentShader,i=e.program;if(!t.getProgramParameter(i,t.LINK_STATUS)){var a,o;if(!this._gl.getShaderParameter(r,this._gl.COMPILE_STATUS)&&(a=this._gl.getShaderInfoLog(r)))throw e.vertexCompilationError=a,new Error("VERTEX SHADER "+a);if(!this._gl.getShaderParameter(n,this._gl.COMPILE_STATUS)&&(a=this._gl.getShaderInfoLog(n)))throw e.fragmentCompilationError=a,new Error("FRAGMENT SHADER "+a);if(o=t.getProgramInfoLog(i))throw e.programLinkError=o,new Error(o)}if(this.validateShaderPrograms&&(t.validateProgram(i),!t.getProgramParameter(i,t.VALIDATE_STATUS)&&(o=t.getProgramInfoLog(i))))throw e.programValidationError=o,new Error(o);t.deleteShader(r),t.deleteShader(n),e.vertexShader=void 0,e.fragmentShader=void 0,e.onCompiled&&(e.onCompiled(),e.onCompiled=void 0)},e.prototype._preparePipelineContext=function(e,t,r,n,i,a,o){var s=e;s.program=n?this.createRawShaderProgram(s,t,r,void 0,o):this.createShaderProgram(s,t,r,a,void 0,o),s.program.__SPECTOR_rebuildProgram=i},e.prototype._isRenderingStateCompiled=function(e){var t=e;return!!this._gl.getProgramParameter(t.program,this._caps.parallelShaderCompile.COMPLETION_STATUS_KHR)&&(this._finalizePipelineContext(t),!0)},e.prototype._executeWhenRenderingStateIsCompiled=function(e,t){var r=e;if(r.isParallelCompiled){var n=r.onCompiled;r.onCompiled=n?function(){n(),t()}:t}else t()},e.prototype.getUniforms=function(e,t){for(var r=new Array,n=e,i=0;i<t.length;i++)r.push(this._gl.getUniformLocation(n.program,t[i]));return r},e.prototype.getAttributes=function(e,t){for(var r=[],n=e,i=0;i<t.length;i++)try{r.push(this._gl.getAttribLocation(n.program,t[i]))}catch(e){r.push(-1)}return r},e.prototype.enableEffect=function(e){e&&e!==this._currentEffect&&(this.bindSamplers(e),this._currentEffect=e,e.onBind&&e.onBind(e),e._onBindObservable&&e._onBindObservable.notifyObservers(e))},e.prototype.setInt=function(e,t){e&&this._gl.uniform1i(e,t)},e.prototype.setIntArray=function(e,t){e&&this._gl.uniform1iv(e,t)},e.prototype.setIntArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2iv(e,t)},e.prototype.setIntArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3iv(e,t)},e.prototype.setIntArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4iv(e,t)},e.prototype.setArray=function(e,t){e&&this._gl.uniform1fv(e,t)},e.prototype.setArray2=function(e,t){e&&t.length%2==0&&this._gl.uniform2fv(e,t)},e.prototype.setArray3=function(e,t){e&&t.length%3==0&&this._gl.uniform3fv(e,t)},e.prototype.setArray4=function(e,t){e&&t.length%4==0&&this._gl.uniform4fv(e,t)},e.prototype.setMatrices=function(e,t){e&&this._gl.uniformMatrix4fv(e,!1,t)},e.prototype.setMatrix3x3=function(e,t){e&&this._gl.uniformMatrix3fv(e,!1,t)},e.prototype.setMatrix2x2=function(e,t){e&&this._gl.uniformMatrix2fv(e,!1,t)},e.prototype.setFloat=function(e,t){e&&this._gl.uniform1f(e,t)},e.prototype.setFloat2=function(e,t,r){e&&this._gl.uniform2f(e,t,r)},e.prototype.setFloat3=function(e,t,r,n){e&&this._gl.uniform3f(e,t,r,n)},e.prototype.setFloat4=function(e,t,r,n,i){e&&this._gl.uniform4f(e,t,r,n,i)},e.prototype.applyStates=function(){if(this._depthCullingState.apply(this._gl),this._stencilState.apply(this._gl),this._alphaState.apply(this._gl),this._colorWriteChanged){this._colorWriteChanged=!1;var e=this._colorWrite;this._gl.colorMask(e,e,e,e)}},e.prototype.setColorWrite=function(e){e!==this._colorWrite&&(this._colorWriteChanged=!0,this._colorWrite=e)},e.prototype.getColorWrite=function(){return this._colorWrite},Object.defineProperty(e.prototype,"depthCullingState",{get:function(){return this._depthCullingState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"alphaState",{get:function(){return this._alphaState},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stencilState",{get:function(){return this._stencilState},enumerable:!0,configurable:!0}),e.prototype.clearInternalTexturesCache=function(){this._internalTexturesCache=[]},e.prototype.wipeCaches=function(e){this.preventCacheWipeBetweenFrames&&!e||(this._currentEffect=null,this._viewportCached.x=0,this._viewportCached.y=0,this._viewportCached.z=0,this._viewportCached.w=0,this._unbindVertexArrayObject(),e&&(this._currentProgram=null,this.resetTextureCache(),this._stencilState.reset(),this._depthCullingState.reset(),this._depthCullingState.depthFunc=this._gl.LEQUAL,this._alphaState.reset(),this._alphaMode=1,this._alphaEquation=0,this._colorWrite=!0,this._colorWriteChanged=!0,this._unpackFlipYCached=null,this._gl.pixelStorei(this._gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this._gl.NONE),this._gl.pixelStorei(this._gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this._mustWipeVertexAttributes=!0,this.unbindAllAttributes()),this._resetVertexBufferBinding(),this._cachedIndexBuffer=null,this._cachedEffectForVertexBuffers=null,this.bindIndexBuffer(null))},e.prototype._getSamplingParameters=function(e,t){var r=this._gl,n=r.NEAREST,i=r.NEAREST;switch(e){case 11:n=r.LINEAR,i=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 3:n=r.LINEAR,i=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 8:n=r.NEAREST,i=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 4:n=r.NEAREST,i=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 5:n=r.NEAREST,i=t?r.LINEAR_MIPMAP_NEAREST:r.LINEAR;break;case 6:n=r.NEAREST,i=t?r.LINEAR_MIPMAP_LINEAR:r.LINEAR;break;case 7:n=r.NEAREST,i=r.LINEAR;break;case 1:n=r.NEAREST,i=r.NEAREST;break;case 9:n=r.LINEAR,i=t?r.NEAREST_MIPMAP_NEAREST:r.NEAREST;break;case 10:n=r.LINEAR,i=t?r.NEAREST_MIPMAP_LINEAR:r.NEAREST;break;case 2:n=r.LINEAR,i=r.LINEAR;break;case 12:n=r.LINEAR,i=r.NEAREST}return{min:i,mag:n}},e.prototype._createTexture=function(){var e=this._gl.createTexture();if(!e)throw new Error("Unable to create texture");return e},e.prototype.createTexture=function(t,r,n,i,a,o,s,c,u,h,l,f,d){var p=this;void 0===a&&(a=3),void 0===o&&(o=null),void 0===s&&(s=null),void 0===c&&(c=null),void 0===u&&(u=null),void 0===h&&(h=null),void 0===l&&(l=null),void 0===f&&(f=[]);for(var g=String(t),_="data:"===g.substr(0,5),m="blob:"===g.substr(0,5),b=_&&-1!==g.indexOf(";base64,"),y=u||new ne(this,Z.Url),v=g.lastIndexOf("."),T=l||(v>-1?g.substring(v).toLowerCase():""),x=this.excludedCompressedTextureFormats(g,this._textureFormatInUse),E=null,P=0,S=e._TextureLoaders;P<S.length;P++){var w=S[P];if(-1===f.indexOf(w)&&w.canLoad(T,x,u,b,!!c)){E=w;break}}E&&(g=E.transformUrl(g,x)),i&&i._addPendingData(y),y.url=g,y.generateMipMaps=!r,y.samplingMode=a,y.invertY=n,this._doNotHandleContextLost||(y._buffer=c);var R=null;o&&!u&&(R=y.onLoadedObservable.add(o)),u||this._internalTexturesCache.push(y);var C=function(e,n){i&&i._removePendingData(y);var o=!1;if(E&&E.getFallbackTextureUrl(g,p._textureFormatInUse))return o=!0,f.push(E),void p.createTexture(t,r,y.invertY,i,a,null,s,c,y,void 0,void 0,f);o||(R&&y.onLoadedObservable.remove(R),!ae.UseFallbackTexture)?s&&s(e||"Unknown error",n):p.createTexture(ae.FallbackTexture,r,y.invertY,i,a,null,s,c,y)};if(E){var A=function(e){E.loadData(e,y,(function(e,t,r,n,o,s){s?C("TextureLoader failed to load data"):p._prepareWebGLTexture(y,i,e,t,y.invertY,!r,n,(function(){return o(),!1}),a)}))};c?c instanceof ArrayBuffer?A(new Uint8Array(c)):ArrayBuffer.isView(c)?A(c):s&&s("Unable to load: only ArrayBuffer or ArrayBufferView is supported",null):this._loadFile(g,(function(e){return A(new Uint8Array(e))}),void 0,i?i.offlineProvider:void 0,!0,(function(e,t){C("Unable to load "+(e&&e.responseURL,t))}))}else{var F=function(e){m&&!p._doNotHandleContextLost&&(y._buffer=e),p._prepareWebGLTexture(y,i,e.width,e.height,y.invertY,r,!1,(function(t,r,n){var a=p._gl,o=e.width===t&&e.height===r,s=h?p._getInternalFormat(h):".jpg"===T?a.RGB:a.RGBA;if(o)return a.texImage2D(a.TEXTURE_2D,0,s,s,a.UNSIGNED_BYTE,e),!1;var c=p._caps.maxTextureSize;if(e.width>c||e.height>c||!p._supportsHardwareTextureRescaling)return p._prepareWorkingCanvas(),!(!p._workingCanvas||!p._workingContext||(p._workingCanvas.width=t,p._workingCanvas.height=r,p._workingContext.drawImage(e,0,0,e.width,e.height,0,0,t,r),a.texImage2D(a.TEXTURE_2D,0,s,s,a.UNSIGNED_BYTE,p._workingCanvas),y.width=t,y.height=r,1));var u=new ne(p,Z.Temp);return p._bindTextureDirectly(a.TEXTURE_2D,u,!0),a.texImage2D(a.TEXTURE_2D,0,s,s,a.UNSIGNED_BYTE,e),p._rescaleTexture(u,y,i,s,(function(){p._releaseTexture(u),p._bindTextureDirectly(a.TEXTURE_2D,y,!0),n()})),!0}),a)};!_||b?c&&(c.decoding||c.close)?F(c):e._FileToolsLoadImage(g,F,C,i?i.offlineProvider:null,d):"string"==typeof c||c instanceof ArrayBuffer||ArrayBuffer.isView(c)||c instanceof Blob?e._FileToolsLoadImage(c,F,C,i?i.offlineProvider:null,d):c&&F(c)}return y},e._FileToolsLoadImage=function(e,t,r,n,i){throw re.WarnImport("FileTools")},e.prototype._rescaleTexture=function(e,t,r,n,i){},e.prototype.createRawTexture=function(e,t,r,n,i,a,o,s,c){throw void 0===s&&(s=null),void 0===c&&(c=0),re.WarnImport("Engine.RawTexture")},e.prototype.createRawCubeTexture=function(e,t,r,n,i,a,o,s){throw void 0===s&&(s=null),re.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture3D=function(e,t,r,n,i,a,o,s,c,u){throw void 0===c&&(c=null),void 0===u&&(u=0),re.WarnImport("Engine.RawTexture")},e.prototype.createRawTexture2DArray=function(e,t,r,n,i,a,o,s,c,u){throw void 0===c&&(c=null),void 0===u&&(u=0),re.WarnImport("Engine.RawTexture")},e.prototype._unpackFlipY=function(e){this._unpackFlipYCached!==e&&(this._gl.pixelStorei(this._gl.UNPACK_FLIP_Y_WEBGL,e?1:0),this.enableUnpackFlipYCached&&(this._unpackFlipYCached=e))},e.prototype._getUnpackAlignement=function(){return this._gl.getParameter(this._gl.UNPACK_ALIGNMENT)},e.prototype._getTextureTarget=function(e){return e.isCube?this._gl.TEXTURE_CUBE_MAP:e.is3D?this._gl.TEXTURE_3D:e.is2DArray||e.isMultiview?this._gl.TEXTURE_2D_ARRAY:this._gl.TEXTURE_2D},e.prototype.updateTextureSamplingMode=function(e,t,r){void 0===r&&(r=!1);var n=this._getTextureTarget(t),i=this._getSamplingParameters(e,t.generateMipMaps||r);this._setTextureParameterInteger(n,this._gl.TEXTURE_MAG_FILTER,i.mag,t),this._setTextureParameterInteger(n,this._gl.TEXTURE_MIN_FILTER,i.min),r&&(t.generateMipMaps=!0,this._gl.generateMipmap(n)),this._bindTextureDirectly(n,null),t.samplingMode=e},e.prototype.updateTextureWrappingMode=function(e,t,r,n){void 0===r&&(r=null),void 0===n&&(n=null);var i=this._getTextureTarget(e);null!==t&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t),e),e._cachedWrapU=t),null!==r&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(r),e),e._cachedWrapV=r),(e.is2DArray||e.is3D)&&null!==n&&(this._setTextureParameterInteger(i,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(n),e),e._cachedWrapR=n),this._bindTextureDirectly(i,null)},e.prototype._setupDepthStencilTexture=function(e,t,r,n,i){var a=t.width||t,o=t.height||t,s=t.layers||0;e.baseWidth=a,e.baseHeight=o,e.width=a,e.height=o,e.is2DArray=s>0,e.depth=s,e.isReady=!0,e.samples=1,e.generateMipMaps=!1,e._generateDepthBuffer=!0,e._generateStencilBuffer=r,e.samplingMode=n?2:1,e.type=0,e._comparisonFunction=i;var c=this._gl,u=this._getTextureTarget(e),h=this._getSamplingParameters(e.samplingMode,!1);c.texParameteri(u,c.TEXTURE_MAG_FILTER,h.mag),c.texParameteri(u,c.TEXTURE_MIN_FILTER,h.min),c.texParameteri(u,c.TEXTURE_WRAP_S,c.CLAMP_TO_EDGE),c.texParameteri(u,c.TEXTURE_WRAP_T,c.CLAMP_TO_EDGE),0===i?(c.texParameteri(u,c.TEXTURE_COMPARE_FUNC,515),c.texParameteri(u,c.TEXTURE_COMPARE_MODE,c.NONE)):(c.texParameteri(u,c.TEXTURE_COMPARE_FUNC,i),c.texParameteri(u,c.TEXTURE_COMPARE_MODE,c.COMPARE_REF_TO_TEXTURE))},e.prototype._uploadCompressedDataToTextureDirectly=function(e,t,r,n,i,a,o){void 0===a&&(a=0),void 0===o&&(o=0);var s=this._gl,c=s.TEXTURE_2D;e.isCube&&(c=s.TEXTURE_CUBE_MAP_POSITIVE_X+a),this._gl.compressedTexImage2D(c,o,t,r,n,0,i)},e.prototype._uploadDataToTextureDirectly=function(e,t,r,n,i,a){void 0===r&&(r=0),void 0===n&&(n=0),void 0===a&&(a=!1);var o=this._gl,s=this._getWebGLTextureType(e.type),c=this._getInternalFormat(e.format),u=void 0===i?this._getRGBABufferInternalSizedFormat(e.type,e.format):this._getInternalFormat(i);this._unpackFlipY(e.invertY);var h=o.TEXTURE_2D;e.isCube&&(h=o.TEXTURE_CUBE_MAP_POSITIVE_X+r);var l=Math.round(Math.log(e.width)*Math.LOG2E),f=Math.round(Math.log(e.height)*Math.LOG2E),d=a?e.width:Math.pow(2,Math.max(l-n,0)),p=a?e.height:Math.pow(2,Math.max(f-n,0));o.texImage2D(h,n,u,d,p,0,c,s,t)},e.prototype.updateTextureData=function(e,t,r,n,i,a,o,s){void 0===o&&(o=0),void 0===s&&(s=0);var c=this._gl,u=this._getWebGLTextureType(e.type),h=this._getInternalFormat(e.format);this._unpackFlipY(e.invertY);var l=c.TEXTURE_2D;e.isCube&&(l=c.TEXTURE_CUBE_MAP_POSITIVE_X+o),c.texSubImage2D(l,s,r,n,i,a,h,u,t)},e.prototype._uploadArrayBufferViewToTexture=function(e,t,r,n){void 0===r&&(r=0),void 0===n&&(n=0);var i=this._gl,a=e.isCube?i.TEXTURE_CUBE_MAP:i.TEXTURE_2D;this._bindTextureDirectly(a,e,!0),this._uploadDataToTextureDirectly(e,t,r,n),this._bindTextureDirectly(a,null,!0)},e.prototype._prepareWebGLTextureContinuation=function(e,t,r,n,i){var a=this._gl;if(a){var o=this._getSamplingParameters(i,!r);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,o.mag),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,o.min),r||n||a.generateMipmap(a.TEXTURE_2D),this._bindTextureDirectly(a.TEXTURE_2D,null),t&&t._removePendingData(e),e.onLoadedObservable.notifyObservers(e),e.onLoadedObservable.clear()}},e.prototype._prepareWebGLTexture=function(t,r,n,i,a,o,s,c,u){var h=this;void 0===u&&(u=3);var l=this.getCaps().maxTextureSize,f=Math.min(l,this.needPOTTextures?e.GetExponentOfTwo(n,l):n),d=Math.min(l,this.needPOTTextures?e.GetExponentOfTwo(i,l):i),p=this._gl;p&&(t._webGLTexture?(this._bindTextureDirectly(p.TEXTURE_2D,t,!0),this._unpackFlipY(void 0===a||!!a),t.baseWidth=n,t.baseHeight=i,t.width=f,t.height=d,t.isReady=!0,c(f,d,(function(){h._prepareWebGLTextureContinuation(t,r,o,s,u)}))||this._prepareWebGLTextureContinuation(t,r,o,s,u)):r&&r._removePendingData(t))},e.prototype._setupFramebufferDepthAttachments=function(e,t,r,n,i){void 0===i&&(i=1);var a=this._gl;if(e&&t)return this._getDepthStencilBuffer(r,n,i,a.DEPTH_STENCIL,a.DEPTH24_STENCIL8,a.DEPTH_STENCIL_ATTACHMENT);if(t){var o=a.DEPTH_COMPONENT16;return this._webGLVersion>1&&(o=a.DEPTH_COMPONENT32F),this._getDepthStencilBuffer(r,n,i,o,o,a.DEPTH_ATTACHMENT)}return e?this._getDepthStencilBuffer(r,n,i,a.STENCIL_INDEX8,a.STENCIL_INDEX8,a.STENCIL_ATTACHMENT):null},e.prototype._releaseFramebufferObjects=function(e){var t=this._gl;e._framebuffer&&(t.deleteFramebuffer(e._framebuffer),e._framebuffer=null),e._depthStencilBuffer&&(t.deleteRenderbuffer(e._depthStencilBuffer),e._depthStencilBuffer=null),e._MSAAFramebuffer&&(t.deleteFramebuffer(e._MSAAFramebuffer),e._MSAAFramebuffer=null),e._MSAARenderBuffer&&(t.deleteRenderbuffer(e._MSAARenderBuffer),e._MSAARenderBuffer=null)},e.prototype._releaseTexture=function(e){this._releaseFramebufferObjects(e),this._deleteTexture(e._webGLTexture),this.unbindAllTextures();var t=this._internalTexturesCache.indexOf(e);-1!==t&&this._internalTexturesCache.splice(t,1),e._lodTextureHigh&&e._lodTextureHigh.dispose(),e._lodTextureMid&&e._lodTextureMid.dispose(),e._lodTextureLow&&e._lodTextureLow.dispose(),e._irradianceTexture&&e._irradianceTexture.dispose()},e.prototype._deleteTexture=function(e){this._gl.deleteTexture(e)},e.prototype._setProgram=function(e){this._currentProgram!==e&&(this._gl.useProgram(e),this._currentProgram=e)},e.prototype.bindSamplers=function(e){var t=e.getPipelineContext();this._setProgram(t.program);for(var r=e.getSamplers(),n=0;n<r.length;n++){var i=e.getUniform(r[n]);i&&(this._boundUniforms[n]=i)}this._currentEffect=null},e.prototype._activateCurrentTexture=function(){this._currentTextureChannel!==this._activeChannel&&(this._gl.activeTexture(this._gl.TEXTURE0+this._activeChannel),this._currentTextureChannel=this._activeChannel)},e.prototype._bindTextureDirectly=function(e,t,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1);var i=!1,a=t&&t._associatedChannel>-1;return r&&a&&(this._activeChannel=t._associatedChannel),this._boundTexturesCache[this._activeChannel]!==t||n?(this._activateCurrentTexture(),t&&t.isMultiview?this._gl.bindTexture(e,t?t._colorTextureArray:null):this._gl.bindTexture(e,t?t._webGLTexture:null),this._boundTexturesCache[this._activeChannel]=t,t&&(t._associatedChannel=this._activeChannel)):r&&(i=!0,this._activateCurrentTexture()),a&&!r&&this._bindSamplerUniformToChannel(t._associatedChannel,this._activeChannel),i},e.prototype._bindTexture=function(e,t){void 0!==e&&(t&&(t._associatedChannel=e),this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,t))},e.prototype.unbindAllTextures=function(){for(var e=0;e<this._maxSimultaneousTextures;e++)this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))},e.prototype.setTexture=function(e,t,r){void 0!==e&&(t&&(this._boundUniforms[e]=t),this._setTexture(e,r))},e.prototype._bindSamplerUniformToChannel=function(e,t){var r=this._boundUniforms[e];r&&r._currentState!==t&&(this._gl.uniform1i(r,t),r._currentState=t)},e.prototype._getTextureWrapMode=function(e){switch(e){case 1:return this._gl.REPEAT;case 0:return this._gl.CLAMP_TO_EDGE;case 2:return this._gl.MIRRORED_REPEAT}return this._gl.REPEAT},e.prototype._setTexture=function(e,t,r,n){if(void 0===r&&(r=!1),void 0===n&&(n=!1),!t)return null!=this._boundTexturesCache[e]&&(this._activeChannel=e,this._bindTextureDirectly(this._gl.TEXTURE_2D,null),this._bindTextureDirectly(this._gl.TEXTURE_CUBE_MAP,null),this.webGLVersion>1&&(this._bindTextureDirectly(this._gl.TEXTURE_3D,null),this._bindTextureDirectly(this._gl.TEXTURE_2D_ARRAY,null))),!1;if(t.video)this._activeChannel=e,t.update();else if(4===t.delayLoadState)return t.delayLoad(),!1;var i;i=n?t.depthStencilTexture:t.isReady()?t.getInternalTexture():t.isCube?this.emptyCubeTexture:t.is3D?this.emptyTexture3D:t.is2DArray?this.emptyTexture2DArray:this.emptyTexture,!r&&i&&(i._associatedChannel=e);var a=!0;this._boundTexturesCache[e]===i&&(r||this._bindSamplerUniformToChannel(i._associatedChannel,e),a=!1),this._activeChannel=e;var o=this._getTextureTarget(i);if(a&&this._bindTextureDirectly(o,i,r),i&&!i.isMultiview){if(i.isCube&&i._cachedCoordinatesMode!==t.coordinatesMode){i._cachedCoordinatesMode=t.coordinatesMode;var s=3!==t.coordinatesMode&&5!==t.coordinatesMode?1:0;t.wrapU=s,t.wrapV=s}i._cachedWrapU!==t.wrapU&&(i._cachedWrapU=t.wrapU,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_S,this._getTextureWrapMode(t.wrapU),i)),i._cachedWrapV!==t.wrapV&&(i._cachedWrapV=t.wrapV,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_T,this._getTextureWrapMode(t.wrapV),i)),i.is3D&&i._cachedWrapR!==t.wrapR&&(i._cachedWrapR=t.wrapR,this._setTextureParameterInteger(o,this._gl.TEXTURE_WRAP_R,this._getTextureWrapMode(t.wrapR),i)),this._setAnisotropicLevel(o,i,t.anisotropicFilteringLevel)}return!0},e.prototype.setTextureArray=function(e,t,r){if(void 0!==e&&t){this._textureUnits&&this._textureUnits.length===r.length||(this._textureUnits=new Int32Array(r.length));for(var n=0;n<r.length;n++){var i=r[n].getInternalTexture();i?(this._textureUnits[n]=e+n,i._associatedChannel=e+n):this._textureUnits[n]=-1}this._gl.uniform1iv(t,this._textureUnits);for(var a=0;a<r.length;a++)this._setTexture(this._textureUnits[a],r[a],!0)}},e.prototype._setAnisotropicLevel=function(e,t,r){var n=this._caps.textureAnisotropicFilterExtension;11!==t.samplingMode&&3!==t.samplingMode&&2!==t.samplingMode&&(r=1),n&&t._cachedAnisotropicFilteringLevel!==r&&(this._setTextureParameterFloat(e,n.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r,this._caps.maxAnisotropy),t),t._cachedAnisotropicFilteringLevel=r)},e.prototype._setTextureParameterFloat=function(e,t,r,n){this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameterf(e,t,r)},e.prototype._setTextureParameterInteger=function(e,t,r,n){n&&this._bindTextureDirectly(e,n,!0,!0),this._gl.texParameteri(e,t,r)},e.prototype.unbindAllAttributes=function(){if(this._mustWipeVertexAttributes){this._mustWipeVertexAttributes=!1;for(var e=0;e<this._caps.maxVertexAttribs;e++)this.disableAttributeByIndex(e)}else{e=0;for(var t=this._vertexAttribArraysEnabled.length;e<t;e++)e>=this._caps.maxVertexAttribs||!this._vertexAttribArraysEnabled[e]||this.disableAttributeByIndex(e)}},e.prototype.releaseEffects=function(){for(var e in this._compiledEffects){var t=this._compiledEffects[e].getPipelineContext();this._deletePipelineContext(t)}this._compiledEffects={}},e.prototype.dispose=function(){this.stopRenderLoop(),this.onBeforeTextureInitObservable&&this.onBeforeTextureInitObservable.clear(),this._emptyTexture&&(this._releaseTexture(this._emptyTexture),this._emptyTexture=null),this._emptyCubeTexture&&(this._releaseTexture(this._emptyCubeTexture),this._emptyCubeTexture=null),this.releaseEffects(),this.unbindAllAttributes(),this._boundUniforms=[],oe.IsWindowObjectExist()&&this._renderingCanvas&&(this._doNotHandleContextLost||(this._renderingCanvas.removeEventListener("webglcontextlost",this._onContextLost),this._renderingCanvas.removeEventListener("webglcontextrestored",this._onContextRestored))),this._workingCanvas=null,this._workingContext=null,this._currentBufferPointers=[],this._renderingCanvas=null,this._currentProgram=null,this._boundRenderFunction=null,be.ResetCache();for(var e=0,t=this._activeRequests;e<t.length;e++)t[e].abort()},e.prototype.attachContextLostEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextlost",e,!1)},e.prototype.attachContextRestoredEvent=function(e){this._renderingCanvas&&this._renderingCanvas.addEventListener("webglcontextrestored",e,!1)},e.prototype.getError=function(){return this._gl.getError()},e.prototype._canRenderToFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(1)},e.prototype._canRenderToHalfFloatFramebuffer=function(){return this._webGLVersion>1?this._caps.colorBufferFloat:this._canRenderToFramebuffer(2)},e.prototype._canRenderToFramebuffer=function(e){for(var t=this._gl;t.getError()!==t.NO_ERROR;);var r=!0,n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n),t.texImage2D(t.TEXTURE_2D,0,this._getRGBABufferInternalSizedFormat(e),1,1,0,t.RGBA,this._getWebGLTextureType(e),null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST);var i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);var a=t.checkFramebufferStatus(t.FRAMEBUFFER);if((r=(r=r&&a===t.FRAMEBUFFER_COMPLETE)&&t.getError()===t.NO_ERROR)&&(t.clear(t.COLOR_BUFFER_BIT),r=r&&t.getError()===t.NO_ERROR),r){t.bindFramebuffer(t.FRAMEBUFFER,null);var o=t.RGBA,s=t.UNSIGNED_BYTE,c=new Uint8Array(4);t.readPixels(0,0,1,1,o,s,c),r=r&&t.getError()===t.NO_ERROR}for(t.deleteTexture(n),t.deleteFramebuffer(i),t.bindFramebuffer(t.FRAMEBUFFER,null);!r&&t.getError()!==t.NO_ERROR;);return r},e.prototype._getWebGLTextureType=function(e){if(1===this._webGLVersion){switch(e){case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT_OES;case 0:return this._gl.UNSIGNED_BYTE;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5}return this._gl.UNSIGNED_BYTE}switch(e){case 3:return this._gl.BYTE;case 0:return this._gl.UNSIGNED_BYTE;case 4:return this._gl.SHORT;case 5:return this._gl.UNSIGNED_SHORT;case 6:return this._gl.INT;case 7:return this._gl.UNSIGNED_INT;case 1:return this._gl.FLOAT;case 2:return this._gl.HALF_FLOAT;case 8:return this._gl.UNSIGNED_SHORT_4_4_4_4;case 9:return this._gl.UNSIGNED_SHORT_5_5_5_1;case 10:return this._gl.UNSIGNED_SHORT_5_6_5;case 11:return this._gl.UNSIGNED_INT_2_10_10_10_REV;case 12:return this._gl.UNSIGNED_INT_24_8;case 13:return this._gl.UNSIGNED_INT_10F_11F_11F_REV;case 14:return this._gl.UNSIGNED_INT_5_9_9_9_REV;case 15:return this._gl.FLOAT_32_UNSIGNED_INT_24_8_REV}return this._gl.UNSIGNED_BYTE},e.prototype._getInternalFormat=function(e){var t=this._gl.RGBA;switch(e){case 0:t=this._gl.ALPHA;break;case 1:t=this._gl.LUMINANCE;break;case 2:t=this._gl.LUMINANCE_ALPHA;break;case 6:t=this._gl.RED;break;case 7:t=this._gl.RG;break;case 4:t=this._gl.RGB;break;case 5:t=this._gl.RGBA}if(this._webGLVersion>1)switch(e){case 8:t=this._gl.RED_INTEGER;break;case 9:t=this._gl.RG_INTEGER;break;case 10:t=this._gl.RGB_INTEGER;break;case 11:t=this._gl.RGBA_INTEGER}return t},e.prototype._getRGBABufferInternalSizedFormat=function(e,t){if(1===this._webGLVersion){if(void 0!==t)switch(t){case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;case 4:return this._gl.RGB}return this._gl.RGBA}switch(e){case 3:switch(t){case 6:return this._gl.R8_SNORM;case 7:return this._gl.RG8_SNORM;case 4:return this._gl.RGB8_SNORM;case 8:return this._gl.R8I;case 9:return this._gl.RG8I;case 10:return this._gl.RGB8I;case 11:return this._gl.RGBA8I;default:return this._gl.RGBA8_SNORM}case 0:switch(t){case 6:return this._gl.R8;case 7:return this._gl.RG8;case 4:return this._gl.RGB8;case 5:return this._gl.RGBA8;case 8:return this._gl.R8UI;case 9:return this._gl.RG8UI;case 10:return this._gl.RGB8UI;case 11:return this._gl.RGBA8UI;case 0:return this._gl.ALPHA;case 1:return this._gl.LUMINANCE;case 2:return this._gl.LUMINANCE_ALPHA;default:return this._gl.RGBA8}case 4:switch(t){case 8:return this._gl.R16I;case 9:return this._gl.RG16I;case 10:return this._gl.RGB16I;case 11:default:return this._gl.RGBA16I}case 5:switch(t){case 8:return this._gl.R16UI;case 9:return this._gl.RG16UI;case 10:return this._gl.RGB16UI;case 11:default:return this._gl.RGBA16UI}case 6:switch(t){case 8:return this._gl.R32I;case 9:return this._gl.RG32I;case 10:return this._gl.RGB32I;case 11:default:return this._gl.RGBA32I}case 7:switch(t){case 8:return this._gl.R32UI;case 9:return this._gl.RG32UI;case 10:return this._gl.RGB32UI;case 11:default:return this._gl.RGBA32UI}case 1:switch(t){case 6:return this._gl.R32F;case 7:return this._gl.RG32F;case 4:return this._gl.RGB32F;case 5:default:return this._gl.RGBA32F}case 2:switch(t){case 6:return this._gl.R16F;case 7:return this._gl.RG16F;case 4:return this._gl.RGB16F;case 5:default:return this._gl.RGBA16F}case 10:return this._gl.RGB565;case 13:return this._gl.R11F_G11F_B10F;case 14:return this._gl.RGB9_E5;case 8:return this._gl.RGBA4;case 9:return this._gl.RGB5_A1;case 11:switch(t){case 5:return this._gl.RGB10_A2;case 11:return this._gl.RGB10_A2UI;default:return this._gl.RGB10_A2}}return this._gl.RGBA8},e.prototype._getRGBAMultiSampleBufferFormat=function(e){return 1===e?this._gl.RGBA32F:2===e?this._gl.RGBA16F:this._gl.RGBA8},e.prototype._loadFile=function(t,r,n,i,a,o){var s=this,c=e._FileToolsLoadFile(t,r,n,i,a,o);return this._activeRequests.push(c),c.onCompleteObservable.add((function(e){s._activeRequests.splice(s._activeRequests.indexOf(e),1)})),c},e._FileToolsLoadFile=function(e,t,r,n,i,a){throw re.WarnImport("FileTools")},e.prototype.readPixels=function(e,t,r,n,i){void 0===i&&(i=!0);var a=i?4:3,o=i?this._gl.RGBA:this._gl.RGB,s=new Uint8Array(n*r*a);return this._gl.readPixels(e,t,r,n,o,this._gl.UNSIGNED_BYTE,s),s},e.isSupported=function(){if(null===this._isSupported)try{var e=Se.CreateCanvas(1,1),t=e.getContext("webgl")||e.getContext("experimental-webgl");this._isSupported=null!=t&&!!window.WebGLRenderingContext}catch(e){this._isSupported=!1}return this._isSupported},e.CeilingPOT=function(e){return e--,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,++e},e.FloorPOT=function(e){return e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,(e|=e>>16)-(e>>1)},e.NearestPOT=function(t){var r=e.CeilingPOT(t),n=e.FloorPOT(t);return r-t>t-n?n:r},e.GetExponentOfTwo=function(t,r,n){var i;switch(void 0===n&&(n=2),n){case 1:i=e.FloorPOT(t);break;case 2:i=e.NearestPOT(t);break;case 3:default:i=e.CeilingPOT(t)}return Math.min(i,r)},e.QueueNewFrame=function(e,t){return oe.IsWindowObjectExist()?(t||(t=window),t.requestAnimationFrame?t.requestAnimationFrame(e):t.msRequestAnimationFrame?t.msRequestAnimationFrame(e):t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(e):t.mozRequestAnimationFrame?t.mozRequestAnimationFrame(e):t.oRequestAnimationFrame?t.oRequestAnimationFrame(e):window.setTimeout(e,16)):"undefined"!=typeof requestAnimationFrame?requestAnimationFrame(e):setTimeout(e,16)},e.prototype.getHostDocument=function(){return this._renderingCanvas&&this._renderingCanvas.ownerDocument?this._renderingCanvas.ownerDocument:document},e.ExceptionList=[{key:"Chrome/63.0",capture:"63\\.0\\.3239\\.(\\d+)",captureConstraint:108,targets:["uniformBuffer"]},{key:"Firefox/58",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Firefox/59",capture:null,captureConstraint:null,targets:["uniformBuffer"]},{key:"Chrome/72.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/73.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Chrome/74.+?Mobile",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/71",capture:null,captureConstraint:null,targets:["vao"]},{key:"Mac OS.+Chrome/72",capture:null,captureConstraint:null,targets:["vao"]}],e._TextureLoaders=[],e.CollisionsEpsilon=.001,e._isSupported=null,e}();Re.prototype.createRenderTargetTexture=function(e,t){var r=new te;void 0!==t&&"object"==typeof t?(r.generateMipMaps=t.generateMipMaps,r.generateDepthBuffer=!!t.generateDepthBuffer,r.generateStencilBuffer=!!t.generateStencilBuffer,r.type=void 0===t.type?0:t.type,r.samplingMode=void 0===t.samplingMode?3:t.samplingMode,r.format=void 0===t.format?5:t.format):(r.generateMipMaps=t,r.generateDepthBuffer=!0,r.generateStencilBuffer=!1,r.type=0,r.samplingMode=3,r.format=5),(1!==r.type||this._caps.textureFloatLinearFiltering)&&(2!==r.type||this._caps.textureHalfFloatLinearFiltering)||(r.samplingMode=1),1!==r.type||this._caps.textureFloat||(r.type=0,ie.Warn("Float textures are not supported. Render target forced to TEXTURETYPE_UNSIGNED_BYTE type"));var n=this._gl,i=new ne(this,Z.RenderTarget),a=e.width||e,o=e.height||e,s=e.layers||0,c=this._getSamplingParameters(r.samplingMode,!!r.generateMipMaps),u=0!==s?n.TEXTURE_2D_ARRAY:n.TEXTURE_2D,h=this._getRGBABufferInternalSizedFormat(r.type,r.format),l=this._getInternalFormat(r.format),f=this._getWebGLTextureType(r.type);this._bindTextureDirectly(u,i),0!==s?(i.is2DArray=!0,n.texImage3D(u,0,h,a,o,s,0,l,f,null)):n.texImage2D(u,0,h,a,o,0,l,f,null),n.texParameteri(u,n.TEXTURE_MAG_FILTER,c.mag),n.texParameteri(u,n.TEXTURE_MIN_FILTER,c.min),n.texParameteri(u,n.TEXTURE_WRAP_S,n.CLAMP_TO_EDGE),n.texParameteri(u,n.TEXTURE_WRAP_T,n.CLAMP_TO_EDGE),r.generateMipMaps&&this._gl.generateMipmap(u),this._bindTextureDirectly(u,null);var d=n.createFramebuffer();return this._bindUnboundFramebuffer(d),i._depthStencilBuffer=this._setupFramebufferDepthAttachments(!!r.generateStencilBuffer,r.generateDepthBuffer,a,o),i.is2DArray||n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,i._webGLTexture,0),this._bindUnboundFramebuffer(null),i._framebuffer=d,i.baseWidth=a,i.baseHeight=o,i.width=a,i.height=o,i.depth=s,i.isReady=!0,i.samples=1,i.generateMipMaps=!!r.generateMipMaps,i.samplingMode=r.samplingMode,i.type=r.type,i.format=r.format,i._generateDepthBuffer=r.generateDepthBuffer,i._generateStencilBuffer=!!r.generateStencilBuffer,this._internalTexturesCache.push(i),i},Re.prototype.createDepthStencilTexture=function(e,t){if(t.isCube){var r=e.width||e;return this._createDepthStencilCubeTexture(r,t)}return this._createDepthStencilTexture(e,t)},Re.prototype._createDepthStencilTexture=function(e,t){var r=this._gl,i=e.layers||0,a=0!==i?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D,o=new ne(this,Z.Depth);if(!this._caps.depthTextureExtension)return ie.Error("Depth texture is not supported by your browser or hardware."),o;var s=Object(n.a)({bilinearFiltering:!1,comparisonFunction:0,generateStencil:!1},t);this._bindTextureDirectly(a,o,!0),this._setupDepthStencilTexture(o,e,s.generateStencil,s.bilinearFiltering,s.comparisonFunction);var c=s.generateStencil?r.UNSIGNED_INT_24_8:r.UNSIGNED_INT,u=s.generateStencil?r.DEPTH_STENCIL:r.DEPTH_COMPONENT,h=u;return this.webGLVersion>1&&(h=s.generateStencil?r.DEPTH24_STENCIL8:r.DEPTH_COMPONENT24),o.is2DArray?r.texImage3D(a,0,h,o.width,o.height,i,0,u,c,null):r.texImage2D(a,0,h,o.width,o.height,0,u,c,null),this._bindTextureDirectly(a,null),o};var Ce=1,Ae=[{v:"precision highp float;const int pc=0,qc=1,rc=2,sc=3,tc=-1;const int k=0,l=1,m=2,n=3;const int uc=0,vc=1,wc=2;uniform vec2 u_0;uniform vec2 u_1;uniform vec2 u_2;uniform float u_3;uniform int u_4;uniform float u_5;uniform int u_6;uniform int u_7;uniform mat3 u_8;uniform float u_12;uniform int u_13;uniform float u_14;uniform int u_15;uniform vec2 u_17;uniform int u_18;uniform int u_19;attribute vec2 a_v;attribute vec4 a_p0;attribute vec4 a_p1;attribute vec4 a_p2;attribute vec4 a_p3;attribute vec4 a_p4;attribute float a_d1;attribute float a_d2;const float o=0.0,p=1.0,q=3.0,s=4.0,t=5.0,u=6.0,v=7.0;const float xc=0.001;const float yc=0.001;const float zc=0.001;varying float frag_type;varying vec3 frag_geoUVS;varying vec2 frag_geoRange;varying vec4 frag_specialParam1;varying vec4 frag_specialParam2;varying vec4 frag_specialParam3;varying vec3 frag_specialParam4;varying vec2 frag_specialParam5;const int Ac=2,Bc=5;const int Cc=0,Dc=1,Ec=2,Fc=3;vec2 Gc(vec4 Hc){mat3 Ic=u_8;vec2 Jc=u_0;vec2 Kc=u_1;vec2 Lc=u_17;return((Ic*vec3(Hc.xy,1.0)).xy*Kc-Jc)/Lc;}vec2 Mc(vec2 wb){return vec2(-wb.y,wb.x);}void main(){vec2 Nc=a_v;int Y=u_7;vec2 Oc=u_2;float Pc=u_3;int Z=u_4;float Qc=u_5;float Rc=u_12;int fb=u_13;float Sc=u_14;int Tc=u_15;vec2 Lc=u_17;bool Uc=u_18 !=0;bool Vc=u_19 !=0;frag_type=0.0;frag_geoRange=frag_specialParam5=vec2(0.0,0.0);frag_geoUVS=frag_specialParam4=vec3(0.0,0.0,0.0);frag_specialParam1=frag_specialParam2=frag_specialParam3=vec4(0.0,0.0,0.0,0.0);if(Y==rc || Y==sc){gl_Position=vec4(Nc,0.0,1.0);frag_type=p;}else{vec2 Wc=Gc(a_p0),Xc=Gc(a_p1),Yc=Gc(a_p2),Zc=Gc(a_p3),ad=Gc(a_p4);int bd=int(a_p0.z),cd=int(a_p1.z),dd=int(a_p2.z),ed=int(a_p3.z),fd=int(a_p4.z);float gd=Vc ? 0.0 : a_d1,hd=Vc ? 0.0 : a_d2;float id=a_p1.w,jd=a_p2.w,kd=a_p3.w;bool ld=cd==wc;bool md=dd==wc;vec2 nd,od,pd;int qd,rd;if(md){nd=Xc;od=Yc;pd=Zc;qd=cd;rd=ed;}else if(ld){nd=Wc;od=Xc;pd=Yc;qd=bd;rd=dd;}else{nd=Xc;od=(Xc+Yc)*0.5;pd=Yc;qd=cd;rd=dd;}vec2 sd=pd-nd,td=od-nd,ud=pd-od;float vd=length(sd),wd=length(td),xd=length(ud);vec2 yd=sd/vd,zd=td/wd,Ad=ud/xd;vec2 Bd=Mc(yd),Cd=Mc(zd),Dd=Mc(Ad);float Ed=dot(Cd,Ad);mat2 Fd;vec2 Gd,Hd;float Id;bool Jd=false;vec2 Kd;if(md || ld){vec2 Ld=ud-td;float Md=(dot(-td,ud)+dot(-td,-td))/dot(Ld,Ld);vec2 Nd=mix(nd,od,Md),Od=mix(od,pd,Md),Pd=normalize(Od-Nd);float Qd=sign(Ed);mat2 Rd=mat2(Pd,vec2(-Pd.y,Pd.x)*Qd);vec2 Sd=mix(Nd,Od,Md);vec2 Td=(nd-Sd)*Rd,Ud=(pd-Sd)*Rd;float Vd=abs(Td.x)> abs(Ud.x)?(Td.x*Td.x)/Td.y :(Ud.x*Ud.x)/Ud.y;Fd=Rd/Vd;Gd=Sd;Hd=vec2(Td.x,Ud.x)/Vd;Id=Vd*Qd;float Wd=abs(Td.y/Td.x),Xd=abs(Ud.y/Ud.x);Jd=Uc || abs(Ed)< xc || min(min(Wd,Xd),1.0/max(Wd,Xd))< zc || min(abs(vd),min(abs(wd/vd),abs(xd/vd)))< Pc*yc;}bool Yd=md || ld;vec2 Zd=Wc;int ae=bd;vec2 be=Yd ? ad : Zc;int ce=Yd ? fd : ed;bool de=(ae==0),ee=(ce==0),fe=(rd==0);if(ae==0)Zd=nd-(od-nd);if(ce==0)be=pd-(pd-od);vec2 ge=nd-Zd,he=-ge,ie=be-pd,je=-ie;float ke=length(ge),le=length(ie);vec2 me=ge/ke,ne=ie/le;vec2 oe=Mc(me),pe=Mc(ne);if(! Yd || Jd){if(wd < yc){zd=me;Cd=oe;}if(xd < yc){Ad=ne;Dd=pe;}if(vd < yc){yd=normalize(be-Zd);Bd=Mc(yd);}if(vd < yc){yd=vec2(1.0,0.0);Bd=vec2(0.0,-1.0);vd=yc;}if(wd < yc){zd=yd;Cd=Bd;}if(xd < yc){Ad=yd;Dd=Bd;}if(ke < yc){me=zd;oe=Cd;}if(le < yc){ne=Ad;pe=Dd;}Fd=mat2(yd/vd,Bd/vd);Gd=nd;Hd=vec2(0.0,1.0);Id=vd;}vec2 qe=vec2(0.0,0.0);if(Y==pc &&(! Yd || md)){if(Uc){bool fe=(rd==0);if(fe || abs(vd)< Pc*yc)frag_type=o;else{float re=clamp(id,0.0,1.0);float se=clamp((Yd ? kd : jd),0.0,1.0);float te=Yd ? gd+(hd-gd)*2.0 : hd;float ue=Rc*0.5;vec4 ve=vec4(min(nd.x,pd.x)-Pc*Lc.x,min(nd.y,pd.y)-Pc*Lc.y,max(nd.x,pd.x)+Pc*Lc.x,max(nd.y,pd.y)+Pc*Lc.y);qe=Nc*vec2(ve [ 2 ]-ve [ 0 ],ve [ 3 ]-ve [ 1 ])/2.0+vec2(ve [ 2 ]+ve [ 0 ],ve [ 3 ]+ve [ 1 ])/2.0;vec2 we=vec2(yd.x==0.0 ? 1.0 : sign(yd.x),yd.y==0.0 ? 1.0 : sign(yd.y));float xe=ue*(1.0-re),ye=ue*(1.0-se);float ze=ue*re,Ae=ue*se;vec2 Be=nd-we*ze,Ce=pd+we*Ae;vec2 De=Be+vec2(we.x*2.0*ze,0.0),Ee=Ce-vec2(we.x*2.0*Ae,0.0);vec2 Fe=Be+vec2(0.0,we.y*2.0*ze),Ge=Ce-vec2(0.0,we.y*2.0*Ae);bool He=dot(Bd,De-nd)>=0.0,Ie=dot(Bd,Ee-nd)>=0.0;vec2 Je=He ? De : Fe,Ke=Ie ? Ee : Ge;vec2 Le=He ? Fe : De,Me=Ie ? Ge : Ee;float Ne=max(abs(yd.x),abs(yd.y));float Oe=dot(qe-Je,Mc(normalize(Ke-Je)))*Ne+ue;float Pe=dot(qe-Le,-Mc(normalize(Me-Le)))*Ne+ue;float Qe=dot(qe-nd,Bd);float Re=dot(qe-nd,(re > xc)? Mc(Le-Je): yd);float Se=dot(qe-pd,(se > xc)? Mc(Ke-Me):-yd);frag_specialParam1=vec4(qe-nd,qe-pd)*0.5/Pc;frag_specialParam2=vec4(Oe,Pe,xe,ye)*0.5/Pc;frag_specialParam3=vec4(hd-gd,gd,0.0,0.0);frag_specialParam4=vec3(Qe,Re,Se);frag_type=v;}}else{float Te=dot(oe,zd),Ue=dot(Dd,ne),Ve=dot(oe,yd),We=dot(Bd,ne);bool Xe=abs(Te)< xc,Ye=abs(Ue)< xc;bool Ze=Xe && dot(me,zd)< 0.0,af=Ye && dot(Ad,ne)< 0.0;float bf=(! Xe)? sign(Te):(Ve !=0.0)? sign(Ve): sign(We);float cf=(! Ye)? sign(Ue):(We !=0.0)? sign(We): sign(Ve);vec2 df=normalize(oe+Cd)*-bf;float ef=abs(dot(df,Cd));float ff=(Z==k)? ef :(Z==l)? 1.0/max(ef,xc): 1.0;vec2 gf=Ze ? zd*bf : df*ff;vec2 hf=normalize(Dd+pe)*-cf;float jf=abs(dot(hf,Dd));float kf=(Z==k)? jf :(Z==l)? 1.0/max(jf,xc): 1.0;vec2 lf=af ?-Ad*cf : hf*kf;vec4 ve=vec4(min(min(min(min(nd.x,pd.x),od.x),nd.x+gf.x*Pc),pd.x+lf.x*Pc)-Pc,min(min(min(min(nd.y,pd.y),od.y),nd.y+gf.y*Pc),pd.y+lf.y*Pc)-Pc,max(max(max(max(nd.x,pd.x),od.x),nd.x+gf.x*Pc),pd.x+lf.x*Pc)+Pc,max(max(max(max(nd.y,pd.y),od.y),nd.y+gf.y*Pc),pd.y+lf.y*Pc)+Pc);qe=Nc*vec2(ve [ 2 ]-ve [ 0 ],ve [ 3 ]-ve [ 1 ])/2.0+vec2(ve [ 2 ]+ve [ 0 ],ve [ 3 ]+ve [ 1 ])/2.0;vec2 mf=normalize(Cd+gf*bf);vec2 nf=-normalize(oe+gf*bf);bool of=fe || Ze || Xe || ff > wd*10.0 || ff > ke*10.0;vec2 pf=qe-nd;vec2 qf=normalize(gf);float Cb=-dot(pf,(wd < xc || Ze)? yd : zd);float Db=of ? Cb :-dot(pf,Mc(qf))*bf;float Eb=of ?-dot(pf,Cd)*bf : dot(pf,Mc(mf))/(2.0*Pc*length(gf+mf*dot(-gf,mf)));float Fb=of ? 0.5 :(dot(pf,qf)/Pc-Qc)/abs(dot(qf,Cd));float Gb=of ? 1.0 : dot(pf,Mc(nf))/(2.0*Pc*length(gf+nf*dot(-gf,nf)));vec2 rf=-normalize(Dd+lf*cf);vec2 sf=normalize(pe+lf*cf);bool tf=fe || af || Ye || kf > xd*10.0 || kf > le*10.0;vec2 uf=qe-pd;vec2 vf=normalize(lf);float Hb=dot(uf,(xd < xc || af)? yd : Ad);float Ib=tf ? Hb : dot(uf,Mc(vf))*cf;float Jb=tf ?-dot(uf,Dd)*cf : dot(uf,Mc(rf))/(2.0*Pc*length(lf+rf*dot(-lf,rf)));float Kb=tf ? 0.5 :(dot(uf,vf)/Pc-Qc)/abs(dot(vf,Dd));float Lb=tf ? 1.0 : dot(uf,Mc(sf))/(2.0*Pc*length(lf+sf*dot(-lf,sf)));float wf=(1.0-Sc)*Rc/(4.0*Pc);if(de)Gb=-dot(pf,zd)/(2.0*Pc)+wf;if(ee)Lb=dot(uf,Ad)/(2.0*Pc)+wf;float xf,yf;if(Yd && ! Jd){float zf=gd,te=gd+(hd-gd)*2.0;float Af=sqrt(1.0+4.0*Hd [ 0 ]*Hd [ 0 ]),Bf=sqrt(1.0+4.0*Hd [ 1 ]*Hd [ 1 ]);float Cf=sign(Hd [ 0 ])*0.5*(abs(Hd [ 0 ])*Af+0.5*log(2.0*abs(Hd [ 0 ])+Af));float Df=sign(Hd [ 1 ])*0.5*(abs(Hd [ 1 ])*Bf+0.5*log(2.0*abs(Hd [ 1 ])+Bf));xf=(te-zf)/abs(Df-Cf);yf=zf-Cf*xf;}else{float zf=gd;float te=hd;xf=te-zf;yf=zf;}float re=id;float se=Yd ? kd : jd;vec2 Ef=(vec2(1.0,1.0)-clamp(vec2(re,se),0.0,1.0))*Rc/(4.0*Pc);frag_specialParam1=vec4(vec2(Cb,Db)/Rc,Eb,Fb);frag_specialParam2=vec4(vec2(Hb,Ib)/Rc,Jb,Kb);frag_specialParam3=vec4(xf,yf,Ef.x,Ef.y);if(Tc==0 || Sc > 0.0)frag_specialParam4=vec3(de ? 0.0 : 1.0,ee ? 0.0 : 1.0,fe ? 0.0 : 1.0);else frag_specialParam4=vec3(1.0,1.0,fe ? 0.0 : 1.0);frag_specialParam5=vec2(Gb,Lb);frag_type=(Yd && ! Jd)? s : q;}}else if(Y==qc &&(! Jd || md)){float Ff=(Nc.y)/(Lc.x*Oc.x);if(! Yd || Jd){vec2 Gf=(Nc.x < 0.0)? nd : pd;qe=Gf+vec2(Ff,0.0);frag_type=t;}else{float Hf=clamp((nd.y-od.y)/(nd.y+pd.y-2.0*od.y),0.0,1.0);vec2 If=mix(mix(nd,od,Hf),mix(od,pd,Hf),Hf);vec2 Jf=md ? nd : If;vec2 Kf=md ? If : pd;vec2 Gf=(Nc.x < 0.0)? Jf : Kf;vec2 Lf=(If-Gd)*Fd;vec2 Mf=(Gf+vec2(Ff,0.0)-Gd)*Fd;vec2 Nf=((md ? nd : pd)-Gd)*Fd;float Of=Mf.x-Lf.x;float Pf=sign(Nf.x-Lf.x);float fc=Of*Pf;float gc=sign(dot(Cd,Ad));qe=Gf+vec2(Ff,0.0);frag_specialParam1.x=dot(qe-nd,Cd*sign(dot(Cd,yd)));frag_specialParam1.y=dot(qe-od,Dd*sign(dot(Dd,-zd)));frag_specialParam1.z=dot(qe-pd,Bd*sign(dot(Bd,-Ad)));frag_specialParam1.w=dot(qe-Jf,vec2(Jf.y-Kf.y,Kf.x-Jf.x));frag_specialParam2.x=fc;frag_specialParam2.y=gc;frag_type=u;}}else{gl_Position=vec4(0.0,0.0,0.0,0.0);frag_type=o;}gl_Position=vec4(qe.x*Oc.x*2.0*Lc.x,-qe.y*Oc.y*2.0*Lc.y,0.0,1.0);frag_geoRange=Hd;frag_geoUVS.xy=(qe-Gd)*Fd;frag_geoUVS.z=Id*0.5/Pc;if(fb==2)frag_specialParam3=vec4(Nc.x*0.5+0.5,Nc.y*0.5+0.5,sd.x+sd.y,0.0);}}",f:"precision highp float;const int c=0,d=1,e=2,f=3,h=4,i=5,j=6;const int k=0,l=1,m=2,n=3;uniform int ufrag_0;uniform int ufrag_1;uniform float ufrag_2;uniform float ufrag_3;uniform float ufrag_4;uniform float ufrag_5;uniform float ufrag_6;uniform int ufrag_7;uniform float ufrag_8;uniform float ufrag_10;uniform float ufrag_11;uniform float ufrag_12;uniform vec4 ufrag_13;uniform float ufrag_15;uniform vec2 ufrag_16;uniform int ufrag_17;uniform float ufrag_18;uniform float ufrag_19;varying float frag_type;const float o=0.0,p=1.0,q=3.0,s=4.0,t=5.0,u=6.0,v=7.0;varying vec3 frag_geoUVS;varying vec2 frag_geoRange;varying vec4 frag_specialParam1;varying vec4 frag_specialParam2;varying vec4 frag_specialParam3;varying vec3 frag_specialParam4;varying vec2 frag_specialParam5;float A(vec2 B,vec2 C){float a=0.5-B.y;float b=-0.5*B.x;float D=b*0.5;float E=(b*b)*0.25;float F=(a*a*a)/27.0;if(E+F > 0.0){float G=sqrt(E+F);float H=G-D;float I=sign(H)*pow(abs(H),1.0/3.0);float J=G+D;float K=-sign(J)*pow(abs(J),1.0/3.0);float x=I+K;return clamp(x,C [ 0 ],C [ 1 ]);}else{const float L=0.333333333;const vec3 M=vec3(0.0,2.094395102,4.188790205);float N=1.0/a;vec3 O=2.0*sqrt(-a*L)*cos(L*acos(sqrt(-6.75*N)*b*N)-M);vec3 x=clamp(O,C [ 0 ],C [ 1 ]);vec3 P=B.x-x,Q=B.y-x*x,R=P*P+Q*Q;return(R [ 0 ] < R [ 1 ] && R [ 0 ] < R [ 2 ])? x [ 0 ] :(R [ 1 ] < R [ 2 ])? x [ 1 ] : x [ 2 ];}}bool S(float T){return T-0.4 < frag_type && frag_type < T+0.4;}float U(float V,float a,float b,float W,float X){return clamp((abs(V*2.0-a-b)+a-b)*W*0.5+X,0.0,1.0);}void main(){int Y=ufrag_0;int Z=ufrag_1;float ab=ufrag_2;float bb=ufrag_3;float cb=ufrag_4;float db=ufrag_5;float eb=ufrag_6;int fb=ufrag_7;float gb=ufrag_8;float hb=ufrag_10;float ib=ufrag_11;float jb=ufrag_12;vec4 kb=ufrag_13;float lb=ufrag_15;vec2 mb=ufrag_16;bool nb=(ufrag_17==1);float ob=ufrag_18;float pb=ufrag_19;const float qb=1.0;float F=qb;float rb;float sb=0.0;float tb=0.0;if(Y==0 && ! S(v)){float V=0.0;float ub=0.0;vec2 vb;if(S(s)){float x=A(frag_geoUVS.xy,frag_geoRange);vb=frag_geoUVS.xy-vec2(x,x*x);vec2 wb=normalize(vec2(1.0,2.0*x));sb=dot(vb,vec2(-wb.y,wb.x))*frag_geoUVS.z;float xb=2.0*abs(x),yb=sqrt(1.0+xb*xb);float zb=sign(x)*(xb*yb+log(xb+yb))*0.25;float Ab=1.0-abs(sign((x-frag_geoRange [ 0 ])*(x-frag_geoRange [ 1 ])));V=zb+Ab*dot(vb,wb);ub=(x-frag_geoRange [ 0 ])/(frag_geoRange [ 1 ]-frag_geoRange [ 0 ]);}else{vb=frag_geoUVS.xy-vec2(clamp(frag_geoUVS.x,0.0,1.0),0.0);V=ub=frag_geoUVS.x;sb=frag_geoUVS.y;}F=length(vb)*abs(frag_geoUVS.z);ub=clamp(ub,0.0,1.0);const float Bb=0.01;float Cb=frag_specialParam1 [ 0 ],Db=frag_specialParam1 [ 1 ],Eb=frag_specialParam1 [ 2 ],Fb=frag_specialParam1 [ 3 ],Gb=frag_specialParam5 [ 0 ];float Hb=frag_specialParam2 [ 0 ],Ib=frag_specialParam2 [ 1 ],Jb=frag_specialParam2 [ 2 ],Kb=frag_specialParam2 [ 3 ],Lb=frag_specialParam5 [ 1 ];float Mb=frag_specialParam4.x,Nb=frag_specialParam4.y,Ob=frag_specialParam4.z;bool Pb=ub < 0.5 ?(Mb !=0.0 &&(Db > Bb || Fb > 1.0)):(Nb !=0.0 &&(Ib > Bb || Kb > 1.0));if(Z !=m){if(Pb)F=qb;else{const float Qb=0.001;if(Cb > Bb && Mb !=0.0)F=(Db <=Qb)? Eb :(Fb >=0.0)? Gb : qb;if(Hb > Bb && Nb !=0.0)F=(Ib <=Qb)? Jb :(Kb >=0.0)? Lb : qb;}}float Rb=F;if(Mb==0.0)Rb=max(Rb,Gb);if(Nb==0.0)Rb=max(Rb,Lb);tb=V*frag_specialParam3.x+frag_specialParam3.y;bool Sb=(mb==vec2(0.0,0.0))||(mb [ 0 ] <=tb && tb <=mb [ 1 ]);bb=Sb ? bb*Ob : 0.0;float Tb=(F <=lb && Sb)? bb : 0.0;float Ub=Pb ? 0.0 : Tb;const float Vb=0.2;const float Wb=(1.0-2.0*Vb)*2.0;float Xb=abs(fract(db+tb*cb)*2.0-1.0)*jb;float Yb=U(Xb,kb [ 0 ],kb [ 1 ],Wb,Vb)*U(Xb,kb [ 2 ],kb [ 3 ],Wb,Vb)*Tb;float Zb=clamp(0.5-F*sign(sb)*ib,0.0,1.0)*Ub;rb=sign(Rb)*max(0.0,abs(Rb)+mix(frag_specialParam3.z,frag_specialParam3.w,ub));float ac=(0.5-rb+pb)*bb;float bc=(0.5-F)*ab;vec4 cc=vec4(bc,ac,Zb,Yb);vec4 dc=vec4(ac,bc,0.0,0.0);vec4 ec=mix(cc,dc,ob);gl_FragColor=clamp(ec,0.0,1.0);}else if(S(t)){gl_FragColor=vec4(0.0,0.0,0.0,1.0);if(eb==sign(frag_geoUVS.y))discard;}else if(S(u)){gl_FragColor=vec4(0.0,0.0,0.0,0.0);if(frag_specialParam1.x > 0.0 && frag_specialParam1.y > 0.0 && frag_specialParam1.z > 0.0){float fc=frag_specialParam2.x,gc=frag_specialParam2.y;float hc=((fc >=0.0)? sign((frag_geoUVS.y-frag_geoUVS.x*frag_geoUVS.x)): 1.0)*gc;if(eb==hc)discard;}else if(eb==sign(frag_specialParam1.w))discard;}else if(S(v)){tb=frag_geoUVS.x*frag_specialParam3.x+frag_specialParam3.y;float ic=max(abs(frag_specialParam1.x),abs(frag_specialParam1.y))+frag_specialParam2.z;float jc=max(abs(frag_specialParam1.z),abs(frag_specialParam1.w))+frag_specialParam2.w;rb=min(ic,jc);if(frag_specialParam4.y >=0.0 && frag_specialParam4.z >=0.0)rb=min(rb,frag_specialParam4.x >=0.0 ? frag_specialParam2.x : frag_specialParam2.y);float kc=0.5-clamp(rb,0.0,0.5);gl_FragColor=vec4(kc*ab,kc*bb,0.0,1.0);}else gl_FragColor=vec4(frag_type*(1.0-gb),0.0,0.0,frag_type*gb);if(Y==0 && nb){float lc=smoothstep(lb,lb*1.5,rb);float mc=(tb+32.0*rb/lb)*jb;float nc=1.0-(mc+lc);gl_FragColor=vec4(nc,nc,nc,1.0);}if(fb==e){gl_FragColor.rgb=clamp(vec3(1.0-F*2.0,1.0-F*4.0,1.0-F*8.0),0.0,1.0);float oc=0.25+clamp((abs(frag_specialParam3.x+frag_specialParam3.y-1.0)+abs(frag_specialParam3.x-frag_specialParam3.y))*4.0-2.75,0.0,1.0);gl_FragColor+=vec4(oc*(1.0+sin(frag_specialParam3.z))/2.0,oc*(1.0+cos(frag_specialParam3.z))/2.0,oc*frag_specialParam3.z/18.0,1.0);}}",a:["a_v","a_p0","a_p1","a_p2","a_p3","a_p4","a_d1","a_d2"],u:["ufrag_0","ufrag_1","ufrag_2","ufrag_3","ufrag_4","ufrag_5","ufrag_6","ufrag_7","ufrag_8","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_15","ufrag_16","ufrag_17","ufrag_18","ufrag_19","u_0","u_1","u_2","u_3","u_4","u_5","u_6","u_7","u_8","u_12","u_13","u_14","u_15","u_17","u_18","u_19"],s:[]},{v:"precision highp float;uniform mat3 u_0;uniform mat3 u_1;uniform vec2 u_2;uniform mat3 u_3;uniform mat3 u_4;uniform mat3 u_5;uniform mat3 u_6;uniform vec2 u_7;uniform vec2 u_8;uniform vec2 u_9;uniform mat3 u_10;uniform vec2 u_12;uniform int u_13;uniform int u_14;uniform vec2 u_15;uniform int u_16;uniform float u_17;uniform float u_18;uniform float u_19;attribute vec2 a_v;attribute vec2 a_0;attribute vec2 a_1;varying vec2 k,l,m,n,o,p,q;varying float s;mat2 Mc(float Nc){return mat2(cos(Nc),-sin(Nc),sin(Nc),cos(Nc));}vec2 Oc(vec2 Pc){return vec2(Pc.x/2.0,Pc.y/-2.0)+vec2(0.5,0.5);}vec2 Qc(vec2 Pc,mat3 Rc){return(Rc*vec3(vec2(Pc.x/2.0,Pc.y/2.0),1.0)).xy*vec2(1.0,-1.0)+vec2(0.5,0.5);}mat4 Sc(float Tc,float Uc,float Vc,float Wc){float a=1.0/tan(Tc*0.5),b=1.0/(Vc-Wc);return mat4(a/Uc,0.0,0.0,0.0,0.0,-a,0.0,0.0,0.0,0.0,(Vc+Wc)*b,-1.0,0.0,0.0,2.0*Vc*Wc*b,0.0);}mat4 Xc(float Nc){float Yc=cos(Nc),Zc=sin(Nc);return mat4(1.0,0.0,0.0,0.0,0.0,Yc,-Zc,0.0,0.0,Zc,Yc,0.0,0.0,0.0,0.0,1.0);}mat4 ad(float Nc){float Yc=cos(Nc),Zc=sin(Nc);return mat4(Yc,0.0,Zc,0.0,0.0,1.0,0.0,0.0,-Zc,0.0,Yc,0.0,0.0,0.0,0.0,1.0);}void main(){vec2 bd=a_v;mat3 cd=u_0;vec2 dd=u_15;mat3 ed=u_1;vec2 fd=u_2;mat3 gd=u_3;mat3 hd=u_4;mat3 id=u_5;mat3 jd=u_6;vec2 kd=u_7;vec2 ld=u_8;vec2 md=u_9;mat3 nd=u_10;vec2 od=u_12;int pd=u_13;int qd=u_14;float rd=u_18;float sd=u_19;vec2 td=bd;vec2 ud=bd;if(u_16 !=0){td=bd+a_0*2.0;ud=bd+a_1*2.0;bd=mix(td,ud,u_17);}vec2 vd=(cd*vec3(bd.xy/2.0,1.0)).xy;vec2 wd;if(dd !=vec2(1.0,1.0)){const float xd=1.57079632679;mat4 yd=ad((1.0-dd.x)*xd),zd=Xc((1.0-dd.y)*xd);mat4 Ad=mat4(mat2(ed));Ad [ 3 ] [ 0 ]=ed [ 2 ] [ 0 ];Ad [ 3 ] [ 1 ]=ed [ 2 ] [ 1 ];vec4 Bd=Ad*zd*yd*vec4(vd,0.0,1.0)-vec4(fd*0.5,0.0,0.0);gl_Position=vec4((Bd.xy/fd)*vec2(2.0,-2.0),0.0,1.0);const float Cd=0.78539816339;float Dd=fd.y/(2.0*tan(Cd*0.5));Bd.z-=Dd;vec4 Ed=Sc(Cd,fd.x/fd.y,Dd/2.0,Dd*2.0)*Bd;gl_Position=Ed/Ed.w;}else{vec2 wd=(ed*vec3(vd,1.0)).xy;gl_Position=vec4((wd/fd-vec2(0.5,0.5))*vec2(2.0,-2.0),0.0,1.0);}gl_Position.z=mix(rd,sd,bd.y*0.5+0.5);k=Qc(td.xy,gd);l=Qc((pd !=0)? gl_Position.xy : ud.xy,hd);n=Qc((qd !=0)? gl_Position.xy : bd.xy,jd);m=Qc(bd.xy,id);p=Oc(bd.xy*kd);q=Oc(bd.xy*ld)+md;o=Qc(bd.xy,nd);s=(vd.y-od [ 0 ])/(od [ 1 ]-od [ 0 ]);}",f:"precision highp float;uniform sampler2D t_0;uniform sampler2D t_1;uniform sampler2D t_2;uniform sampler2D t_3;uniform sampler2D t_4;uniform sampler2D t_5;uniform sampler2D t_6;uniform float ufrag_0;uniform float ufrag_1;uniform float ufrag_2;uniform vec4 ufrag_3;uniform vec4 ufrag_4;uniform float ufrag_5;uniform float ufrag_6;uniform vec4 ufrag_7;uniform vec3 ufrag_8;uniform vec3 ufrag_9;uniform int ufrag_10;uniform int ufrag_11;uniform vec2 ufrag_12;uniform vec4 ufrag_13;uniform int ufrag_14;uniform int ufrag_15;uniform int ufrag_16;uniform vec2 ufrag_17;uniform int ufrag_18;uniform int ufrag_19;uniform float ufrag_20;uniform float ufrag_21;uniform vec4 ufrag_22;uniform vec4 ufrag_23;uniform int ufrag_24;uniform int ufrag_25;uniform vec4 ufrag_26;uniform float ufrag_27;uniform float ufrag_28;uniform float ufrag_29;uniform int ufrag_30;uniform int ufrag_31;uniform float ufrag_32;uniform int ufrag_34;uniform int ufrag_35;uniform float ufrag_36;uniform int ufrag_37;const int c=0,d=1,e=2,f=3,h=11,i=14,j=16;varying vec2 k,l,m,n,o,p,q;varying float s;float t(float u){return clamp(u,0.0,1.0);}const vec3 v=vec3(2.2,2.2,2.2);const vec3 A=vec3(1.0/2.2,1.0/2.2,1.0/2.2);const vec2 B=vec2(.5,.5);vec4 C(vec4 D,vec3 E){return vec4(pow(D.rgb,E),D.a);}vec4 F(vec4 G,vec4 H){float I=H.a+G.a*(1.0-H.a);return vec4((H.rgb*H.a+G.rgb*G.a*(1.0-H.a))/I,I);}float J(float K,vec3 L,vec3 M){float N=clamp(K,L [ 0 ],L [ 2 ]);vec3 O=abs((N-L)*M);return min(O [ 0 ],min(O [ 1 ],O [ 2 ]));}float P(vec2 Q){vec2 R=sign(B-abs(Q-B));return max(0.0,R.x+R.y)*.5;}float S(float T,float U,float V){const float W=-0.5;const float X=0.16;const float Y=0.5;float Z=mix(X,W,t(V*Y));float ab=min(V,U);float bb=1.0-t((T-Z)/ab);return bb*bb;}vec2 cb(vec4 db,float eb,float fb,float gb,vec4 hb,float ib,vec3 jb,vec3 kb,float V,float lb){float mb=max(fb,V)*0.5;float nb=db.r-0.5;float ob=S(-nb/eb,0.5/eb,V);float pb=clamp(0.5-mix(db.g,min(1.0-db.r,db.g),ufrag_29),0.0,0.5);float qb=0.5-db.b;float K=pb*sign(qb)/eb;bool rb=kb [ 0 ]==kb [ 2 ];if(! rb && abs(K)< fb*0.5-V*2.0)K=qb/eb;K+=lb;const float sb=0.2;const float tb=1.0/(1.0-sb*2.0);const float ub=0.5-0.5*tb;float vb=db.a;float wb=vb*tb+ub;float xb=(1.0-wb)*(mb+V);float yb=abs(K);if(vb <(1.0-sb))yb=mix(max(xb,yb),length(vec2(xb,yb)),ib);const float zb=0.49;float Ab=min(mb,zb/eb);float Bb=S(yb-Ab,0.5/eb-Ab,V);if(wb >=ib){float Cb=J(K,jb*mb,kb);float Db=min(min(kb [ 0 ],kb [ 1 ]),kb [ 2 ]);float Eb=V*Db;float Fb=S(Cb-Ab,0.5/eb-Ab,Eb);Bb=min(Bb,Fb);}if(ufrag_37==0)return vec2(clamp(ob,0.0,1.0),clamp(Bb,0.0,1.0));else return vec2(0.0,clamp(max(ob,Bb),0.0,1.0));}const int Gb=0,Hb=1,Ib=2,Jb=3,Kb=4,Lb=5,Mb=6,Nb=7,Ob=8,Pb=9;vec2 Qb(int Rb,vec4 Sb,vec2 Q,float eb){if(Rb==Kb)return vec2(1.0-min(min(Sb [ 0 ]*Q.x,Sb [ 3 ]*Q.y),min(Sb [ 2 ]*(1.0-Q.x),Sb [ 1 ]*(1.0-Q.y))),0.0);if(Rb==Ib){float Tb=Q.x,Ub=floor(Tb),N=Tb-Ub;Tb=(fract(Ub*0.5)==0.0)? N : 1.0-N;return vec2(Tb,0.0);}else return Q;}vec4 Vb(int Rb,vec4 Sb,vec4 Wb,vec2 Q,sampler2D Xb,int Yb,vec4 db,float eb){if(Rb==Gb)return vec4(0.0,0.0,0.0,0.0);if(Rb==Hb)return Sb;if(Yb !=0 && Rb !=0 && Rb > 1 &&(Q.x < 0.0 || Q.x > 1.0 || Q.y < 0.0 || Q.y > 1.0))return vec4(0.0,0.0,0.0,0.0);vec4 bb=texture2D(Xb,Qb(Rb,Sb,Q,eb));if(Rb==Nb)return mix(Sb,Wb,bb.r);else{if(Rb==Mb)bb.rgb/=bb.a;return bb;}}void main(){float eb=ufrag_0;float fb=ufrag_1;float Zb=ufrag_2;vec4 ac=ufrag_3;vec4 bc=ufrag_4;float gb=ufrag_5;float ib=ufrag_6;vec4 hb=ufrag_7;vec3 jb=ufrag_8;vec3 kb=ufrag_9;int cc=ufrag_10;int dc=ufrag_11;vec2 ec=ufrag_12;vec4 fc=ufrag_13;int gc=ufrag_15;int hc=ufrag_16;vec2 ic=ufrag_17;int jc=ufrag_18;int kc=ufrag_19;float lc=ufrag_20;float mc=ufrag_21;vec4 nc=ufrag_22;vec4 oc=ufrag_23;int pc=ufrag_24;int qc=ufrag_25;vec4 rc=ufrag_26;float lb=ufrag_27;float sc=ufrag_28;int tc=ufrag_30;int uc=ufrag_31;float vc=ufrag_32;bool wc=ufrag_34 !=0;float xc=ufrag_36;vec4 yc=wc ? vec4(0.0,0.0,0.0,0.0): texture2D(t_0,k);if(gc==e){yc*=P(k);if(xc > 0.0){vec4 zc=texture2D(t_1,l)*P(l);yc=mix(yc,zc,t(xc));}gl_FragColor=yc;gl_FragColor.rgb/=gl_FragColor.a;}else if(gc <=d){vec2 Ac=wc ? vec2(1.0,0.0): cb(yc,eb,fb,gb,hb,ib,jb,kb,Zb,lb);vec4 Bc=Vb(cc,ac,nc,l,t_1,jc,yc,eb);Bc.rgb=mix(Bc.rgb,vec3(0.5)*sign(sc)+0.5,abs(sc));Bc.a*=lc;if(tc !=0){vec4 Cc=Vb(Mb,vec4(0.0,0.0,0.0,0.0),vec4(0.0,0.0,0.0,0.0),m,t_6,uc,yc,eb);Cc.a*=vc;if(Cc.a > 0.0)Bc=F(Bc,Cc);}if(qc !=0){float Dc=texture2D(t_5,q).a;Bc.rgb=mix(Bc.rgb,rc.rgb,(1.0-Dc)*rc.a);}vec4 Ec=vec4(Bc.rgb,Bc.a*Ac [ 0 ]);vec4 Fc=Vb(dc,bc,oc,n,t_2,kc,yc,eb);vec4 Gc=vec4(Fc.rgb,Fc.a*Ac [ 1 ]*mc);gl_FragColor=F(Ec,Gc);if(gc==d){if(gl_FragColor.a > 0.0)gl_FragColor=fc;else gl_FragColor=vec4(0.0,0.0,0.0,0.0);}}else if(gc==f){float Hc=(yc.r-0.5);float Ic=t(1.0-2.0*abs(sin(Hc*64.0)))*0.5;if(Hc < 0.0)gl_FragColor=vec4(0.0,Ic*(1.0+Hc),1.0+Hc,1.0+Hc);else gl_FragColor=vec4(1.0-Hc,Ic*(1.0-Hc),0.0,1.0);}else{if(gc==h)gl_FragColor=vec4(yc.r,yc.g*2.0,0.0,1.0);else if(gc==i)gl_FragColor=vec4(yc.r,0.0,0.0,1.0);else if(gc==j)gl_FragColor=vec4(yc.b,yc.b > 0.95 ?(yc.b-0.95)*20.0 : 0.0,yc.a,1.0);else gl_FragColor=vec4(yc.r,yc.g,yc.b,1.0);}float Jc=ec [ 0 ]+(ec [ 1 ]-ec [ 0 ])*t(s);if(pc !=0)Jc-=1.0-texture2D(t_4,p).a;if(hc !=0 &&(gc==0 || gc==2)){if(hc==1){Jc-=1.0-ic [ 1 ];}else if(hc==2){float Kc=1.0-texture2D(t_3,o).r;Jc-=1.0-t(Kc*ic [ 0 ]+ic [ 1 ]);}}gl_FragColor.a=t(gl_FragColor.a)*t(Jc);if(gc !=1 && fc.a > 0.0)gl_FragColor.rgb=fc.rgb;gl_FragColor.rgb*=gl_FragColor.a;gl_FragColor.rgb=clamp(gl_FragColor.rgb,0.0,1.0);if(ufrag_35==1){float Lc=1.0-gl_FragColor.a;gl_FragColor=vec4(Lc+gl_FragColor.rgb,gl_FragColor.a);}}",a:["a_v","a_0","a_1"],u:["ufrag_0","ufrag_1","ufrag_2","ufrag_3","ufrag_4","ufrag_5","ufrag_6","ufrag_7","ufrag_8","ufrag_9","ufrag_10","ufrag_11","ufrag_12","ufrag_13","ufrag_14","ufrag_15","ufrag_16","ufrag_17","ufrag_18","ufrag_19","ufrag_20","ufrag_21","ufrag_22","ufrag_23","ufrag_24","ufrag_25","ufrag_26","ufrag_27","ufrag_28","ufrag_29","ufrag_30","ufrag_31","ufrag_32","ufrag_34","ufrag_35","ufrag_36","ufrag_37","u_0","u_1","u_2","u_3","u_4","u_5","u_6","u_7","u_8","u_9","u_10","u_12","u_13","u_14","u_15","u_16","u_17","u_18","u_19"],s:["t_0","t_1","t_2","t_3","t_4","t_5","t_6"]},{v:"precision highp float;uniform int u_0;uniform vec2 u_1;uniform vec2 u_2;uniform mat3 u_3;attribute vec2 a_v;attribute vec4 a_p1;attribute vec4 a_p2;varying vec2 c;void main(){if(u_0==0){gl_Position=vec4(a_v,0.0,1.0);}else{vec2 p;if(a_v.x > 0.0){vec2 F=(a_v.y < 0.0)? a_p1.xy : a_p2.xy;gl_Position=vec4((((u_3*vec3(F,1.0)).xy-u_1)*u_2)*vec2(2.0,-2.0),0.0,1.0);}else gl_Position=vec4(0.0,0.0,0.0,1.0);}c=a_v*vec2(0.5,-0.5)+vec2(0.5,0.5);}",f:"precision highp float;uniform float bfrag_0 [ 11 ];uniform vec4 bfrag_1 [ 11 ];uniform int ufrag_0;uniform vec2 ufrag_2;uniform int ufrag_3;varying vec2 c;const float d=2.2;const float e=1.0/2.2;vec4 f(vec4 h,float i){if(ufrag_3==1)return vec4(pow(h.r,i),pow(h.g,i),pow(h.b,i),h.a);else return h;}vec4 j(float k){for(int l=0;l < 10;l++){if(k <=bfrag_0 [ l+1 ]){vec4 m=f(bfrag_1 [ l ],d);vec4 n=f(bfrag_1 [ l+1 ],d);return f(mix(m,n,(k-bfrag_0 [ l ])/(bfrag_0 [ l+1 ]-bfrag_0 [ l ])),e);}}return bfrag_1 [ 10 ];}float o(vec2 p,vec2 q){vec2 s=p-q;float t=dot(s,s);float u=q.x*p.y-p.x*q.y;vec2 v=s*u;float A=sqrt(t-u*u);vec2 B=s*A;vec2 C=vec2((v.y+sign(B.y)*B.x),(-v.x+abs(B.y)))/t;vec2 D=vec2((v.y-sign(B.y)*B.x),(-v.x-abs(B.y)))/t;vec2 E=sign(length(C-q)-length(D-q))==sign(dot(q-p,q))? C : D;float k=length(p-q)/length(E-q);return clamp(k,0.0,1.0);}void main(){float k=c.x;if(ufrag_0==1){vec2 q=ufrag_2;k=o(c*2.0-1.0,q*2.0-1.0);}gl_FragColor=j(k);}",a:["a_v","a_p1","a_p2"],u:["bfrag_0","bfrag_1","ufrag_0","ufrag_2","ufrag_3","u_0","u_1","u_2","u_3"],s:[]},{v:"precision highp float;uniform float u_0;uniform vec2 u_1;uniform vec2 u_2;uniform vec2 u_3;uniform int u_4;attribute vec2 a_v;varying vec2 c,d,e,f,h,i,j,k,l;void main(){vec2 G=a_v;float H=u_0;vec2 I=u_1;vec2 J=u_2;vec2 K=u_3;int p=u_4;gl_Position=vec4(G.x,-G.y,0.0,1.0);vec2 L=(vec2(G.x,-G.y)*I/2.0)+vec2(0.5,0.5);if(p==1){vec2 M=J*vec2(2.0*H/(K.x*8.0),2.0*H/(K.y*8.0));vec2 N=L-J*vec2(H/K.x,H/K.y);c=N;d=N+M;e=N+M*2.0;f=N+M*3.0;h=N+M*4.0;i=N+M*5.0;j=N+M*6.0;k=N+M*7.0;l=N+M*8.0;}else{vec2 r=vec2(H/K.x,H/K.y);c=L+r*vec2(-0.7,-0.7);d=L+r*vec2(0.0,-1.0);e=L+r*vec2(0.7,-0.7);f=L+r*vec2(-1.0,0.0);h=L;i=L+r*vec2(1.0,0.0);j=L+r*vec2(-0.7,0.7);k=L+r*vec2(0.0,1.0);l=L+r*vec2(0.7,0.7);}}",f:"precision highp float;uniform sampler2D tex_0;uniform vec4 ufrag_0;uniform float ufrag_2;uniform int ufrag_3;uniform int ufrag_4;varying vec2 c,d,e,f,h,i,j,k,l;void main(){vec4 m=ufrag_0;int n=ufrag_3;float o=ufrag_2;int p=ufrag_4;vec4 q=p==1 ? vec4(1.20,1.15,1.10,1.05)*o : vec4(1.20,1.20,1.20,1.20)*o;vec4 s=texture2D(tex_0,c,q [ 0 ]);vec4 t=texture2D(tex_0,d,q [ 1 ]);vec4 u=texture2D(tex_0,e,q [ 2 ]);vec4 v=texture2D(tex_0,f,q [ 3 ]);vec4 A=texture2D(tex_0,h,o);vec4 B=texture2D(tex_0,i,q [ 3 ]);vec4 C=texture2D(tex_0,j,q [ 2 ]);vec4 D=texture2D(tex_0,k,q [ 1 ]);vec4 E=texture2D(tex_0,l,q [ 0 ]);if(n==0){vec4 F=s*0.000229+t*0.005977+u*0.060598+v*0.241732+A*0.382928+B*0.241732+C*0.060598+D*0.005977+E*0.000229;gl_FragColor=clamp(F,0.0,1.0);}else if(n==1){float F=s.a*0.000229+t.a*0.005977+u.a*0.060598+v.a*0.241732+A.a*0.382928+B.a*0.241732+C.a*0.060598+D.a*0.005977+E.a*0.000229;gl_FragColor=vec4(m.rgb,1.0)*m.a*F;}else if(n==2){float F=min(min(min(min(s.a,t.a),min(u.a,v.a)),min(min(A.a,B.a),min(C.a,D.a))),E.a);gl_FragColor=vec4(m.rgb,1.0)*m.a*F;}else if(n==3){float F=max(max(max(max(s.a,t.a),max(u.a,v.a)),max(max(A.a,B.a),max(C.a,D.a))),E.a);gl_FragColor=vec4(m.rgb,1.0)*m.a*F;}}",a:["a_v"],u:["ufrag_0","ufrag_2","ufrag_3","ufrag_4","u_0","u_1","u_2","u_3","u_4"],s:["tex_0"]},{v:"precision highp float;attribute vec2 a_v;varying vec2 c;void main(){vec2 v=a_v;gl_Position=vec4(v.x,-v.y,0.0,1.0);c=(vec2(v.x,v.y)/2.0)+vec2(0.5,0.5);}",f:"precision highp float;varying vec2 c;const int d=1,e=2,f=3,h=4,i=5,j=6,k=7,l=8,m=9,n=10,o=11,p=12;uniform int ufrag_0;uniform float ufrag_1;void main(){const float PI=3.141592653;const float q=0.707106781;int s=ufrag_0;float t=ufrag_1;float u=0.0,x=c.x,y=c.y;if(s==d)u=1.0-x*t;else if(s==e)u=max(abs(x*2.0-1.0),abs(y*2.0-1.0));else if(s==f)u=1.0-(x*t+floor(y*t)/2.0);else if(s==h)u=length(c*2.0-vec2(1.0,1.0))*q;else if(s==i)u=(abs(x*2.0-1.0)+abs(y*2.0-1.0))*0.5;else if(s==j)u=fract(sin(dot(c,vec2(12.9898,78.233)))*43758.5453);else if(s==k)u=min(abs(x*2.0-1.0),abs(y*2.0-1.0));else if(s==l)u=fract(sin(x*12.9898)*43758.5453);else if(s==m)u=abs(x*2.0-1.0);else if(s==n)u=1.0-(floor(x*t)+floor(y*t))/(2.0*t);else if(s==o)u=1.0-atan(abs(x-0.5),0.5-y)/PI;else if(s==p)u=1.0-atan(x-0.5,0.5-y)*t/(2.0*PI);gl_FragColor=vec4(mod(u,1.0),0.0,0.0,1.0);}",a:["a_v"],u:["ufrag_0","ufrag_1"],s:[]},{v:"precision highp float;attribute vec2 a_v;attribute vec4 a_0;attribute vec4 a_1;varying vec2 c;const int f=0,h=1,i=2,j=3;void main(){vec2 k=a_v;vec4 l=a_0,m=a_1;vec2 n=k*0.5+0.5;c=vec2(l [ f ]+(l [ i ]-l [ f ])*n.x,1.0-(l [ h ]+(l [ j ]-l [ h ])*n.y));gl_Position=vec4((m [ f ]+(m [ i ]-m [ f ])*n.x)*2.0-1.0,1.0-((m [ h ]+(m [ j ]-m [ h ])*n.y)*2.0),0.0,1.0);}",f:"precision highp float;uniform sampler2D t_0;uniform float ufrag_0;varying vec2 c;void main(){float d=ufrag_0;vec4 e=texture2D(t_0,c);e.rgb=(e.rgb-0.5)*d+0.5;gl_FragColor=e;}",a:["a_v","a_0","a_1"],u:["ufrag_0"],s:["t_0"]}],Fe=[{attributeName:name,attributeSize:1,offset:0,divisor:0,index:-1}],Be={x:0,y:0,width:1,height:1},Oe=[{attributeName:"",index:0,attributeSize:2,offset:0,divisor:0}],Ie=function(){function e(e,t,r,n){this.m_shaderPrograms=new Array(6),this.m_isInitializeReady=!0,this.m_isInScope=!1,this.m_stateRestorer=n,this.m_wipeStateBetweenScopes=t,this.m_disableParallelShaderCompile=r,this.setWebGLContext(e)}return e.prototype.getBabylonEngine=function(){return this.m_engine},Object.defineProperty(e.prototype,"quadMesh",{get:function(){return this.m_quadMesh},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"emptyTexture",{get:function(){return this.m_emptyTexture},enumerable:!0,configurable:!0}),e.prototype.needPowerOf2TexturesForTilingOrMipMap=function(){return this.m_needPowerOf2TexturesForTilingOrMipMap},e.prototype.isCurrentWebGLContext=function(e){return this.m_gl==e},e.prototype.setWebGLContext=function(e){if(this.m_gl!=e){this.m_engine&&(this.m_emptyTexture&&this.m_engine._releaseTexture(this.m_emptyTexture),this.m_quadMesh&&this.m_quadMesh.discard()),this.m_gl=e;var t=e.canvas.width,r=e.canvas.height;this.m_canvasRenderSize=new a.d(t,r),this.m_engine=new Re(e),this.m_engine.preventCacheWipeBetweenFrames=!0,this.m_engine.doNotHandleContextLost=!0,this.m_engine.setSize(t,r),this.m_engine.setViewport(Be);var n=this.m_engine.getCaps();this.m_parallelShaderCompilationExtension=n.parallelShaderCompile,n.parallelShaderCompile=void 0,this.m_renderToFilteredFloat=n.textureFloatRender&&n.textureFloatLinearFiltering,this.m_renderToFilteredHalfFloat=n.textureHalfFloatRender&&n.textureHalfFloatLinearFiltering,this.m_needPowerOf2TexturesForTilingOrMipMap=this.m_engine.needPOTTextures,this.m_uniqueGraphicsProcessorId=Ce,Ce++;for(var i=0;i<6;i++)this.m_shaderPrograms[i]=void 0}},e.prototype.updateViewportSize=function(){var e=this.m_gl.canvas.width,t=this.m_gl.canvas.height;this.m_canvasRenderSize=new a.d(e,t),this.m_engine.setSize(e,t),this.m_engine.setViewport(Be)},e.prototype.onWebGLContextLost=function(){for(var e=0;e<6;e++)this.m_shaderPrograms[e]=void 0},e.prototype.initializeProgramsAsync=function(){return Object(n.b)(this,void 0,void 0,(function(){var e,t,r,i;return Object(n.d)(this,(function(n){switch(n.label){case 0:if(this.m_isInitializeReady=!1,e=this.m_engine.getCaps(),this.m_disableParallelShaderCompile||(e.parallelShaderCompile=this.m_parallelShaderCompilationExtension),t=[],!this.beginRenderScopeInternal(!1))throw l.a.Error(592328457,"Failed to enter render scope.");for(r=0;r<6;r++)i=this.getProgramInWebGlScope(r),t.push(i.enureDoneAsync());return this.endRenderScopeInternal(!1),[4,Promise.all(t)];case 1:return n.sent(),this.m_isInitializeReady=!0,[2]}}))}))},e.prototype.isInRenderScope=function(){return this.m_isInScope},e.prototype.beginRenderScope=function(){if(!this.m_isInitializeReady)throw l.a.Error(592525269,"Please, wait for onDone to be called in initialize.");return this.beginRenderScopeInternal(!0)},e.prototype.endRenderScope=function(){this.endRenderScopeInternal(!0)},e.prototype.beginRenderScopeInternal=function(e){var t=this.m_gl.isContextLost();return this.m_isInScope&&l.a.Error(592525270,"already in glContext scope"),t&&l.a.Error(592525271,"Invalnew glContext context is lostid"),!this.m_gl||t?this.m_isInScope=!1:(this.m_isInScope=!0,e&&(this.m_stateRestorer?(this.m_stateRestorer.init(this.m_gl),this.m_stateRestorer.setDefaults(),this.m_engine.wipeCaches(!0)):this.m_wipeStateBetweenScopes&&this.m_engine.wipeCaches(!0)),this.ensureVertexBufferAndMaxTapeInitialized()),this.m_isInScope},e.prototype.endRenderScopeInternal=function(e){this.m_isInScope?this.m_gl.isContextLost()?l.a.Error(592525273,"leaving glContext context is lost"):this.m_stateRestorer&&e&&this.m_stateRestorer.restore():l.a.Error(592525272,"leaving glContext not in scope"),this.m_isInScope=!1},e.prototype.ensureVertexBufferAndMaxTapeInitialized=function(){this.m_emptyTexture||(this.m_emptyTexture=this.createTextureGraphicsResource(a.d.One,new Uint8Array([0,0,0,0]),!0,!1,!1,!1,4,!1)),this.m_quadMesh||(this.m_quadMesh=O.a.CreateGridXY(this,new a.d(2,2),new a.b(-1,-1,1,1)))},e.prototype.getProgramInWebGlScope=function(e){var t=this.m_shaderPrograms[e];return t||(t=this.m_shaderPrograms[e]=new Le(this,e)),t},e.prototype.createTextureGraphicsResourceFromExternalWebGLTexture=function(e,t,r){var n=t instanceof WebGLTexture?t:null;if(t instanceof ne&&(n=t._webGLTexture),!n)throw l.a.Error(592525275,"wrong texture type");var i=new ne(this.m_engine,0);return i._webGLTexture=n,r&&(i._framebuffer=r),i.width=e.x,i.height=e.y,i.baseWidth=e.x,i.baseHeight=e.y,i},e.prototype.createTextureGraphicsResource=function(e,t,r,n,i,a,o,s){if(t instanceof HTMLImageElement){var c,u=this.m_gl;if(c=u.createTexture())return u.bindTexture(u.TEXTURE_2D,c),u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,!0),u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,u.RGBA,u.UNSIGNED_BYTE,t),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.CLAMP_TO_EDGE),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.CLAMP_TO_EDGE),u.bindTexture(u.TEXTURE_2D,null),this.createTextureGraphicsResourceFromExternalWebGLTexture(e,c,void 0)}var h,f=this.m_engine,d=0;n&&this.m_renderToFilteredHalfFloat?d=2:n&&this.m_renderToFilteredFloat&&(d=1);var p=r?5:4,g=s?2:1;if(i)h=f.createRenderTargetTexture({width:e.x,height:e.y},{generateDepthBuffer:!1,generateStencilBuffer:a,format:p,type:d,samplingMode:g,generateMipMaps:!1});else{if(n)throw l.a.Error(592525276,"wrong texture format outside of renderTarget");var _=new ne(f,Z.Unknown);_.updateSize(e.x,e.y),_.type=d,_.format=p,f.updateTextureSamplingMode(g,_),t instanceof Uint8Array&&f._uploadArrayBufferViewToTexture(_,t),h=_}return this.setWrapMode(h,o),h},e.prototype.setRenderTarget=function(e){e?(this.m_engine.bindFramebuffer(e),this.m_currentRenderTarget=e):(this.m_engine.restoreDefaultFramebuffer(),this.m_currentRenderTarget=void 0)},e.prototype.generateMipMap=function(e){this.m_engine.updateTextureSamplingMode(3,e,!0)},e.prototype.setWrapMode=function(e,t){var r=4==t?0:1==t||3==t?2:1,n=4==t?0:2==t||3==t?2:1;this.m_engine.updateTextureWrappingMode(e,r,n)},e.prototype.copyTexturePixelsToArray=function(e,t,r){var n=Math.floor(t.left),i=Math.floor(t.top),a=Math.floor(t.width),o=Math.floor(t.height);this.setRenderTarget(e);var s=this.m_engine.readPixels(n,i,a,o,r);return this.setRenderTarget(void 0),s},e.prototype.getCurrentViewportSize=function(){return this.m_currentRenderTarget?new a.d(this.m_currentRenderTarget.width,this.m_currentRenderTarget.height):this.m_canvasRenderSize},e.prototype.getUniqueGraphicsProcessorId=function(){return this.m_uniqueGraphicsProcessorId},e.prototype.isFloatTextureSupported=function(){return this.m_renderToFilteredFloat||this.m_renderToFilteredHalfFloat},e.prototype.activateShaderProgram=function(e){var t=this.getProgramInWebGlScope(e);return t.activate(),t},e.prototype.preCompileShaderAsync=function(e){this.beginRenderScopeInternal(!1)&&(this.getProgramInWebGlScope(e),this.endRenderScopeInternal(!1))},e.prototype.preLinkShaderAsync=function(e){this.preCompileShaderAsync(e)},e.prototype.tryPrepareProgramResourcesInWebGlScope=function(e){for(var t=0;t<2;t++)this.m_shaderPrograms[t]||this.getProgramInWebGlScope(t);return!0},e}(),Le=function(){function e(e,t){this.graphicsProcessor=e,this.m_engine=e.getBabylonEngine(),this.programId=t,this.m_effect=this.createEffect()}return e.prototype.getBabylonEngine=function(){return this.m_engine},e.prototype.getBabylonEffect=function(){return this.m_effect},e.prototype.done=function(){return void 0!==this.effectErrors||this.m_effect.isReady()},e.prototype.enureDoneAsync=function(){var e=this;return new Promise((function(t,r){e.done()?t():(e.m_effect.onCompileObservable.add((function(){return t()})),e.m_effect.onErrorObservable.add(r))}))},e.prototype.createEffect=function(){var e=this;return l.a.Message(592525280,"Compiling shader "+this.programId),new be({vertexSource:Ae[this.programId].v,fragmentSource:Ae[this.programId].f,spectorName:this.programId},Ae[this.programId].a,Ae[this.programId].u,Ae[this.programId].s,this.m_engine,void 0,void 0,void 0,(function(t,r){e.effectErrors=r}))},e.prototype.activate=function(){this.handleActivationErrors(),this.m_engine.enableEffect(this.m_effect),this.m_currentMesh=void 0,this.bindMesh(void 0)},e.prototype.bindMesh=function(e){var t=e||this.graphicsProcessor.quadMesh;t&&t.isValid(this.graphicsProcessor)?this.m_currentMesh!=t&&(t.vertexBuffer&&t.indexBuffer&&t.isValid(this.graphicsProcessor)&&(this.m_engine._bindIndexBufferWithCache(t.indexBuffer),Oe[0].index=this.m_effect.getAttributeLocationByName("a_v"),this.m_engine.bindInstancesBuffer(t.vertexBuffer,Oe,!1)),this.m_currentMesh=t):l.a.Error(592525281,"Invalid Mesh")},e.prototype.handleActivationErrors=function(){if(this.effectErrors||!this.m_effect.isReady()){var e="Program "+this.programId+" ";if(this.effectErrors){var t=this.m_effect.getPipelineContext();if(t.vertexCompilationError)throw l.a.Error(592525282,e+"V compile failed: "+t.vertexCompilationError);if(t.fragmentCompilationError)throw l.a.Error(592525283,e+"V compile failed: "+t.fragmentCompilationError);if(t.programLinkError)throw l.a.Error(592525312,e+"link failed: "+t.programLinkError);if(t.programValidationError)throw l.a.Error(592525313,e+"validation failed: "+t.programValidationError);throw l.a.Error(592525314,e+"preparation failed:"+this.effectErrors)}if(!this.m_effect.isReady())throw l.a.Error(592525315,e+"Effect not ready yet.")}},e.prototype.setTexture=function(e,t){var r=t||this.graphicsProcessor.emptyTexture;this.m_effect._bindTexture(e,r||null)},e.prototype.clearAndEnbaleDepthBuffer=function(){this.m_engine.depthCullingState.depthFunc=513,this.m_engine.depthCullingState.depthMask=!0,this.m_engine.depthCullingState.depthTest=!0,this.m_engine.clear(null,!1,!0,!1)},e.prototype.setDistanceFieldStencilSumIncrement=function(e){var t=e?34055:34056,r=this.m_engine;r.stencilState.stencilOpStencilFail=t,r.stencilState.stencilOpDepthFail=t,r.stencilState.stencilOpStencilDepthPass=t},e.prototype.setBlendingMode=function(e){var t=this.m_engine;t.alphaState.alphaBlend=!0,0==e?(t.alphaState.setAlphaBlendFunctionParameters(1,771,1,771),t.alphaState.setAlphaEquationParameters(32774,32774)):1==e?(t.alphaState.setAlphaBlendFunctionParameters(1,1,0,1),t.alphaState.setAlphaEquationParameters(32775,32774)):2==e?(t.alphaState.setAlphaBlendFunctionParameters(775,769,0,1),t.alphaState.setAlphaEquationParameters(32774,32774)):3==e?(t.alphaState.setAlphaBlendFunctionParameters(1,1,1,1),t.alphaState.setAlphaEquationParameters(32779,32779)):l.a.Error(592525318,"Wrong blending mode")},e.prototype.begin=function(e,t,r){var n=this.m_engine;this.graphicsProcessor.setRenderTarget(e),this.m_engine.setViewport(Be),t&&n.clear(t,!0,!1,!1),r?this.setBlendingMode(0):n.alphaState.alphaBlend=!1,n.depthCullingState.depthTest=!1,n.depthCullingState.depthMask=!0,n.stencilState.stencilTest=!1,n.stencilState.stencilMask=255,n.setColorWrite(!0)},e.prototype.end=function(){this.graphicsProcessor.setRenderTarget(void 0),this.m_engine.unbindInstanceAttributes(),this.m_engine.setViewport(Be)},e.prototype.drawQuads=function(e){this.bindMesh(void 0),this.m_engine.drawElementsType(0,0,6*e)},e.prototype.drawQuadInstances=function(e){this.bindMesh(void 0),this.m_engine.drawElementsType(0,0,6,e)},e.prototype.drawMesh=function(e){this.bindMesh(e),this.m_engine.drawElementsType(0,0,3*e.triangleCount)},e.prototype.setDummyPointerAttribute=function(e){if(this.graphicsProcessor.quadMesh&&this.graphicsProcessor.quadMesh.vertexBuffer){var t=this.graphicsProcessor.quadMesh.vertexBuffer,r=this.m_engine;Fe[0].index=this.m_effect.getAttributeLocationByName(e),r.bindInstancesBuffer(t,Fe,!1)}else l.a.Error(592525319,"Quad not initialized")},e.prototype.disableInstanceAttribute=function(e){this.m_engine.disableInstanceAttributeByName(e)},e}(),Me={itemHit:void 0,itemStack:void 0,textHit:void 0},De=function(){function e(){this.cache=new X}return e.prototype.releaseGeneratedResources=function(){this.cache.clear()},e}(),ke=function(){function e(){this.index=0}return Object.defineProperty(e.prototype,"color",{get:function(){var e=this.index%256,t=(this.index-e)/256%256,r=(this.index-e-256*t)/65536%256;return new c.b(e/255,t/255,r/255,1)},enumerable:!0,configurable:!0}),e.prototype.next=function(){this.index++},e}(),Ne=function(e,t,r,n){var i=e&&e.fade?e.fade:t.fade;if(i){if(this.fade=i.clone(),i.isDistributedByLength&&e&&e.drawDistribution&&n+1<e.drawDistribution.length){var o=e.drawDistribution[n],s=e.drawDistribution[n+1];this.fade.progress=(i.progress-o)/(s-o)}else i.isDistributedByLength&&e&&l.a.Error(592525086,"Unable to distribute by length"),this.fade.progress=i.progress;if(2==t.getType()&&i.isDistributedByLength){if(!r.cache.drawDistribution){var c=0,u=function(e){for(var t=0,r=e.paths||[];t<r.length;t++){var n=r[t];c+=n.measureLength(a.a.FromTransforms(n.transform,e.transform))}return!0};Object(f.f)(t,u);var h=c,d=0,p=t;r.cache.drawDistribution=[];for(var g=0;g<p.items.length;g++)r.cache.drawDistribution.push(d/h),c=0,Object(f.f)(p.items.getAt(g),u),d+=c;r.cache.drawDistribution.push(1)}this.drawDistribution=r.cache.drawDistribution}}},Ge=1,je=function(){function e(e){this.m_babylonWipeStateBetweenScopes=!0,this.m_babylonDisableParallelShaderCompile=!1,this.m_currentFramePerformanceSummary=new F.a,this.m_babylonWipeStateBetweenScopes=1==e.babylonWipeStateBetweenScopes,this.m_babylonDisableParallelShaderCompile=1==e.babylonDisableParallelShaderCompile,this.m_stateRestorer=e.stateRestorer,this.m_morphPlayer=e.morphPlayer,this.m_debugStringProvider=e.debugStringProvider,this.m_perfSummary=new F.b,this.m_rendererId=""+Ge++}return e.prototype.initializeAsync=function(e){return Object(n.b)(this,void 0,void 0,(function(){return Object(n.d)(this,(function(t){switch(t.label){case 0:if(this.setWebGLContext(e),!this.m_graphicsProcessor)throw l.a.Error(592328459,"Failed to initialize graphics processor.");return[4,this.m_graphicsProcessor.initializeProgramsAsync()];case 1:return t.sent(),[2]}}))}))},e.prototype.setWebGLContext=function(e){this.m_graphicsProcessor&&!this.m_graphicsProcessor.isCurrentWebGLContext(e)&&this.onWebGLContextLost(),this.m_graphicsProcessor?this.m_graphicsProcessor.setWebGLContext(e):this.m_graphicsProcessor=new Ie(e,this.m_babylonWipeStateBetweenScopes,this.m_babylonDisableParallelShaderCompile,this.m_stateRestorer)},e.prototype.onWebGLContextLost=function(){if(this.m_scratchBuffers){for(var e=0,t=this.m_scratchBuffers;e<t.length;e++)t[e].release();this.m_scratchBuffers=void 0}Object(L.b)(),this.m_graphicsProcessor&&(this.m_graphicsProcessor.onWebGLContextLost(),this.m_graphicsProcessor=void 0)},e.prototype.getGraphicsProcessor=function(){return this.m_graphicsProcessor},e.prototype.getPerformanceSummary=function(){return this.m_perfSummary},e.prototype.resetPerformanceSummary=function(){this.m_perfSummary=new F.b},e.prototype.getCurrentFramePerformanceSummary=function(){return this.m_currentFramePerformanceSummary},e.prototype.getDebugStringProvider=function(){return this.m_debugStringProvider},e.prototype.ensureScratchBuffers=function(){if(!this.m_scratchBuffers){this.m_scratchBuffers=[];for(var e=0;e<B.l;e++)this.m_scratchBuffers.push(new B.a(this,new a.d(B.m,B.m),!0))}return this.m_scratchBuffers},e.prototype.ensureRenderNode=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new De,e.renderDataMap[this.m_rendererId]=t),t},e.prototype.ensurePathRenderData=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new D,e.renderDataMap[this.m_rendererId]=t),t},e.prototype.ensureImageRenderData=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new N,e.renderDataMap[this.m_rendererId]=t),t},e.prototype.ensureMorphKeyFrameRenderData=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new q.a,e.renderDataMap[this.m_rendererId]=t),t},e.prototype.ensureMorphElementRenderData=function(e){var t=e.renderDataMap[this.m_rendererId];return t||(t=new q.a,e.renderDataMap[this.m_rendererId]=t),t},e.prototype.attachTextureToImage=function(e,t){var r=this.ensureImageRenderData(e);e.changeTracker.replaceListener(r.texture,t),r.texture=t},e.prototype.getTextureFromImage=function(e){if(e)return this.ensureImageRenderData(e).texture},e.prototype.deleteAllTextures=function(e){e.clearCache();var t=[];e.getBrushImages(t);for(var r=0,n=t;r<n.length;r++){var i=n[r];this.ensureImageRenderData(i).releaseGeneratedResources()}},e.prototype.tryGetImageDebugData=function(e){var t=this.ensureImageRenderData(e);return new k(t.state,t.texture)},e.prototype.getDebugGlyphCacheInfo=function(e){return Object(L.e)(e)},e.prototype.generateTextureMemoryReport=function(e,t){for(var r={externalImages:0,managedImages:0,scratchBuffers:this.hasHitTestTexture()?4:0,glyphPages:0,shapeDistanceFields:0,textDistanceFields:0,otherBrushes:0,effects:0,rasterizedItems:0,fadeMasks:0,morphTextures:0,totalTarget:0,totalTargetExpected:B.o,renderBuffers:0,renderBuffersExpected:B.j},n=0,i=this.m_scratchBuffers||[];n<i.length;n++){var a=i[n];r.scratchBuffers+=a.getMemoryUsage()}for(var o=0,s=L.h||[];o<s.length;o++){var c=s[o];r.glyphPages+=c.getMemoryUsage()}for(var u=0,h=e;u<h.length;u++)ze(this,h[u],r);for(var l=0,f=t||[];l<f.length;l++)He(this,f[l],r);return r.totalTarget=r.scratchBuffers+r.glyphPages+r.shapeDistanceFields+r.textDistanceFields+r.otherBrushes+r.effects+r.rasterizedItems+r.fadeMasks+r.morphTextures,r},e.prototype.initOutOfTime=function(){return this.m_initDeadline&&this.m_initDeadline<performance.now()},e.prototype.render=function(e,t,r){var n=this.m_graphicsProcessor;if(n){var i=performance.now();if(!n||n.beginRenderScope()){var a=new F.a;a.glResetCostMs+=performance.now()-i,a.beginTime=(new Date).getTime(),this.m_currentFramePerformanceSummary=a,a.totalCostMs=-performance.now(),this.tryPrepareItemInWebGlScope(e,n,!0,void 0)||l.a.Error(592525120,"could not fully prepare scene"),a.shapeRenderCostMs=-performance.now(),this.renderItemInWebGLRenderScope(e,t,r);var o=r&&r.target instanceof B.a?r&&r.target.size:n.getCurrentViewportSize();if(L.g&&Object(L.c)(n,o),a.shapeRenderCostMs+=performance.now(),a.glRestoreCostMs=-performance.now(),n.endRenderScope(),a.glRestoreCostMs+=performance.now(),a.totalCostMs+=performance.now(),a.endTime=(new Date).getTime(),this.m_perfSummary.perfInfoCurrentFrame=a,this.m_perfSummary.perfInfoFirstFrame||(this.m_perfSummary.perfInfoFirstFrame=a),this.m_perfSummary.perfInfoSumOfAllFrames||(this.m_perfSummary.perfInfoSumOfAllFrames=new F.a),this.m_perfSummary.perfInfoSumOfAllFrames.add(a),this.m_perfSummary.frameCount++,this.m_perfSummary.averageFrameCost=this.m_perfSummary.perfInfoSumOfAllFrames.totalCostMs/this.m_perfSummary.frameCount,this.m_perfSummary.viewWidth=o.x,this.m_perfSummary.viewHeight=o.y,this.m_perfSummary.frameCount>1){var s=(this.m_perfSummary.perfInfoSumOfAllFrames.totalCostMs-this.m_perfSummary.perfInfoFirstFrame.totalCostMs)/(this.m_perfSummary.frameCount-1);this.m_perfSummary.estimatedFps=Math.floor(Math.min(1e3/s,60))}else this.m_perfSummary.estimatedFps=Math.floor(Math.min(1e3/this.m_perfSummary.perfInfoCurrentFrame.shapeRenderCostMs,60));this.m_currentFramePerformanceSummary=new F.a}}else l.a.Error(592525091,"glContext must be provided")},e.prototype.renderItemInWebGLRenderScope=function(e,t,r){var n=this.m_graphicsProcessor;if(n){n.updateViewportSize();var i=r?r.target:void 0,o=i?i.size:n.getCurrentViewportSize(),s=r?r.transform:void 0,c=n.activateShaderProgram(1);c.begin(i?i.babylonTexture:void 0,t,!0),this.drawItem(31,c,e,o,a.a.Identity,void 0,s?s.toMatrix3():a.a.Identity,0,void 0,!1,r),c.end()}else l.a.Error(592525121,"glContext must be provided")},e.prototype.renderMorph=function(e,t,r,n){if(!this.m_morphPlayer)throw l.a.Error(591667344,"Morph not available for this renderer");this.m_morphPlayer.renderMorph(this,e,t,r,n)},e.prototype.tryPrepareMorph=function(e,t){if(!this.m_morphPlayer)throw l.a.Error(591667345,"Morph not available for this renderer");return this.m_morphPlayer.tryPrepareMorph(this,e,t)},e.prototype.tryGetImageDebugDataForMorphKeyFrame=function(e){var t=this.ensureMorphKeyFrameRenderData(e);return t.texture?new k(1,t.texture):void 0},e.prototype.renderLayers=function(e,t,r){var n=this.m_graphicsProcessor;if(n){if(!n||n.beginRenderScope()){var i=this.m_targetTexture?this.m_targetTexture.size:n.getCurrentViewportSize(),a=n.activateShaderProgram(1);a.begin(this.m_targetTexture?this.m_targetTexture.babylonTexture:void 0,t,!0),I.g&&a.clearAndEnbaleDepthBuffer();for(var o=0;o<e.length;o++){var s=e[o];Object(I.e)(s,a,i,r?r.toMatrix3():void 0,void 0)}a.end(),n.endRenderScope()}}else l.a.Error(592525125,"glContext must be provided")},e.prototype.retrieveHitTestResult=function(e,t,r,n){if(t==r.index){var i={itemHit:e,itemStack:[e],textHit:void 0};if(e instanceof f.d){var o=e.text;if(o){var s=n.transformPoint(a.a.FromTransforms(new a.c(e.transform.translation.negate(),e.transform.scale.inverse()),o.frameToShape.toInverseMatrix3(),o.layoutToFrame.toInverseMatrix3()));i.textHit=o.hitTest(s)?o.getSelectionFromLayoutPosition(s):void 0}}return i}if(e instanceof f.b)for(var c=0,u=e.items.elements;c<u.length;c++){var h=u[c];r.next();var l=this.retrieveHitTestResult(h,t,r,n.transformPoint(e.transform.toInverseMatrix3()));if(l&&l.itemStack)return l.itemStack.splice(0,0,e),l}},e.prototype.hitTestScene=function(e,t,r,n){var i=this.m_graphicsProcessor;if(!i)return l.a.Error(592525129,"glContext must be provided"),Me;if(2!=e.getType())return l.a.Error(592525130,"rootItem must be a group"),Me;var o=e;if(!i.beginRenderScope())return Me;this.tryPrepareItemInWebGlScope(e,i,!0,void 0)||l.a.Error(592525131,"could not fully prepare"),this.m_hitTestTexture&&this.m_hitTestTexture.isValid(this)||(this.m_hitTestTexture=new B.a(this,a.d.One,!0,!1));var s=new ke,u=i.activateShaderProgram(1);u.begin(this.m_hitTestTexture.babylonTexture,c.b.Transparent,!0);var h=a.d.One,f=r?r.toMatrix3().multiply(a.a.Translation2D(t.negate())):a.a.Translation2D(t.negate());this.drawItem(0,u,o,h,a.a.Identity,void 0,f,4,s,!1,{filter:n}),u.end();var d=this.m_hitTestTexture&&this.m_hitTestTexture.babylonTexture?i.copyTexturePixelsToArray(this.m_hitTestTexture.babylonTexture,new a.b(0,0,1,1),!0):void 0;if(i.endRenderScope(),!d||0==d[3])return Me;var p=d[0]+256*d[1]+65536*d[2];s=new ke;var g=r instanceof a.a?r.tryGetTransform(a.d.Zero):r,_=g?g.toInverseMatrix3():void 0,m=this.retrieveHitTestResult(o,p,s,_?t.transformPoint(_):t);if(m)return m;throw l.a.Error(592525132,"Unable to retrieve hit shape")},e.prototype.hasHitTestTexture=function(){return null!=this.m_hitTestTexture},e.prototype.tryInitTextures=function(e,t,r,n,i){if(t.isHidden)return!0;var o=this.ensureRenderNode(t);o.cache.checkIfUpdateNeeded(t,e);var u=new Ne(n,t,o,i);if(1==t.getType()){var h=t;if(h.incrementalPath&&(o.cache.initTextureStage=W.fromBegining),o.cache.initTextureStage<W.distanceFieldsReady){if(h.incrementalPath)o.cache.distanceFields&&1==o.cache.distanceFields.length||(o.cache.distanceFields=[new L.a(this,void 0,0)]);else if(h.paths&&!o.cache.distanceFields&&!h.isSolidRect()){var f=-performance.now();if(o.cache.distanceFields=[],h.paths&&h.paths.length>0)for(var d=0,p=0,g=h.paths[0].fillMode,_=0;_<h.paths.length;_++){var m=_==h.paths.length-1,b=m?0:h.paths[_+1].fillMode;(m||b!=g)&&(!h.style.hasLine||0==h.style.pen.headEnd.end&&0==h.style.pen.tailEnd.end?o.cache.distanceFields.push(new L.a(this,s.j.FromFirstLast(d,p),g,h.mergeMode,0)):(0!=g&&null!=h.style.fillBrush&&o.cache.distanceFields.push(new L.a(this,s.j.FromFirstLast(d,p),g,h.mergeMode,1)),o.cache.distanceFields.push(new L.a(this,s.j.FromFirstLast(d,p),g,h.mergeMode,2))),g=b,d=_+1),p=_+1}if(f+=performance.now(),3==h.role?this.m_currentFramePerformanceSummary.distanceFieldForTextCostMs+=f:this.m_currentFramePerformanceSummary.distanceFieldForShapeCostMs+=f,this.initOutOfTime())return!1}for(var y=0,v=o.cache.distanceFields||[];y<v.length;y++){var T=v[y],x=(f=-performance.now(),null!=h.incrementalPath),E=T.refresh(this,t,!0,x);if(!E&&x&&(E=T.refresh(this,t,!0,!1)),E||l.a.Error(592525133,"error in distanceField refresh"),f+=performance.now(),3==h.role?this.m_currentFramePerformanceSummary.distanceFieldForTextCostMs+=f:this.m_currentFramePerformanceSummary.distanceFieldForShapeCostMs+=f,this.initOutOfTime())return!1}o.cache.initTextureStage=W.distanceFieldsReady}if(o.cache.initTextureStage<W.brushTexturesReady){if(o.cache.initBrushTexture(this,t,0),this.initOutOfTime())return!1;if(o.cache.initBrushTexture(this,t,1),this.initOutOfTime())return!1;if(o.cache.initBrushTexture(this,t,2),this.initOutOfTime())return!1;o.cache.initTextureStage=W.brushTexturesReady}if(h.text&&h.text.cache){for(var P=0,S=0,w=h.text.cache.textShapes||[];S<w.length;S++){var R=w[S];if(h.text.animationProps)if(R.textRange){var C=h.text.animationProps.getAt(R.textRange.start);R.fade=C.fade,R.animationTransform=C.animationTransform,R.isHidden=C.isHidden}else l.a.Error(592525134,"no range");else R.fade=void 0,R.animationTransform=a.a.Identity,R.isHidden=!1;if(!this.tryInitTextures(e,R,r,u,P))return!1;P++}for(var A=0,F=h.text.cache.selectionShapes||[];A<F.length;A++){var B=F[A];if(!this.tryInitTextures(e,B,r,u,0))return!1}}}else{if(2!=t.getType())throw l.a.Error(592525135,"Unknown Item type");if(o.cache.initTextureStage<W.brushTexturesReady&&(o.cache.initBrushTexture(this,t,0),o.cache.initTextureStage=W.brushTexturesReady),2==t.getType()){var O=t;for(_=0;_<O.items.length;_++){var I=O.items.getAt(_);if(I&&!this.tryInitTextures(e,I,r,u,_))return!1;if(this.initOutOfTime())return!1}}}var M=-performance.now();if(o.cache.fade=u.fade,o.cache.initFadeTexture(this,t,u.fade),M+=performance.now(),t.fade&&(this.m_currentFramePerformanceSummary.fadeTextureCostMs+=M),this.initOutOfTime())return!1;if(r&&o.cache.initTextureStage<W.effectsReady){if(t.effects){if(t.effects.innerShadow&&t.effects.innerShadow.color.a>0&&(!o.cache.innerShadowTexture||o.cache.innerShadowTexture.isDirty)&&(o.cache.innerShadowTexture=this.initTextureRasterizedItem(t,0,o.cache.innerShadowTexture,c.b.Black,t.effects.innerShadow.radius,8,2),this.initOutOfTime()))return!1;if(t.effects.softEdges&&t.effects.softEdges.radius>0&&(!o.cache.softEdgesTexture||o.cache.softEdgesTexture.isDirty)&&(o.cache.softEdgesTexture=this.initTextureRasterizedItem(t,0,o.cache.softEdgesTexture,c.b.Black,t.effects.softEdges.radius,16,3),this.initOutOfTime()))return!1;if(t.effects.glow&&t.effects.glow.radius>0&&t.effects.glow.color.a>0&&(!o.cache.glowTexture||o.cache.glowTexture.isDirty)&&(o.cache.glowTexture=this.initTextureRasterizedItem(t,16,o.cache.glowTexture,t.effects.glow.color,t.effects.glow.radius?2*t.effects.glow.radius:0,1,3),this.initOutOfTime()))return!1;if(t.effects.shadow&&t.effects.shadow.color.a>0&&(!o.cache.shadowTexture||o.cache.shadowTexture.isDirty)&&(o.cache.shadowTexture=this.initTextureRasterizedItem(t,17,o.cache.shadowTexture,t.effects.shadow.color,t.effects.shadow.radius?t.effects.shadow.radius:0,2,3),this.initOutOfTime()))return!1;if(t.effects.reflection&&(!o.cache.reflectionTexture||o.cache.reflectionTexture.isDirty)&&(o.cache.reflectionTexture=this.initTextureRasterizedItem(t,27,o.cache.reflectionTexture,void 0,t.effects.reflection.radius,4,3),this.initOutOfTime()))return!1}o.cache.initTextureStage=W.effectsReady}if(r)if(t.fade&&13!=t.fade.preset){if((!o.cache.spriteTexture||o.cache.spriteTexture.isDirty||this.hasAnimatedContentTexture(t))&&(o.cache.spriteTexture=this.initTextureRasterizedItem(t,31,o.cache.spriteTexture,void 0,0,0,1),this.initOutOfTime()))return!1}else o.cache.spriteTexture&&o.cache.spriteTexture.release(),o.cache.spriteTexture=void 0;return!0},e.prototype.tryPreparePaths=function(e){for(var t=0,r=e;t<r.length;t++){var n=r[t];if(this.ensurePathRenderData(n).refreshCachedTapeBuffers(n),this.initOutOfTime())return!1}return!0},e.prototype.tryPrepareGeneratedShapes=function(e){var t=this;return Object(f.f)(e,(function(e){return!e.text||(e.text.cache||(e.text.cache=new p),e.text.cache.update(e.text),!t.initOutOfTime())}))},e.prototype.tryPrepareTapes=function(e){var t=this;return Object(f.f)(e,(function(e){if(e.paths){if(!t.tryPreparePaths(e.paths))return!1;if(e.shapeBoundsCache.pathsBounds||e.style.hasLine||(e.shapeBoundsCache.pathsBounds=Object(u.c)(e.paths)),t.initOutOfTime())return!1}return!0}))},e.prototype.tryPrepareItemInWebGlScope=function(e,t,r,n){var i=performance.now();if(this.m_initDeadline=n?i+n:void 0,t){if(!t.tryPrepareProgramResourcesInWebGlScope(this.m_initDeadline))return!1}else Object(O.b)();if(!this.tryPrepareGeneratedShapes(e))return!1;if(!this.tryPrepareTapes(e))return!1;if(t){var a=!1;return Object(L.f)(this,e),this.initOutOfTime()||(a=this.tryInitTextures(t,e,r,void 0,0)),a}return!0},e.prototype.tryPrepareItem=function(e,t,r){var n=this.m_graphicsProcessor;if(!n)return l.a.Error(592525136,"glContext must be provided"),!1;if(!n.beginRenderScope())return!1;var i=this.tryPrepareItemInWebGlScope(e,n,t,r);return n.endRenderScope(),i},e.prototype.drawItem=function(e,t,r,n,i,o,s,c,u,h,l){void 0===h&&(h=!1);for(var f=0,d=r.instanceOffsets||[a.d.Zero];f<d.length;f++){var p=d[f];this.drawItemOnce(e,t,r,n,r.instanceOffsets?a.a.Translation2D(p).multiply(i):i,o,s,c,u,h,l)}},e.prototype.drawItemOnce=function(e,t,r,n,o,s,c,u,h,l,d){void 0===l&&(l=!1);var p=0==u||4==u,g=s||r.animationTransform,_=p&&g?o.multiply(g.multiply(c)):o.multiply(c);if(!(r.isHidden||d&&d.filter&&!d.filter(r))){var m=this.ensureRenderNode(r),b=m.cache?m.cache.fade:void 0;if(p&&m.cache.spriteTexture&&m.cache.spriteTexture.uvScale&&m.cache.spriteTexture.localBounds)(v=Ue(r))&&((S=new I.c(m.cache.spriteTexture,Object(B.p)(v,r.transform))).fadeInfo=p&&b?{fade:b,fadeTexture:m.cache.fadeTexture,fadeRect:void 0}:void 0,Object(I.e)(S,t,n,_,h?h.color:void 0));else{if(0!=e&&r.effects&&(r.effects.glow||r.effects.shadow||r.effects.reflection)&&i.a==i.b&&4!=u&&(!d||!d.textRange)){var y=void 0;(4&e&&r.effects.reflection||2&e&&r.effects.shadow)&&(y=r.effectsBoundsOverride?r.effectsBoundsOverride:Object(f.h)(r,!1,0,1));var v=Ue(r);if(4&e&&r.effects.reflection&&m.cache.reflectionTexture&&m.cache.reflectionTexture.uvScale&&m.cache.reflectionTexture.localBounds&&y&&v){var T=r.effects.reflection,x=y.bottom+T.distance/2;r instanceof f.d&&r.textEffectMetrics&&(x-=r.textEffectMetrics.descent);var E=a.a.Translation2D(new a.d(0,-x)).multiply(a.a.Scale2D(new a.d(1,-1))).multiply(a.a.Translation2D(new a.d(0,x))).multiply(_),P={opacity0:T.startAlpha,opacity1:T.endAlpha,y0:T.startPosition,y1:T.endPosition};(S=new I.c(m.cache.reflectionTexture,Object(B.p)(v,r.transform))).fadeInfo=p&&b?{fade:b,fadeTexture:m.cache.fadeTexture,fadeRect:void 0}:void 0,S.reflectionGradient=P,Object(I.e)(S,t,n,E,h?h.color:void 0)}if(2&e&&r.effects.shadow&&m.cache.shadowTexture&&m.cache.shadowTexture.uvScale&&m.cache.shadowTexture.localBounds&&y&&v){var S,w=Object(f.g)(r.effects.shadow.alignment,y),R=Object(f.j)(r.effects.shadow.angle,r.effects.shadow.distance,r.effects.shadow.scale,r.effects.shadow.skew,w);(S=new I.c(m.cache.shadowTexture,Object(B.p)(v,r.transform))).fadeInfo=p&&b?{fade:b,fadeTexture:m.cache.fadeTexture,fadeRect:void 0}:void 0,Object(I.e)(S,t,n,R.multiply(_),h?h.color:void 0)}1&e&&r.effects.glow&&m.cache.glowTexture&&m.cache.glowTexture.uvScale&&m.cache.glowTexture.localBounds&&v&&((S=new I.c(m.cache.glowTexture,Object(B.p)(v,r.transform))).fadeInfo=p&&b?{fade:b,fadeTexture:m.cache.fadeTexture,fadeRect:void 0}:void 0,Object(I.e)(S,t,n,_,h?h.color:void 0))}if(1==r.getType()){var C=r;if(!d||!d.textRange)if(C.isSolidRect())K(this,m.cache,void 0,e,t,C,n,_,u,h?h.color:void 0);else for(var A=0,F=m.cache.distanceFields||[];A<F.length;A++){var O=F[A];K(this,m.cache,O,e,t,C,n,_,u,h?h.color:void 0)}if(C.text&&C.text.cache&&(!d||!d.noSubtree||d.textRange)){var L=new a.c(a.d.Zero,a.d.One,C.transform.rotation,C.transform.translation),M=i.j?L.toMatrix3().multiply(o):L.toMatrix3(),D=i.j&&!C.text.animationProps?g:void 0,k=i.j?c:C.text.hasAnimationProps()?o.multiply(c):_;if(h)for(var N=0,G=C.text.cache.hitTestLineShapes||[];N<G.length;N++){var j=G[N];(!d||!d.textRange||j.textRange&&d.textRange.includes(j.textRange.start))&&this.drawItem(31,t,j,n,M,D,k,u,h,l)}else{for(var U=0,W=C.text.cache.textShapes||[];U<W.length;U++){var V=W[U];(!d||!d.textRange||V.textRange&&d.textRange.includes(V.textRange.start))&&this.drawItem(31,t,V,n,M,D,k,u,h,l)}if(0==u)for(var z=0,H=C.text.cache.selectionShapes||[];z<H.length;z++){var X=H[z];this.drawItem(31,t,X,n,M,D,k,u,h,l)}}}}else if(2==r.getType()&&(!d||!d.noSubtree&&!d.textRange)){var q=r;if(q)for(var Y=0;Y<q.items.length;Y++){var Q=q.items.getAt(Y);h&&h.next();var Z=i.j?q.transform.toMatrix3().multiply(o):a.a.Identity,J=i.j?g:void 0,$=i.j?c:q.transform.toMatrix3().multiply(_);this.drawItem(31,t,Q,n,Z,J,$,u,h,l,d)}}}}},e.prototype.renderToTexture=function(e,t,r,n,i,o,s){n&&n.size.equals(i)||(n=new B.a(this,i,!0,!1));var u=e.activateShaderProgram(1);return u.begin(n.babylonTexture,c.b.Transparent,!0),this.drawItemOnce(r,u,t,i,a.a.Identity,void 0,o.toMatrix3(),s,void 0),u.end(),n},e.prototype.drawTextureToTexture=function(e,t,r){var n=this.m_graphicsProcessor;if(!n)throw l.a.Error(592525137,"No Graphics Processor");var i=n.isInRenderScope();if(!i&&!n.beginRenderScope())throw l.a.Error(591541203,"Failed to begin RenderScope");var a=n.activateShaderProgram(1);a.begin(e.babylonTexture,c.b.Transparent,!0);var o=new I.c(t,{center:r.scale(.5),size:r,rotation:0,flipX:!1,flipY:!1});Object(I.e)(o,a,r),a.end(),i||n.endRenderScope()},e.prototype.initTextureRasterizedItem=function(e,t,r,n,i,o,s){var c=this.m_graphicsProcessor;if(!c)throw l.a.Error(591541204,"No Graphics Processor");var u=performance.now(),h=i?B.c*Math.min(1,4/Math.sqrt(i)):B.c,d=!!(4&o),p=!!(24&o),g=!(2==e.getType()&&e.isDocumentShape),_=d||g&&!p,m=Object(f.h)(e,_,t,31,e.transform.toInverseMatrix3().multiply(a.a.Scale2D(e.transform.scale)));if(m){var b=(m=m.inflate(Math.max(2/h,i))).size,y=m.center.divide(e.transform.scale).transformPoint(e.transform);if(b&&y){var v=Math.min(h,B.m/Math.max(b.x,b.y)),T=b.scale(v),x=i||n,E=new a.d(Object(a.e)(x?Object(a.h)(T.x):T.x,16,B.m),Object(a.e)(x?Object(a.h)(T.y):T.y,16,B.m)),P=Math.min(v,Math.min(E.x/b.x,E.y/b.y)),S=e.transform.scale.sign(),w=16==o||8==o?new a.c(y.negate(),new a.d(P,P).multiply(S),-e.transform.rotation*S.x*S.y,new a.d(E.x/2,E.y/2)):new a.c(y.negate(),new a.d(P,P),-e.transform.rotation,new a.d(E.x/2,E.y/2)),R=Ue(e);if(R){(r=this.renderToTexture(c,e,t,r,E,w,s))&&(r.uvScale=b.scale(P).divide(r.size),r.localBounds=m.multiply(e.transform.scale.inverse()),r.contentLocation={logicalCenter:R.center.transformPoint(e.transform).transformPoint(w),logicalSize:R.size.multiply(e.transform.scale).scale(P),physicalCenter:r.size.scale(.5),physicalSize:b.scale(P),rotation:0,flipX:!1,flipY:!1},x&&(r.generateMipMap(),Object(I.d)(this,r,i*P,o,n)));var C=performance.now()-u;return 3==s||2==s?this.m_currentFramePerformanceSummary.effectsCostMs+=C:1==s&&(this.m_currentFramePerformanceSummary.cacheToSpriteCostMs+=C),r&&(r.isDirty=!1),r}}}},e.prototype.hasAnimatedTextureContent=function(e){if(6==e.getType()){var t=this.getTextureFromImage(e.image);if(t)return t.animatedContent}return!1},e.prototype.hasAnimatedContentTexture=function(e){return e instanceof f.d&&(e.style.fillBrush&&this.hasAnimatedTextureContent(e.style.fillBrush)||e.style.lineBrush&&this.hasAnimatedTextureContent(e.style.lineBrush)||e.style.pictureBrush&&this.hasAnimatedTextureContent(e.style.pictureBrush))},e.prototype.preCompileShaderAsync=function(e){this.m_graphicsProcessor?this.m_graphicsProcessor.preCompileShaderAsync(e):l.a.Error(592525138,"Graphics Processor not initoalized")},e.prototype.preLinkShaderAsync=function(e){this.m_graphicsProcessor?this.m_graphicsProcessor.preLinkShaderAsync(e):l.a.Error(592525139,"Graphics Processor not initoalized")},e.prototype.getDebugString=function(e){return this.m_debugStringProvider?e instanceof f.c?this.m_debugStringProvider.getDebugStringForItem(e,this):e instanceof o.a?this.m_debugStringProvider.getDebugStringForMorph(e,this):"unsupported object":"no debug string provider"},e}();function Ue(e){return 1==e.getType()?Object(f.i)(e,!1):Object(f.h)(e,!1,0,0,e.transform.toInverseMatrix3())}function We(e,t){return e instanceof B.a?(e.needsRenderBuffer&&(t.renderBuffers+=e.getRenderBufferMemoryUsage()),e.getMemoryUsage()):e?e.size.x*e.size.y*4:0}function Ve(e,t){e&&(e instanceof B.a&&e.tag?t.otherBrushes+=We(e,t):e.ownsTexture?t.managedImages+=We(e,t):t.externalImages+=We(e,t))}function ze(e,t,r,n){void 0===n&&(n=!1);var i=e.ensureRenderNode(t);if(i.cache){for(var a=0,o=i.cache.distanceFields||[];a<o.length;a++){var s=o[a];n?r.textDistanceFields+=We(s,r):r.shapeDistanceFields+=We(s,r)}Ve(i.cache.fillTexture,r),Ve(i.cache.lineTexture,r),Ve(i.cache.pictureTexture,r),r.effects+=We(i.cache.innerShadowTexture,r),r.effects+=We(i.cache.softEdgesTexture,r),r.effects+=We(i.cache.glowTexture,r),r.effects+=We(i.cache.shadowTexture,r),r.effects+=We(i.cache.reflectionTexture,r),r.fadeMasks+=We(i.cache.fadeTexture,r),r.rasterizedItems+=We(i.cache.spriteTexture,r)}if(t instanceof f.d&&t.text&&t.text.cache){var c=t.text.cache;c.textShapes.forEach((function(t){ze(e,t,r,!0)})),c.hitTestLineShapes.forEach((function(t){ze(e,t,r,!0)})),c.selectionShapes&&c.selectionShapes.forEach((function(t){ze(e,t,r,!0)}))}t instanceof f.b&&t.items.elements.forEach((function(t){ze(e,t,r)}))}function He(e,t,r){for(var n=0,i=t.elements;n<i.length;n++)for(var a=0,o=i[n].keyFrames;a<o.length;a++){var s=o[a];if(s){var c=e.ensureMorphKeyFrameRenderData(s);c.texture&&(r.morphTextures+=We(c.texture,r))}}}function Xe(e){return void 0===e&&(e={}),new je(e)}r.d(t,"a",(function(){return Xe}))},function(e,t,r){"use strict";var n=r(2),i=2,a=function(){function e(e){this.webGLRestoreToDefault=!1,this.old_VERTEX_ATTRIB_ARRAY_ENABLED=new Array(i),this.webGLRestoreToDefault=e}return e.prototype.init=function(e){if(this.gl&&n.a.Error(591663577,"Previous Init has not been Restored"),this.gl=e,this.old_VIEWPORT=e.getParameter(e.VIEWPORT),!this.webGLRestoreToDefault){this.old_ACTIVE_TEXTURE=e.getParameter(e.ACTIVE_TEXTURE),this.old_ARRAY_BUFFER_BINDING=e.getParameter(e.ARRAY_BUFFER_BINDING),this.old_BLEND=e.getParameter(e.BLEND),this.old_BLEND_COLOR=e.getParameter(e.BLEND_COLOR),this.old_BLEND_DST_ALPHA=e.getParameter(e.BLEND_DST_ALPHA),this.old_BLEND_DST_RGB=e.getParameter(e.BLEND_DST_RGB),this.old_BLEND_EQUATION_ALPHA=e.getParameter(e.BLEND_EQUATION_ALPHA),this.old_BLEND_EQUATION_RGB=e.getParameter(e.BLEND_EQUATION_RGB),this.old_BLEND_SRC_ALPHA=e.getParameter(e.BLEND_SRC_ALPHA),this.old_BLEND_SRC_RGB=e.getParameter(e.BLEND_SRC_RGB),this.old_COLOR_CLEAR_VALUE=e.getParameter(e.COLOR_CLEAR_VALUE),this.old_COLOR_WRITEMASK=e.getParameter(e.COLOR_WRITEMASK),this.old_CULL_FACE=e.getParameter(e.CULL_FACE),this.old_CULL_FACE_MODE=e.getParameter(e.CULL_FACE_MODE),this.old_CURRENT_PROGRAM=e.getParameter(e.CURRENT_PROGRAM),this.old_DEPTH_CLEAR_VALUE=e.getParameter(e.DEPTH_CLEAR_VALUE),this.old_DEPTH_FUNC=e.getParameter(e.DEPTH_FUNC),this.old_DEPTH_RANGE=e.getParameter(e.DEPTH_RANGE),this.old_DEPTH_TEST=e.getParameter(e.DEPTH_TEST),this.old_DEPTH_WRITEMASK=e.getParameter(e.DEPTH_WRITEMASK),this.old_DITHER=e.getParameter(e.DITHER),this.old_ELEMENT_ARRAY_BUFFER_BINDING=e.getParameter(e.ELEMENT_ARRAY_BUFFER_BINDING),this.old_FRAMEBUFFER_BINDING=e.getParameter(e.FRAMEBUFFER_BINDING),this.old_FRONT_FACE=e.getParameter(e.FRONT_FACE),this.old_GENERATE_MIPMAP_HINT=e.getParameter(e.GENERATE_MIPMAP_HINT),this.old_LINE_WIDTH=e.getParameter(e.LINE_WIDTH),this.old_PACK_ALIGNMENT=e.getParameter(e.PACK_ALIGNMENT),this.old_POLYGON_OFFSET_FACTOR=e.getParameter(e.POLYGON_OFFSET_FACTOR),this.old_POLYGON_OFFSET_FILL=e.getParameter(e.POLYGON_OFFSET_FILL),this.old_POLYGON_OFFSET_UNITS=e.getParameter(e.POLYGON_OFFSET_UNITS),this.old_RENDERBUFFER_BINDING=e.getParameter(e.RENDERBUFFER_BINDING),this.old_SAMPLE_COVERAGE_INVERT=e.getParameter(e.SAMPLE_COVERAGE_INVERT),this.old_SAMPLE_COVERAGE_VALUE=e.getParameter(e.SAMPLE_COVERAGE_VALUE),this.old_SCISSOR_BOX=e.getParameter(e.SCISSOR_BOX),this.old_SCISSOR_TEST=e.getParameter(e.SCISSOR_TEST),this.old_STENCIL_BACK_FAIL=e.getParameter(e.STENCIL_BACK_FAIL),this.old_STENCIL_BACK_FUNC=e.getParameter(e.STENCIL_BACK_FUNC),this.old_STENCIL_BACK_PASS_DEPTH_FAIL=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_FAIL),this.old_STENCIL_BACK_PASS_DEPTH_PASS=e.getParameter(e.STENCIL_BACK_PASS_DEPTH_PASS),this.old_STENCIL_BACK_REF=e.getParameter(e.STENCIL_BACK_REF),this.old_STENCIL_BACK_VALUE_MASK=e.getParameter(e.STENCIL_BACK_VALUE_MASK),this.old_STENCIL_BACK_WRITEMASK=e.getParameter(e.STENCIL_BACK_WRITEMASK),this.old_STENCIL_CLEAR_VALUE=e.getParameter(e.STENCIL_CLEAR_VALUE),this.old_STENCIL_FAIL=e.getParameter(e.STENCIL_FAIL),this.old_STENCIL_FUNC=e.getParameter(e.STENCIL_FUNC),this.old_STENCIL_PASS_DEPTH_FAIL=e.getParameter(e.STENCIL_PASS_DEPTH_FAIL),this.old_STENCIL_PASS_DEPTH_PASS=e.getParameter(e.STENCIL_PASS_DEPTH_PASS),this.old_STENCIL_REF=e.getParameter(e.STENCIL_REF),this.old_STENCIL_TEST=e.getParameter(e.STENCIL_TEST),this.old_STENCIL_VALUE_MASK=e.getParameter(e.STENCIL_VALUE_MASK),this.old_STENCIL_WRITEMASK=e.getParameter(e.STENCIL_WRITEMASK),this.old_TEXTURE_BINDING_2D=e.getParameter(e.TEXTURE_BINDING_2D),this.old_TEXTURE_BINDING_CUBE_MAP=e.getParameter(e.TEXTURE_BINDING_CUBE_MAP),this.old_UNPACK_ALIGNMENT=e.getParameter(e.UNPACK_ALIGNMENT),this.old_UNPACK_COLORSPACE_CONVERSION_WEBGL=e.getParameter(e.UNPACK_COLORSPACE_CONVERSION_WEBGL),this.old_UNPACK_FLIP_Y_WEBGL=e.getParameter(e.UNPACK_FLIP_Y_WEBGL),this.old_UNPACK_PREMULTIPLY_ALPHA_WEBGL=e.getParameter(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL);for(var t=0;t<i;t++)this.old_VERTEX_ATTRIB_ARRAY_ENABLED[t]=e.getVertexAttrib(t,e.VERTEX_ATTRIB_ARRAY_ENABLED)}},e.prototype.setDefaults=function(){if(this.gl){this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.disable(this.gl.BLEND),this.gl.blendColor(0,0,0,0),this.gl.blendEquation(this.gl.FUNC_ADD),this.gl.blendFunc(this.gl.ONE,this.gl.ZERO),this.gl.clearColor(0,0,0,0),this.gl.colorMask(!0,!0,!0,!0),this.gl.disable(this.gl.CULL_FACE),this.gl.cullFace(this.gl.BACK),this.gl.useProgram(null),this.gl.clearDepth(1),this.gl.depthFunc(this.gl.LESS),this.gl.depthRange(0,1),this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(!0),this.gl.disable(this.gl.DITHER),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this.gl.frontFace(this.gl.CCW),this.gl.hint(this.gl.GENERATE_MIPMAP_HINT,this.gl.DONT_CARE),this.gl.lineWidth(1),this.gl.polygonOffset(0,0),this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,null),this.gl.sampleCoverage(1,!1),this.gl.scissor(0,0,this.old_VIEWPORT[2],this.old_VIEWPORT[3]),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.stencilFunc(this.gl.ALWAYS,0,1),this.gl.stencilMask(255),this.gl.stencilOp(this.gl.KEEP,this.gl.KEEP,this.gl.KEEP),this.gl.clearStencil(0),this.gl.disable(this.gl.STENCIL_TEST),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,null),this.gl.pixelStorei(this.gl.PACK_ALIGNMENT,4),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,4),this.gl.pixelStorei(this.gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this.gl.BROWSER_DEFAULT_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,0),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,0),this.gl.viewport(this.old_VIEWPORT[0],this.old_VIEWPORT[1],this.old_VIEWPORT[2],this.old_VIEWPORT[3]);for(var e=0;e<i;e++)this.gl.disableVertexAttribArray(e)}else n.a.Error(591663578,"Trying to set default without Init")},e.prototype.restore=function(){if(this.gl){if(this.webGLRestoreToDefault)this.setDefaults();else{this.gl.activeTexture(this.old_ACTIVE_TEXTURE),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.old_ARRAY_BUFFER_BINDING),this.old_BLEND?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this.gl.blendColor(this.old_BLEND_COLOR[0],this.old_BLEND_COLOR[1],this.old_BLEND_COLOR[2],this.old_BLEND_COLOR[3]),this.gl.blendEquationSeparate(this.old_BLEND_EQUATION_RGB,this.old_BLEND_EQUATION_ALPHA),this.gl.blendFuncSeparate(this.old_BLEND_SRC_RGB,this.old_BLEND_DST_RGB,this.old_BLEND_SRC_ALPHA,this.old_BLEND_DST_ALPHA),this.gl.clearColor(this.old_COLOR_CLEAR_VALUE[0],this.old_COLOR_CLEAR_VALUE[1],this.old_COLOR_CLEAR_VALUE[2],this.old_COLOR_CLEAR_VALUE[3]),this.gl.colorMask(this.old_COLOR_WRITEMASK[0],this.old_COLOR_WRITEMASK[1],this.old_COLOR_WRITEMASK[2],this.old_COLOR_WRITEMASK[3]),this.old_CULL_FACE?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.cullFace(this.old_CULL_FACE_MODE),this.gl.useProgram(this.old_CURRENT_PROGRAM),this.gl.clearDepth(this.old_DEPTH_CLEAR_VALUE),this.gl.depthFunc(this.old_DEPTH_FUNC),this.gl.depthRange(this.old_DEPTH_RANGE[0],this.old_DEPTH_RANGE[1]),this.old_DEPTH_TEST?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this.gl.depthMask(this.old_DEPTH_WRITEMASK),this.old_DITHER?this.gl.enable(this.gl.DITHER):this.gl.disable(this.gl.DITHER),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this.old_ELEMENT_ARRAY_BUFFER_BINDING),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.old_FRAMEBUFFER_BINDING),this.gl.frontFace(this.old_FRONT_FACE),this.gl.hint(this.gl.GENERATE_MIPMAP_HINT,this.old_GENERATE_MIPMAP_HINT),this.gl.lineWidth(this.old_LINE_WIDTH),this.gl.pixelStorei(this.gl.PACK_ALIGNMENT,this.old_PACK_ALIGNMENT),this.gl.polygonOffset(this.old_POLYGON_OFFSET_FACTOR,this.old_POLYGON_OFFSET_UNITS),this.old_POLYGON_OFFSET_FILL?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this.gl.bindRenderbuffer(this.gl.RENDERBUFFER,this.old_RENDERBUFFER_BINDING),this.gl.sampleCoverage(this.old_SAMPLE_COVERAGE_VALUE,this.old_SAMPLE_COVERAGE_INVERT),this.gl.scissor(this.old_SCISSOR_BOX[0],this.old_SCISSOR_BOX[1],this.old_SCISSOR_BOX[2],this.old_SCISSOR_BOX[3]),this.old_SCISSOR_TEST?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this.gl.stencilFuncSeparate(this.gl.FRONT,this.old_STENCIL_FUNC,this.old_STENCIL_REF,this.old_STENCIL_VALUE_MASK),this.gl.stencilFuncSeparate(this.gl.BACK,this.old_STENCIL_BACK_FUNC,this.old_STENCIL_BACK_REF,this.old_STENCIL_BACK_VALUE_MASK),this.gl.stencilMaskSeparate(this.gl.FRONT,this.old_STENCIL_WRITEMASK),this.gl.stencilMaskSeparate(this.gl.BACK,this.old_STENCIL_BACK_WRITEMASK),this.gl.stencilOpSeparate(this.gl.FRONT,this.old_STENCIL_FAIL,this.old_STENCIL_PASS_DEPTH_FAIL,this.old_STENCIL_PASS_DEPTH_PASS),this.gl.stencilOpSeparate(this.gl.BACK,this.old_STENCIL_BACK_FAIL,this.old_STENCIL_BACK_PASS_DEPTH_FAIL,this.old_STENCIL_BACK_PASS_DEPTH_PASS),this.gl.clearStencil(this.old_STENCIL_CLEAR_VALUE),this.old_STENCIL_TEST?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this.gl.bindTexture(this.gl.TEXTURE_2D,this.old_TEXTURE_BINDING_2D),this.gl.bindTexture(this.gl.TEXTURE_CUBE_MAP,this.old_TEXTURE_BINDING_CUBE_MAP),this.gl.pixelStorei(this.gl.UNPACK_ALIGNMENT,this.old_UNPACK_ALIGNMENT),this.gl.pixelStorei(this.gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,this.old_UNPACK_COLORSPACE_CONVERSION_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,this.old_UNPACK_FLIP_Y_WEBGL),this.gl.pixelStorei(this.gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this.old_UNPACK_PREMULTIPLY_ALPHA_WEBGL),this.gl.viewport(this.old_VIEWPORT[0],this.old_VIEWPORT[1],this.old_VIEWPORT[2],this.old_VIEWPORT[3]);for(var e=0;e<i;e++)this.old_VERTEX_ATTRIB_ARRAY_ENABLED[e]?this.gl.enableVertexAttribArray(e):this.gl.disableVertexAttribArray(e)}this.gl=void 0}else n.a.Error(591663579,"Trying to Restore without Init")},e}();function o(e){return new a(!!e)}r.d(t,"a",(function(){return o}))},function(e,t,r){"use strict";r.r(t);var n=r(5);r.d(t,"TrackableArray",(function(){return n.b})),r.d(t,"ChangeTracker",(function(){return n.a}));var i=r(11);r.d(t,"Glow",(function(){return i.b})),r.d(t,"Shadow",(function(){return i.e})),r.d(t,"InnerShadow",(function(){return i.c})),r.d(t,"Reflection",(function(){return i.d})),r.d(t,"SoftEdges",(function(){return i.f})),r.d(t,"Effects",(function(){return i.a}));var a=r(23);r.d(t,"Fade",(function(){return a.a}));var o=r(0);r.d(t,"epsilon",(function(){return o.f})),r.d(t,"Vector2",(function(){return o.d})),r.d(t,"Matrix3",(function(){return o.a})),r.d(t,"Transform",(function(){return o.c})),r.d(t,"Rect",(function(){return o.b})),r.d(t,"getNearestPowerOfTwo",(function(){return o.h})),r.d(t,"getGreaterPowerOfTwo",(function(){return o.g})),r.d(t,"clamp",(function(){return o.e})),r.d(t,"mix",(function(){return o.k})),r.d(t,"measureQuadraticLength",(function(){return o.j})),r.d(t,"interpolateAngle",(function(){return o.i}));var s=r(4);r.d(t,"Item",(function(){return s.c})),r.d(t,"Shape",(function(){return s.d})),r.d(t,"Group",(function(){return s.b})),r.d(t,"forEachShape",(function(){return s.f})),r.d(t,"forEachPath",(function(){return s.e})),r.d(t,"getPenAlignment",(function(){return s.k})),r.d(t,"getBoundsOfPaths",(function(){return s.i})),r.d(t,"getBoundsForEffects",(function(){return s.h})),r.d(t,"getAlignmentPoint",(function(){return s.g})),r.d(t,"getEffectTransformsMatrix",(function(){return s.j})),r.d(t,"GetBrush",(function(){return s.a}));var c=r(13);r.d(t,"MorphKeyFrame",(function(){return c.c})),r.d(t,"MorphElement",(function(){return c.b})),r.d(t,"Morph",(function(){return c.a}));var u=r(6);r.d(t,"Path",(function(){return u.d})),r.d(t,"pathDistEpsilon",(function(){return u.i})),r.d(t,"getPointDataSize",(function(){return u.g})),r.d(t,"Figure",(function(){return u.a})),r.d(t,"FigureBuilder",(function(){return u.b})),r.d(t,"createFiguresFromPathString",(function(){return u.f})),r.d(t,"IncrementalPath",(function(){return u.c})),r.d(t,"calculateBoundsOfFigures",(function(){return u.e})),r.d(t,"isUntransformedRect",(function(){return u.h}));var h=r(10);r.d(t,"s_isAnimationTransformAbsolute",(function(){return h.j})),r.d(t,"setIsAnimationTransformAbsolute",(function(){return h.n})),r.d(t,"s_minLineWidth",(function(){return h.k})),r.d(t,"s_minLineWidthForArrowHead",(function(){return h.l})),r.d(t,"setMinLineWidth",(function(){return h.p})),r.d(t,"debug_OFF",(function(){return h.b})),r.d(t,"debug_edge",(function(){return h.d})),r.d(t,"debug_tape",(function(){return h.h})),r.d(t,"debug_fill",(function(){return h.e})),r.d(t,"debug_signed",(function(){return h.g})),r.d(t,"debug_relief",(function(){return h.f})),r.d(t,"debug_dash",(function(){return h.c})),r.d(t,"debug_thinLine",(function(){return h.i})),r.d(t,"debugMode",(function(){return h.a})),r.d(t,"setDebugMode",(function(){return h.m})),r.d(t,"setLogger",(function(){return h.o}));var l=r(1);r.d(t,"Color",(function(){return l.b})),r.d(t,"ImageContainer",(function(){return l.f})),r.d(t,"Brush",(function(){return l.a})),r.d(t,"SolidBrush",(function(){return l.j})),r.d(t,"GradientStop",(function(){return l.d})),r.d(t,"GradientBrush",(function(){return l.c})),r.d(t,"ImageBrush",(function(){return l.e})),r.d(t,"PatternBrush",(function(){return l.g})),r.d(t,"SpecialBrush",(function(){return l.k})),r.d(t,"PenEnd",(function(){return l.i})),r.d(t,"Pen",(function(){return l.h})),r.d(t,"Style",(function(){return l.l})),r.d(t,"getBrushImagesFromBrush",(function(){return l.m}));var f=r(9);r.d(t,"TextRange",(function(){return f.j})),r.d(t,"RangeDataPartition",(function(){return f.b})),r.d(t,"TrackableRangeDataPartition",(function(){return f.n})),r.d(t,"TextStroke",(function(){return f.m})),r.d(t,"TextRunAnimationProps",(function(){return f.k})),r.d(t,"PathingLine",(function(){return f.a})),r.d(t,"WarpingEnvelope",(function(){return f.o})),r.d(t,"TextImage",(function(){return f.f})),r.d(t,"TextCharacter",(function(){return f.d})),r.d(t,"TextBullet",(function(){return f.c})),r.d(t,"TextEffectMetrics",(function(){return f.e})),r.d(t,"TextLine",(function(){return f.h})),r.d(t,"TextParagraph",(function(){return f.i})),r.d(t,"TextSelectionHighlight",(function(){return f.l})),r.d(t,"TextLayout",(function(){return f.g})),r.d(t,"arrayPushIfNotThere",(function(){return f.p})),r.d(t,"runStartToRangeList",(function(){return f.q}))},function(e,t,r){"use strict";r.d(t,"a",(function(){return n}));var n,i=r(7),a=r(0),o=r(1),s=r(11),c=r(6),u=r(4),h=r(9),l=r(5),f=4096,d=914400,p=.01;!function(e){function t(t,i){if(!t)return a.c.Identity;var o=t.pt?r(t.pt).scale(i):void 0,s=t.s?n(t.s):new a.d(1,1),c=t.rSpecified?t.r*e.c_internalAngleToRadianFactor:void 0,u=t.t?r(t.t).scale(i):void 0;return new a.c(o,s,c,u)}function r(e){return new a.d(e.x,e.y)}function n(e,t){return void 0===t&&(t=0),new a.d(e.x||t,e.y||t)}function g(e){return new o.b(e[0]/255,e[1]/255,e[2]/255,e[3]/255)}function _(e){return new a.b(e.l,e.t,e.r,e.b)}function m(e){for(var t=[],r=0,n=e;r<n.length;r++){var i=n[r],a=i.pos,s=g(i.clr);t.push(new o.d(a,s))}return t.sort((function(e,t){return e.position-t.position})),t}function b(e){return!(!e||2!=e.length)&&0==Math.min(e[0].position,e[1].position)&&1==Math.max(e[0].position,e[1].position)}function y(t,r,n){switch(t.bt){case 0:return new o.j(o.b.Transparent);case 1:var i=g(t.Item.clr);return new o.j(i);case 2:var a=t.Item;if((h=new o.c(2)).isStretched=a.isStretched,h.rotateWithShape=a.rtSp,h.angle=a.ang*e.c_internalAngleToRadianFactor,a.ftrct&&(h.fillToRect=_(a.ftrct)),a.ffrct&&(h.fillFromRect=_(a.ffrct)),a.stops){var s=m(a.stops);h.gradientStops=s,h.isGammaCorrected=b(s)}return h;case 3:var c=t.Item;return(h=new o.c(3)).isStretched=c.isStretched,h.rotateWithShape=c.rtSp,h.angle=c.ang*e.c_internalAngleToRadianFactor,c.ftrct&&(h.fillToRect=_(c.ftrct)),c.ffrct&&(h.fillFromRect=_(c.ffrct)),c.stops&&(s=m(c.stops),h.gradientStops=s,h.isGammaCorrected=b(s)),h;case 4:var u=t.Item;return(h=new o.c(4)).isStretched=u.isStretched,h.rotateWithShape=u.rtSp,h.angle=u.ang*e.c_internalAngleToRadianFactor,u.ftrct&&(h.fillToRect=_(u.ftrct)),u.ffrct&&(h.fillFromRect=_(u.ffrct)),u.stops&&(s=m(u.stops),h.gradientStops=s,h.isGammaCorrected=b(s)),h;case 5:var h,l=t.Item;return(h=new o.c(5)).isStretched=l.isStretched,h.rotateWithShape=l.rtSp,h.angle=l.ang*e.c_internalAngleToRadianFactor,l.ftrct&&(h.fillToRect=_(l.ftrct)),l.ffrct&&(h.fillFromRect=_(l.ffrct)),l.stops&&(s=m(l.stops),h.gradientStops=s,h.isGammaCorrected=b(s)),h;case 7:var f=t.Item;return new o.g(f.type,g(f.clrFg),g(f.clrBg));case 6:return v(t.Item,r);case 8:case 9:n.Message(39084627,"unsupported Brush "+JSON.stringify(t))}return new o.j(o.b.Transparent)}function v(e,t){if(e.id){var r=new o.f;r.id=e.id;var n=new o.e(r);return n.wrapMode=e.wrpmd,n.alignment=e.algn,n.isStretched=e.isStretched,n.offset=new a.d(e.off.x,e.off.y),n.scale=new a.d(e.scale.x,e.scale.y),n.opacity=e.opcty,n.rotateWithShape=e.rotWShp,n.isStretched||(n.scale=n.scale.divide(new a.d(e.dpi.x,e.dpi.y)).scale(d*t),n.offset=n.offset.scale(t)),n}}function T(e){return{cap:e.capType,end:e.type,length:e.len,width:e.width,widthMin:e.widthMin}}function x(e,t,r){if(!e)return new o.l;var n,i;e.fillBrsh&&(n=y(e.fillBrsh,t,r)),e.outlnBrsh&&(i=y(e.outlnBrsh,t,r));var a=function(e,t,r,n){var i=new o.h(t*n);return i.lineHeight=r*n,e?(e.dtSpecified&&(i.dashType=e.dt),e.jtSpecified&&(i.lineJoin=e.jt),e.mlSpecified&&(i.miterLimit=e.ml),e.ctSpecified&&(i.compoundType=e.ct),e.atSpecified&&(i.alignment=e.at),e.doffSpecified&&(i.dashOffset=e.doff),e.dctSpecified&&(i.useRoundDash=1==e.dct),e.headEnd&&(i.headEnd=T(e.headEnd)),e.tailEnd&&(i.tailEnd=T(e.tailEnd)),e.tip&&(i.tipType=e.tip),i):i}(e.pen,e.lnWdth,e.lnHgth,t),s=new o.l(n,i,a);return e.pctBrush&&(s.pictureBrush=v(e.pctBrush,t)),e.blend&&(s.blendingMode=e.blend),s}function E(t,r,n){var i,o,c,u,h;if(t.glw){var l=t.glw.blrRd*r,f=g(t.glw.clr);i=new s.b(f,l)}if(t.otrSdw){var d=t.otrSdw;(o=new s.e(g(d.clr),d.blrRd*r,d.ang*e.c_internalAngleToRadianFactor,d.dst*r,new a.d(d.sx*n,d.sy*n),new a.d(d.kx,d.ky))).alignment=d.algn,o.shadowType=d.tp}if(t.inrSdw){var p=t.inrSdw;c=new s.c(g(p.clr),p.blrRd*r,p.ang*e.c_internalAngleToRadianFactor,p.dst*r)}if(t.rflctn){var _=t.rflctn;u=new s.d(_.blrRd*r,_.sAlph,_.sPos,_.eAlph,_.ePos,_.dst*r)}return t.sftEdg&&(h=new s.f(t.sftEdg.blrRd*r)),new s.a(i,o,c,u,h)}function P(e,r){var n=e.pts;if(n){var i,o,s=null==(i=e.f)?1:0==i?0:2==i?2:3==i?3:4==i?4:5==i?5:1;if(e.h>0){var u=JSON.parse("["+n+"]");o={figures:[new c.a(u,!1,e.h)]}}else o={figures:c.f(n)};return o.fillMode=s,o.lineEnabled=e.s,e.xfrm?o.transform=t(e.xfrm,r):o.transform=a.c.Identity,o.transform=o.transform.applyScaleAndTranslationBefore(new a.d(r,r),a.d.Zero),o}}function S(e,r,i){for(var o=[],s=e.xfrm?t(e.xfrm,r):a.c.Identity,u=e.fontInfo,h=0,l=e.glyphInstance;h<l.length;h++){var d=l[h];if(d.glyph&&i){var p=i.getGlyph(u,d.glyph);if(!p)continue;if(!p.clientData){var g=P(p.p,1);g&&(g.lineEnabled=!0,g.fillMode=1,g.glyphCacheId={fontId:u,glyphId:d.glyph},p.clientData=new c.d(g))}if(!p.clientData)continue;var _=n(d.scale,1).scale(r);_=_.scale(1/f);var m=n(d.off).scale(r),b=new c.d(p.clientData,s.applyScaleAndTranslationBefore(_,m));o.push(b)}}return o}function w(e){return new h.j(e.cp,e.len)}function R(e,t){var r=P(e,t);if(r){var n=r.figures.length?r.figures[0]:void 0;if(n)return n instanceof c.a?n:n.createFigure()}}function C(e,t){if(!e)return 0;switch(e){case 0:return 0;case 1:return 1;case 2:return 2;case 3:return 3;case 4:return 4;case 5:return 5;case 6:return 6;case 7:return 7;case 8:return 8;case 9:return 9;case 10:return 10;case 11:return 11;case 12:return 12;case 13:return 13;case 14:return 14;case 15:return 15;case 16:return 16}return t.Error(595637021,"Incorrect ShapeBuilder.TextStrokeType"),1}function A(e,t,r){for(var n=new l.b,i=0,a=e;i<a.length;i++){var o=a[i],s=x(o.style,t,r);n.push(new h.m(C(o.type,r),o.verticalCenter,o.thickness,s))}return n}function F(e,t,r,n,i,o){var s=o.getGlyph(i,e);if(s){if(!s.clientData){var u=P(s.p,1);u&&(u.lineEnabled=!0,u.fillMode=1,u.glyphCacheId={fontId:i,glyphId:e},s.clientData=new c.d(u))}if(s.clientData)return new c.d(s.clientData,new a.c(a.d.Zero,t,n,r))}}function B(t,r,i,o,s,c){for(var u=[],h=t.fi?t.fi.v:r,l=0,d=t.gi||[];l<d.length;l++){var p=d[l];if(p.g&&s){var g=p.s?n(p.s,1).scale(o/f):i||a.d.Zero;g.equals(a.d.Zero)&&c.Error(0,"No glyph scale");var _=n(p.o).scale(o),m=p.r?p.r.v*e.c_internalAngleToRadianFactor:0,b=F(p.g,g,_,m,h,s);b&&u.push(b)}}return u}function O(e,t,r,n,i,a,o){for(var s=[],u=0,l=e.g||[];u<l.length;u++){var f=l[u];s=s.concat(B(f,t,r,n,i,o))}for(var d=0,p=e.p||[];d<p.length;d++){var g=P(p[d],n);g&&s.push(new c.d(g))}var m,b=_(e.lb);if(e.i){var y=v(e.i.i,n),T=_(e.i.b);y&&y.image&&T&&(m=new h.f(y.image,T,a))}return new h.d(b,s,e.f?e.f.v:void 0,e.w?e.w.v:void 0,m)}function I(e,t,r,n,i,o,s){var c=w(e.rng),u=_(e.lbnd),l=new h.h(c,u),f=[];if(e.c)for(var d=0;d<e.c.length;d++){var p=O(e.c[d],t.getAt(l.localRange.start+d),r.getAt(l.localRange.start+d),n,i,o,s);p&&f.push(p)}else e.s&&e.s.v&&(f=function(e,t,r,n,i,o,s){for(var c=[],u=e.split(";"),l=0;l<u.length;l++){for(var f=u[l].split(/([A-VXYZ])/),d=f.length>0?f[0]:void 0,p=void 0,g=void 0,_=1;_<f.length-1;_+=2){var m=f[_];"L"==m&&(p=f[_+1]),"R"==m&&(g=f[_+1])}if(d&&p&&g){var b=parseFloat(p),y=parseFloat(g),v="W"==d,T=void 0;if(!v){var x=F(parseInt(d),i.getAt(o+l),new a.d(b,0),0,n.getAt(o+l),r);x&&(T=[x])}var E=new a.b(b,t.top,y,t.bottom);c.push(new h.d(E,T,!1,v))}else s.Error(0,"Wrong SimplifiedCharacterString: 0:"+d+", L:"+p+", R:"+g)}return c}(e.s.v,u,i,t,r,l.localRange.start,s));return l.characters=f,e.b&&(l.bender=function(e,t){return e.wenv?function(e,t){var r=R(e.tpp,t),n=R(e.btp,t);if(r&&n)return new h.o(_(e.rct),r,n,e.vrt)}(e.wenv,t):e.plin?function(e,t){var r=R(e.pth,t);if(r){var n=0==e.algn?0:2==e.algn?1:.5;return new h.a(_(e.rct),r,n,e.s,e.pvt,e.vrt)}}(e.plin,t):void 0}(e.b,n)),e.o&&(l.offset=new a.d(e.o.x,e.o.y)),l.fillBounds=_(e.fb),l.textEffectMetrics=new h.e(e.ea,e.ed,e.eh),l}function L(e,t,r,i,s){var c=new h.i(w(e.gr),new o.l(new o.g(27,o.b.Blue,o.b.Yellow)));e.o&&(c.offset=new a.d(e.o.x,e.o.y));for(var u=new h.b(""),l=0,d=e.fipr||[];l<d.length;l++){var p=d[l];u.set(p.fontInfo,w(p.range))}for(var g=new h.b(a.d.Zero),_=0,m=e.gspr||[];_<m.length;_++){var b=m[_];g.set(n(b.s,1).scale(r/f),w(b.rng))}e.blt&&(c.bullet=function(e,t,r,n,i,a){if(e.c){var o=O(e.c,t,void 0,r,n,i,a),s=x(e.style,r,a),c=e.fx?E(e.fx,r,1):void 0,u=e.stks&&e.stks.length>0?A(e.stks,r,a):void 0;return new h.c(o,s,c,u)}}(e.blt,e.blt.fi,r,t,i,s));for(var y=new Array,v=0,T=e.l||[];v<T.length;v++){var P=I(T[v],u,g,r,t,i,s);P&&y.push(P)}for(var S=0,R=e.spr||[];S<R.length;S++){var C=R[S],F=x(C.style,r,s);c.stylePerLocalRange.set(F,w(C.range))}for(var B=0,L=e.stkspr||[];B<L.length;B++){var M=L[B],D=A(M.textStrokeList,r,s);D?c.strokesPerLocalRange.set(D,w(M.range)):s.Error(39084627,"Unable to convert stroke")}for(var k=0,N=e.lwrng||[];k<N.length;k++){var G=N[k];c.addLocalWordRange(w(G))}for(var j=0,U=e.fxpr||[];j<U.length;j++){var W=U[j];c.effectsPerLocalRange.set(E(W.fx,r,1),w(W.range))}return c.lines=y,c}function M(e,r,n,i,o){var s=new h.g,c=new a.c(i.translation.negate(),a.d.One,-i.rotation,a.d.Zero);return s.paragraphs=function(e,t,r,n,i){for(var a=[],o=0,s=e||[];o<s.length;o++){var c=s[o];a.push(L(c,t,r,n,i))}return a}(e.p,r,n,c,o),s.layoutToFrame=t(e.ltfxfrm,n),s.frameToShape=t(e.ftsxfrm,n),s}function D(e,r,n,o,h){try{if(!e)return;var l=[],f=t(e.xfrm,o),d=new Array;if(r)for(var g=0,_=r;g<_.length;g++){var m=_[g];if(m){var b=P(m,o);b&&d.push(new c.d(b))}}e.tx&&function(e,r,n,i,a,o){for(var s=0,h=e;s<h.length;s++){var l=h[s];if(l.primitives){for(var f=new Array,d=0,p=l.primitives;d<p.length;d++){var g=p[d];if(g.p&&g.p.pts&&g.p.pts.length){var _=P(g.p,i);if(!_)continue;_.lineEnabled=!0,_.fillMode=1,f.push(new c.d(_))}else if(g.r){var m=S(g.r,i,n);f.push.apply(f,m)}}var b=x(l.style,1,o),y=t(l.xfrm,i),v=new u.d(f,b,void 0,y);v.overlapMode=1,v.mergeMode=l.union?1:0,v.role=3,a.push(v)}}}(e.tx,0,n,o,l,h);var y=x(e.style,o,h),v=e.fx?E(e.fx,o,p):void 0;if(e.tx){var T=v?new s.a(void 0,void 0,v.innerShadow,void 0,v.softEdges):void 0,w=v?new s.a(v.glow,v.shadow,void 0,v.reflection,void 0):void 0,R=new u.d(d,y,T,f);return e.tl&&(R.text=M(e.tl,n,o,f,h)),new u.b(Object(i.e)([R],l),w)}var C=new u.d(d,y,v,f);if(e.tl&&(C.text=M(e.tl,n,o,f,h)),void 0!==e.ioff){for(var A=[],F=0,B=e.ioff;F<B.length;F++){var O=B[F],I=new a.d(O.x*o,O.y*o);A.push(I)}A.length>0&&(C.instanceOffsets=A)}return C}catch(e){h.Error(595637020,"Unexpected exception parsing shape")}}function k(e){return e.clientData||(e.clientData={}),e.clientData}e.c_internalAngleToRadianFactor=2*Math.PI/216e5,e.getPresWidthAndHeightJson=function(e){return new a.d(e.w,e.h)},e.convertDocShapeOrGroup=function e(t,r,n,i){if(t){var a=t.bapi&&t.bapi.v||"";if(t.Items){for(var o=[],s=0,c=t.Items;s<c.length;s++){var h=e(c[s],r,n,i);h&&o.push(h)}var l,f=t.fx?E(t.fx,n,p):void 0;return k(l=new u.b(o,f)).partId=a,l}return(l=D(t,t.pthLst||[],r,n,i))&&(k(l).partId=a),l}}}(n||(n={}))},function(e,t){}])}));
//# sourceMappingURL=ShapeBuilder.js.map